<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 3. Data Structure in Action – The Little Book of Algorithms</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../books/en-us/list-2.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-27c261d06b905028a18691de25d09dde.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../books/en-us/list-3.html"><span class="chapter-title">Chapter 3. Data Structure in Action</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">The Little Book of Algorithms</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Content</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../books/en-us/cheatsheet.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">The Cheatsheet</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../books/en-us/plan.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">The Plan</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../books/en-us/book.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">The Book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../books/en-us/list-1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 1. Foundatmemtions of Algorithms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../books/en-us/list-2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 2. Sorting and searching</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../books/en-us/list-3.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Chapter 3. Data Structure in Action</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#section-21.-arrays-linked-lists-stacks-queues" id="toc-section-21.-arrays-linked-lists-stacks-queues" class="nav-link active" data-scroll-target="#section-21.-arrays-linked-lists-stacks-queues">Section 21. Arrays, linked lists, stacks, queues</a>
  <ul class="collapse">
  <li><a href="#dynamic-array-resize" id="toc-dynamic-array-resize" class="nav-link" data-scroll-target="#dynamic-array-resize">201 Dynamic Array Resize</a></li>
  <li><a href="#circular-array-implementation" id="toc-circular-array-implementation" class="nav-link" data-scroll-target="#circular-array-implementation">202 Circular Array Implementation</a></li>
  <li><a href="#singly-linked-list-insertdelete" id="toc-singly-linked-list-insertdelete" class="nav-link" data-scroll-target="#singly-linked-list-insertdelete">203 Singly Linked List Insert/Delete</a></li>
  <li><a href="#doubly-linked-list-insertdelete" id="toc-doubly-linked-list-insertdelete" class="nav-link" data-scroll-target="#doubly-linked-list-insertdelete">204 Doubly Linked List Insert/Delete</a></li>
  <li><a href="#stack-pushpop" id="toc-stack-pushpop" class="nav-link" data-scroll-target="#stack-pushpop">205 Stack Push/Pop</a></li>
  <li><a href="#queue-enqueuedequeue" id="toc-queue-enqueuedequeue" class="nav-link" data-scroll-target="#queue-enqueuedequeue">206 Queue Enqueue/Dequeue</a></li>
  <li><a href="#deque-implementation" id="toc-deque-implementation" class="nav-link" data-scroll-target="#deque-implementation">207 Deque Implementation</a></li>
  <li><a href="#circular-queue" id="toc-circular-queue" class="nav-link" data-scroll-target="#circular-queue">208 Circular Queue</a></li>
  <li><a href="#stack-via-queue" id="toc-stack-via-queue" class="nav-link" data-scroll-target="#stack-via-queue">209 Stack via Queue</a></li>
  <li><a href="#queue-via-stack" id="toc-queue-via-stack" class="nav-link" data-scroll-target="#queue-via-stack">210 Queue via Stack</a></li>
  </ul></li>
  <li><a href="#section-22.-hash-tables-and-variants" id="toc-section-22.-hash-tables-and-variants" class="nav-link" data-scroll-target="#section-22.-hash-tables-and-variants">Section 22. Hash Tables and Variants</a>
  <ul class="collapse">
  <li><a href="#hash-table-insertion" id="toc-hash-table-insertion" class="nav-link" data-scroll-target="#hash-table-insertion">211 Hash Table Insertion</a></li>
  <li><a href="#linear-probing" id="toc-linear-probing" class="nav-link" data-scroll-target="#linear-probing">212 Linear Probing</a></li>
  <li><a href="#quadratic-probing" id="toc-quadratic-probing" class="nav-link" data-scroll-target="#quadratic-probing">213 Quadratic Probing</a></li>
  <li><a href="#double-hashing" id="toc-double-hashing" class="nav-link" data-scroll-target="#double-hashing">214 Double Hashing</a></li>
  <li><a href="#cuckoo-hashing" id="toc-cuckoo-hashing" class="nav-link" data-scroll-target="#cuckoo-hashing">215 Cuckoo Hashing</a></li>
  <li><a href="#robin-hood-hashing" id="toc-robin-hood-hashing" class="nav-link" data-scroll-target="#robin-hood-hashing">216 Robin Hood Hashing</a></li>
  <li><a href="#chained-hash-table" id="toc-chained-hash-table" class="nav-link" data-scroll-target="#chained-hash-table">217 Chained Hash Table</a></li>
  <li><a href="#perfect-hashing" id="toc-perfect-hashing" class="nav-link" data-scroll-target="#perfect-hashing">218 Perfect Hashing</a></li>
  <li><a href="#consistent-hashing" id="toc-consistent-hashing" class="nav-link" data-scroll-target="#consistent-hashing">219 Consistent Hashing</a></li>
  <li><a href="#dynamic-rehashing" id="toc-dynamic-rehashing" class="nav-link" data-scroll-target="#dynamic-rehashing">220 Dynamic Rehashing</a></li>
  </ul></li>
  <li><a href="#section-23.-heaps" id="toc-section-23.-heaps" class="nav-link" data-scroll-target="#section-23.-heaps">Section 23. Heaps</a>
  <ul class="collapse">
  <li><a href="#binary-heap-insert" id="toc-binary-heap-insert" class="nav-link" data-scroll-target="#binary-heap-insert">221 Binary Heap Insert</a></li>
  <li><a href="#binary-heap-delete" id="toc-binary-heap-delete" class="nav-link" data-scroll-target="#binary-heap-delete">222 Binary Heap Delete</a></li>
  <li><a href="#build-heap-heapify" id="toc-build-heap-heapify" class="nav-link" data-scroll-target="#build-heap-heapify">223 Build Heap (Heapify)</a></li>
  <li><a href="#heap-sort" id="toc-heap-sort" class="nav-link" data-scroll-target="#heap-sort">224 Heap Sort</a></li>
  <li><a href="#min-heap-implementation" id="toc-min-heap-implementation" class="nav-link" data-scroll-target="#min-heap-implementation">225 Min Heap Implementation</a></li>
  <li><a href="#max-heap-implementation" id="toc-max-heap-implementation" class="nav-link" data-scroll-target="#max-heap-implementation">226 Max Heap Implementation</a></li>
  <li><a href="#fibonacci-heap-insertdelete" id="toc-fibonacci-heap-insertdelete" class="nav-link" data-scroll-target="#fibonacci-heap-insertdelete">227 Fibonacci Heap Insert/Delete</a></li>
  <li><a href="#pairing-heap-merge" id="toc-pairing-heap-merge" class="nav-link" data-scroll-target="#pairing-heap-merge">228 Pairing Heap Merge</a></li>
  <li><a href="#binomial-heap-merge" id="toc-binomial-heap-merge" class="nav-link" data-scroll-target="#binomial-heap-merge">229 Binomial Heap Merge</a></li>
  <li><a href="#leftist-heap-merge" id="toc-leftist-heap-merge" class="nav-link" data-scroll-target="#leftist-heap-merge">230 Leftist Heap Merge</a></li>
  </ul></li>
  <li><a href="#section-24.-balanced-trees" id="toc-section-24.-balanced-trees" class="nav-link" data-scroll-target="#section-24.-balanced-trees">Section 24. Balanced Trees</a>
  <ul class="collapse">
  <li><a href="#avl-tree-insert" id="toc-avl-tree-insert" class="nav-link" data-scroll-target="#avl-tree-insert">231 AVL Tree Insert</a></li>
  <li><a href="#avl-tree-delete" id="toc-avl-tree-delete" class="nav-link" data-scroll-target="#avl-tree-delete">232 AVL Tree Delete</a></li>
  <li><a href="#red-black-tree-insert" id="toc-red-black-tree-insert" class="nav-link" data-scroll-target="#red-black-tree-insert">233 Red-Black Tree Insert</a></li>
  <li><a href="#red-black-tree-delete" id="toc-red-black-tree-delete" class="nav-link" data-scroll-target="#red-black-tree-delete">234 Red-Black Tree Delete</a></li>
  <li><a href="#splay-tree-access" id="toc-splay-tree-access" class="nav-link" data-scroll-target="#splay-tree-access">235 Splay Tree Access</a></li>
  <li><a href="#treap-insert" id="toc-treap-insert" class="nav-link" data-scroll-target="#treap-insert">236 Treap Insert</a></li>
  <li><a href="#treap-delete" id="toc-treap-delete" class="nav-link" data-scroll-target="#treap-delete">237 Treap Delete</a></li>
  <li><a href="#weight-balanced-tree" id="toc-weight-balanced-tree" class="nav-link" data-scroll-target="#weight-balanced-tree">238 Weight Balanced Tree</a></li>
  <li><a href="#scapegoat-tree-rebuild" id="toc-scapegoat-tree-rebuild" class="nav-link" data-scroll-target="#scapegoat-tree-rebuild">239 Scapegoat Tree Rebuild</a></li>
  <li><a href="#aa-tree" id="toc-aa-tree" class="nav-link" data-scroll-target="#aa-tree">240 AA Tree</a></li>
  </ul></li>
  <li><a href="#section-25.-segment-trees-and-fenwick-trees" id="toc-section-25.-segment-trees-and-fenwick-trees" class="nav-link" data-scroll-target="#section-25.-segment-trees-and-fenwick-trees">Section 25. Segment Trees and Fenwick Trees</a>
  <ul class="collapse">
  <li><a href="#build-segment-tree" id="toc-build-segment-tree" class="nav-link" data-scroll-target="#build-segment-tree">241 Build Segment Tree</a></li>
  <li><a href="#range-sum-query" id="toc-range-sum-query" class="nav-link" data-scroll-target="#range-sum-query">242 Range Sum Query</a></li>
  <li><a href="#range-update-lazy-propagation-technique" id="toc-range-update-lazy-propagation-technique" class="nav-link" data-scroll-target="#range-update-lazy-propagation-technique">243 Range Update (Lazy Propagation Technique)</a></li>
  <li><a href="#point-update" id="toc-point-update" class="nav-link" data-scroll-target="#point-update">244 Point Update</a></li>
  <li><a href="#fenwick-tree-build" id="toc-fenwick-tree-build" class="nav-link" data-scroll-target="#fenwick-tree-build">245 Fenwick Tree Build</a></li>
  <li><a href="#fenwick-update" id="toc-fenwick-update" class="nav-link" data-scroll-target="#fenwick-update">246 Fenwick Update</a></li>
  <li><a href="#fenwick-query" id="toc-fenwick-query" class="nav-link" data-scroll-target="#fenwick-query">247 Fenwick Query</a></li>
  <li><a href="#segment-tree-merge" id="toc-segment-tree-merge" class="nav-link" data-scroll-target="#segment-tree-merge">248 Segment Tree Merge</a></li>
  <li><a href="#persistent-segment-tree" id="toc-persistent-segment-tree" class="nav-link" data-scroll-target="#persistent-segment-tree">249 Persistent Segment Tree</a></li>
  <li><a href="#d-segment-tree" id="toc-d-segment-tree" class="nav-link" data-scroll-target="#d-segment-tree">250 2D Segment Tree</a></li>
  </ul></li>
  <li><a href="#section-26.-disjoint-set-union" id="toc-section-26.-disjoint-set-union" class="nav-link" data-scroll-target="#section-26.-disjoint-set-union">Section 26. Disjoint Set Union</a>
  <ul class="collapse">
  <li><a href="#make-set" id="toc-make-set" class="nav-link" data-scroll-target="#make-set">251 Make-Set</a></li>
  <li><a href="#find" id="toc-find" class="nav-link" data-scroll-target="#find">252 Find</a></li>
  <li><a href="#union" id="toc-union" class="nav-link" data-scroll-target="#union">253 Union</a></li>
  <li><a href="#union-by-rank" id="toc-union-by-rank" class="nav-link" data-scroll-target="#union-by-rank">254 Union by Rank</a></li>
  <li><a href="#path-compression" id="toc-path-compression" class="nav-link" data-scroll-target="#path-compression">255 Path Compression</a></li>
  <li><a href="#dsu-with-rollback" id="toc-dsu-with-rollback" class="nav-link" data-scroll-target="#dsu-with-rollback">256 DSU with Rollback</a></li>
  <li><a href="#dsu-on-tree" id="toc-dsu-on-tree" class="nav-link" data-scroll-target="#dsu-on-tree">257 DSU on Tree</a></li>
  <li><a href="#kruskals-mst-using-dsu" id="toc-kruskals-mst-using-dsu" class="nav-link" data-scroll-target="#kruskals-mst-using-dsu">258 Kruskal’s MST (Using DSU)</a></li>
  <li><a href="#connected-components-using-dsu" id="toc-connected-components-using-dsu" class="nav-link" data-scroll-target="#connected-components-using-dsu">259 Connected Components (Using DSU)</a></li>
  <li><a href="#offline-query-dsu" id="toc-offline-query-dsu" class="nav-link" data-scroll-target="#offline-query-dsu">260 Offline Query DSU</a></li>
  </ul></li>
  <li><a href="#section-27.-probabilistic-data-structure" id="toc-section-27.-probabilistic-data-structure" class="nav-link" data-scroll-target="#section-27.-probabilistic-data-structure">Section 27. Probabilistic Data Structure</a>
  <ul class="collapse">
  <li><a href="#bloom-filter-insert" id="toc-bloom-filter-insert" class="nav-link" data-scroll-target="#bloom-filter-insert">261 Bloom Filter Insert</a></li>
  <li><a href="#bloom-filter-query" id="toc-bloom-filter-query" class="nav-link" data-scroll-target="#bloom-filter-query">262 Bloom Filter Query</a></li>
  <li><a href="#counting-bloom-filter" id="toc-counting-bloom-filter" class="nav-link" data-scroll-target="#counting-bloom-filter">263 Counting Bloom Filter</a></li>
  <li><a href="#cuckoo-filter" id="toc-cuckoo-filter" class="nav-link" data-scroll-target="#cuckoo-filter">264 Cuckoo Filter</a></li>
  <li><a href="#count-min-sketch" id="toc-count-min-sketch" class="nav-link" data-scroll-target="#count-min-sketch">265 Count-Min Sketch</a></li>
  <li><a href="#hyperloglog" id="toc-hyperloglog" class="nav-link" data-scroll-target="#hyperloglog">266 HyperLogLog</a></li>
  <li><a href="#flajoletmartin-algorithm" id="toc-flajoletmartin-algorithm" class="nav-link" data-scroll-target="#flajoletmartin-algorithm">267 Flajolet–Martin Algorithm</a></li>
  <li><a href="#minhash" id="toc-minhash" class="nav-link" data-scroll-target="#minhash">268 MinHash</a></li>
  <li><a href="#what-problem-are-we-solving-67" id="toc-what-problem-are-we-solving-67" class="nav-link" data-scroll-target="#what-problem-are-we-solving-67">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-32" id="toc-how-it-works-plain-language-32" class="nav-link" data-scroll-target="#how-it-works-plain-language-32">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-4" id="toc-example-step-by-step-4" class="nav-link" data-scroll-target="#example-step-by-step-4">Example (Step by Step)</a></li>
  <li><a href="#visualization-14" id="toc-visualization-14" class="nav-link" data-scroll-target="#visualization-14">Visualization</a></li>
  <li><a href="#tiny-code-easy-version-7" id="toc-tiny-code-easy-version-7" class="nav-link" data-scroll-target="#tiny-code-easy-version-7">Tiny Code (Easy Version)</a></li>
  <li><a href="#why-it-matters-67" id="toc-why-it-matters-67" class="nav-link" data-scroll-target="#why-it-matters-67">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-67" id="toc-a-gentle-proof-why-it-works-67" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-67">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-67" id="toc-try-it-yourself-67" class="nav-link" data-scroll-target="#try-it-yourself-67">Try It Yourself</a></li>
  <li><a href="#test-cases-67" id="toc-test-cases-67" class="nav-link" data-scroll-target="#test-cases-67">Test Cases</a></li>
  <li><a href="#complexity-67" id="toc-complexity-67" class="nav-link" data-scroll-target="#complexity-67">Complexity</a></li>
  <li><a href="#reservoir-sampling" id="toc-reservoir-sampling" class="nav-link" data-scroll-target="#reservoir-sampling">269 Reservoir Sampling</a></li>
  <li><a href="#what-problem-are-we-solving-68" id="toc-what-problem-are-we-solving-68" class="nav-link" data-scroll-target="#what-problem-are-we-solving-68">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-33" id="toc-how-it-works-plain-language-33" class="nav-link" data-scroll-target="#how-it-works-plain-language-33">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-5" id="toc-example-step-by-step-5" class="nav-link" data-scroll-target="#example-step-by-step-5">Example (step by step)</a></li>
  <li><a href="#mathematical-intuition" id="toc-mathematical-intuition" class="nav-link" data-scroll-target="#mathematical-intuition">Mathematical Intuition</a></li>
  <li><a href="#visualization-15" id="toc-visualization-15" class="nav-link" data-scroll-target="#visualization-15">Visualization</a></li>
  <li><a href="#tiny-code-easy-version-8" id="toc-tiny-code-easy-version-8" class="nav-link" data-scroll-target="#tiny-code-easy-version-8">Tiny Code (Easy Version)</a></li>
  <li><a href="#why-it-matters-68" id="toc-why-it-matters-68" class="nav-link" data-scroll-target="#why-it-matters-68">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-68" id="toc-a-gentle-proof-why-it-works-68" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-68">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-68" id="toc-try-it-yourself-68" class="nav-link" data-scroll-target="#try-it-yourself-68">Try It Yourself</a></li>
  <li><a href="#test-cases-68" id="toc-test-cases-68" class="nav-link" data-scroll-target="#test-cases-68">Test Cases</a></li>
  <li><a href="#complexity-68" id="toc-complexity-68" class="nav-link" data-scroll-target="#complexity-68">Complexity</a></li>
  <li><a href="#skip-bloom-filter" id="toc-skip-bloom-filter" class="nav-link" data-scroll-target="#skip-bloom-filter">270 Skip Bloom Filter</a></li>
  <li><a href="#what-problem-are-we-solving-69" id="toc-what-problem-are-we-solving-69" class="nav-link" data-scroll-target="#what-problem-are-we-solving-69">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-34" id="toc-how-it-works-plain-language-34" class="nav-link" data-scroll-target="#how-it-works-plain-language-34">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-6" id="toc-example-step-by-step-6" class="nav-link" data-scroll-target="#example-step-by-step-6">Example (Step by Step)</a></li>
  <li><a href="#visualization-16" id="toc-visualization-16" class="nav-link" data-scroll-target="#visualization-16">Visualization</a></li>
  <li><a href="#tiny-code-simplified-python" id="toc-tiny-code-simplified-python" class="nav-link" data-scroll-target="#tiny-code-simplified-python">Tiny Code (Simplified Python)</a></li>
  <li><a href="#why-it-matters-69" id="toc-why-it-matters-69" class="nav-link" data-scroll-target="#why-it-matters-69">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-69" id="toc-a-gentle-proof-why-it-works-69" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-69">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-69" id="toc-try-it-yourself-69" class="nav-link" data-scroll-target="#try-it-yourself-69">Try It Yourself</a></li>
  <li><a href="#test-cases-69" id="toc-test-cases-69" class="nav-link" data-scroll-target="#test-cases-69">Test Cases</a></li>
  <li><a href="#complexity-69" id="toc-complexity-69" class="nav-link" data-scroll-target="#complexity-69">Complexity</a></li>
  </ul></li>
  <li><a href="#section-28.-skip-lists-and-b-trees" id="toc-section-28.-skip-lists-and-b-trees" class="nav-link" data-scroll-target="#section-28.-skip-lists-and-b-trees">Section 28. Skip Lists and B-Trees</a>
  <ul class="collapse">
  <li><a href="#skip-list-insert" id="toc-skip-list-insert" class="nav-link" data-scroll-target="#skip-list-insert">271 Skip List Insert</a></li>
  <li><a href="#what-problem-are-we-solving-70" id="toc-what-problem-are-we-solving-70" class="nav-link" data-scroll-target="#what-problem-are-we-solving-70">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-35" id="toc-how-it-works-plain-language-35" class="nav-link" data-scroll-target="#how-it-works-plain-language-35">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-7" id="toc-example-step-by-step-7" class="nav-link" data-scroll-target="#example-step-by-step-7">Example Step by Step</a></li>
  <li><a href="#tiny-code-simplified-python-1" id="toc-tiny-code-simplified-python-1" class="nav-link" data-scroll-target="#tiny-code-simplified-python-1">Tiny Code (Simplified Python)</a></li>
  <li><a href="#why-it-matters-70" id="toc-why-it-matters-70" class="nav-link" data-scroll-target="#why-it-matters-70">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-70" id="toc-a-gentle-proof-why-it-works-70" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-70">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-70" id="toc-try-it-yourself-70" class="nav-link" data-scroll-target="#try-it-yourself-70">Try It Yourself</a></li>
  <li><a href="#test-cases-70" id="toc-test-cases-70" class="nav-link" data-scroll-target="#test-cases-70">Test Cases</a></li>
  <li><a href="#complexity-70" id="toc-complexity-70" class="nav-link" data-scroll-target="#complexity-70">Complexity</a></li>
  <li><a href="#skip-list-delete" id="toc-skip-list-delete" class="nav-link" data-scroll-target="#skip-list-delete">272 Skip List Delete</a></li>
  <li><a href="#what-problem-are-we-solving-71" id="toc-what-problem-are-we-solving-71" class="nav-link" data-scroll-target="#what-problem-are-we-solving-71">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-36" id="toc-how-it-works-plain-language-36" class="nav-link" data-scroll-target="#how-it-works-plain-language-36">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-8" id="toc-example-step-by-step-8" class="nav-link" data-scroll-target="#example-step-by-step-8">Example Step by Step</a></li>
  <li><a href="#tiny-code-simplified-python-2" id="toc-tiny-code-simplified-python-2" class="nav-link" data-scroll-target="#tiny-code-simplified-python-2">Tiny Code (Simplified Python)</a></li>
  <li><a href="#why-it-matters-71" id="toc-why-it-matters-71" class="nav-link" data-scroll-target="#why-it-matters-71">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-71" id="toc-a-gentle-proof-why-it-works-71" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-71">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-71" id="toc-try-it-yourself-71" class="nav-link" data-scroll-target="#try-it-yourself-71">Try It Yourself</a></li>
  <li><a href="#test-cases-71" id="toc-test-cases-71" class="nav-link" data-scroll-target="#test-cases-71">Test Cases</a></li>
  <li><a href="#complexity-71" id="toc-complexity-71" class="nav-link" data-scroll-target="#complexity-71">Complexity</a></li>
  <li><a href="#skip-list-search" id="toc-skip-list-search" class="nav-link" data-scroll-target="#skip-list-search">273 Skip List Search</a></li>
  <li><a href="#what-problem-are-we-solving-72" id="toc-what-problem-are-we-solving-72" class="nav-link" data-scroll-target="#what-problem-are-we-solving-72">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-37" id="toc-how-it-works-plain-language-37" class="nav-link" data-scroll-target="#how-it-works-plain-language-37">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-9" id="toc-example-step-by-step-9" class="nav-link" data-scroll-target="#example-step-by-step-9">Example Step by Step</a></li>
  <li><a href="#visualization-17" id="toc-visualization-17" class="nav-link" data-scroll-target="#visualization-17">Visualization</a></li>
  <li><a href="#tiny-code-simplified-python-3" id="toc-tiny-code-simplified-python-3" class="nav-link" data-scroll-target="#tiny-code-simplified-python-3">Tiny Code (Simplified Python)</a></li>
  <li><a href="#why-it-matters-72" id="toc-why-it-matters-72" class="nav-link" data-scroll-target="#why-it-matters-72">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-72" id="toc-a-gentle-proof-why-it-works-72" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-72">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-72" id="toc-try-it-yourself-72" class="nav-link" data-scroll-target="#try-it-yourself-72">Try It Yourself</a></li>
  <li><a href="#test-cases-72" id="toc-test-cases-72" class="nav-link" data-scroll-target="#test-cases-72">Test Cases</a></li>
  <li><a href="#complexity-72" id="toc-complexity-72" class="nav-link" data-scroll-target="#complexity-72">Complexity</a></li>
  <li><a href="#b-tree-insert" id="toc-b-tree-insert" class="nav-link" data-scroll-target="#b-tree-insert">274 B-Tree Insert</a></li>
  <li><a href="#what-problem-are-we-solving-73" id="toc-what-problem-are-we-solving-73" class="nav-link" data-scroll-target="#what-problem-are-we-solving-73">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-38" id="toc-how-it-works-plain-language-38" class="nav-link" data-scroll-target="#how-it-works-plain-language-38">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-10" id="toc-example-step-by-step-10" class="nav-link" data-scroll-target="#example-step-by-step-10">Example Step by Step</a></li>
  <li><a href="#visualization-18" id="toc-visualization-18" class="nav-link" data-scroll-target="#visualization-18">Visualization</a></li>
  <li><a href="#tiny-code-simplified-python-4" id="toc-tiny-code-simplified-python-4" class="nav-link" data-scroll-target="#tiny-code-simplified-python-4">Tiny Code (Simplified Python)</a></li>
  <li><a href="#why-it-matters-73" id="toc-why-it-matters-73" class="nav-link" data-scroll-target="#why-it-matters-73">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-73" id="toc-a-gentle-proof-why-it-works-73" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-73">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-73" id="toc-try-it-yourself-73" class="nav-link" data-scroll-target="#try-it-yourself-73">Try It Yourself</a></li>
  <li><a href="#test-cases-73" id="toc-test-cases-73" class="nav-link" data-scroll-target="#test-cases-73">Test Cases</a></li>
  <li><a href="#complexity-73" id="toc-complexity-73" class="nav-link" data-scroll-target="#complexity-73">Complexity</a></li>
  <li><a href="#b-tree-delete" id="toc-b-tree-delete" class="nav-link" data-scroll-target="#b-tree-delete">275 B-Tree Delete</a></li>
  <li><a href="#what-problem-are-we-solving-74" id="toc-what-problem-are-we-solving-74" class="nav-link" data-scroll-target="#what-problem-are-we-solving-74">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-39" id="toc-how-it-works-plain-language-39" class="nav-link" data-scroll-target="#how-it-works-plain-language-39">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-11" id="toc-example-step-by-step-11" class="nav-link" data-scroll-target="#example-step-by-step-11">Example Step by Step</a></li>
  <li><a href="#visualization-19" id="toc-visualization-19" class="nav-link" data-scroll-target="#visualization-19">Visualization</a></li>
  <li><a href="#tiny-code-simplified-python-5" id="toc-tiny-code-simplified-python-5" class="nav-link" data-scroll-target="#tiny-code-simplified-python-5">Tiny Code (Simplified Python)</a></li>
  <li><a href="#why-it-matters-74" id="toc-why-it-matters-74" class="nav-link" data-scroll-target="#why-it-matters-74">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-74" id="toc-a-gentle-proof-why-it-works-74" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-74">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-74" id="toc-try-it-yourself-74" class="nav-link" data-scroll-target="#try-it-yourself-74">Try It Yourself</a></li>
  <li><a href="#test-cases-74" id="toc-test-cases-74" class="nav-link" data-scroll-target="#test-cases-74">Test Cases</a></li>
  <li><a href="#complexity-74" id="toc-complexity-74" class="nav-link" data-scroll-target="#complexity-74">Complexity</a></li>
  <li><a href="#b-tree-search" id="toc-b-tree-search" class="nav-link" data-scroll-target="#b-tree-search">276 B+ Tree Search</a></li>
  <li><a href="#what-problem-are-we-solving-75" id="toc-what-problem-are-we-solving-75" class="nav-link" data-scroll-target="#what-problem-are-we-solving-75">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-40" id="toc-how-it-works-plain-language-40" class="nav-link" data-scroll-target="#how-it-works-plain-language-40">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-12" id="toc-example-step-by-step-12" class="nav-link" data-scroll-target="#example-step-by-step-12">Example Step by Step</a></li>
  <li><a href="#visualization-20" id="toc-visualization-20" class="nav-link" data-scroll-target="#visualization-20">Visualization</a></li>
  <li><a href="#tiny-code-simplified-python-6" id="toc-tiny-code-simplified-python-6" class="nav-link" data-scroll-target="#tiny-code-simplified-python-6">Tiny Code (Simplified Python)</a></li>
  <li><a href="#why-it-matters-75" id="toc-why-it-matters-75" class="nav-link" data-scroll-target="#why-it-matters-75">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-75" id="toc-a-gentle-proof-why-it-works-75" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-75">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-75" id="toc-try-it-yourself-75" class="nav-link" data-scroll-target="#try-it-yourself-75">Try It Yourself</a></li>
  <li><a href="#test-cases-75" id="toc-test-cases-75" class="nav-link" data-scroll-target="#test-cases-75">Test Cases</a></li>
  <li><a href="#complexity-75" id="toc-complexity-75" class="nav-link" data-scroll-target="#complexity-75">Complexity</a></li>
  <li><a href="#b-tree" id="toc-b-tree" class="nav-link" data-scroll-target="#b-tree">278 B* Tree</a></li>
  <li><a href="#what-problem-are-we-solving-76" id="toc-what-problem-are-we-solving-76" class="nav-link" data-scroll-target="#what-problem-are-we-solving-76">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-41" id="toc-how-it-works-plain-language-41" class="nav-link" data-scroll-target="#how-it-works-plain-language-41">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-13" id="toc-example-step-by-step-13" class="nav-link" data-scroll-target="#example-step-by-step-13">Example Step by Step</a></li>
  <li><a href="#visualization-21" id="toc-visualization-21" class="nav-link" data-scroll-target="#visualization-21">Visualization</a></li>
  <li><a href="#tiny-code-simplified-pseudocode" id="toc-tiny-code-simplified-pseudocode" class="nav-link" data-scroll-target="#tiny-code-simplified-pseudocode">Tiny Code (Simplified Pseudocode)</a></li>
  <li><a href="#why-it-matters-76" id="toc-why-it-matters-76" class="nav-link" data-scroll-target="#why-it-matters-76">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-76" id="toc-a-gentle-proof-why-it-works-76" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-76">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-76" id="toc-try-it-yourself-76" class="nav-link" data-scroll-target="#try-it-yourself-76">Try It Yourself</a></li>
  <li><a href="#test-cases-76" id="toc-test-cases-76" class="nav-link" data-scroll-target="#test-cases-76">Test Cases</a></li>
  <li><a href="#complexity-76" id="toc-complexity-76" class="nav-link" data-scroll-target="#complexity-76">Complexity</a></li>
  <li><a href="#adaptive-radix-tree" id="toc-adaptive-radix-tree" class="nav-link" data-scroll-target="#adaptive-radix-tree">279 Adaptive Radix Tree</a></li>
  <li><a href="#what-problem-are-we-solving-77" id="toc-what-problem-are-we-solving-77" class="nav-link" data-scroll-target="#what-problem-are-we-solving-77">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-42" id="toc-how-it-works-plain-language-42" class="nav-link" data-scroll-target="#how-it-works-plain-language-42">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-14" id="toc-example-step-by-step-14" class="nav-link" data-scroll-target="#example-step-by-step-14">Example Step by Step</a></li>
  <li><a href="#visualization-22" id="toc-visualization-22" class="nav-link" data-scroll-target="#visualization-22">Visualization</a></li>
  <li><a href="#tiny-code-simplified-pseudocode-1" id="toc-tiny-code-simplified-pseudocode-1" class="nav-link" data-scroll-target="#tiny-code-simplified-pseudocode-1">Tiny Code (Simplified Pseudocode)</a></li>
  <li><a href="#why-it-matters-77" id="toc-why-it-matters-77" class="nav-link" data-scroll-target="#why-it-matters-77">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-77" id="toc-a-gentle-proof-why-it-works-77" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-77">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-77" id="toc-try-it-yourself-77" class="nav-link" data-scroll-target="#try-it-yourself-77">Try It Yourself</a></li>
  <li><a href="#test-cases-77" id="toc-test-cases-77" class="nav-link" data-scroll-target="#test-cases-77">Test Cases</a></li>
  <li><a href="#complexity-77" id="toc-complexity-77" class="nav-link" data-scroll-target="#complexity-77">Complexity</a></li>
  <li><a href="#trie-compression" id="toc-trie-compression" class="nav-link" data-scroll-target="#trie-compression">280 Trie Compression</a></li>
  <li><a href="#what-problem-are-we-solving-78" id="toc-what-problem-are-we-solving-78" class="nav-link" data-scroll-target="#what-problem-are-we-solving-78">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-43" id="toc-how-it-works-plain-language-43" class="nav-link" data-scroll-target="#how-it-works-plain-language-43">How It Works (Plain Language)</a></li>
  <li><a href="#example-30" id="toc-example-30" class="nav-link" data-scroll-target="#example-30">Example</a></li>
  <li><a href="#example-step-by-step-15" id="toc-example-step-by-step-15" class="nav-link" data-scroll-target="#example-step-by-step-15">Example Step by Step</a></li>
  <li><a href="#tiny-code-simplified-pseudocode-2" id="toc-tiny-code-simplified-pseudocode-2" class="nav-link" data-scroll-target="#tiny-code-simplified-pseudocode-2">Tiny Code (Simplified Pseudocode)</a></li>
  <li><a href="#why-it-matters-78" id="toc-why-it-matters-78" class="nav-link" data-scroll-target="#why-it-matters-78">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-78" id="toc-a-gentle-proof-why-it-works-78" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-78">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-78" id="toc-try-it-yourself-78" class="nav-link" data-scroll-target="#try-it-yourself-78">Try It Yourself</a></li>
  <li><a href="#test-cases-78" id="toc-test-cases-78" class="nav-link" data-scroll-target="#test-cases-78">Test Cases</a></li>
  <li><a href="#complexity-78" id="toc-complexity-78" class="nav-link" data-scroll-target="#complexity-78">Complexity</a></li>
  <li><a href="#section-29.-persistent-and-functional-data-structures" id="toc-section-29.-persistent-and-functional-data-structures" class="nav-link" data-scroll-target="#section-29.-persistent-and-functional-data-structures">Section 29. Persistent and Functional Data Structures</a>
  <ul class="collapse">
  <li><a href="#persistent-stack" id="toc-persistent-stack" class="nav-link" data-scroll-target="#persistent-stack">281 Persistent Stack</a></li>
  <li><a href="#what-problem-are-we-solving-79" id="toc-what-problem-are-we-solving-79" class="nav-link" data-scroll-target="#what-problem-are-we-solving-79">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-44" id="toc-how-it-works-plain-language-44" class="nav-link" data-scroll-target="#how-it-works-plain-language-44">How It Works (Plain Language)</a></li>
  <li><a href="#example-31" id="toc-example-31" class="nav-link" data-scroll-target="#example-31">Example</a></li>
  <li><a href="#tiny-code-python" id="toc-tiny-code-python" class="nav-link" data-scroll-target="#tiny-code-python">Tiny Code (Python)</a></li>
  <li><a href="#tiny-code-c-conceptual" id="toc-tiny-code-c-conceptual" class="nav-link" data-scroll-target="#tiny-code-c-conceptual">Tiny Code (C, Conceptual)</a></li>
  <li><a href="#why-it-matters-79" id="toc-why-it-matters-79" class="nav-link" data-scroll-target="#why-it-matters-79">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-79" id="toc-a-gentle-proof-why-it-works-79" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-79">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-79" id="toc-try-it-yourself-79" class="nav-link" data-scroll-target="#try-it-yourself-79">Try It Yourself</a></li>
  <li><a href="#test-cases-79" id="toc-test-cases-79" class="nav-link" data-scroll-target="#test-cases-79">Test Cases</a></li>
  <li><a href="#complexity-79" id="toc-complexity-79" class="nav-link" data-scroll-target="#complexity-79">Complexity</a></li>
  <li><a href="#persistent-array" id="toc-persistent-array" class="nav-link" data-scroll-target="#persistent-array">282 Persistent Array</a></li>
  <li><a href="#what-problem-are-we-solving-80" id="toc-what-problem-are-we-solving-80" class="nav-link" data-scroll-target="#what-problem-are-we-solving-80">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-45" id="toc-how-it-works-plain-language-45" class="nav-link" data-scroll-target="#how-it-works-plain-language-45">How It Works (Plain Language)</a></li>
  <li><a href="#example-32" id="toc-example-32" class="nav-link" data-scroll-target="#example-32">Example</a></li>
  <li><a href="#example-step-by-step-tree-representation" id="toc-example-step-by-step-tree-representation" class="nav-link" data-scroll-target="#example-step-by-step-tree-representation">Example Step-by-Step (Tree Representation)</a></li>
  <li><a href="#tiny-code-python-tree-based" id="toc-tiny-code-python-tree-based" class="nav-link" data-scroll-target="#tiny-code-python-tree-based">Tiny Code (Python, Tree-based)</a></li>
  <li><a href="#why-it-matters-80" id="toc-why-it-matters-80" class="nav-link" data-scroll-target="#why-it-matters-80">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-80" id="toc-a-gentle-proof-why-it-works-80" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-80">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-80" id="toc-try-it-yourself-80" class="nav-link" data-scroll-target="#try-it-yourself-80">Try It Yourself</a></li>
  <li><a href="#test-cases-80" id="toc-test-cases-80" class="nav-link" data-scroll-target="#test-cases-80">Test Cases</a></li>
  <li><a href="#complexity-80" id="toc-complexity-80" class="nav-link" data-scroll-target="#complexity-80">Complexity</a></li>
  <li><a href="#persistent-segment-tree-1" id="toc-persistent-segment-tree-1" class="nav-link" data-scroll-target="#persistent-segment-tree-1">283 Persistent Segment Tree</a></li>
  <li><a href="#what-problem-are-we-solving-81" id="toc-what-problem-are-we-solving-81" class="nav-link" data-scroll-target="#what-problem-are-we-solving-81">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-46" id="toc-how-it-works-plain-language-46" class="nav-link" data-scroll-target="#how-it-works-plain-language-46">How It Works (Plain Language)</a></li>
  <li><a href="#example-33" id="toc-example-33" class="nav-link" data-scroll-target="#example-33">Example</a></li>
  <li><a href="#example-step-by-step-16" id="toc-example-step-by-step-16" class="nav-link" data-scroll-target="#example-step-by-step-16">Example Step-by-Step</a></li>
  <li><a href="#tiny-code-python-1" id="toc-tiny-code-python-1" class="nav-link" data-scroll-target="#tiny-code-python-1">Tiny Code (Python)</a></li>
  <li><a href="#why-it-matters-81" id="toc-why-it-matters-81" class="nav-link" data-scroll-target="#why-it-matters-81">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-81" id="toc-a-gentle-proof-why-it-works-81" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-81">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-81" id="toc-try-it-yourself-81" class="nav-link" data-scroll-target="#try-it-yourself-81">Try It Yourself</a></li>
  <li><a href="#test-cases-81" id="toc-test-cases-81" class="nav-link" data-scroll-target="#test-cases-81">Test Cases</a></li>
  <li><a href="#complexity-81" id="toc-complexity-81" class="nav-link" data-scroll-target="#complexity-81">Complexity</a></li>
  <li><a href="#persistent-linked-list" id="toc-persistent-linked-list" class="nav-link" data-scroll-target="#persistent-linked-list">284 Persistent Linked List</a></li>
  <li><a href="#what-problem-are-we-solving-82" id="toc-what-problem-are-we-solving-82" class="nav-link" data-scroll-target="#what-problem-are-we-solving-82">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-47" id="toc-how-it-works-plain-language-47" class="nav-link" data-scroll-target="#how-it-works-plain-language-47">How It Works (Plain Language)</a></li>
  <li><a href="#example-34" id="toc-example-34" class="nav-link" data-scroll-target="#example-34">Example</a></li>
  <li><a href="#example-graph-view" id="toc-example-graph-view" class="nav-link" data-scroll-target="#example-graph-view">Example (Graph View)</a></li>
  <li><a href="#tiny-code-python-2" id="toc-tiny-code-python-2" class="nav-link" data-scroll-target="#tiny-code-python-2">Tiny Code (Python)</a></li>
  <li><a href="#tiny-code-c-conceptual-1" id="toc-tiny-code-c-conceptual-1" class="nav-link" data-scroll-target="#tiny-code-c-conceptual-1">Tiny Code (C, Conceptual)</a></li>
  <li><a href="#why-it-matters-82" id="toc-why-it-matters-82" class="nav-link" data-scroll-target="#why-it-matters-82">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-82" id="toc-a-gentle-proof-why-it-works-82" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-82">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-82" id="toc-try-it-yourself-82" class="nav-link" data-scroll-target="#try-it-yourself-82">Try It Yourself</a></li>
  <li><a href="#test-cases-82" id="toc-test-cases-82" class="nav-link" data-scroll-target="#test-cases-82">Test Cases</a></li>
  <li><a href="#complexity-82" id="toc-complexity-82" class="nav-link" data-scroll-target="#complexity-82">Complexity</a></li>
  <li><a href="#finger-tree" id="toc-finger-tree" class="nav-link" data-scroll-target="#finger-tree">286 Finger Tree</a></li>
  <li><a href="#what-problem-are-we-solving-83" id="toc-what-problem-are-we-solving-83" class="nav-link" data-scroll-target="#what-problem-are-we-solving-83">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-48" id="toc-how-it-works-plain-language-48" class="nav-link" data-scroll-target="#how-it-works-plain-language-48">How It Works (Plain Language)</a></li>
  <li><a href="#example-state" id="toc-example-state" class="nav-link" data-scroll-target="#example-state">Example State</a></li>
  <li><a href="#tiny-code-python-conceptual" id="toc-tiny-code-python-conceptual" class="nav-link" data-scroll-target="#tiny-code-python-conceptual">Tiny Code (Python – Conceptual)</a></li>
  <li><a href="#why-it-matters-83" id="toc-why-it-matters-83" class="nav-link" data-scroll-target="#why-it-matters-83">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-83" id="toc-a-gentle-proof-why-it-works-83" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-83">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-83" id="toc-try-it-yourself-83" class="nav-link" data-scroll-target="#try-it-yourself-83">Try It Yourself</a></li>
  <li><a href="#test-cases-83" id="toc-test-cases-83" class="nav-link" data-scroll-target="#test-cases-83">Test Cases</a></li>
  <li><a href="#complexity-83" id="toc-complexity-83" class="nav-link" data-scroll-target="#complexity-83">Complexity</a></li>
  <li><a href="#zipper-structure" id="toc-zipper-structure" class="nav-link" data-scroll-target="#zipper-structure">287 Zipper Structure</a></li>
  <li><a href="#what-problem-are-we-solving-84" id="toc-what-problem-are-we-solving-84" class="nav-link" data-scroll-target="#what-problem-are-we-solving-84">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-49" id="toc-how-it-works-plain-language-49" class="nav-link" data-scroll-target="#how-it-works-plain-language-49">How It Works (Plain Language)</a></li>
  <li><a href="#example-list-zipper" id="toc-example-list-zipper" class="nav-link" data-scroll-target="#example-list-zipper">Example (List Zipper)</a></li>
  <li><a href="#tiny-code-python-list-zipper" id="toc-tiny-code-python-list-zipper" class="nav-link" data-scroll-target="#tiny-code-python-list-zipper">Tiny Code (Python – List Zipper)</a></li>
  <li><a href="#example-tree-zipper-conceptual" id="toc-example-tree-zipper-conceptual" class="nav-link" data-scroll-target="#example-tree-zipper-conceptual">Example (Tree Zipper – Conceptual)</a></li>
  <li><a href="#why-it-matters-84" id="toc-why-it-matters-84" class="nav-link" data-scroll-target="#why-it-matters-84">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-84" id="toc-a-gentle-proof-why-it-works-84" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-84">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-84" id="toc-try-it-yourself-84" class="nav-link" data-scroll-target="#try-it-yourself-84">Try It Yourself</a></li>
  <li><a href="#test-cases-84" id="toc-test-cases-84" class="nav-link" data-scroll-target="#test-cases-84">Test Cases</a></li>
  <li><a href="#complexity-84" id="toc-complexity-84" class="nav-link" data-scroll-target="#complexity-84">Complexity</a></li>
  <li><a href="#trie-with-versioning" id="toc-trie-with-versioning" class="nav-link" data-scroll-target="#trie-with-versioning">289 Trie with Versioning</a></li>
  <li><a href="#what-problem-are-we-solving-85" id="toc-what-problem-are-we-solving-85" class="nav-link" data-scroll-target="#what-problem-are-we-solving-85">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-50" id="toc-how-it-works-plain-language-50" class="nav-link" data-scroll-target="#how-it-works-plain-language-50">How It Works (Plain Language)</a></li>
  <li><a href="#tiny-code-conceptual-python" id="toc-tiny-code-conceptual-python" class="nav-link" data-scroll-target="#tiny-code-conceptual-python">Tiny Code (Conceptual Python)</a></li>
  <li><a href="#example-36" id="toc-example-36" class="nav-link" data-scroll-target="#example-36">Example</a></li>
  <li><a href="#why-it-matters-85" id="toc-why-it-matters-85" class="nav-link" data-scroll-target="#why-it-matters-85">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-85" id="toc-a-gentle-proof-why-it-works-85" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-85">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-85" id="toc-try-it-yourself-85" class="nav-link" data-scroll-target="#try-it-yourself-85">Try It Yourself</a></li>
  <li><a href="#test-case" id="toc-test-case" class="nav-link" data-scroll-target="#test-case">Test Case</a></li>
  <li><a href="#complexity-85" id="toc-complexity-85" class="nav-link" data-scroll-target="#complexity-85">Complexity</a></li>
  <li><a href="#persistent-union-find" id="toc-persistent-union-find" class="nav-link" data-scroll-target="#persistent-union-find">290 Persistent Union-Find</a></li>
  <li><a href="#what-problem-are-we-solving-86" id="toc-what-problem-are-we-solving-86" class="nav-link" data-scroll-target="#what-problem-are-we-solving-86">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-51" id="toc-how-it-works-plain-language-51" class="nav-link" data-scroll-target="#how-it-works-plain-language-51">How It Works (Plain Language)</a></li>
  <li><a href="#tiny-code-conceptual-python-1" id="toc-tiny-code-conceptual-python-1" class="nav-link" data-scroll-target="#tiny-code-conceptual-python-1">Tiny Code (Conceptual Python)</a></li>
  <li><a href="#example-37" id="toc-example-37" class="nav-link" data-scroll-target="#example-37">Example</a></li>
  <li><a href="#why-it-matters-86" id="toc-why-it-matters-86" class="nav-link" data-scroll-target="#why-it-matters-86">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-86" id="toc-a-gentle-proof-why-it-works-86" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-86">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-86" id="toc-try-it-yourself-86" class="nav-link" data-scroll-target="#try-it-yourself-86">Try It Yourself</a></li>
  <li><a href="#test-cases-85" id="toc-test-cases-85" class="nav-link" data-scroll-target="#test-cases-85">Test Cases</a></li>
  <li><a href="#complexity-86" id="toc-complexity-86" class="nav-link" data-scroll-target="#complexity-86">Complexity</a></li>
  </ul></li>
  <li><a href="#section-30.-advanced-trees-and-range-queries" id="toc-section-30.-advanced-trees-and-range-queries" class="nav-link" data-scroll-target="#section-30.-advanced-trees-and-range-queries">Section 30. Advanced Trees and Range Queries</a>
  <ul class="collapse">
  <li><a href="#sparse-table-build" id="toc-sparse-table-build" class="nav-link" data-scroll-target="#sparse-table-build">291 Sparse Table Build</a></li>
  <li><a href="#what-problem-are-we-solving-87" id="toc-what-problem-are-we-solving-87" class="nav-link" data-scroll-target="#what-problem-are-we-solving-87">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-52" id="toc-how-it-works-plain-language-52" class="nav-link" data-scroll-target="#how-it-works-plain-language-52">How It Works (Plain Language)</a></li>
  <li><a href="#example-step-by-step-17" id="toc-example-step-by-step-17" class="nav-link" data-scroll-target="#example-step-by-step-17">Example Step by Step</a></li>
  <li><a href="#tiny-code-python-rmq-with-min" id="toc-tiny-code-python-rmq-with-min" class="nav-link" data-scroll-target="#tiny-code-python-rmq-with-min">Tiny Code (Python, RMQ with min)</a></li>
  <li><a href="#why-it-matters-87" id="toc-why-it-matters-87" class="nav-link" data-scroll-target="#why-it-matters-87">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-87" id="toc-a-gentle-proof-why-it-works-87" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-87">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-87" id="toc-try-it-yourself-87" class="nav-link" data-scroll-target="#try-it-yourself-87">Try It Yourself</a></li>
  <li><a href="#test-cases-86" id="toc-test-cases-86" class="nav-link" data-scroll-target="#test-cases-86">Test Cases</a></li>
  <li><a href="#complexity-87" id="toc-complexity-87" class="nav-link" data-scroll-target="#complexity-87">Complexity</a></li>
  <li><a href="#cartesian-tree" id="toc-cartesian-tree" class="nav-link" data-scroll-target="#cartesian-tree">292 Cartesian Tree</a></li>
  <li><a href="#what-problem-are-we-solving-88" id="toc-what-problem-are-we-solving-88" class="nav-link" data-scroll-target="#what-problem-are-we-solving-88">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-53" id="toc-how-it-works-plain-language-53" class="nav-link" data-scroll-target="#how-it-works-plain-language-53">How It Works (Plain Language)</a></li>
  <li><a href="#example-38" id="toc-example-38" class="nav-link" data-scroll-target="#example-38">Example</a></li>
  <li><a href="#tiny-code-python-min-heap-cartesian-tree" id="toc-tiny-code-python-min-heap-cartesian-tree" class="nav-link" data-scroll-target="#tiny-code-python-min-heap-cartesian-tree">Tiny Code (Python, Min-Heap Cartesian Tree)</a></li>
  <li><a href="#why-it-matters-88" id="toc-why-it-matters-88" class="nav-link" data-scroll-target="#why-it-matters-88">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-88" id="toc-a-gentle-proof-why-it-works-88" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-88">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-88" id="toc-try-it-yourself-88" class="nav-link" data-scroll-target="#try-it-yourself-88">Try It Yourself</a></li>
  <li><a href="#test-cases-87" id="toc-test-cases-87" class="nav-link" data-scroll-target="#test-cases-87">Test Cases</a></li>
  <li><a href="#complexity-88" id="toc-complexity-88" class="nav-link" data-scroll-target="#complexity-88">Complexity</a></li>
  <li><a href="#segment-tree-beats" id="toc-segment-tree-beats" class="nav-link" data-scroll-target="#segment-tree-beats">293 Segment Tree Beats</a></li>
  <li><a href="#what-problem-are-we-solving-89" id="toc-what-problem-are-we-solving-89" class="nav-link" data-scroll-target="#what-problem-are-we-solving-89">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-54" id="toc-how-it-works-plain-language-54" class="nav-link" data-scroll-target="#how-it-works-plain-language-54">How It Works (Plain Language)</a></li>
  <li><a href="#example-range-chmin" id="toc-example-range-chmin" class="nav-link" data-scroll-target="#example-range-chmin">Example (Range Chmin)</a></li>
  <li><a href="#tiny-code-simplified-range-chmin" id="toc-tiny-code-simplified-range-chmin" class="nav-link" data-scroll-target="#tiny-code-simplified-range-chmin">Tiny Code (Simplified Range Chmin)</a></li>
  <li><a href="#why-it-matters-89" id="toc-why-it-matters-89" class="nav-link" data-scroll-target="#why-it-matters-89">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-89" id="toc-a-gentle-proof-why-it-works-89" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-89">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-89" id="toc-try-it-yourself-89" class="nav-link" data-scroll-target="#try-it-yourself-89">Try It Yourself</a></li>
  <li><a href="#test-cases-88" id="toc-test-cases-88" class="nav-link" data-scroll-target="#test-cases-88">Test Cases</a></li>
  <li><a href="#complexity-89" id="toc-complexity-89" class="nav-link" data-scroll-target="#complexity-89">Complexity</a></li>
  <li><a href="#merge-sort-tree" id="toc-merge-sort-tree" class="nav-link" data-scroll-target="#merge-sort-tree">294 Merge Sort Tree</a></li>
  <li><a href="#what-problem-are-we-solving-90" id="toc-what-problem-are-we-solving-90" class="nav-link" data-scroll-target="#what-problem-are-we-solving-90">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-55" id="toc-how-it-works-plain-language-55" class="nav-link" data-scroll-target="#how-it-works-plain-language-55">How It Works (Plain Language)</a></li>
  <li><a href="#example-39" id="toc-example-39" class="nav-link" data-scroll-target="#example-39">Example</a></li>
  <li><a href="#tiny-code-python-count-x" id="toc-tiny-code-python-count-x" class="nav-link" data-scroll-target="#tiny-code-python-count-x">Tiny Code (Python, Count ≤ x)</a></li>
  <li><a href="#why-it-matters-90" id="toc-why-it-matters-90" class="nav-link" data-scroll-target="#why-it-matters-90">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-90" id="toc-a-gentle-proof-why-it-works-90" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-90">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-90" id="toc-try-it-yourself-90" class="nav-link" data-scroll-target="#try-it-yourself-90">Try It Yourself</a></li>
  <li><a href="#test-cases-89" id="toc-test-cases-89" class="nav-link" data-scroll-target="#test-cases-89">Test Cases</a></li>
  <li><a href="#complexity-90" id="toc-complexity-90" class="nav-link" data-scroll-target="#complexity-90">Complexity</a></li>
  <li><a href="#wavelet-tree" id="toc-wavelet-tree" class="nav-link" data-scroll-target="#wavelet-tree">295 Wavelet Tree</a></li>
  <li><a href="#what-problem-are-we-solving-91" id="toc-what-problem-are-we-solving-91" class="nav-link" data-scroll-target="#what-problem-are-we-solving-91">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works" id="toc-how-it-works" class="nav-link" data-scroll-target="#how-it-works">How It Works</a></li>
  <li><a href="#example-40" id="toc-example-40" class="nav-link" data-scroll-target="#example-40">Example</a></li>
  <li><a href="#core-operations" id="toc-core-operations" class="nav-link" data-scroll-target="#core-operations">Core Operations</a></li>
  <li><a href="#tiny-code-sketch-in-python" id="toc-tiny-code-sketch-in-python" class="nav-link" data-scroll-target="#tiny-code-sketch-in-python">Tiny Code Sketch in Python</a></li>
  <li><a href="#why-it-matters-91" id="toc-why-it-matters-91" class="nav-link" data-scroll-target="#why-it-matters-91">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-of-bounds" id="toc-a-gentle-proof-of-bounds" class="nav-link" data-scroll-target="#a-gentle-proof-of-bounds">A Gentle Proof of Bounds</a></li>
  <li><a href="#try-it-yourself-91" id="toc-try-it-yourself-91" class="nav-link" data-scroll-target="#try-it-yourself-91">Try It Yourself</a></li>
  <li><a href="#test-cases-90" id="toc-test-cases-90" class="nav-link" data-scroll-target="#test-cases-90">Test Cases</a></li>
  <li><a href="#complexity-91" id="toc-complexity-91" class="nav-link" data-scroll-target="#complexity-91">Complexity</a></li>
  <li><a href="#kd-tree" id="toc-kd-tree" class="nav-link" data-scroll-target="#kd-tree">296 KD-Tree</a></li>
  <li><a href="#what-problem-are-we-solving-92" id="toc-what-problem-are-we-solving-92" class="nav-link" data-scroll-target="#what-problem-are-we-solving-92">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-1" id="toc-how-it-works-1" class="nav-link" data-scroll-target="#how-it-works-1">How It Works</a></li>
  <li><a href="#example-41" id="toc-example-41" class="nav-link" data-scroll-target="#example-41">Example</a></li>
  <li><a href="#tiny-code-python-3" id="toc-tiny-code-python-3" class="nav-link" data-scroll-target="#tiny-code-python-3">Tiny Code (Python)</a></li>
  <li><a href="#how-nearest-neighbor-works" id="toc-how-nearest-neighbor-works" class="nav-link" data-scroll-target="#how-nearest-neighbor-works">How Nearest Neighbor Works</a></li>
  <li><a href="#why-it-matters-92" id="toc-why-it-matters-92" class="nav-link" data-scroll-target="#why-it-matters-92">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-91" id="toc-a-gentle-proof-why-it-works-91" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-91">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-92" id="toc-try-it-yourself-92" class="nav-link" data-scroll-target="#try-it-yourself-92">Try It Yourself</a></li>
  <li><a href="#test-cases-91" id="toc-test-cases-91" class="nav-link" data-scroll-target="#test-cases-91">Test Cases</a></li>
  <li><a href="#complexity-92" id="toc-complexity-92" class="nav-link" data-scroll-target="#complexity-92">Complexity</a></li>
  <li><a href="#range-tree" id="toc-range-tree" class="nav-link" data-scroll-target="#range-tree">297 Range Tree</a></li>
  <li><a href="#what-problem-are-we-solving-93" id="toc-what-problem-are-we-solving-93" class="nav-link" data-scroll-target="#what-problem-are-we-solving-93">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-2" id="toc-how-it-works-2" class="nav-link" data-scroll-target="#how-it-works-2">How It Works</a></li>
  <li><a href="#example-42" id="toc-example-42" class="nav-link" data-scroll-target="#example-42">Example</a></li>
  <li><a href="#tiny-code-python-like-pseudocode" id="toc-tiny-code-python-like-pseudocode" class="nav-link" data-scroll-target="#tiny-code-python-like-pseudocode">Tiny Code (Python-like Pseudocode)</a></li>
  <li><a href="#step-by-step-table-2d-query" id="toc-step-by-step-table-2d-query" class="nav-link" data-scroll-target="#step-by-step-table-2d-query">Step-by-Step Table (2D Query)</a></li>
  <li><a href="#why-it-matters-93" id="toc-why-it-matters-93" class="nav-link" data-scroll-target="#why-it-matters-93">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-92" id="toc-a-gentle-proof-why-it-works-92" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-92">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-93" id="toc-try-it-yourself-93" class="nav-link" data-scroll-target="#try-it-yourself-93">Try It Yourself</a></li>
  <li><a href="#test-cases-92" id="toc-test-cases-92" class="nav-link" data-scroll-target="#test-cases-92">Test Cases</a></li>
  <li><a href="#complexity-93" id="toc-complexity-93" class="nav-link" data-scroll-target="#complexity-93">Complexity</a></li>
  <li><a href="#fenwick-2d-tree" id="toc-fenwick-2d-tree" class="nav-link" data-scroll-target="#fenwick-2d-tree">298 Fenwick 2D Tree</a></li>
  <li><a href="#what-problem-are-we-solving-94" id="toc-what-problem-are-we-solving-94" class="nav-link" data-scroll-target="#what-problem-are-we-solving-94">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-3" id="toc-how-it-works-3" class="nav-link" data-scroll-target="#how-it-works-3">How It Works</a></li>
  <li><a href="#example-43" id="toc-example-43" class="nav-link" data-scroll-target="#example-43">Example</a></li>
  <li><a href="#step-by-step-update-example" id="toc-step-by-step-update-example" class="nav-link" data-scroll-target="#step-by-step-update-example">Step-by-Step Update Example</a></li>
  <li><a href="#tiny-code-python-like-pseudocode-1" id="toc-tiny-code-python-like-pseudocode-1" class="nav-link" data-scroll-target="#tiny-code-python-like-pseudocode-1">Tiny Code (Python-like Pseudocode)</a></li>
  <li><a href="#why-it-matters-94" id="toc-why-it-matters-94" class="nav-link" data-scroll-target="#why-it-matters-94">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-93" id="toc-a-gentle-proof-why-it-works-93" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-93">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-94" id="toc-try-it-yourself-94" class="nav-link" data-scroll-target="#try-it-yourself-94">Try It Yourself</a></li>
  <li><a href="#test-cases-93" id="toc-test-cases-93" class="nav-link" data-scroll-target="#test-cases-93">Test Cases</a></li>
  <li><a href="#complexity-94" id="toc-complexity-94" class="nav-link" data-scroll-target="#complexity-94">Complexity</a></li>
  <li><a href="#treap-splitmerge" id="toc-treap-splitmerge" class="nav-link" data-scroll-target="#treap-splitmerge">299 Treap Split/Merge</a></li>
  <li><a href="#what-problem-are-we-solving-95" id="toc-what-problem-are-we-solving-95" class="nav-link" data-scroll-target="#what-problem-are-we-solving-95">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-56" id="toc-how-it-works-plain-language-56" class="nav-link" data-scroll-target="#how-it-works-plain-language-56">How It Works (Plain Language)</a></li>
  <li><a href="#example-44" id="toc-example-44" class="nav-link" data-scroll-target="#example-44">Example</a></li>
  <li><a href="#step-by-step-split-example" id="toc-step-by-step-split-example" class="nav-link" data-scroll-target="#step-by-step-split-example">Step-by-Step Split Example</a></li>
  <li><a href="#tiny-code-python-like-pseudocode-2" id="toc-tiny-code-python-like-pseudocode-2" class="nav-link" data-scroll-target="#tiny-code-python-like-pseudocode-2">Tiny Code (Python-like Pseudocode)</a></li>
  <li><a href="#why-it-matters-95" id="toc-why-it-matters-95" class="nav-link" data-scroll-target="#why-it-matters-95">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-94" id="toc-a-gentle-proof-why-it-works-94" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-94">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-95" id="toc-try-it-yourself-95" class="nav-link" data-scroll-target="#try-it-yourself-95">Try It Yourself</a></li>
  <li><a href="#test-cases-94" id="toc-test-cases-94" class="nav-link" data-scroll-target="#test-cases-94">Test Cases</a></li>
  <li><a href="#complexity-95" id="toc-complexity-95" class="nav-link" data-scroll-target="#complexity-95">Complexity</a></li>
  <li><a href="#mos-algorithm-on-tree" id="toc-mos-algorithm-on-tree" class="nav-link" data-scroll-target="#mos-algorithm-on-tree">300 Mo’s Algorithm on Tree</a></li>
  <li><a href="#what-problem-are-we-solving-96" id="toc-what-problem-are-we-solving-96" class="nav-link" data-scroll-target="#what-problem-are-we-solving-96">What Problem Are We Solving?</a></li>
  <li><a href="#how-it-works-plain-language-57" id="toc-how-it-works-plain-language-57" class="nav-link" data-scroll-target="#how-it-works-plain-language-57">How It Works (Plain Language)</a></li>
  <li><a href="#example-45" id="toc-example-45" class="nav-link" data-scroll-target="#example-45">Example</a></li>
  <li><a href="#step-by-step-example-10" id="toc-step-by-step-example-10" class="nav-link" data-scroll-target="#step-by-step-example-10">Step-by-Step Example</a></li>
  <li><a href="#tiny-code-python-like-pseudocode-3" id="toc-tiny-code-python-like-pseudocode-3" class="nav-link" data-scroll-target="#tiny-code-python-like-pseudocode-3">Tiny Code (Python-like Pseudocode)</a></li>
  <li><a href="#why-it-matters-96" id="toc-why-it-matters-96" class="nav-link" data-scroll-target="#why-it-matters-96">Why It Matters</a></li>
  <li><a href="#a-gentle-proof-why-it-works-95" id="toc-a-gentle-proof-why-it-works-95" class="nav-link" data-scroll-target="#a-gentle-proof-why-it-works-95">A Gentle Proof (Why It Works)</a></li>
  <li><a href="#try-it-yourself-96" id="toc-try-it-yourself-96" class="nav-link" data-scroll-target="#try-it-yourself-96">Try It Yourself</a></li>
  <li><a href="#test-cases-95" id="toc-test-cases-95" class="nav-link" data-scroll-target="#test-cases-95">Test Cases</a></li>
  <li><a href="#complexity-96" id="toc-complexity-96" class="nav-link" data-scroll-target="#complexity-96">Complexity</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Chapter 3. Data Structure in Action</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="section-21.-arrays-linked-lists-stacks-queues" class="level2">
<h2 class="anchored" data-anchor-id="section-21.-arrays-linked-lists-stacks-queues">Section 21. Arrays, linked lists, stacks, queues</h2>
<section id="dynamic-array-resize" class="level3">
<h3 class="anchored" data-anchor-id="dynamic-array-resize">201 Dynamic Array Resize</h3>
<p>Dynamic array resizing is how we keep push operations fast while growing storage as needed. The idea is simple: when the array is full, allocate a bigger one, copy the elements, and keep going. If we double the capacity on each resize, the average cost per push stays constant.</p>
<section id="what-problem-are-we-solving" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving">What Problem Are We Solving?</h4>
<p>A fixed array has a fixed size. Real programs do not always know n in advance. We want an array that supports <code>push</code> at end with near constant time, grows automatically, and keeps elements in contiguous memory for cache friendliness.</p>
<p>Goal: Provide <code>push</code>, <code>pop</code>, <code>get</code>, <code>set</code> on a resizable array with amortized O(1) time for push.</p>
</section>
<section id="how-does-it-work-plain-language" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language">How Does It Work (Plain Language)?</h4>
<p>Keep two numbers: size and capacity.</p>
<ol type="1">
<li>Start with a small capacity (for example, 1 or 8).</li>
<li>On <code>push</code>, if <code>size &lt; capacity</code>, write the element and increase <code>size</code>.</li>
<li>If <code>size == capacity</code>, allocate new storage with capacity doubled, copy old elements, release the old block, then push.</li>
<li>Optionally, if many <code>pop</code>s reduce <code>size</code> far below <code>capacity</code>, shrink by halving to avoid wasted space.</li>
</ol>
<p>Why doubling? Doubling keeps the number of costly resizes small. Most pushes are cheap writes. Only occasionally do we pay for copying.</p>
<p>Example Steps (Growth Simulation)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 4%">
<col style="width: 11%">
<col style="width: 15%">
<col style="width: 44%">
<col style="width: 10%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Size Before</th>
<th>Capacity Before</th>
<th>Action</th>
<th>Size After</th>
<th>Capacity After</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>1</td>
<td>push(1)</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>1</td>
<td>full → resize to 2, copy 1 element, push(2)</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2</td>
<td>2</td>
<td>full → resize to 4, copy 2 elements, push(3)</td>
<td>3</td>
<td>4</td>
</tr>
<tr class="even">
<td>4</td>
<td>3</td>
<td>4</td>
<td>push(4)</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td>5</td>
<td>4</td>
<td>4</td>
<td>full → resize to 8, copy 4 elements, push(5)</td>
<td>5</td>
<td>8</td>
</tr>
</tbody>
</table>
<p>Notice how capacity doubles occasionally while most pushes cost O(1).</p>
</section>
<section id="tiny-code-easy-versions" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> size<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> capacity<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>data<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> DynArray<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> da_init<span class="op">(</span>DynArray <span class="op">*</span>a<span class="op">,</span> <span class="dt">size_t</span> init_cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>init_cap <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> init_cap <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>data <span class="op">=</span> <span class="op">(</span><span class="dt">int</span> <span class="op">*)</span>malloc<span class="op">(</span>init_cap <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>a<span class="op">-&gt;</span>data<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>size <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>capacity <span class="op">=</span> init_cap<span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> da_resize<span class="op">(</span>DynArray <span class="op">*</span>a<span class="op">,</span> <span class="dt">size_t</span> new_cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">(</span><span class="dt">int</span> <span class="op">*)</span>realloc<span class="op">(</span>a<span class="op">-&gt;</span>data<span class="op">,</span> new_cap <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>p<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>data <span class="op">=</span> p<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>capacity <span class="op">=</span> new_cap<span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> da_push<span class="op">(</span>DynArray <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a<span class="op">-&gt;</span>size <span class="op">==</span> a<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> new_cap <span class="op">=</span> a<span class="op">-&gt;</span>capacity <span class="op">*</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>da_resize<span class="op">(</span>a<span class="op">,</span> new_cap<span class="op">))</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>data<span class="op">[</span>a<span class="op">-&gt;</span>size<span class="op">++]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> da_pop<span class="op">(</span>DynArray <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a<span class="op">-&gt;</span>size <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> a<span class="op">-&gt;</span>data<span class="op">[--</span>a<span class="op">-&gt;</span>size<span class="op">];</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a<span class="op">-&gt;</span>capacity <span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> a<span class="op">-&gt;</span>size <span class="op">&lt;=</span> a<span class="op">-&gt;</span>capacity <span class="op">/</span> <span class="dv">4</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> new_cap <span class="op">=</span> a<span class="op">-&gt;</span>capacity <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>new_cap <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> new_cap <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        da_resize<span class="op">(</span>a<span class="op">,</span> new_cap<span class="op">);</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    DynArray a<span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>da_init<span class="op">(&amp;</span>a<span class="op">,</span> <span class="dv">1</span><span class="op">))</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> da_push<span class="op">(&amp;</span>a<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> a<span class="op">.</span>size<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> a<span class="op">.</span>data<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">size=</span><span class="sc">%zu</span><span class="st"> cap=</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">.</span>size<span class="op">,</span> a<span class="op">.</span>capacity<span class="op">);</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>a<span class="op">.</span>data<span class="op">);</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DynArray:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, init_cap<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._cap <span class="op">=</span> <span class="bu">max</span>(<span class="dv">1</span>, init_cap)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._n <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> <span class="va">self</span>._cap</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _resize(<span class="va">self</span>, new_cap):</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        new <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> new_cap</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._n):</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>            new[i] <span class="op">=</span> <span class="va">self</span>._data[i]</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data <span class="op">=</span> new</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._cap <span class="op">=</span> new_cap</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> push(<span class="va">self</span>, x):</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._n <span class="op">==</span> <span class="va">self</span>._cap:</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._resize(<span class="va">self</span>._cap <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data[<span class="va">self</span>._n] <span class="op">=</span> x</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._n <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pop(<span class="va">self</span>):</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._n <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"pop from empty DynArray"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._n <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>._data[<span class="va">self</span>._n]</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data[<span class="va">self</span>._n] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._cap <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> <span class="va">self</span>._n <span class="op">&lt;=</span> <span class="va">self</span>._cap <span class="op">//</span> <span class="dv">4</span>:</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._resize(<span class="bu">max</span>(<span class="dv">1</span>, <span class="va">self</span>._cap <span class="op">//</span> <span class="dv">2</span>))</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, i):</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="dv">0</span> <span class="op">&lt;=</span> i <span class="op">&lt;</span> <span class="va">self</span>._n:</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"index out of range"</span>)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._data[i]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters">Why It Matters</h4>
<ul>
<li>Amortized O(1) push for dynamic growth</li>
<li>Contiguous memory for cache performance</li>
<li>Simple API that underlies vectors, array lists, and many scripting language arrays</li>
<li>Balanced memory usage via optional shrinking</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works">A Gentle Proof (Why It Works)</h4>
<p>Accounting view for doubling Charge each push a constant credit (e.g.&nbsp;3 units).</p>
<ol type="1">
<li>A normal push costs 1 unit and stores 2 credits with the element.</li>
<li>When resizing from capacity k → 2k, copying k elements costs k units, paid by saved credits.</li>
<li>The new element pays its own 1 unit.</li>
</ol>
<p>Thus amortized cost per push is O(1).</p>
<p>Growth factor choice Any factor &gt; 1 gives amortized O(1).</p>
<ul>
<li>Doubling → fewer resizes, more memory slack</li>
<li>1.5x → less slack, more frequent copies</li>
<li>Too small (&lt;1.2) → breaks amortized bound</li>
</ul>
</section>
<section id="try-it-yourself" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself">Try It Yourself</h4>
<ol type="1">
<li>Simulate pushes 1..32 for factors 2.0 and 1.5. Count resizes.</li>
<li>Add <code>reserve(n)</code> to preallocate capacity.</li>
<li>Implement shrinking when <code>size &lt;= capacity / 4</code>.</li>
<li>Replace <code>int</code> with a struct, measure copy cost.</li>
<li>Use potential method: Φ = 2·size − capacity.</li>
</ol>
</section>
<section id="test-cases" class="level4">
<h4 class="anchored" data-anchor-id="test-cases">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation Sequence</th>
<th>Capacity Trace (Factor 2)</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>push 1..8</td>
<td>1 → 2 → 4 → 8</td>
<td>resize at 1, 2, 4</td>
</tr>
<tr class="even">
<td>push 9</td>
<td>8 → 16</td>
<td>resize before write</td>
</tr>
<tr class="odd">
<td>push 10..16</td>
<td>16</td>
<td>no resize</td>
</tr>
<tr class="even">
<td>pop 16..9</td>
<td>16</td>
<td>shrinking optional</td>
</tr>
<tr class="odd">
<td>pop 8</td>
<td>16 → 8</td>
<td>shrink at 25% load</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Push on full array triggers one resize before write</li>
<li>Pop on empty array should error or return false</li>
<li><code>reserve(n)</code> larger than current capacity must preserve data</li>
<li>Shrink never reduces capacity below size</li>
</ul>
</section>
<section id="complexity" class="level4">
<h4 class="anchored" data-anchor-id="complexity">Complexity</h4>
<ul>
<li><p>Time:</p>
<ul>
<li>push amortized O(1)</li>
<li>push worst case O(n) on resize</li>
<li>pop amortized O(1)</li>
<li>get/set O(1)</li>
</ul></li>
<li><p>Space: O(n), capacity ≤ constant × size</p></li>
</ul>
<p>Dynamic array resizing turns a rigid array into a flexible container. Grow when needed, copy occasionally, and enjoy constant-time pushes on average.</p>
</section>
</section>
<section id="circular-array-implementation" class="level3">
<h3 class="anchored" data-anchor-id="circular-array-implementation">202 Circular Array Implementation</h3>
<p>A circular array (or ring buffer) stores elements in a fixed-size array while allowing wrap-around indexing. It is perfect for implementing queues and buffers where old data is overwritten or processed in a first-in-first-out manner.</p>
<section id="what-problem-are-we-solving-1" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-1">What Problem Are We Solving?</h4>
<p>A regular array wastes space if we only move front and rear pointers forward. A circular array solves this by wrapping indices around when they reach the end, so all slots can be reused without shifting elements.</p>
<p>Goal: Efficiently support enqueue, dequeue, peek, and size in O(1) time using a fixed-size buffer with wrap-around indexing.</p>
</section>
<section id="how-does-it-work-plain-language-1" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-1">How Does It Work (Plain Language)?</h4>
<p>Maintain:</p>
<ul>
<li><code>front</code>: index of the first element</li>
<li><code>rear</code>: index of the next free slot</li>
<li><code>count</code>: number of elements in the buffer</li>
<li><code>capacity</code>: maximum number of elements</li>
</ul>
<p>Wrap-around indexing uses modulo arithmetic:</p>
<pre class="text"><code>next_index = (current_index + 1) % capacity</code></pre>
<p>When adding or removing, always increment <code>front</code> or <code>rear</code> with this rule.</p>
<p>Example Steps (Wrap-around Simulation)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 27%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Front</th>
<th>Rear</th>
<th>Count</th>
<th>Array State</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>enqueue(10)</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>[10, <em>, </em>, _]</td>
<td>rear advanced</td>
</tr>
<tr class="even">
<td>2</td>
<td>enqueue(20)</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>[10, 20, <em>, </em>]</td>
<td></td>
</tr>
<tr class="odd">
<td>3</td>
<td>enqueue(30)</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td>[10, 20, 30, _]</td>
<td></td>
</tr>
<tr class="even">
<td>4</td>
<td>dequeue()</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>[<em>, 20, 30, </em>]</td>
<td>front advanced</td>
</tr>
<tr class="odd">
<td>5</td>
<td>enqueue(40)</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>[40, 20, 30, _]</td>
<td>wrap-around</td>
</tr>
<tr class="even">
<td>6</td>
<td>enqueue(50)</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>[40, 20, 30, 50]</td>
<td>full queue</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-1" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-1">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>data<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> front<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> rear<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> capacity<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> CircularQueue<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cq_init<span class="op">(</span>CircularQueue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> capacity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>data <span class="op">=</span> malloc<span class="op">(</span>capacity <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>q<span class="op">-&gt;</span>data<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>capacity <span class="op">=</span> capacity<span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>front <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cq_enqueue<span class="op">(</span>CircularQueue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>count <span class="op">==</span> q<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// full</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>data<span class="op">[</span>q<span class="op">-&gt;</span>rear<span class="op">]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="op">(</span>q<span class="op">-&gt;</span>rear <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> q<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count<span class="op">++;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cq_dequeue<span class="op">(</span>CircularQueue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// empty</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> q<span class="op">-&gt;</span>data<span class="op">[</span>q<span class="op">-&gt;</span>front<span class="op">];</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>front <span class="op">=</span> <span class="op">(</span>q<span class="op">-&gt;</span>front <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> q<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count<span class="op">--;</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    CircularQueue q<span class="op">;</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    cq_init<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    cq_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    cq_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    cq_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">30</span><span class="op">);</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    cq_dequeue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    cq_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">40</span><span class="op">);</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    cq_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">50</span><span class="op">);</span> <span class="co">// should fail if capacity=4</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Front value: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> q<span class="op">.</span>data<span class="op">[</span>q<span class="op">.</span>front<span class="op">]);</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>q<span class="op">.</span>data<span class="op">);</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CircularQueue:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, capacity):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._cap <span class="op">=</span> capacity</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> capacity</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._front <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rear <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> enqueue(<span class="va">self</span>, x):</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._count <span class="op">==</span> <span class="va">self</span>._cap:</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">OverflowError</span>(<span class="st">"queue full"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data[<span class="va">self</span>._rear] <span class="op">=</span> x</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rear <span class="op">=</span> (<span class="va">self</span>._rear <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="va">self</span>._cap</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dequeue(<span class="va">self</span>):</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"queue empty"</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>._data[<span class="va">self</span>._front]</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._front <span class="op">=</span> (<span class="va">self</span>._front <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="va">self</span>._cap</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._count <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> peek(<span class="va">self</span>):</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"queue empty"</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._data[<span class="va">self</span>._front]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-1" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-1">Why It Matters</h4>
<ul>
<li>Enables constant time queue operations</li>
<li>No element shifting needed</li>
<li>Efficient use of fixed memory</li>
<li>Backbone for circular buffers, task schedulers, streaming pipelines, and audio/video buffers</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-1" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-1">A Gentle Proof (Why It Works)</h4>
<p>Modulo indexing ensures positions loop back when reaching array end. If capacity is n, then all indices stay in <code>[0, n-1]</code>. No overflow occurs since <code>front</code>, <code>rear</code> always wrap around. The condition <code>count == capacity</code> detects full queue, and <code>count == 0</code> detects empty.</p>
<p>Thus each operation touches only one element and updates O(1) variables.</p>
</section>
<section id="try-it-yourself-1" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-1">Try It Yourself</h4>
<ol type="1">
<li>Implement a circular buffer with overwrite (old data replaced).</li>
<li>Add <code>is_full()</code> and <code>is_empty()</code> helpers.</li>
<li>Simulate producer-consumer with one enqueue per producer tick and one dequeue per consumer tick.</li>
<li>Extend to store structs instead of integers.</li>
</ol>
</section>
<section id="test-cases-1" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-1">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 27%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Operation Sequence</th>
<th>Front</th>
<th>Rear</th>
<th>Count</th>
<th>Array State</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>enqueue(10)</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>[10, <em>, </em>, _]</td>
<td>normal push</td>
</tr>
<tr class="even">
<td>enqueue(20)</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>[10, 20, <em>, </em>]</td>
<td></td>
</tr>
<tr class="odd">
<td>enqueue(30)</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td>[10, 20, 30, _]</td>
<td></td>
</tr>
<tr class="even">
<td>dequeue()</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>[<em>, 20, 30, </em>]</td>
<td></td>
</tr>
<tr class="odd">
<td>enqueue(40)</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>[40, 20, 30, _]</td>
<td>wrap-around</td>
</tr>
<tr class="even">
<td>enqueue(50)</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>[40, 20, 30, 50]</td>
<td>full</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Enqueue when full → error or overwrite</li>
<li>Dequeue when empty → error</li>
<li>Modulo indexing avoids overflow</li>
<li>Works with any capacity ≥ 1</li>
</ul>
</section>
<section id="complexity-1" class="level4">
<h4 class="anchored" data-anchor-id="complexity-1">Complexity</h4>
<ul>
<li>Time: O(1) for enqueue, dequeue, peek</li>
<li>Space: O(n) fixed buffer</li>
</ul>
<p>Circular arrays provide elegant constant-time queues with wrap-around indexing, a small trick that powers big systems.</p>
</section>
</section>
<section id="singly-linked-list-insertdelete" class="level3">
<h3 class="anchored" data-anchor-id="singly-linked-list-insertdelete">203 Singly Linked List Insert/Delete</h3>
<p>A singly linked list is a chain of nodes, each pointing to the next. It grows and shrinks dynamically without preallocating memory. Operations like insert and delete rely on pointer adjustments rather than shifting elements.</p>
<section id="what-problem-are-we-solving-2" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-2">What Problem Are We Solving?</h4>
<p>Static arrays are fixed-size and require shifting elements for insertions or deletions in the middle. Singly linked lists solve this by connecting elements through pointers, allowing efficient O(1) insertion and deletion (given a node reference).</p>
<p>Goal: Support insert, delete, and traversal on a structure that can grow dynamically without reallocating or shifting elements.</p>
</section>
<section id="how-does-it-work-plain-language-2" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-2">How Does It Work (Plain Language)?</h4>
<p>Each node stores two fields:</p>
<ul>
<li><code>data</code> (the value)</li>
<li><code>next</code> (pointer to the next node)</li>
</ul>
<p>The list has a <code>head</code> pointer to the first node. Insertion and deletion work by updating the <code>next</code> pointers.</p>
<p>Example Steps (Insertion at Position)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 4%">
<col style="width: 23%">
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Node Updated</th>
<th>Before</th>
<th>After</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>create list</td>
<td>-</td>
<td>empty</td>
<td>head = NULL</td>
<td>list starts empty</td>
</tr>
<tr class="even">
<td>2</td>
<td>insert(10) at head</td>
<td>new node</td>
<td>NULL</td>
<td>[10]</td>
<td>head → 10</td>
</tr>
<tr class="odd">
<td>3</td>
<td>insert(20) at head</td>
<td>new node</td>
<td>[10]</td>
<td>[20 → 10]</td>
<td>head updated</td>
</tr>
<tr class="even">
<td>4</td>
<td>insert(30) after 20</td>
<td>new node</td>
<td>[20 → 10]</td>
<td>[20 → 30 → 10]</td>
<td>pointer rerouted</td>
</tr>
<tr class="odd">
<td>5</td>
<td>delete(30)</td>
<td>node 20</td>
<td>[20 → 30 → 10]</td>
<td>[20 → 10]</td>
<td>bypass removed node</td>
</tr>
</tbody>
</table>
<p>Key idea: To insert, point the new node’s <code>next</code> to the target’s next, then link the target’s <code>next</code> to the new node. To delete, bypass the target node by linking previous node’s <code>next</code> to the one after target.</p>
</section>
<section id="tiny-code-easy-versions-2" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-2">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> data<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert_head<span class="op">(</span>Node<span class="op">*</span> head<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> new_node <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>data <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>next <span class="op">=</span> head<span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_node<span class="op">;</span> <span class="co">// new head</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert_after<span class="op">(</span>Node<span class="op">*</span> node<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>node<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> new_node <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>data <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>next <span class="op">=</span> node<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>next <span class="op">=</span> new_node<span class="op">;</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_node<span class="op">;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> delete_value<span class="op">(</span>Node<span class="op">*</span> head<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>head<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>head<span class="op">-&gt;</span>data <span class="op">==</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        Node<span class="op">*</span> tmp <span class="op">=</span> head<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        free<span class="op">(</span>head<span class="op">);</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> tmp<span class="op">;</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> prev <span class="op">=</span> head<span class="op">;</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> cur <span class="op">=</span> head<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>cur<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>cur<span class="op">-&gt;</span>data <span class="op">==</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>            prev<span class="op">-&gt;</span>next <span class="op">=</span> cur<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>cur<span class="op">);</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>        prev <span class="op">=</span> cur<span class="op">;</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        cur <span class="op">=</span> cur<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> head<span class="op">;</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_list<span class="op">(</span>Node<span class="op">*</span> head<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Node<span class="op">*</span> p <span class="op">=</span> head<span class="op">;</span> p<span class="op">;</span> p <span class="op">=</span> p<span class="op">-&gt;</span>next<span class="op">)</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> -&gt; "</span><span class="op">,</span> p<span class="op">-&gt;</span>data<span class="op">);</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"NULL</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> head <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    head <span class="op">=</span> insert_head<span class="op">(</span>head<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    head <span class="op">=</span> insert_head<span class="op">(</span>head<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    insert_after<span class="op">(</span>head<span class="op">,</span> <span class="dv">30</span><span class="op">);</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    print_list<span class="op">(</span>head<span class="op">);</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    head <span class="op">=</span> delete_value<span class="op">(</span>head<span class="op">,</span> <span class="dv">30</span><span class="op">);</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    print_list<span class="op">(</span>head<span class="op">);</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> data</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">next</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LinkedList:</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.head <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert_head(<span class="va">self</span>, data):</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Node(data)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        node.<span class="bu">next</span> <span class="op">=</span> <span class="va">self</span>.head</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.head <span class="op">=</span> node</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert_after(<span class="va">self</span>, prev, data):</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> prev <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Node(data)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        node.<span class="bu">next</span> <span class="op">=</span> prev.<span class="bu">next</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        prev.<span class="bu">next</span> <span class="op">=</span> node</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete_value(<span class="va">self</span>, value):</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        cur <span class="op">=</span> <span class="va">self</span>.head</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        prev <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> cur:</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cur.data <span class="op">==</span> value:</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> prev:</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                    prev.<span class="bu">next</span> <span class="op">=</span> cur.<span class="bu">next</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.head <span class="op">=</span> cur.<span class="bu">next</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>            prev <span class="op">=</span> cur</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>            cur <span class="op">=</span> cur.<span class="bu">next</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> print_list(<span class="va">self</span>):</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        cur <span class="op">=</span> <span class="va">self</span>.head</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> cur:</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(cur.data, end<span class="op">=</span><span class="st">" -&gt; "</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>            cur <span class="op">=</span> cur.<span class="bu">next</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"NULL"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-2" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-2">Why It Matters</h4>
<ul>
<li>Provides dynamic growth with no preallocation</li>
<li>Enables O(1) insertion and deletion at head or given position</li>
<li>Useful in stacks, queues, hash table buckets, and adjacency lists</li>
<li>Foundation for more complex data structures (trees, graphs)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-2" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-2">A Gentle Proof (Why It Works)</h4>
<p>Each operation only changes a constant number of pointers.</p>
<ul>
<li>Insert: 2 assignments → O(1)</li>
<li>Delete: find node O(n), then 1 reassignment Because pointers are updated locally, the rest of the list remains valid.</li>
</ul>
</section>
<section id="try-it-yourself-2" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-2">Try It Yourself</h4>
<ol type="1">
<li>Implement insert_tail for O(n) tail insertion.</li>
<li>Write reverse() to flip the list in place.</li>
<li>Add size() to count nodes.</li>
<li>Experiment with deleting from head and middle.</li>
</ol>
</section>
<section id="test-cases-2" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-2">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert_head(10)</td>
<td>[]</td>
<td>[10]</td>
<td>creates head</td>
</tr>
<tr class="even">
<td>insert_head(20)</td>
<td>[10]</td>
<td>[20 → 10]</td>
<td>new head</td>
</tr>
<tr class="odd">
<td>insert_after(head, 30)</td>
<td>[20 → 10]</td>
<td>[20 → 30 → 10]</td>
<td>pointer reroute</td>
</tr>
<tr class="even">
<td>delete_value(30)</td>
<td>[20 → 30 → 10]</td>
<td>[20 → 10]</td>
<td>node removed</td>
</tr>
<tr class="odd">
<td>delete_value(40)</td>
<td>[20 → 10]</td>
<td>[20 → 10]</td>
<td>no change</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Delete from empty list → no effect</li>
<li>Insert after NULL → no effect</li>
<li>Delete head node → update head pointer</li>
</ul>
</section>
<section id="complexity-2" class="level4">
<h4 class="anchored" data-anchor-id="complexity-2">Complexity</h4>
<ul>
<li>Time: insert O(1), delete O(n) (if searching by value), traversal O(n)</li>
<li>Space: O(n) for n nodes</li>
</ul>
<p>Singly linked lists teach pointer manipulation, where structure grows one node at a time, and every link matters.</p>
</section>
</section>
<section id="doubly-linked-list-insertdelete" class="level3">
<h3 class="anchored" data-anchor-id="doubly-linked-list-insertdelete">204 Doubly Linked List Insert/Delete</h3>
<p>A doubly linked list extends the singly linked list by adding backward links. Each node points to both its previous and next neighbor, making insertions and deletions easier in both directions.</p>
<section id="what-problem-are-we-solving-3" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-3">What Problem Are We Solving?</h4>
<p>Singly linked lists cannot traverse backward and deleting a node requires access to its predecessor. Doubly linked lists fix this by storing two pointers per node, allowing constant-time insertions and deletions at any position when you have a node reference.</p>
<p>Goal: Support bidirectional traversal and efficient local insert/delete operations with O(1) pointer updates.</p>
</section>
<section id="how-does-it-work-plain-language-3" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-3">How Does It Work (Plain Language)?</h4>
<p>Each node stores:</p>
<ul>
<li><code>data</code>: the value</li>
<li><code>prev</code>: pointer to the previous node</li>
<li><code>next</code>: pointer to the next node</li>
</ul>
<p>The list tracks two ends:</p>
<ul>
<li><code>head</code> points to the first node</li>
<li><code>tail</code> points to the last node</li>
</ul>
<p>Example Steps (Insertion and Deletion)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 22%">
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Target</th>
<th>Before</th>
<th>After</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>create list</td>
<td>-</td>
<td>empty</td>
<td>[10]</td>
<td>head=tail=10</td>
</tr>
<tr class="even">
<td>2</td>
<td>insert_front(20)</td>
<td>head</td>
<td>[10]</td>
<td>[20 ⇄ 10]</td>
<td>head updated</td>
</tr>
<tr class="odd">
<td>3</td>
<td>insert_back(30)</td>
<td>tail</td>
<td>[20 ⇄ 10]</td>
<td>[20 ⇄ 10 ⇄ 30]</td>
<td>tail updated</td>
</tr>
<tr class="even">
<td>4</td>
<td>delete(10)</td>
<td>middle</td>
<td>[20 ⇄ 10 ⇄ 30]</td>
<td>[20 ⇄ 30]</td>
<td>pointers bypass 10</td>
</tr>
</tbody>
</table>
<p>Each operation only touches nearby nodes, no need to shift elements.</p>
</section>
<section id="tiny-code-easy-versions-3" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-3">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> data<span class="op">;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node<span class="op">*</span> prev<span class="op">;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node<span class="op">*</span> next<span class="op">;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert_front<span class="op">(</span>Node<span class="op">*</span> head<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> node <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>data <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>prev <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>next <span class="op">=</span> head<span class="op">;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>head<span class="op">)</span> head<span class="op">-&gt;</span>prev <span class="op">=</span> node<span class="op">;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> node<span class="op">;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert_back<span class="op">(</span>Node<span class="op">*</span> head<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> node <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>data <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>next <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>head<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>prev <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node<span class="op">;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> tail <span class="op">=</span> head<span class="op">;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>tail<span class="op">-&gt;</span>next<span class="op">)</span> tail <span class="op">=</span> tail<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    tail<span class="op">-&gt;</span>next <span class="op">=</span> node<span class="op">;</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>prev <span class="op">=</span> tail<span class="op">;</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> head<span class="op">;</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> delete_value<span class="op">(</span>Node<span class="op">*</span> head<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> cur <span class="op">=</span> head<span class="op">;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>cur <span class="op">&amp;&amp;</span> cur<span class="op">-&gt;</span>data <span class="op">!=</span> value<span class="op">)</span> cur <span class="op">=</span> cur<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>cur<span class="op">)</span> <span class="cf">return</span> head<span class="op">;</span> <span class="co">// not found</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>cur<span class="op">-&gt;</span>prev<span class="op">)</span> cur<span class="op">-&gt;</span>prev<span class="op">-&gt;</span>next <span class="op">=</span> cur<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> head <span class="op">=</span> cur<span class="op">-&gt;</span>next<span class="op">;</span> <span class="co">// deleting head</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>cur<span class="op">-&gt;</span>next<span class="op">)</span> cur<span class="op">-&gt;</span>next<span class="op">-&gt;</span>prev <span class="op">=</span> cur<span class="op">-&gt;</span>prev<span class="op">;</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>cur<span class="op">);</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> head<span class="op">;</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_forward<span class="op">(</span>Node<span class="op">*</span> head<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Node<span class="op">*</span> p <span class="op">=</span> head<span class="op">;</span> p<span class="op">;</span> p <span class="op">=</span> p<span class="op">-&gt;</span>next<span class="op">)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> ⇄ "</span><span class="op">,</span> p<span class="op">-&gt;</span>data<span class="op">);</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"NULL</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> data</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.prev <span class="op">=</span> <span class="va">None</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">next</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DoublyLinkedList:</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.head <span class="op">=</span> <span class="va">None</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert_front(<span class="va">self</span>, data):</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Node(data)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        node.<span class="bu">next</span> <span class="op">=</span> <span class="va">self</span>.head</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.head:</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.head.prev <span class="op">=</span> node</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.head <span class="op">=</span> node</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert_back(<span class="va">self</span>, data):</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Node(data)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.head:</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.head <span class="op">=</span> node</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        cur <span class="op">=</span> <span class="va">self</span>.head</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> cur.<span class="bu">next</span>:</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>            cur <span class="op">=</span> cur.<span class="bu">next</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        cur.<span class="bu">next</span> <span class="op">=</span> node</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        node.prev <span class="op">=</span> cur</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete_value(<span class="va">self</span>, value):</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        cur <span class="op">=</span> <span class="va">self</span>.head</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> cur:</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cur.data <span class="op">==</span> value:</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> cur.prev:</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                    cur.prev.<span class="bu">next</span> <span class="op">=</span> cur.<span class="bu">next</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.head <span class="op">=</span> cur.<span class="bu">next</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> cur.<span class="bu">next</span>:</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                    cur.<span class="bu">next</span>.prev <span class="op">=</span> cur.prev</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>            cur <span class="op">=</span> cur.<span class="bu">next</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> print_forward(<span class="va">self</span>):</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>        cur <span class="op">=</span> <span class="va">self</span>.head</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> cur:</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(cur.data, end<span class="op">=</span><span class="st">" ⇄ "</span>)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>            cur <span class="op">=</span> cur.<span class="bu">next</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"NULL"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-3" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-3">Why It Matters</h4>
<ul>
<li>Bidirectional traversal (forward/backward)</li>
<li>O(1) insertion and deletion when node is known</li>
<li>Foundation for deque, LRU cache, and text editor buffers</li>
<li>Enables clean list reversal and splice operations</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-3" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-3">A Gentle Proof (Why It Works)</h4>
<p>Each node update modifies at most four pointers:</p>
<ul>
<li>Insert: new node’s <code>next</code>, <code>prev</code> + neighbor links</li>
<li>Delete: predecessor’s <code>next</code>, successor’s <code>prev</code> Since each step is constant work, operations are O(1) given node reference.</li>
</ul>
<p>Traversal still costs O(n), but local edits are efficient.</p>
</section>
<section id="try-it-yourself-3" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-3">Try It Yourself</h4>
<ol type="1">
<li>Implement reverse() by swapping <code>prev</code> and <code>next</code> pointers.</li>
<li>Add tail pointer to allow O(1) insert_back.</li>
<li>Support bidirectional iteration.</li>
<li>Implement <code>pop_front()</code> and <code>pop_back()</code>.</li>
</ol>
</section>
<section id="test-cases-3" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-3">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Output</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert_front(10)</td>
<td>[]</td>
<td>[10]</td>
<td>head=tail=10</td>
</tr>
<tr class="even">
<td>insert_front(20)</td>
<td>[10]</td>
<td>[20 ⇄ 10]</td>
<td>new head</td>
</tr>
<tr class="odd">
<td>insert_back(30)</td>
<td>[20 ⇄ 10]</td>
<td>[20 ⇄ 10 ⇄ 30]</td>
<td>new tail</td>
</tr>
<tr class="even">
<td>delete_value(10)</td>
<td>[20 ⇄ 10 ⇄ 30]</td>
<td>[20 ⇄ 30]</td>
<td>middle removed</td>
</tr>
<tr class="odd">
<td>delete_value(20)</td>
<td>[20 ⇄ 30]</td>
<td>[30]</td>
<td>head removed</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Deleting from empty list → no effect</li>
<li>Inserting on empty list sets both head and tail</li>
<li>Properly maintain both directions after each update</li>
</ul>
</section>
<section id="complexity-3" class="level4">
<h4 class="anchored" data-anchor-id="complexity-3">Complexity</h4>
<ul>
<li><p>Time:</p>
<ul>
<li>Insert/Delete (given node): O(1)</li>
<li>Search: O(n)</li>
<li>Traverse: O(n)</li>
</ul></li>
<li><p>Space: O(n) (2 pointers per node)</p></li>
</ul>
<p>Doubly linked lists bring symmetry, move forward, move back, and edit in constant time.</p>
</section>
</section>
<section id="stack-pushpop" class="level3">
<h3 class="anchored" data-anchor-id="stack-pushpop">205 Stack Push/Pop</h3>
<p>A stack is a simple but powerful data structure that follows the LIFO (Last In, First Out) rule. The most recently added element is the first to be removed, like stacking plates where you can only take from the top.</p>
<section id="what-problem-are-we-solving-4" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-4">What Problem Are We Solving?</h4>
<p>We often need to reverse order or track nested operations, such as function calls, parentheses, undo/redo, and expression evaluation. A stack gives us a clean way to manage this behavior with push (add) and pop (remove).</p>
<p>Goal: Support push, pop, peek, and is_empty in O(1) time, maintaining LIFO order.</p>
</section>
<section id="how-does-it-work-plain-language-4" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-4">How Does It Work (Plain Language)?</h4>
<p>Think of a vertical pile.</p>
<ul>
<li>Push(x): Place x on top.</li>
<li>Pop(): Remove the top element.</li>
<li>Peek(): View top without removing.</li>
</ul>
<p>Implementation can use either an array (fixed or dynamic) or a linked list.</p>
<p>Example Steps (Array Stack Simulation)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Stack (Top → Bottom)</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>push(10)</td>
<td>[10]</td>
<td>first element</td>
</tr>
<tr class="even">
<td>2</td>
<td>push(20)</td>
<td>[20, 10]</td>
<td>top is 20</td>
</tr>
<tr class="odd">
<td>3</td>
<td>push(30)</td>
<td>[30, 20, 10]</td>
<td></td>
</tr>
<tr class="even">
<td>4</td>
<td>pop()</td>
<td>[20, 10]</td>
<td>30 removed</td>
</tr>
<tr class="odd">
<td>5</td>
<td>peek()</td>
<td>top = 20</td>
<td>top unchanged</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-4" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-4">Tiny Code (Easy Versions)</h4>
<p>C (Array-Based Stack)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>data<span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> top<span class="op">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> capacity<span class="op">;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Stack<span class="op">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> stack_init<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>data <span class="op">=</span> malloc<span class="op">(</span>cap <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>s<span class="op">-&gt;</span>data<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>capacity <span class="op">=</span> cap<span class="op">;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>top <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> stack_push<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>top <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> s<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// full</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>data<span class="op">[++</span>s<span class="op">-&gt;</span>top<span class="op">]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> stack_pop<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>top <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// empty</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> s<span class="op">-&gt;</span>data<span class="op">[</span>s<span class="op">-&gt;</span>top<span class="op">--];</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> stack_peek<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>top <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> s<span class="op">-&gt;</span>data<span class="op">[</span>s<span class="op">-&gt;</span>top<span class="op">];</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    Stack s<span class="op">;</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    stack_init<span class="op">(&amp;</span>s<span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    stack_push<span class="op">(&amp;</span>s<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    stack_push<span class="op">(&amp;</span>s<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    stack_pop<span class="op">(&amp;</span>s<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Popped: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    stack_peek<span class="op">(&amp;</span>s<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Top: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>s<span class="op">.</span>data<span class="op">);</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (List as Stack)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Stack:</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data <span class="op">=</span> []</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> push(<span class="va">self</span>, x):</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data.append(x)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pop(<span class="va">self</span>):</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._data:</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"pop from empty stack"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._data.pop()</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> peek(<span class="va">self</span>):</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._data:</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"peek from empty stack"</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._data[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_empty(<span class="va">self</span>):</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._data) <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> Stack()</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>s.push(<span class="dv">10</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>s.push(<span class="dv">20</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s.pop())  <span class="co"># 20</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s.peek()) <span class="co"># 10</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-4" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-4">Why It Matters</h4>
<ul>
<li>Core to recursion, parsing, and backtracking</li>
<li>Underpins function call stacks in programming languages</li>
<li>Natural structure for undo, reverse, and balanced parentheses</li>
<li>Simplicity with wide applications in algorithms</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-4" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-4">A Gentle Proof (Why It Works)</h4>
<p>Each operation touches only the top element or index.</p>
<ul>
<li><code>push</code>: increment top, write value</li>
<li><code>pop</code>: read top, decrement top All O(1) time. The LIFO property ensures correct reverse order for function calls and nested scopes.</li>
</ul>
</section>
<section id="try-it-yourself-4" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-4">Try It Yourself</h4>
<ol type="1">
<li>Implement stack with linked list nodes.</li>
<li>Extend capacity dynamically when full.</li>
<li>Use stack to check balanced parentheses in a string.</li>
<li>Reverse a list using stack operations.</li>
</ol>
</section>
<section id="test-cases-4" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-4">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Output</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>push(10)</td>
<td>[]</td>
<td>[10]</td>
<td>top = 10</td>
</tr>
<tr class="even">
<td>push(20)</td>
<td>[10]</td>
<td>[20, 10]</td>
<td>top = 20</td>
</tr>
<tr class="odd">
<td>pop()</td>
<td>[20, 10]</td>
<td>returns 20, stack [10]</td>
<td></td>
</tr>
<tr class="even">
<td>peek()</td>
<td>[10]</td>
<td>returns 10</td>
<td></td>
</tr>
<tr class="odd">
<td>pop()</td>
<td>[10]</td>
<td>returns 10, stack []</td>
<td>empty after pop</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Pop from empty → error or return false</li>
<li>Peek from empty → error</li>
<li>Overflow if array full (unless dynamic)</li>
</ul>
</section>
<section id="complexity-4" class="level4">
<h4 class="anchored" data-anchor-id="complexity-4">Complexity</h4>
<ul>
<li>Time: push O(1), pop O(1), peek O(1)</li>
<li>Space: O(n) for n elements</li>
</ul>
<p>Stacks embody disciplined memory, last in, first out, a minimalist model of control flow and history.</p>
</section>
</section>
<section id="queue-enqueuedequeue" class="level3">
<h3 class="anchored" data-anchor-id="queue-enqueuedequeue">206 Queue Enqueue/Dequeue</h3>
<p>A queue is the mirror twin of a stack. It follows FIFO (First In, First Out), the first element added is the first one removed, like people waiting in line.</p>
<section id="what-problem-are-we-solving-5" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-5">What Problem Are We Solving?</h4>
<p>We need a structure where items are processed in arrival order: scheduling tasks, buffering data, breadth-first search, or managing print jobs. A queue lets us enqueue at the back and dequeue from the front, simple and fair.</p>
<p>Goal: Support enqueue, dequeue, peek, and is_empty in O(1) time using a circular layout or linked list.</p>
</section>
<section id="how-does-it-work-plain-language-5" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-5">How Does It Work (Plain Language)?</h4>
<p>A queue has two ends:</p>
<ul>
<li>front → where items are removed</li>
<li>rear → where items are added</li>
</ul>
<p>Operations:</p>
<ul>
<li><code>enqueue(x)</code> adds at <code>rear</code></li>
<li><code>dequeue()</code> removes from <code>front</code></li>
<li><code>peek()</code> looks at the <code>front</code> item</li>
</ul>
<p>If implemented with a circular array, wrap indices using modulo arithmetic.</p>
<p>Example Steps (FIFO Simulation)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 19%">
<col style="width: 35%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Queue (Front → Rear)</th>
<th>Front</th>
<th>Rear</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>enqueue(10)</td>
<td>[10]</td>
<td>0</td>
<td>1</td>
<td>first element</td>
</tr>
<tr class="even">
<td>2</td>
<td>enqueue(20)</td>
<td>[10, 20]</td>
<td>0</td>
<td>2</td>
<td>rear advanced</td>
</tr>
<tr class="odd">
<td>3</td>
<td>enqueue(30)</td>
<td>[10, 20, 30]</td>
<td>0</td>
<td>3</td>
<td></td>
</tr>
<tr class="even">
<td>4</td>
<td>dequeue()</td>
<td>[20, 30]</td>
<td>1</td>
<td>3</td>
<td>10 removed</td>
</tr>
<tr class="odd">
<td>5</td>
<td>enqueue(40)</td>
<td>[20, 30, 40]</td>
<td>1</td>
<td>0</td>
<td>wrap-around</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-5" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-5">Tiny Code (Easy Versions)</h4>
<p>C (Circular Array Queue)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>data<span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> front<span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> rear<span class="op">;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count<span class="op">;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> capacity<span class="op">;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Queue<span class="op">;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> queue_init<span class="op">(</span>Queue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>data <span class="op">=</span> malloc<span class="op">(</span>cap <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>q<span class="op">-&gt;</span>data<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>capacity <span class="op">=</span> cap<span class="op">;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>front <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> enqueue<span class="op">(</span>Queue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>count <span class="op">==</span> q<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// full</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>data<span class="op">[</span>q<span class="op">-&gt;</span>rear<span class="op">]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="op">(</span>q<span class="op">-&gt;</span>rear <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> q<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count<span class="op">++;</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dequeue<span class="op">(</span>Queue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// empty</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> q<span class="op">-&gt;</span>data<span class="op">[</span>q<span class="op">-&gt;</span>front<span class="op">];</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>front <span class="op">=</span> <span class="op">(</span>q<span class="op">-&gt;</span>front <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> q<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count<span class="op">--;</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> queue_peek<span class="op">(</span>Queue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> q<span class="op">-&gt;</span>data<span class="op">[</span>q<span class="op">-&gt;</span>front<span class="op">];</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    Queue q<span class="op">;</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    queue_init<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">30</span><span class="op">);</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    dequeue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Dequeued: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">40</span><span class="op">);</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">50</span><span class="op">);</span> <span class="co">// will fail if capacity = 4</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    queue_peek<span class="op">(&amp;</span>q<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Front: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>q<span class="op">.</span>data<span class="op">);</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (List as Queue using deque)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> deque</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Queue:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data <span class="op">=</span> deque()</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> enqueue(<span class="va">self</span>, x):</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data.append(x)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dequeue(<span class="va">self</span>):</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._data:</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"dequeue from empty queue"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._data.popleft()</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> peek(<span class="va">self</span>):</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._data:</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"peek from empty queue"</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._data[<span class="dv">0</span>]</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_empty(<span class="va">self</span>):</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._data) <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> Queue()</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>q.enqueue(<span class="dv">10</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>q.enqueue(<span class="dv">20</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q.dequeue())  <span class="co"># 10</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q.peek())     <span class="co"># 20</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-5" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-5">Why It Matters</h4>
<ul>
<li>Enforces fairness (first come, first served)</li>
<li>Foundation for BFS, schedulers, buffers, pipelines</li>
<li>Easy to implement and reason about</li>
<li>Natural counterpart to stack</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-5" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-5">A Gentle Proof (Why It Works)</h4>
<p>Each operation updates only front or rear index, not entire array. Circular indexing ensures constant-time wrap-around:</p>
<pre class="text"><code>rear = (rear + 1) % capacity
front = (front + 1) % capacity</code></pre>
<p>All operations touch O(1) data and fields, so runtime stays O(1).</p>
</section>
<section id="try-it-yourself-5" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-5">Try It Yourself</h4>
<ol type="1">
<li>Implement a linked-list-based queue.</li>
<li>Add <code>is_full()</code> and <code>is_empty()</code> checks.</li>
<li>Write a queue-based BFS on a simple graph.</li>
<li>Compare linear vs circular queue behavior.</li>
</ol>
</section>
<section id="test-cases-5" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-5">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 35%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Queue (Front → Rear)</th>
<th>Front</th>
<th>Rear</th>
<th>Count</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>enqueue(10)</td>
<td>[10]</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td></td>
</tr>
<tr class="even">
<td>enqueue(20)</td>
<td>[10, 20]</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td></td>
</tr>
<tr class="odd">
<td>enqueue(30)</td>
<td>[10, 20, 30]</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td></td>
</tr>
<tr class="even">
<td>dequeue()</td>
<td>[20, 30]</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>removes 10</td>
</tr>
<tr class="odd">
<td>enqueue(40)</td>
<td>[20, 30, 40]</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>wrap-around</td>
</tr>
<tr class="even">
<td>peek()</td>
<td>front=20</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>check front</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Dequeue from empty → error</li>
<li>Enqueue to full → overflow</li>
<li>Works seamlessly with wrap-around</li>
</ul>
</section>
<section id="complexity-5" class="level4">
<h4 class="anchored" data-anchor-id="complexity-5">Complexity</h4>
<ul>
<li>Time: enqueue O(1), dequeue O(1), peek O(1)</li>
<li>Space: O(n) for fixed buffer or dynamic growth</li>
</ul>
<p>Queues bring fairness to data, what goes in first comes out first, steady and predictable.</p>
</section>
</section>
<section id="deque-implementation" class="level3">
<h3 class="anchored" data-anchor-id="deque-implementation">207 Deque Implementation</h3>
<p>A deque (double-ended queue) is a flexible container that allows adding and removing elements from both ends, a blend of stack and queue behavior.</p>
<section id="what-problem-are-we-solving-6" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-6">What Problem Are We Solving?</h4>
<p>Stacks restrict you to one end, queues to two fixed roles. Sometimes we need both: insert at front or back, pop from either side. Deques power sliding window algorithms, palindrome checks, undo-redo systems, and task schedulers.</p>
<p>Goal: Support <code>push_front</code>, <code>push_back</code>, <code>pop_front</code>, <code>pop_back</code>, and <code>peek_front/back</code> in O(1) time.</p>
</section>
<section id="how-does-it-work-plain-language-6" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-6">How Does It Work (Plain Language)?</h4>
<p>Deques can be built using:</p>
<ul>
<li>A circular array (using wrap-around indexing)</li>
<li>A doubly linked list (bidirectional pointers)</li>
</ul>
<p>Operations:</p>
<ul>
<li><code>push_front(x)</code> → insert before front</li>
<li><code>push_back(x)</code> → insert after rear</li>
<li><code>pop_front()</code> → remove front element</li>
<li><code>pop_back()</code> → remove rear element</li>
</ul>
<p>Example Steps (Circular Array Simulation)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 20%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 31%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Front</th>
<th>Rear</th>
<th>Deque (Front → Rear)</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>push_back(10)</td>
<td>0</td>
<td>1</td>
<td>[10]</td>
<td>first item</td>
</tr>
<tr class="even">
<td>2</td>
<td>push_back(20)</td>
<td>0</td>
<td>2</td>
<td>[10, 20]</td>
<td>rear grows</td>
</tr>
<tr class="odd">
<td>3</td>
<td>push_front(5)</td>
<td>3</td>
<td>2</td>
<td>[5, 10, 20]</td>
<td>wrap-around front</td>
</tr>
<tr class="even">
<td>4</td>
<td>pop_back()</td>
<td>3</td>
<td>1</td>
<td>[5, 10]</td>
<td>20 removed</td>
</tr>
<tr class="odd">
<td>5</td>
<td>pop_front()</td>
<td>0</td>
<td>1</td>
<td>[10]</td>
<td>5 removed</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-6" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-6">Tiny Code (Easy Versions)</h4>
<p>C (Circular Array Deque)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>data<span class="op">;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> front<span class="op">;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> rear<span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count<span class="op">;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> capacity<span class="op">;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Deque<span class="op">;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dq_init<span class="op">(</span>Deque <span class="op">*</span>d<span class="op">,</span> <span class="dt">int</span> cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>data <span class="op">=</span> malloc<span class="op">(</span>cap <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>d<span class="op">-&gt;</span>data<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>capacity <span class="op">=</span> cap<span class="op">;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>front <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dq_push_front<span class="op">(</span>Deque <span class="op">*</span>d<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>d<span class="op">-&gt;</span>count <span class="op">==</span> d<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// full</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>front <span class="op">=</span> <span class="op">(</span>d<span class="op">-&gt;</span>front <span class="op">-</span> <span class="dv">1</span> <span class="op">+</span> d<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="op">%</span> d<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>data<span class="op">[</span>d<span class="op">-&gt;</span>front<span class="op">]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>count<span class="op">++;</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dq_push_back<span class="op">(</span>Deque <span class="op">*</span>d<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>d<span class="op">-&gt;</span>count <span class="op">==</span> d<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>data<span class="op">[</span>d<span class="op">-&gt;</span>rear<span class="op">]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="op">(</span>d<span class="op">-&gt;</span>rear <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> d<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>count<span class="op">++;</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dq_pop_front<span class="op">(</span>Deque <span class="op">*</span>d<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>d<span class="op">-&gt;</span>count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> d<span class="op">-&gt;</span>data<span class="op">[</span>d<span class="op">-&gt;</span>front<span class="op">];</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>front <span class="op">=</span> <span class="op">(</span>d<span class="op">-&gt;</span>front <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> d<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>count<span class="op">--;</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dq_pop_back<span class="op">(</span>Deque <span class="op">*</span>d<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>d<span class="op">-&gt;</span>count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="op">(</span>d<span class="op">-&gt;</span>rear <span class="op">-</span> <span class="dv">1</span> <span class="op">+</span> d<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="op">%</span> d<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> d<span class="op">-&gt;</span>data<span class="op">[</span>d<span class="op">-&gt;</span>rear<span class="op">];</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    d<span class="op">-&gt;</span>count<span class="op">--;</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    Deque d<span class="op">;</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    dq_init<span class="op">(&amp;</span>d<span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    dq_push_back<span class="op">(&amp;</span>d<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    dq_push_back<span class="op">(&amp;</span>d<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    dq_push_front<span class="op">(&amp;</span>d<span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    dq_pop_back<span class="op">(&amp;</span>d<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Popped back: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>    dq_pop_front<span class="op">(&amp;</span>d<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Popped front: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>d<span class="op">.</span>data<span class="op">);</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (Deque using collections)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> deque</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> deque()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>d.append(<span class="dv">10</span>)       <span class="co"># push_back</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>d.appendleft(<span class="dv">5</span>)    <span class="co"># push_front</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>d.append(<span class="dv">20</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d.pop())     <span class="co"># pop_back -&gt; 20</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d.popleft()) <span class="co"># pop_front -&gt; 5</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d)           <span class="co"># deque([10])</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-6" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-6">Why It Matters</h4>
<ul>
<li>Generalizes both stack and queue</li>
<li>Core tool for sliding window maximum, palindrome checks, BFS with state, and task buffers</li>
<li>Doubly-ended flexibility with constant-time operations</li>
<li>Ideal for systems needing symmetric access</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-6" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-6">A Gentle Proof (Why It Works)</h4>
<p>Circular indexing ensures wrap-around in O(1). Each operation moves one index and changes one value:</p>
<ul>
<li>push → set value + adjust index</li>
<li>pop → adjust index + read value</li>
</ul>
<p>No shifting or reallocation needed, so all operations remain O(1).</p>
</section>
<section id="try-it-yourself-6" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-6">Try It Yourself</h4>
<ol type="1">
<li>Implement deque with a doubly linked list.</li>
<li>Add <code>peek_front()</code> and <code>peek_back()</code>.</li>
<li>Simulate a sliding window maximum algorithm.</li>
<li>Compare performance of deque vs list for queue-like tasks.</li>
</ol>
</section>
<section id="test-cases-6" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-6">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 35%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Front</th>
<th>Rear</th>
<th>Count</th>
<th>Deque (Front → Rear)</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>push_back(10)</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>[10]</td>
<td>init</td>
</tr>
<tr class="even">
<td>push_back(20)</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>[10, 20]</td>
<td></td>
</tr>
<tr class="odd">
<td>push_front(5)</td>
<td>3</td>
<td>2</td>
<td>3</td>
<td>[5, 10, 20]</td>
<td>wrap front</td>
</tr>
<tr class="even">
<td>pop_back()</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>[5, 10]</td>
<td>20 removed</td>
</tr>
<tr class="odd">
<td>pop_front()</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>[10]</td>
<td>5 removed</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Push on full deque → error or resize</li>
<li>Pop on empty deque → error</li>
<li>Wrap-around correctness is critical</li>
</ul>
</section>
<section id="complexity-6" class="level4">
<h4 class="anchored" data-anchor-id="complexity-6">Complexity</h4>
<ul>
<li>Time: push/pop front/back O(1)</li>
<li>Space: O(n)</li>
</ul>
<p>Deques are the agile queues, you can act from either side, fast and fair.</p>
</section>
</section>
<section id="circular-queue" class="level3">
<h3 class="anchored" data-anchor-id="circular-queue">208 Circular Queue</h3>
<p>A circular queue is a queue optimized for fixed-size buffers where indices wrap around automatically. It’s widely used in real-time systems, network packet buffers, and streaming pipelines to reuse space efficiently.</p>
<section id="what-problem-are-we-solving-7" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-7">What Problem Are We Solving?</h4>
<p>A linear queue wastes space after several dequeues, since front indices move forward. A circular queue solves this by wrapping the indices, making every slot reusable.</p>
<p>Goal: Implement a queue with fixed capacity where enqueue and dequeue both take O(1) time and space is used cyclically.</p>
</section>
<section id="how-does-it-work-plain-language-7" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-7">How Does It Work (Plain Language)?</h4>
<p>A circular queue keeps track of:</p>
<ul>
<li><code>front</code>: index of the first element</li>
<li><code>rear</code>: index of the next position to insert</li>
<li><code>count</code>: number of elements</li>
</ul>
<p>Use modulo arithmetic for wrap-around:</p>
<pre class="text"><code>next_index = (current_index + 1) % capacity</code></pre>
<p>Key Conditions</p>
<ul>
<li>Full when <code>count == capacity</code></li>
<li>Empty when <code>count == 0</code></li>
</ul>
<p>Example Steps (Wrap-around Simulation)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 27%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Front</th>
<th>Rear</th>
<th>Count</th>
<th>Queue State</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>enqueue(10)</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>[10, <em>, </em>, _]</td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td>enqueue(20)</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>[10, 20, <em>, </em>]</td>
<td></td>
</tr>
<tr class="odd">
<td>3</td>
<td>enqueue(30)</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td>[10, 20, 30, _]</td>
<td></td>
</tr>
<tr class="even">
<td>4</td>
<td>dequeue()</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>[<em>, 20, 30, </em>]</td>
<td>front advanced</td>
</tr>
<tr class="odd">
<td>5</td>
<td>enqueue(40)</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>[40, 20, 30, _]</td>
<td>wrap-around</td>
</tr>
<tr class="even">
<td>6</td>
<td>enqueue(50)</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>[40, 20, 30, 50]</td>
<td>full</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-7" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-7">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>data<span class="op">;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> front<span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> rear<span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count<span class="op">;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> capacity<span class="op">;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> CircularQueue<span class="op">;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cq_init<span class="op">(</span>CircularQueue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>data <span class="op">=</span> malloc<span class="op">(</span>cap <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>q<span class="op">-&gt;</span>data<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>capacity <span class="op">=</span> cap<span class="op">;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>front <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cq_enqueue<span class="op">(</span>CircularQueue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>count <span class="op">==</span> q<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// full</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>data<span class="op">[</span>q<span class="op">-&gt;</span>rear<span class="op">]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="op">(</span>q<span class="op">-&gt;</span>rear <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> q<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count<span class="op">++;</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cq_dequeue<span class="op">(</span>CircularQueue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// empty</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> q<span class="op">-&gt;</span>data<span class="op">[</span>q<span class="op">-&gt;</span>front<span class="op">];</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>front <span class="op">=</span> <span class="op">(</span>q<span class="op">-&gt;</span>front <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> q<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count<span class="op">--;</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cq_peek<span class="op">(</span>CircularQueue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> q<span class="op">-&gt;</span>data<span class="op">[</span>q<span class="op">-&gt;</span>front<span class="op">];</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    CircularQueue q<span class="op">;</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    cq_init<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    cq_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    cq_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    cq_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">30</span><span class="op">);</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>    cq_dequeue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Dequeued: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>    cq_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">40</span><span class="op">);</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>    cq_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">50</span><span class="op">);</span> <span class="co">// should fail if full</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    cq_peek<span class="op">(&amp;</span>q<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Front: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>q<span class="op">.</span>data<span class="op">);</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CircularQueue:</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, capacity):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._cap <span class="op">=</span> capacity</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> capacity</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._front <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rear <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> enqueue(<span class="va">self</span>, x):</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._count <span class="op">==</span> <span class="va">self</span>._cap:</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">OverflowError</span>(<span class="st">"Queue full"</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._data[<span class="va">self</span>._rear] <span class="op">=</span> x</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rear <span class="op">=</span> (<span class="va">self</span>._rear <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="va">self</span>._cap</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dequeue(<span class="va">self</span>):</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"Queue empty"</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>._data[<span class="va">self</span>._front]</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._front <span class="op">=</span> (<span class="va">self</span>._front <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="va">self</span>._cap</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._count <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> peek(<span class="va">self</span>):</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"Queue empty"</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._data[<span class="va">self</span>._front]</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> CircularQueue(<span class="dv">4</span>)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>q.enqueue(<span class="dv">10</span>)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>q.enqueue(<span class="dv">20</span>)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>q.enqueue(<span class="dv">30</span>)</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q.dequeue())  <span class="co"># 10</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>q.enqueue(<span class="dv">40</span>)</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q.peek())     <span class="co"># 20</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-7" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-7">Why It Matters</h4>
<ul>
<li>Efficient space reuse, no wasted slots</li>
<li>Predictable memory usage for real-time systems</li>
<li>Backbone of buffering systems (audio, network, streaming)</li>
<li>Fast O(1) operations, no shifting elements</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-7" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-7">A Gentle Proof (Why It Works)</h4>
<p>Since both <code>front</code> and <code>rear</code> wrap using modulo, all operations remain in range <code>[0, capacity-1]</code>. Each operation modifies a fixed number of variables. Thus:</p>
<ul>
<li>enqueue: 1 write + 2 updates</li>
<li>dequeue: 1 read + 2 updates No shifting, no resizing → all O(1) time.</li>
</ul>
</section>
<section id="try-it-yourself-7" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-7">Try It Yourself</h4>
<ol type="1">
<li>Add <code>is_full()</code> and <code>is_empty()</code> helpers.</li>
<li>Implement an overwrite mode where new enqueues overwrite oldest data.</li>
<li>Visualize index movement for multiple wraps.</li>
<li>Use a circular queue to simulate a producer-consumer buffer.</li>
</ol>
</section>
<section id="test-cases-7" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-7">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 34%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Front</th>
<th>Rear</th>
<th>Count</th>
<th>Queue (Front → Rear)</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>enqueue(10)</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>[10, <em>, </em>, _]</td>
<td>first element</td>
</tr>
<tr class="even">
<td>enqueue(20)</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>[10, 20, <em>, </em>]</td>
<td></td>
</tr>
<tr class="odd">
<td>enqueue(30)</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td>[10, 20, 30, _]</td>
<td></td>
</tr>
<tr class="even">
<td>dequeue()</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>[<em>, 20, 30, </em>]</td>
<td>10 removed</td>
</tr>
<tr class="odd">
<td>enqueue(40)</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>[40, 20, 30, _]</td>
<td>wrap-around</td>
</tr>
<tr class="even">
<td>enqueue(50)</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>[40, 20, 30, 50]</td>
<td>full queue</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Enqueue when full → reject or overwrite</li>
<li>Dequeue when empty → error</li>
<li>Wrap-around indexing must handle 0 correctly</li>
</ul>
</section>
<section id="complexity-7" class="level4">
<h4 class="anchored" data-anchor-id="complexity-7">Complexity</h4>
<ul>
<li>Time: enqueue O(1), dequeue O(1), peek O(1)</li>
<li>Space: O(n) fixed buffer</li>
</ul>
<p>Circular queues are the heartbeat of real-time data flows, steady, cyclic, and never wasting a byte.</p>
</section>
</section>
<section id="stack-via-queue" class="level3">
<h3 class="anchored" data-anchor-id="stack-via-queue">209 Stack via Queue</h3>
<p>A stack via queue is a playful twist, implementing LIFO behavior using FIFO tools. It shows how one structure can simulate another by combining basic operations cleverly.</p>
<section id="what-problem-are-we-solving-8" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-8">What Problem Are We Solving?</h4>
<p>Sometimes we’re limited to queue operations (<code>enqueue</code>, <code>dequeue</code>) but still want a stack’s last-in-first-out order. We can simulate <code>push</code> and <code>pop</code> using one or two queues.</p>
<p>Goal: Build a stack that supports <code>push</code>, <code>pop</code>, and <code>peek</code> in O(1) or O(n) time (depending on strategy) using only queue operations.</p>
</section>
<section id="how-does-it-work-plain-language-8" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-8">How Does It Work (Plain Language)?</h4>
<p>Two main strategies:</p>
<ol type="1">
<li>Push costly: rotate elements after every push so front is always top.</li>
<li>Pop costly: enqueue normally, but rotate during pop.</li>
</ol>
<p>We’ll show push costly version, simpler conceptually.</p>
<p>Idea: Each <code>push</code> enqueues new item, then rotates all older elements behind it, so that last pushed is always at the front (ready to pop).</p>
<p>Example Steps (Push Costly)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Queue (Front → Rear)</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>push(10)</td>
<td>[10]</td>
<td>only one element</td>
</tr>
<tr class="even">
<td>2</td>
<td>push(20)</td>
<td>[20, 10]</td>
<td>rotated so 20 is front</td>
</tr>
<tr class="odd">
<td>3</td>
<td>push(30)</td>
<td>[30, 20, 10]</td>
<td>rotated again</td>
</tr>
<tr class="even">
<td>4</td>
<td>pop()</td>
<td>[20, 10]</td>
<td>30 removed</td>
</tr>
<tr class="odd">
<td>5</td>
<td>push(40)</td>
<td>[40, 20, 10]</td>
<td>rotation maintains order</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-8" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-8">Tiny Code (Easy Versions)</h4>
<p>C (Using Two Queues)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>data<span class="op">;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> front<span class="op">,</span> rear<span class="op">,</span> count<span class="op">,</span> capacity<span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Queue<span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> q_init<span class="op">(</span>Queue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>data <span class="op">=</span> malloc<span class="op">(</span>cap <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>q<span class="op">-&gt;</span>data<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>front <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>capacity <span class="op">=</span> cap<span class="op">;</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> q_enqueue<span class="op">(</span>Queue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>count <span class="op">==</span> q<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>data<span class="op">[</span>q<span class="op">-&gt;</span>rear<span class="op">]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>rear <span class="op">=</span> <span class="op">(</span>q<span class="op">-&gt;</span>rear <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> q<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count<span class="op">++;</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> q_dequeue<span class="op">(</span>Queue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> q<span class="op">-&gt;</span>data<span class="op">[</span>q<span class="op">-&gt;</span>front<span class="op">];</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>front <span class="op">=</span> <span class="op">(</span>q<span class="op">-&gt;</span>front <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> q<span class="op">-&gt;</span>capacity<span class="op">;</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>count<span class="op">--;</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    Queue q1<span class="op">,</span> q2<span class="op">;</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> StackViaQueue<span class="op">;</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> svq_init<span class="op">(</span>StackViaQueue <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> q_init<span class="op">(&amp;</span>s<span class="op">-&gt;</span>q1<span class="op">,</span> cap<span class="op">)</span> <span class="op">&amp;&amp;</span> q_init<span class="op">(&amp;</span>s<span class="op">-&gt;</span>q2<span class="op">,</span> cap<span class="op">);</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> svq_push<span class="op">(</span>StackViaQueue <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    q_enqueue<span class="op">(&amp;</span>s<span class="op">-&gt;</span>q2<span class="op">,</span> x<span class="op">);</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>s<span class="op">-&gt;</span>q1<span class="op">.</span>count<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>        q_dequeue<span class="op">(&amp;</span>s<span class="op">-&gt;</span>q1<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>        q_enqueue<span class="op">(&amp;</span>s<span class="op">-&gt;</span>q2<span class="op">,</span> val<span class="op">);</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">// swap q1 and q2</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    Queue tmp <span class="op">=</span> s<span class="op">-&gt;</span>q1<span class="op">;</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>q1 <span class="op">=</span> s<span class="op">-&gt;</span>q2<span class="op">;</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>q2 <span class="op">=</span> tmp<span class="op">;</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> svq_pop<span class="op">(</span>StackViaQueue <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> q_dequeue<span class="op">(&amp;</span>s<span class="op">-&gt;</span>q1<span class="op">,</span> out<span class="op">);</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> svq_peek<span class="op">(</span>StackViaQueue <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>q1<span class="op">.</span>count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> s<span class="op">-&gt;</span>q1<span class="op">.</span>data<span class="op">[</span>s<span class="op">-&gt;</span>q1<span class="op">.</span>front<span class="op">];</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>    StackViaQueue s<span class="op">;</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>    svq_init<span class="op">(&amp;</span>s<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>    svq_push<span class="op">(&amp;</span>s<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>    svq_push<span class="op">(&amp;</span>s<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>    svq_push<span class="op">(&amp;</span>s<span class="op">,</span> <span class="dv">30</span><span class="op">);</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>    svq_pop<span class="op">(&amp;</span>s<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Popped: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>    svq_peek<span class="op">(&amp;</span>s<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Top: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>s<span class="op">.</span>q1<span class="op">.</span>data<span class="op">);</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>s<span class="op">.</span>q2<span class="op">.</span>data<span class="op">);</span></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> deque</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StackViaQueue:</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.q <span class="op">=</span> deque()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> push(<span class="va">self</span>, x):</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.q)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.q.append(x)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># rotate all older elements</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.q.append(<span class="va">self</span>.q.popleft())</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pop(<span class="va">self</span>):</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.q:</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"pop from empty stack"</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.q.popleft()</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> peek(<span class="va">self</span>):</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.q:</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"peek from empty stack"</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.q[<span class="dv">0</span>]</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> StackViaQueue()</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>s.push(<span class="dv">10</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>s.push(<span class="dv">20</span>)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>s.push(<span class="dv">30</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s.pop())  <span class="co"># 30</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s.peek()) <span class="co"># 20</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-8" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-8">Why It Matters</h4>
<ul>
<li>Demonstrates duality of data structures (stack built on queue)</li>
<li>Reinforces operation trade-offs (costly push vs costly pop)</li>
<li>Great teaching example for algorithmic simulation</li>
<li>Builds insight into complexity and resource usage</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-8" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-8">A Gentle Proof (Why It Works)</h4>
<p>In push costly approach:</p>
<ul>
<li>Each push rotates all previous elements behind the new one → new element becomes front.</li>
<li>Pop simply dequeues from front → correct LIFO order.</li>
</ul>
<p>So order is maintained: newest always exits first.</p>
</section>
<section id="try-it-yourself-8" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-8">Try It Yourself</h4>
<ol type="1">
<li>Implement pop costly variant (push O(1), pop O(n)).</li>
<li>Add <code>is_empty()</code> helper.</li>
<li>Compare total number of operations for n pushes and pops.</li>
<li>Extend to generic types with structs or templates.</li>
</ol>
</section>
<section id="test-cases-8" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-8">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Queue (Front → Rear)</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>push(10)</td>
<td>[10]</td>
<td>single element</td>
</tr>
<tr class="even">
<td>push(20)</td>
<td>[20, 10]</td>
<td>rotated</td>
</tr>
<tr class="odd">
<td>push(30)</td>
<td>[30, 20, 10]</td>
<td>rotated</td>
</tr>
<tr class="even">
<td>pop()</td>
<td>[20, 10]</td>
<td>returns 30</td>
</tr>
<tr class="odd">
<td>peek()</td>
<td>[20, 10]</td>
<td>returns 20</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Pop/peek from empty → error</li>
<li>Capacity reached → reject push</li>
<li>Works even with single queue (rotation after push)</li>
</ul>
</section>
<section id="complexity-8" class="level4">
<h4 class="anchored" data-anchor-id="complexity-8">Complexity</h4>
<ul>
<li>Push: O(n)</li>
<li>Pop/Peek: O(1)</li>
<li>Space: O(n)</li>
</ul>
<p>Stack via queue proves constraints breed creativity, same data, different dance.</p>
</section>
</section>
<section id="queue-via-stack" class="level3">
<h3 class="anchored" data-anchor-id="queue-via-stack">210 Queue via Stack</h3>
<p>A queue via stack flips the story: build FIFO behavior using LIFO tools. It’s a classic exercise in algorithmic inversion, showing how fundamental operations can emulate each other with clever order manipulation.</p>
<section id="what-problem-are-we-solving-9" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-9">What Problem Are We Solving?</h4>
<p>Suppose you only have stacks (with <code>push</code>, <code>pop</code>, <code>peek</code>) but need queue behavior (with <code>enqueue</code>, <code>dequeue</code>). We want to process items in arrival order, first in, first out, even though stacks operate last in, first out.</p>
<p>Goal: Implement <code>enqueue</code>, <code>dequeue</code>, and <code>peek</code> for a queue using only stack operations.</p>
</section>
<section id="how-does-it-work-plain-language-9" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-9">How Does It Work (Plain Language)?</h4>
<p>Two stacks are enough:</p>
<ul>
<li>inbox: where we push new items (enqueue)</li>
<li>outbox: where we pop old items (dequeue)</li>
</ul>
<p>When dequeuing, if <code>outbox</code> is empty, we move all items from <code>inbox</code> to <code>outbox</code>, reversing their order so oldest items are on top.</p>
<p>This reversal step restores FIFO behavior.</p>
<p>Example Steps (Two-Stack Method)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 14%">
<col style="width: 26%">
<col style="width: 28%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>inbox (Top → Bottom)</th>
<th>outbox (Top → Bottom)</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>enqueue(10)</td>
<td>[10]</td>
<td>[]</td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td>enqueue(20)</td>
<td>[20, 10]</td>
<td>[]</td>
<td></td>
</tr>
<tr class="odd">
<td>3</td>
<td>enqueue(30)</td>
<td>[30, 20, 10]</td>
<td>[]</td>
<td></td>
</tr>
<tr class="even">
<td>4</td>
<td>dequeue()</td>
<td>[]</td>
<td>[10, 20, 30]</td>
<td>transfer + pop(10)</td>
</tr>
<tr class="odd">
<td>5</td>
<td>enqueue(40)</td>
<td>[40]</td>
<td>[20, 30]</td>
<td>mixed state</td>
</tr>
<tr class="even">
<td>6</td>
<td>dequeue()</td>
<td>[40]</td>
<td>[30]</td>
<td>pop(20) from outbox</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-9" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-9">Tiny Code (Easy Versions)</h4>
<p>C (Using Two Stacks)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>data<span class="op">;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> top<span class="op">;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> capacity<span class="op">;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Stack<span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> stack_init<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>data <span class="op">=</span> malloc<span class="op">(</span>cap <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>s<span class="op">-&gt;</span>data<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>top <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>capacity <span class="op">=</span> cap<span class="op">;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> stack_push<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>top <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> s<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>data<span class="op">[++</span>s<span class="op">-&gt;</span>top<span class="op">]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> stack_pop<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>top <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> s<span class="op">-&gt;</span>data<span class="op">[</span>s<span class="op">-&gt;</span>top<span class="op">--];</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> stack_peek<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>top <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> s<span class="op">-&gt;</span>data<span class="op">[</span>s<span class="op">-&gt;</span>top<span class="op">];</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> stack_empty<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">-&gt;</span>top <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    Stack in<span class="op">,</span> out<span class="op">;</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> QueueViaStack<span class="op">;</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> qvs_init<span class="op">(</span>QueueViaStack <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stack_init<span class="op">(&amp;</span>q<span class="op">-&gt;</span>in<span class="op">,</span> cap<span class="op">)</span> <span class="op">&amp;&amp;</span> stack_init<span class="op">(&amp;</span>q<span class="op">-&gt;</span>out<span class="op">,</span> cap<span class="op">);</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> qvs_enqueue<span class="op">(</span>QueueViaStack <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stack_push<span class="op">(&amp;</span>q<span class="op">-&gt;</span>in<span class="op">,</span> x<span class="op">);</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> qvs_shift<span class="op">(</span>QueueViaStack <span class="op">*</span>q<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>stack_empty<span class="op">(&amp;</span>q<span class="op">-&gt;</span>in<span class="op">))</span> <span class="op">{</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>        stack_pop<span class="op">(&amp;</span>q<span class="op">-&gt;</span>in<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>        stack_push<span class="op">(&amp;</span>q<span class="op">-&gt;</span>out<span class="op">,</span> val<span class="op">);</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> qvs_dequeue<span class="op">(</span>QueueViaStack <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>stack_empty<span class="op">(&amp;</span>q<span class="op">-&gt;</span>out<span class="op">))</span> qvs_shift<span class="op">(</span>q<span class="op">);</span></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stack_pop<span class="op">(&amp;</span>q<span class="op">-&gt;</span>out<span class="op">,</span> out<span class="op">);</span></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> qvs_peek<span class="op">(</span>QueueViaStack <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>stack_empty<span class="op">(&amp;</span>q<span class="op">-&gt;</span>out<span class="op">))</span> qvs_shift<span class="op">(</span>q<span class="op">);</span></span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stack_peek<span class="op">(&amp;</span>q<span class="op">-&gt;</span>out<span class="op">,</span> out<span class="op">);</span></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>    QueueViaStack q<span class="op">;</span></span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>    qvs_init<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>    qvs_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>    qvs_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>    qvs_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">30</span><span class="op">);</span></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>    qvs_dequeue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Dequeued: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>    qvs_enqueue<span class="op">(&amp;</span>q<span class="op">,</span> <span class="dv">40</span><span class="op">);</span></span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>    qvs_peek<span class="op">(&amp;</span>q<span class="op">,</span> <span class="op">&amp;</span>val<span class="op">);</span></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Front: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>q<span class="op">.</span>in<span class="op">.</span>data<span class="op">);</span></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>q<span class="op">.</span>out<span class="op">.</span>data<span class="op">);</span></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (Two Stack Queue)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> QueueViaStack:</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.inbox <span class="op">=</span> []</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outbox <span class="op">=</span> []</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> enqueue(<span class="va">self</span>, x):</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.inbox.append(x)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dequeue(<span class="va">self</span>):</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.outbox:</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">self</span>.inbox:</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.outbox.append(<span class="va">self</span>.inbox.pop())</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.outbox:</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"dequeue from empty queue"</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.outbox.pop()</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> peek(<span class="va">self</span>):</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.outbox:</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">self</span>.inbox:</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.outbox.append(<span class="va">self</span>.inbox.pop())</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.outbox:</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">IndexError</span>(<span class="st">"peek from empty queue"</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.outbox[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> QueueViaStack()</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>q.enqueue(<span class="dv">10</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>q.enqueue(<span class="dv">20</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>q.enqueue(<span class="dv">30</span>)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q.dequeue())  <span class="co"># 10</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>q.enqueue(<span class="dv">40</span>)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q.peek())     <span class="co"># 20</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-9" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-9">Why It Matters</h4>
<ul>
<li>Demonstrates queue emulation with stack operations</li>
<li>Core teaching example for data structure duality</li>
<li>Helps in designing abstract interfaces under constraints</li>
<li>Underpins some streaming and buffering systems</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-9" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-9">A Gentle Proof (Why It Works)</h4>
<p>Each transfer (<code>inbox → outbox</code>) reverses order once, restoring FIFO sequence.</p>
<ul>
<li>Enqueue pushes to inbox (LIFO)</li>
<li>Dequeue pops from outbox (LIFO of reversed) So overall effect = FIFO</li>
</ul>
<p>Transfers happen only when outbox is empty, so amortized cost per operation is O(1).</p>
</section>
<section id="try-it-yourself-9" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-9">Try It Yourself</h4>
<ol type="1">
<li>Implement a single-stack recursive version.</li>
<li>Add <code>is_empty()</code> helper.</li>
<li>Measure amortized vs worst-case complexity.</li>
<li>Extend to generic data type.</li>
</ol>
</section>
<section id="test-cases-9" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-9">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 25%">
<col style="width: 26%">
<col style="width: 13%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>inbox (Top→Bottom)</th>
<th>outbox (Top→Bottom)</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>enqueue(10)</td>
<td>[10]</td>
<td>[]</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>enqueue(20)</td>
<td>[20, 10]</td>
<td>[]</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>enqueue(30)</td>
<td>[30, 20, 10]</td>
<td>[]</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>dequeue()</td>
<td>[]</td>
<td>[10, 20, 30]</td>
<td>returns 10</td>
<td>transfer + pop</td>
</tr>
<tr class="odd">
<td>enqueue(40)</td>
<td>[40]</td>
<td>[20, 30]</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>dequeue()</td>
<td>[40]</td>
<td>[30]</td>
<td>returns 20</td>
<td></td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Dequeue from empty queue → error</li>
<li>Multiple dequeues trigger one transfer</li>
<li>Outbox reused efficiently</li>
</ul>
</section>
<section id="complexity-9" class="level4">
<h4 class="anchored" data-anchor-id="complexity-9">Complexity</h4>
<ul>
<li>Time: amortized O(1) per operation (worst-case O(n) on transfer)</li>
<li>Space: O(n)</li>
</ul>
<p>Queue via stack shows symmetry, turn LIFO into FIFO with one clever reversal.</p>
</section>
</section>
</section>
<section id="section-22.-hash-tables-and-variants" class="level2">
<h2 class="anchored" data-anchor-id="section-22.-hash-tables-and-variants">Section 22. Hash Tables and Variants</h2>
<section id="hash-table-insertion" class="level3">
<h3 class="anchored" data-anchor-id="hash-table-insertion">211 Hash Table Insertion</h3>
<p>A hash table stores key-value pairs for lightning-fast lookups. It uses a hash function to map keys to array indices, letting us access data in near-constant time.</p>
<section id="what-problem-are-we-solving-10" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-10">What Problem Are We Solving?</h4>
<p>We need a data structure that can insert, search, and delete by key efficiently, without scanning every element. Arrays give random access by index; hash tables extend that power to arbitrary keys.</p>
<p>Goal: Map each key to a slot via a hash function and resolve any collisions gracefully.</p>
</section>
<section id="how-does-it-work-plain-language-10" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-10">How Does It Work (Plain Language)?</h4>
<p>A hash table uses a hash function to convert a key into an index:</p>
<pre class="text"><code>index = hash(key) % capacity</code></pre>
<p>When inserting a new (key, value):</p>
<ol type="1">
<li>Compute hash index.</li>
<li>If slot is empty → place pair there.</li>
<li>If occupied → handle collision (chaining or open addressing).</li>
</ol>
<p>We’ll use separate chaining (linked list per slot) as the simplest method.</p>
<p>Example Steps (Separate Chaining)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Key</th>
<th>Hash(key)</th>
<th>Index</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>“apple”</td>
<td>42</td>
<td>2</td>
<td>Insert (“apple”, 10)</td>
</tr>
<tr class="even">
<td>2</td>
<td>“banana”</td>
<td>15</td>
<td>3</td>
<td>Insert (“banana”, 20)</td>
</tr>
<tr class="odd">
<td>3</td>
<td>“pear”</td>
<td>18</td>
<td>2</td>
<td>Collision → chain in index 2</td>
</tr>
<tr class="even">
<td>4</td>
<td>“peach”</td>
<td>21</td>
<td>1</td>
<td>Insert new pair</td>
</tr>
</tbody>
</table>
<p>Table after insertions:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Index</th>
<th>Chain</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>-</td>
</tr>
<tr class="even">
<td>1</td>
<td>(“peach”, 40)</td>
</tr>
<tr class="odd">
<td>2</td>
<td>(“apple”, 10) → (“pear”, 30)</td>
</tr>
<tr class="even">
<td>3</td>
<td>(“banana”, 20)</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-10" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-10">Tiny Code (Easy Versions)</h4>
<p>C (Separate Chaining Example)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define TABLE_SIZE </span><span class="dv">5</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>key<span class="op">;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>buckets<span class="op">[</span>TABLE_SIZE<span class="op">];</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> HashTable<span class="op">;</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> hash<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> h <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(*</span>key<span class="op">)</span> h <span class="op">=</span> h <span class="op">*</span> <span class="dv">31</span> <span class="op">+</span> <span class="op">*</span>key<span class="op">++;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> h <span class="op">%</span> TABLE_SIZE<span class="op">;</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>HashTable<span class="op">*</span> ht_create<span class="op">()</span> <span class="op">{</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>HashTable<span class="op">));</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> TABLE_SIZE<span class="op">;</span> i<span class="op">++)</span> ht<span class="op">-&gt;</span>buckets<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ht<span class="op">;</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ht_insert<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>node <span class="op">=</span> ht<span class="op">-&gt;</span>buckets<span class="op">[</span>idx<span class="op">];</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>node<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>node<span class="op">-&gt;</span>key<span class="op">,</span> key<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span> node<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> node<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>new_node <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>key <span class="op">=</span> strdup<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>next <span class="op">=</span> ht<span class="op">-&gt;</span>buckets<span class="op">[</span>idx<span class="op">];</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>buckets<span class="op">[</span>idx<span class="op">]</span> <span class="op">=</span> new_node<span class="op">;</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ht_search<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>node <span class="op">=</span> ht<span class="op">-&gt;</span>buckets<span class="op">[</span>idx<span class="op">];</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>node<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>node<span class="op">-&gt;</span>key<span class="op">,</span> key<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span> <span class="op">*</span>out <span class="op">=</span> node<span class="op">-&gt;</span>value<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> node<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> ht_create<span class="op">();</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="st">"apple"</span><span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="st">"pear"</span><span class="op">,</span> <span class="dv">30</span><span class="op">);</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="st">"banana"</span><span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ht_search<span class="op">(</span>ht<span class="op">,</span> <span class="st">"pear"</span><span class="op">,</span> <span class="op">&amp;</span>val<span class="op">))</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"pear: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (Dictionary Simulation)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> HashTable:</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, size<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> size</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(size)]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, key):</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(key) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key, value):</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pair <span class="kw">in</span> <span class="va">self</span>.table[idx]:</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pair[<span class="dv">0</span>] <span class="op">==</span> key:</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                pair[<span class="dv">1</span>] <span class="op">=</span> value</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table[idx].append([key, value])</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, key):</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k, v <span class="kw">in</span> <span class="va">self</span>.table[idx]:</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> key:</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> v</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>ht <span class="op">=</span> HashTable()</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>ht.insert(<span class="st">"apple"</span>, <span class="dv">10</span>)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>ht.insert(<span class="st">"pear"</span>, <span class="dv">30</span>)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>ht.insert(<span class="st">"banana"</span>, <span class="dv">20</span>)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ht.search(<span class="st">"pear"</span>))  <span class="co"># 30</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-10" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-10">Why It Matters</h4>
<ul>
<li>Provides average O(1) access, insert, delete</li>
<li>Backbone of symbol tables, maps, sets, and dictionaries</li>
<li>Used in caches, compilers, and indexing systems</li>
<li>Introduces key idea: hash function + collision handling</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-10" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-10">A Gentle Proof (Why It Works)</h4>
<p>Let table size = m, number of keys = n. If hash spreads keys uniformly, expected chain length = α = n/m (load factor).</p>
<ul>
<li>Average lookup: O(1 + α)</li>
<li>Keep α ≤ 1 → near constant time If collisions are minimized, operations stay fast.</li>
</ul>
</section>
<section id="try-it-yourself-10" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-10">Try It Yourself</h4>
<ol type="1">
<li>Implement update to modify existing key’s value.</li>
<li>Add delete(key) to remove entries from chain.</li>
<li>Experiment with different hash functions (e.g.&nbsp;djb2, FNV-1a).</li>
<li>Measure time vs load factor.</li>
</ol>
</section>
<section id="test-cases-10" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-10">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Key</th>
<th>Value</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert</td>
<td>“apple”</td>
<td>10</td>
<td>success</td>
<td>new key</td>
</tr>
<tr class="even">
<td>insert</td>
<td>“banana”</td>
<td>20</td>
<td>success</td>
<td>new key</td>
</tr>
<tr class="odd">
<td>insert</td>
<td>“apple”</td>
<td>15</td>
<td>update</td>
<td>key exists</td>
</tr>
<tr class="even">
<td>search</td>
<td>“banana”</td>
<td></td>
<td>20</td>
<td>found</td>
</tr>
<tr class="odd">
<td>search</td>
<td>“grape”</td>
<td></td>
<td>None</td>
<td>not found</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Insert duplicate → update value</li>
<li>Search non-existent → return None</li>
<li>Table full (open addressing) → needs rehash</li>
</ul>
</section>
<section id="complexity-10" class="level4">
<h4 class="anchored" data-anchor-id="complexity-10">Complexity</h4>
<ul>
<li>Time: average O(1), worst O(n) (all collide)</li>
<li>Space: O(n + m) (keys + table slots)</li>
</ul>
<p>Hash table insertion is the art of turning chaos into order, hash, map, resolve, and store.</p>
</section>
</section>
<section id="linear-probing" class="level3">
<h3 class="anchored" data-anchor-id="linear-probing">212 Linear Probing</h3>
<p>Linear probing is one of the simplest collision resolution strategies in open addressing hash tables. When a collision occurs, it looks for the next empty slot by moving step by step through the table, wrapping around if needed.</p>
<section id="what-problem-are-we-solving-11" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-11">What Problem Are We Solving?</h4>
<p>When two keys hash to the same index, where do we store the new one? Instead of chaining nodes, linear probing searches the next available slot, keeping all data inside the array.</p>
<p>Goal: Resolve collisions by scanning linearly from the point of conflict until an empty slot is found.</p>
</section>
<section id="how-does-it-work-plain-language-11" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-11">How Does It Work (Plain Language)?</h4>
<p>When inserting a key:</p>
<ol type="1">
<li>Compute index = <code>hash(key) % capacity</code>.</li>
<li>If slot empty → place key there.</li>
<li>If occupied → move to <code>(index + 1) % capacity</code>.</li>
<li>Repeat until an empty slot is found or table is full.</li>
</ol>
<p>Lookups and deletions follow the same probe sequence until key is found or empty slot encountered.</p>
<p>Example Steps (Capacity = 7)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Key</th>
<th>Hash(key)</th>
<th>Index</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>10</td>
<td>3</td>
<td>3</td>
<td>Place at index 3</td>
</tr>
<tr class="even">
<td>2</td>
<td>24</td>
<td>3</td>
<td>4</td>
<td>Collision → move to 4</td>
</tr>
<tr class="odd">
<td>3</td>
<td>31</td>
<td>3</td>
<td>5</td>
<td>Collision → move to 5</td>
</tr>
<tr class="even">
<td>4</td>
<td>17</td>
<td>3</td>
<td>6</td>
<td>Collision → move to 6</td>
</tr>
<tr class="odd">
<td>5</td>
<td>38</td>
<td>3</td>
<td>0</td>
<td>Wrap around → place at 0</td>
</tr>
</tbody>
</table>
<p>Final Table</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Index</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>38</td>
</tr>
<tr class="even">
<td>1</td>
<td>-</td>
</tr>
<tr class="odd">
<td>2</td>
<td>-</td>
</tr>
<tr class="even">
<td>3</td>
<td>10</td>
</tr>
<tr class="odd">
<td>4</td>
<td>24</td>
</tr>
<tr class="even">
<td>5</td>
<td>31</td>
</tr>
<tr class="odd">
<td>6</td>
<td>17</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-11" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-11">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CAPACITY </span><span class="dv">7</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define EMPTY </span><span class="op">-</span><span class="dv">1</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DELETED </span><span class="op">-</span><span class="dv">2</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>table<span class="op">;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> HashTable<span class="op">;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hash<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> key <span class="op">%</span> CAPACITY<span class="op">;</span> <span class="op">}</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>HashTable<span class="op">*</span> ht_create<span class="op">()</span> <span class="op">{</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>HashTable<span class="op">));</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>table <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">*</span> CAPACITY<span class="op">);</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> EMPTY<span class="op">;</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ht<span class="op">;</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ht_insert<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> pos <span class="op">=</span> <span class="op">(</span>idx <span class="op">+</span> i<span class="op">)</span> <span class="op">%</span> CAPACITY<span class="op">;</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> EMPTY <span class="op">||</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> DELETED<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Table full, cannot insert </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> key<span class="op">);</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ht_search<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> pos <span class="op">=</span> <span class="op">(</span>idx <span class="op">+</span> i<span class="op">)</span> <span class="op">%</span> CAPACITY<span class="op">;</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> EMPTY<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> key<span class="op">)</span> <span class="cf">return</span> pos<span class="op">;</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ht_delete<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> pos <span class="op">=</span> ht_search<span class="op">(</span>ht<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pos <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">=</span> DELETED<span class="op">;</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> ht_create<span class="op">();</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">24</span><span class="op">);</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">31</span><span class="op">);</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">17</span><span class="op">);</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">38</span><span class="op">);</span></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LinearProbingHash:</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, size<span class="op">=</span><span class="dv">7</span>):</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> size</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> size</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, key):</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> key <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key):</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.size):</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>            pos <span class="op">=</span> (idx <span class="op">+</span> i) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[pos] <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> <span class="va">self</span>.table[pos] <span class="op">==</span> <span class="st">"DELETED"</span>:</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.table[pos] <span class="op">=</span> key</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">OverflowError</span>(<span class="st">"Hash table full"</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, key):</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.size):</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>            pos <span class="op">=</span> (idx <span class="op">+</span> i) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[pos] <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[pos] <span class="op">==</span> key:</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> pos</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete(<span class="va">self</span>, key):</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>        pos <span class="op">=</span> <span class="va">self</span>.search(key)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pos <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.table[pos] <span class="op">=</span> <span class="st">"DELETED"</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>ht <span class="op">=</span> LinearProbingHash()</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">31</span>, <span class="dv">17</span>, <span class="dv">38</span>]:</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    ht.insert(k)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ht.table)</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Search 17 at:"</span>, ht.search(<span class="dv">17</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-11" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-11">Why It Matters</h4>
<ul>
<li>Simplest form of open addressing</li>
<li>Keeps all entries inside one array (no extra memory)</li>
<li>Excellent cache performance</li>
<li>Forms the basis for modern in-place hash maps</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-11" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-11">A Gentle Proof (Why It Works)</h4>
<p>Every key follows the same probe sequence during insert, search, and delete. So if a key is in the table, search will find it; if it’s not, search will hit an empty slot and stop. Uniform hashing ensures average probe length ≈ 1 / (1 - α), where α = n / m is load factor.</p>
</section>
<section id="try-it-yourself-11" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-11">Try It Yourself</h4>
<ol type="1">
<li>Implement <code>resize()</code> when load factor &gt; 0.7.</li>
<li>Test insertion order and wrap-around behavior.</li>
<li>Compare linear probing vs chaining performance.</li>
<li>Visualize clustering as load increases.</li>
</ol>
</section>
<section id="test-cases-11" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-11">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Key</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert</td>
<td>10</td>
<td>index 3</td>
<td>no collision</td>
</tr>
<tr class="even">
<td>insert</td>
<td>24</td>
<td>index 4</td>
<td>move 1 slot</td>
</tr>
<tr class="odd">
<td>insert</td>
<td>31</td>
<td>index 5</td>
<td>move 2 slots</td>
</tr>
<tr class="even">
<td>insert</td>
<td>17</td>
<td>index 6</td>
<td>move 3 slots</td>
</tr>
<tr class="odd">
<td>insert</td>
<td>38</td>
<td>index 0</td>
<td>wrap-around</td>
</tr>
<tr class="even">
<td>search</td>
<td>17</td>
<td>found at 6</td>
<td>linear search</td>
</tr>
<tr class="odd">
<td>delete</td>
<td>24</td>
<td>mark deleted</td>
<td>slot reusable</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Table full → insertion fails</li>
<li>Deleted slots reused</li>
<li>Must stop on EMPTY, not DELETED</li>
</ul>
</section>
<section id="complexity-11" class="level4">
<h4 class="anchored" data-anchor-id="complexity-11">Complexity</h4>
<ul>
<li><p>Time:</p>
<ul>
<li>Average O(1) if α small</li>
<li>Worst O(n) if full cluster</li>
</ul></li>
<li><p>Space: O(n)</p></li>
</ul>
<p>Linear probing walks straight lines through collisions, simple, local, and fast when load is low.</p>
</section>
</section>
<section id="quadratic-probing" class="level3">
<h3 class="anchored" data-anchor-id="quadratic-probing">213 Quadratic Probing</h3>
<p>Quadratic probing improves upon linear probing by reducing primary clustering. Instead of stepping through every slot one by one, it jumps in quadratic increments, spreading colliding keys more evenly across the table.</p>
<section id="what-problem-are-we-solving-12" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-12">What Problem Are We Solving?</h4>
<p>In linear probing, consecutive occupied slots cause clustering, leading to long probe chains and degraded performance. Quadratic probing breaks up these runs by using nonlinear probe sequences.</p>
<p>Goal: Resolve collisions by checking indices offset by quadratic values, <code>+1², +2², +3², …</code>, reducing clustering while keeping predictable probe order.</p>
</section>
<section id="how-does-it-work-plain-language-12" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-12">How Does It Work (Plain Language)?</h4>
<p>When inserting a key:</p>
<ol type="1">
<li>Compute <code>index = hash(key) % capacity</code>.</li>
<li>If slot empty → insert.</li>
<li>If occupied → try <code>(index + 1²) % capacity</code>, <code>(index + 2²) % capacity</code>, etc.</li>
<li>Continue until an empty slot is found or table is full.</li>
</ol>
<p>Lookups and deletions follow the same probe sequence.</p>
<p>Example Steps (Capacity = 7)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Key</th>
<th>Hash(key)</th>
<th>Probes (sequence)</th>
<th>Final Slot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>10</td>
<td>3</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>24</td>
<td>3</td>
<td>3, 4</td>
<td>4</td>
</tr>
<tr class="odd">
<td>3</td>
<td>31</td>
<td>3</td>
<td>3, 4, 0</td>
<td>0</td>
</tr>
<tr class="even">
<td>4</td>
<td>17</td>
<td>3</td>
<td>3, 4, 0, 2</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Table after insertions:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Index</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>31</td>
</tr>
<tr class="even">
<td>1</td>
<td>-</td>
</tr>
<tr class="odd">
<td>2</td>
<td>17</td>
</tr>
<tr class="even">
<td>3</td>
<td>10</td>
</tr>
<tr class="odd">
<td>4</td>
<td>24</td>
</tr>
<tr class="even">
<td>5</td>
<td>-</td>
</tr>
<tr class="odd">
<td>6</td>
<td>-</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-12" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-12">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CAPACITY </span><span class="dv">7</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define EMPTY </span><span class="op">-</span><span class="dv">1</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DELETED </span><span class="op">-</span><span class="dv">2</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>table<span class="op">;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> HashTable<span class="op">;</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hash<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> key <span class="op">%</span> CAPACITY<span class="op">;</span> <span class="op">}</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>HashTable<span class="op">*</span> ht_create<span class="op">()</span> <span class="op">{</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>HashTable<span class="op">));</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>table <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">*</span> CAPACITY<span class="op">);</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> EMPTY<span class="op">;</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ht<span class="op">;</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ht_insert<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> pos <span class="op">=</span> <span class="op">(</span>idx <span class="op">+</span> i <span class="op">*</span> i<span class="op">)</span> <span class="op">%</span> CAPACITY<span class="op">;</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> EMPTY <span class="op">||</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> DELETED<span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Table full, cannot insert </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> key<span class="op">);</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ht_search<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> pos <span class="op">=</span> <span class="op">(</span>idx <span class="op">+</span> i <span class="op">*</span> i<span class="op">)</span> <span class="op">%</span> CAPACITY<span class="op">;</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> EMPTY<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> key<span class="op">)</span> <span class="cf">return</span> pos<span class="op">;</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> ht_create<span class="op">();</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">24</span><span class="op">);</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">31</span><span class="op">);</span></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">17</span><span class="op">);</span></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> QuadraticProbingHash:</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, size<span class="op">=</span><span class="dv">7</span>):</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> size</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> size</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, key):</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> key <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key):</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.size):</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>            pos <span class="op">=</span> (idx <span class="op">+</span> i <span class="op">*</span> i) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[pos] <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> <span class="va">self</span>.table[pos] <span class="op">==</span> <span class="st">"DELETED"</span>:</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.table[pos] <span class="op">=</span> key</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">OverflowError</span>(<span class="st">"Hash table full"</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, key):</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.size):</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>            pos <span class="op">=</span> (idx <span class="op">+</span> i <span class="op">*</span> i) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[pos] <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[pos] <span class="op">==</span> key:</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> pos</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>ht <span class="op">=</span> QuadraticProbingHash()</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">31</span>, <span class="dv">17</span>]:</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    ht.insert(k)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ht.table)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Search 24 at:"</span>, ht.search(<span class="dv">24</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-12" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-12">Why It Matters</h4>
<ul>
<li>Reduces primary clustering seen in linear probing</li>
<li>Keeps keys more evenly distributed</li>
<li>Avoids extra pointers (everything stays in one array)</li>
<li>Useful in hash tables where space is tight and locality helps</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-12" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-12">A Gentle Proof (Why It Works)</h4>
<p>Probe sequence: <span class="math display">\[
i = 0, 1, 2, 3, \ldots
\]</span> Index at step <em>i</em> is <span class="math display">\[
(index + i^2) \bmod m
\]</span> If table size <em>m</em> is prime, this sequence visits up to ⌈m/2⌉ distinct slots before repeating, guaranteeing an empty slot is found if load factor &lt; 0.5.</p>
<p>Thus all operations follow predictable, finite sequences.</p>
</section>
<section id="try-it-yourself-12" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-12">Try It Yourself</h4>
<ol type="1">
<li>Compare clustering with linear probing under same keys.</li>
<li>Experiment with different table sizes (prime vs composite).</li>
<li>Implement deletion markers properly.</li>
<li>Visualize probe paths with small tables.</li>
</ol>
</section>
<section id="test-cases-12" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-12">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Key</th>
<th>Probe Sequence</th>
<th>Slot</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert</td>
<td>10</td>
<td>3</td>
<td>3</td>
<td>no collision</td>
</tr>
<tr class="even">
<td>insert</td>
<td>24</td>
<td>3, 4</td>
<td>4</td>
<td>1 step</td>
</tr>
<tr class="odd">
<td>insert</td>
<td>31</td>
<td>3, 4, 0</td>
<td>0</td>
<td>2 steps</td>
</tr>
<tr class="even">
<td>insert</td>
<td>17</td>
<td>3, 4, 0, 2</td>
<td>2</td>
<td>3 steps</td>
</tr>
<tr class="odd">
<td>search</td>
<td>31</td>
<td>3 → 4 → 0</td>
<td>found</td>
<td>quadratic path</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Table full → insertion fails</li>
<li>Requires table size prime for full coverage</li>
<li>Needs load factor &lt; 0.5 to avoid infinite loops</li>
</ul>
</section>
<section id="complexity-12" class="level4">
<h4 class="anchored" data-anchor-id="complexity-12">Complexity</h4>
<ul>
<li>Time: average O(1), worst O(n)</li>
<li>Space: O(n)</li>
</ul>
<p>Quadratic probing trades a straight line for a curve, spreading collisions smoothly across the table.</p>
</section>
</section>
<section id="double-hashing" class="level3">
<h3 class="anchored" data-anchor-id="double-hashing">214 Double Hashing</h3>
<p>Double hashing uses two independent hash functions to minimize collisions. When a conflict occurs, it jumps forward by a second hash value, creating probe sequences unique to each key and greatly reducing clustering.</p>
<section id="what-problem-are-we-solving-13" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-13">What Problem Are We Solving?</h4>
<p>Linear and quadratic probing both suffer from clustering patterns, especially when keys share similar initial indices. Double hashing breaks this pattern by introducing a second hash function that defines each key’s step size.</p>
<p>Goal: Use two hash functions to determine probe sequence: <span class="math display">\[
\text{index}_i = (h_1(key) + i \cdot h_2(key)) \bmod m
\]</span> This produces independent probe paths and avoids overlap among keys.</p>
</section>
<section id="how-does-it-work-plain-language-13" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-13">How Does It Work (Plain Language)?</h4>
<p>When inserting a key:</p>
<ol type="1">
<li>Compute primary hash: <code>h1 = key % capacity</code>.</li>
<li>Compute step size: <code>h2 = 1 + (key % (capacity - 1))</code> (never zero).</li>
<li>Try <code>h1</code>; if occupied, try <code>(h1 + h2) % m</code>, <code>(h1 + 2*h2) % m</code>, etc.</li>
<li>Repeat until an empty slot is found.</li>
</ol>
<p>Same pattern applies for search and delete.</p>
<p>Example Steps (Capacity = 7)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Key</th>
<th>h₁(key)</th>
<th>h₂(key)</th>
<th>Probe Sequence</th>
<th>Final Slot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>10</td>
<td>3</td>
<td>4</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>24</td>
<td>3</td>
<td>4</td>
<td>3 → 0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>31</td>
<td>3</td>
<td>4</td>
<td>3 → 0 → 4</td>
<td>4</td>
</tr>
<tr class="even">
<td>4</td>
<td>17</td>
<td>3</td>
<td>3</td>
<td>3 → 6</td>
<td>6</td>
</tr>
</tbody>
</table>
<p>Final Table</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Index</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>24</td>
</tr>
<tr class="even">
<td>1</td>
<td>-</td>
</tr>
<tr class="odd">
<td>2</td>
<td>-</td>
</tr>
<tr class="even">
<td>3</td>
<td>10</td>
</tr>
<tr class="odd">
<td>4</td>
<td>31</td>
</tr>
<tr class="even">
<td>5</td>
<td>-</td>
</tr>
<tr class="odd">
<td>6</td>
<td>17</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-13" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-13">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CAPACITY </span><span class="dv">7</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define EMPTY </span><span class="op">-</span><span class="dv">1</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DELETED </span><span class="op">-</span><span class="dv">2</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>table<span class="op">;</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> HashTable<span class="op">;</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> h1<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> key <span class="op">%</span> CAPACITY<span class="op">;</span> <span class="op">}</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> h2<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="dv">1</span> <span class="op">+</span> <span class="op">(</span>key <span class="op">%</span> <span class="op">(</span>CAPACITY <span class="op">-</span> <span class="dv">1</span><span class="op">));</span> <span class="op">}</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>HashTable<span class="op">*</span> ht_create<span class="op">()</span> <span class="op">{</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>HashTable<span class="op">));</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>table <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">*</span> CAPACITY<span class="op">);</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> EMPTY<span class="op">;</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ht<span class="op">;</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ht_insert<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> idx1 <span class="op">=</span> h1<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> step <span class="op">=</span> h2<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> pos <span class="op">=</span> <span class="op">(</span>idx1 <span class="op">+</span> i <span class="op">*</span> step<span class="op">)</span> <span class="op">%</span> CAPACITY<span class="op">;</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> EMPTY <span class="op">||</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> DELETED<span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Table full, cannot insert </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> key<span class="op">);</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ht_search<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> idx1 <span class="op">=</span> h1<span class="op">(</span>key<span class="op">),</span> step <span class="op">=</span> h2<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> pos <span class="op">=</span> <span class="op">(</span>idx1 <span class="op">+</span> i <span class="op">*</span> step<span class="op">)</span> <span class="op">%</span> CAPACITY<span class="op">;</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> EMPTY<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> key<span class="op">)</span> <span class="cf">return</span> pos<span class="op">;</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> ht_create<span class="op">();</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">24</span><span class="op">);</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">31</span><span class="op">);</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">17</span><span class="op">);</span></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DoubleHash:</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, size<span class="op">=</span><span class="dv">7</span>):</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> size</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> size</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _h1(<span class="va">self</span>, key):</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> key <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _h2(<span class="va">self</span>, key):</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span> <span class="op">+</span> (key <span class="op">%</span> (<span class="va">self</span>.size <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key):</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        h1 <span class="op">=</span> <span class="va">self</span>._h1(key)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        h2 <span class="op">=</span> <span class="va">self</span>._h2(key)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.size):</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>            pos <span class="op">=</span> (h1 <span class="op">+</span> i <span class="op">*</span> h2) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[pos] <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> <span class="va">self</span>.table[pos] <span class="op">==</span> <span class="st">"DELETED"</span>:</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.table[pos] <span class="op">=</span> key</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">OverflowError</span>(<span class="st">"Hash table full"</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, key):</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>        h1 <span class="op">=</span> <span class="va">self</span>._h1(key)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>        h2 <span class="op">=</span> <span class="va">self</span>._h2(key)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.size):</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>            pos <span class="op">=</span> (h1 <span class="op">+</span> i <span class="op">*</span> h2) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[pos] <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[pos] <span class="op">==</span> key:</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> pos</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>ht <span class="op">=</span> DoubleHash()</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">31</span>, <span class="dv">17</span>]:</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>    ht.insert(k)</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ht.table)</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Search 24 at:"</span>, ht.search(<span class="dv">24</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-13" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-13">Why It Matters</h4>
<ul>
<li>Minimizes primary and secondary clustering</li>
<li>Probe sequences depend on key, not shared among colliding keys</li>
<li>Achieves uniform distribution when both hash functions are good</li>
<li>Forms basis for high-performance open addressing maps</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-13" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-13">A Gentle Proof (Why It Works)</h4>
<p>If capacity m is prime and h₂(key) never equals 0, then each key generates a unique probe sequence covering all slots: <span class="math display">\[
\text{indices} = {h_1, h_1 + h_2, h_1 + 2h_2, \ldots} \bmod m
\]</span> Thus an empty slot is always reachable, and searches find all candidates.</p>
<p>Expected probe count ≈ <span class="math inline">\(\frac{1}{1 - \alpha}\)</span>, same as other open addressing, but with lower clustering.</p>
</section>
<section id="try-it-yourself-13" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-13">Try It Yourself</h4>
<ol type="1">
<li>Experiment with different h₂ functions (e.g.&nbsp;<code>7 - key % 7</code>).</li>
<li>Compare probe lengths with linear and quadratic probing.</li>
<li>Visualize probe paths for small table sizes.</li>
<li>Test with composite vs prime capacities.</li>
</ol>
</section>
<section id="test-cases-13" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-13">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Key</th>
<th>h₁</th>
<th>h₂</th>
<th>Probe Sequence</th>
<th>Final Slot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert</td>
<td>10</td>
<td>3</td>
<td>4</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="even">
<td>insert</td>
<td>24</td>
<td>3</td>
<td>4</td>
<td>3, 0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>insert</td>
<td>31</td>
<td>3</td>
<td>4</td>
<td>3, 0, 4</td>
<td>4</td>
</tr>
<tr class="even">
<td>insert</td>
<td>17</td>
<td>3</td>
<td>3</td>
<td>3, 6</td>
<td>6</td>
</tr>
<tr class="odd">
<td>search</td>
<td>24</td>
<td>3, 0</td>
<td>found</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>h₂(key) must be nonzero</li>
<li>m should be prime for full coverage</li>
<li>Poor hash choice → incomplete coverage</li>
</ul>
</section>
<section id="complexity-13" class="level4">
<h4 class="anchored" data-anchor-id="complexity-13">Complexity</h4>
<ul>
<li>Time: average O(1), worst O(n)</li>
<li>Space: O(n)</li>
</ul>
<p>Double hashing turns collisions into a graceful dance, two hash functions weaving paths that rarely cross.</p>
</section>
</section>
<section id="cuckoo-hashing" class="level3">
<h3 class="anchored" data-anchor-id="cuckoo-hashing">215 Cuckoo Hashing</h3>
<p>Cuckoo hashing takes inspiration from nature: like the cuckoo bird laying eggs in multiple nests, each key has more than one possible home. If a spot is taken, it <em>kicks out</em> the current occupant, which then moves to its alternate home, ensuring fast and predictable lookups.</p>
<section id="what-problem-are-we-solving-14" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-14">What Problem Are We Solving?</h4>
<p>Traditional open addressing methods (linear, quadratic, double hashing) may degrade under high load factors, causing long probe sequences. Cuckoo hashing guarantees constant-time lookups by giving each key multiple possible positions.</p>
<p>Goal: Use two hash functions and relocate keys upon collision, maintaining O(1) search and insert time.</p>
</section>
<section id="how-does-it-work-plain-language-14" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-14">How Does It Work (Plain Language)?</h4>
<p>Each key has two candidate slots, determined by two hash functions: <span class="math display">\[
h_1(k), \quad h_2(k)
\]</span></p>
<p>When inserting a key:</p>
<ol type="1">
<li>Try <code>h1(k)</code> → if empty, place it.</li>
<li>If occupied → <em>kick out</em> the existing key.</li>
<li>Reinsert the displaced key into its alternate slot.</li>
<li>Repeat until all keys placed or cycle detected (then rehash).</li>
</ol>
<p>Example Steps (Capacity = 7)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Key</th>
<th>h₁(key)</th>
<th>h₂(key)</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>10</td>
<td>3</td>
<td>5</td>
<td>Slot 3 empty → place 10</td>
</tr>
<tr class="even">
<td>2</td>
<td>24</td>
<td>3</td>
<td>4</td>
<td>Slot 3 occupied → move 10</td>
</tr>
<tr class="odd">
<td>3</td>
<td>10</td>
<td>5</td>
<td>3</td>
<td>Slot 5 empty → place 10</td>
</tr>
<tr class="even">
<td>4</td>
<td>31</td>
<td>3</td>
<td>6</td>
<td>Slot 3 empty → place 31</td>
</tr>
</tbody>
</table>
<p>Final Table</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Index</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>-</td>
</tr>
<tr class="even">
<td>1</td>
<td>-</td>
</tr>
<tr class="odd">
<td>2</td>
<td>-</td>
</tr>
<tr class="even">
<td>3</td>
<td>31</td>
</tr>
<tr class="odd">
<td>4</td>
<td>24</td>
</tr>
<tr class="even">
<td>5</td>
<td>10</td>
</tr>
<tr class="odd">
<td>6</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>Every key is accessible in O(1) by checking two positions only.</p>
</section>
<section id="tiny-code-easy-versions-14" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-14">Tiny Code (Easy Versions)</h4>
<p>C (Two-Table Cuckoo Hashing)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CAPACITY </span><span class="dv">7</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define EMPTY </span><span class="op">-</span><span class="dv">1</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX_RELOCATIONS </span><span class="dv">10</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> table1<span class="op">[</span>CAPACITY<span class="op">];</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> table2<span class="op">[</span>CAPACITY<span class="op">];</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> CuckooHash<span class="op">;</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> h1<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> key <span class="op">%</span> CAPACITY<span class="op">;</span> <span class="op">}</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> h2<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">(</span>key <span class="op">/</span> CAPACITY<span class="op">)</span> <span class="op">%</span> CAPACITY<span class="op">;</span> <span class="op">}</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> init<span class="op">(</span>CuckooHash <span class="op">*</span>ht<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        ht<span class="op">-&gt;</span>table1<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> EMPTY<span class="op">;</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>        ht<span class="op">-&gt;</span>table2<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> EMPTY<span class="op">;</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> insert<span class="op">(</span>CuckooHash <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> pos<span class="op">,</span> tmp<span class="op">,</span> loop_guard <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> MAX_RELOCATIONS<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>        pos <span class="op">=</span> h1<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table1<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> EMPTY<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>table1<span class="op">[</span>pos<span class="op">]</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">// kick out</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>        tmp <span class="op">=</span> ht<span class="op">-&gt;</span>table1<span class="op">[</span>pos<span class="op">];</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>        ht<span class="op">-&gt;</span>table1<span class="op">[</span>pos<span class="op">]</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> tmp<span class="op">;</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>        pos <span class="op">=</span> h2<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table2<span class="op">[</span>pos<span class="op">]</span> <span class="op">==</span> EMPTY<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>table2<span class="op">[</span>pos<span class="op">]</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>        tmp <span class="op">=</span> ht<span class="op">-&gt;</span>table2<span class="op">[</span>pos<span class="op">];</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>        ht<span class="op">-&gt;</span>table2<span class="op">[</span>pos<span class="op">]</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> tmp<span class="op">;</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Cycle detected, rehash needed</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> search<span class="op">(</span>CuckooHash <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> pos1 <span class="op">=</span> h1<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> pos2 <span class="op">=</span> h2<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table1<span class="op">[</span>pos1<span class="op">]</span> <span class="op">==</span> key <span class="op">||</span> ht<span class="op">-&gt;</span>table2<span class="op">[</span>pos2<span class="op">]</span> <span class="op">==</span> key<span class="op">)</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>    CuckooHash ht<span class="op">;</span></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>    init<span class="op">(&amp;</span>ht<span class="op">);</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>    insert<span class="op">(&amp;</span>ht<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>    insert<span class="op">(&amp;</span>ht<span class="op">,</span> <span class="dv">24</span><span class="op">);</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>    insert<span class="op">(&amp;</span>ht<span class="op">,</span> <span class="dv">31</span><span class="op">);</span></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"[</span><span class="sc">%d</span><span class="st">] T1=</span><span class="sc">%d</span><span class="st"> T2=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> ht<span class="op">.</span>table1<span class="op">[</span>i<span class="op">],</span> ht<span class="op">.</span>table2<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CuckooHash:</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, size<span class="op">=</span><span class="dv">7</span>):</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> size</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table1 <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> size</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table2 <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> size</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_reloc <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _h1(<span class="va">self</span>, key): <span class="cf">return</span> key <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _h2(<span class="va">self</span>, key): <span class="cf">return</span> (key <span class="op">//</span> <span class="va">self</span>.size) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key):</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.max_reloc):</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>            idx1 <span class="op">=</span> <span class="va">self</span>._h1(key)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table1[idx1] <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.table1[idx1] <span class="op">=</span> key</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>            key, <span class="va">self</span>.table1[idx1] <span class="op">=</span> <span class="va">self</span>.table1[idx1], key  <span class="co"># swap</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>            idx2 <span class="op">=</span> <span class="va">self</span>._h2(key)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table2[idx2] <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.table2[idx2] <span class="op">=</span> key</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>            key, <span class="va">self</span>.table2[idx2] <span class="op">=</span> <span class="va">self</span>.table2[idx2], key  <span class="co"># swap</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="st">"Cycle detected, rehash needed"</span>)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, key):</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> key <span class="kw">in</span> <span class="va">self</span>.table1 <span class="kw">or</span> key <span class="kw">in</span> <span class="va">self</span>.table2</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>ht <span class="op">=</span> CuckooHash()</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">31</span>]:</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    ht.insert(k)</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Table1:"</span>, ht.table1)</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Table2:"</span>, ht.table2)</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Search 24:"</span>, ht.search(<span class="dv">24</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-14" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-14">Why It Matters</h4>
<ul>
<li>O(1) lookup, always two slots per key</li>
<li>Avoids clustering entirely</li>
<li>Excellent for high load factors (up to 0.5–0.9)</li>
<li>Simple predictable probe path</li>
<li>Great choice for hardware tables (e.g.&nbsp;network routing)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-14" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-14">A Gentle Proof (Why It Works)</h4>
<p>Each key has at most two possible homes.</p>
<ul>
<li>If both occupied, displacement ensures eventual convergence (or detects a cycle).</li>
<li>Cycle length bounded → rehash needed rarely.</li>
</ul>
<p>Expected insertion time = O(1) amortized; search always 2 checks only.</p>
</section>
<section id="try-it-yourself-14" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-14">Try It Yourself</h4>
<ol type="1">
<li>Implement rehash when cycle detected.</li>
<li>Add delete(key) and test reinsert.</li>
<li>Visualize displacement chain on insertions.</li>
<li>Compare performance with double hashing.</li>
</ol>
</section>
<section id="test-cases-14" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-14">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Key</th>
<th>h₁</th>
<th>h₂</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert</td>
<td>10</td>
<td>3</td>
<td>5</td>
<td>place at 3</td>
</tr>
<tr class="even">
<td>insert</td>
<td>24</td>
<td>3</td>
<td>4</td>
<td>displace 10 → move to 5</td>
</tr>
<tr class="odd">
<td>insert</td>
<td>31</td>
<td>3</td>
<td>6</td>
<td>place at 3</td>
</tr>
<tr class="even">
<td>search</td>
<td>10</td>
<td>3, 5</td>
<td>found</td>
<td></td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Cycle detected → requires rehash</li>
<li>Both tables full → resize</li>
<li>Must limit relocation attempts</li>
</ul>
</section>
<section id="complexity-14" class="level4">
<h4 class="anchored" data-anchor-id="complexity-14">Complexity</h4>
<ul>
<li><p>Time:</p>
<ul>
<li>Lookup: O(1)</li>
<li>Insert: O(1) amortized</li>
</ul></li>
<li><p>Space: O(2n)</p></li>
</ul>
<p>Cuckoo hashing keeps order in the nest, every key finds a home, or the table learns to rebuild its world.</p>
</section>
</section>
<section id="robin-hood-hashing" class="level3">
<h3 class="anchored" data-anchor-id="robin-hood-hashing">216 Robin Hood Hashing</h3>
<p>Robin Hood hashing is a clever twist on open addressing: when a new key collides, it compares its “distance from home” with the current occupant. If the new key has traveled farther, it <em>steals</em> the slot, redistributing probe distances more evenly and keeping variance low.</p>
<section id="what-problem-are-we-solving-15" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-15">What Problem Are We Solving?</h4>
<p>In linear probing, unlucky keys might travel long distances while others sit close to their home. This leads to probe sequence imbalance, long searches for some keys, short for others. Robin Hood hashing “robs” near-home keys to help far-away ones, minimizing the maximum probe distance.</p>
<p>Goal: Equalize probe distances by swapping keys so that no key is “too far” behind others.</p>
</section>
<section id="how-does-it-work-plain-language-15" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-15">How Does It Work (Plain Language)?</h4>
<p>Each entry remembers its probe distance = number of steps from its original hash slot. When inserting a new key:</p>
<ol type="1">
<li><p>Compute <code>index = hash(key) % capacity</code>.</p></li>
<li><p>If slot empty → insert.</p></li>
<li><p>If occupied → compare probe distances.</p>
<ul>
<li>If newcomer’s distance &gt; occupant’s distance → swap them.</li>
<li>Continue insertion for the displaced key.</li>
</ul></li>
</ol>
<p>Example Steps (Capacity = 7)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Key</th>
<th>Hash(key)</th>
<th>Probe Distance</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>10</td>
<td>3</td>
<td>0</td>
<td>Place at 3</td>
</tr>
<tr class="even">
<td>2</td>
<td>24</td>
<td>3</td>
<td>0</td>
<td>Collision → move to 4 (dist=1)</td>
</tr>
<tr class="odd">
<td>3</td>
<td>31</td>
<td>3</td>
<td>0</td>
<td>Collision → dist=0 &lt; 0? no → move → dist=1 &lt; 1? no → dist=2 → place at 5</td>
</tr>
<tr class="even">
<td>4</td>
<td>17</td>
<td>3</td>
<td>0</td>
<td>Collision chain → compare and swap if farther</td>
</tr>
</tbody>
</table>
<p>This ensures all keys stay near their home index, fairer access for all.</p>
<p>Result Table:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Index</th>
<th>Key</th>
<th>Dist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>10</td>
<td>0</td>
</tr>
<tr class="even">
<td>4</td>
<td>24</td>
<td>1</td>
</tr>
<tr class="odd">
<td>5</td>
<td>31</td>
<td>2</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-15" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-15">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CAPACITY </span><span class="dv">7</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define EMPTY </span><span class="op">-</span><span class="dv">1</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">;</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> dist<span class="op">;</span> <span class="co">// probe distance</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Slot<span class="op">;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    Slot <span class="op">*</span>table<span class="op">;</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> HashTable<span class="op">;</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hash<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> key <span class="op">%</span> CAPACITY<span class="op">;</span> <span class="op">}</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>HashTable<span class="op">*</span> ht_create<span class="op">()</span> <span class="op">{</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>HashTable<span class="op">));</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>table <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Slot<span class="op">)</span> <span class="op">*</span> CAPACITY<span class="op">);</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>        ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">].</span>key <span class="op">=</span> EMPTY<span class="op">;</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>        ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">].</span>dist <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ht<span class="op">;</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ht_insert<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> dist <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>key <span class="op">==</span> EMPTY<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>dist <span class="op">=</span> dist<span class="op">;</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>dist <span class="op">&gt;</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>dist<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>            <span class="co">// swap keys</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> tmp_key <span class="op">=</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>key<span class="op">;</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> tmp_dist <span class="op">=</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>dist<span class="op">;</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>dist <span class="op">=</span> dist<span class="op">;</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>            key <span class="op">=</span> tmp_key<span class="op">;</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>            dist <span class="op">=</span> tmp_dist<span class="op">;</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="op">(</span>idx <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> CAPACITY<span class="op">;</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>        dist<span class="op">++;</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>dist <span class="op">&gt;=</span> CAPACITY<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"Table full</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ht_search<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> dist <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>key <span class="op">!=</span> EMPTY <span class="op">&amp;&amp;</span> dist <span class="op">&lt;=</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>dist<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>idx<span class="op">].</span>key <span class="op">==</span> key<span class="op">)</span> <span class="cf">return</span> idx<span class="op">;</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="op">(</span>idx <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> CAPACITY<span class="op">;</span></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>        dist<span class="op">++;</span></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> ht_create<span class="op">();</span></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">24</span><span class="op">);</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="dv">31</span><span class="op">);</span></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">].</span>key <span class="op">!=</span> EMPTY<span class="op">)</span></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"[</span><span class="sc">%d</span><span class="st">] key=</span><span class="sc">%d</span><span class="st"> dist=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">].</span>key<span class="op">,</span> ht<span class="op">-&gt;</span>table<span class="op">[</span>i<span class="op">].</span>dist<span class="op">);</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RobinHoodHash:</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, size<span class="op">=</span><span class="dv">7</span>):</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> size</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> size</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dist <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> size</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, key):</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> key <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key):</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[idx] <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.table[idx] <span class="op">=</span> key</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.dist[idx] <span class="op">=</span> d</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Robin Hood swap if newcomer is farther</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> d <span class="op">&gt;</span> <span class="va">self</span>.dist[idx]:</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>                key, <span class="va">self</span>.table[idx] <span class="op">=</span> <span class="va">self</span>.table[idx], key</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                d, <span class="va">self</span>.dist[idx] <span class="op">=</span> <span class="va">self</span>.dist[idx], d</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">=</span> (idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>            d <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> d <span class="op">&gt;=</span> <span class="va">self</span>.size:</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">OverflowError</span>(<span class="st">"Table full"</span>)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, key):</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">self</span>.table[idx] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> d <span class="op">&lt;=</span> <span class="va">self</span>.dist[idx]:</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.table[idx] <span class="op">==</span> key:</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> idx</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">=</span> (idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>            d <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>ht <span class="op">=</span> RobinHoodHash()</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">31</span>]:</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>    ht.insert(k)</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(<span class="bu">zip</span>(<span class="bu">range</span>(ht.size), ht.table, ht.dist)))</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Search 24:"</span>, ht.search(<span class="dv">24</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-15" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-15">Why It Matters</h4>
<ul>
<li>Balances access time across all keys</li>
<li>Minimizes variance of probe lengths</li>
<li>Outperforms linear probing under high load</li>
<li>Elegant fairness principle, long-traveling keys get priority</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-15" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-15">A Gentle Proof (Why It Works)</h4>
<p>By ensuring all probe distances are roughly equal, worst-case search cost ≈ average search cost. Keys never get “stuck” behind long clusters, and searches terminate early when probe distance exceeds that of existing slot.</p>
<p>Average search cost ≈ O(1 + α), but with <em>smaller variance</em> than standard linear probing.</p>
</section>
<section id="try-it-yourself-15" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-15">Try It Yourself</h4>
<ol type="1">
<li>Insert keys in different orders and compare probe distances.</li>
<li>Implement deletion (mark deleted and shift neighbors).</li>
<li>Track average probe distance as load grows.</li>
<li>Compare fairness with standard linear probing.</li>
</ol>
</section>
<section id="test-cases-15" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-15">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Key</th>
<th>Home</th>
<th>Final Slot</th>
<th>Dist</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert</td>
<td>10</td>
<td>3</td>
<td>3</td>
<td>0</td>
<td>first insert</td>
</tr>
<tr class="even">
<td>insert</td>
<td>24</td>
<td>3</td>
<td>4</td>
<td>1</td>
<td>collision</td>
</tr>
<tr class="odd">
<td>insert</td>
<td>31</td>
<td>3</td>
<td>5</td>
<td>2</td>
<td>further collision</td>
</tr>
<tr class="even">
<td>search</td>
<td>24</td>
<td>3→4</td>
<td>found</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Table full → stop insertion</li>
<li>Must cap distance to prevent infinite loop</li>
<li>Deletion requires rebalancing neighbors</li>
</ul>
</section>
<section id="complexity-15" class="level4">
<h4 class="anchored" data-anchor-id="complexity-15">Complexity</h4>
<ul>
<li>Time: average O(1), worst O(n)</li>
<li>Space: O(n)</li>
</ul>
<p>Robin Hood hashing brings justice to collisions, no key left wandering too far from home.</p>
</section>
</section>
<section id="chained-hash-table" class="level3">
<h3 class="anchored" data-anchor-id="chained-hash-table">217 Chained Hash Table</h3>
<p>A chained hash table is the classic solution for handling collisions, instead of squeezing every key into the array, each bucket holds a linked list (or chain) of entries that share the same hash index.</p>
<section id="what-problem-are-we-solving-16" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-16">What Problem Are We Solving?</h4>
<p>With open addressing, collisions force you to probe for new slots inside the array. Chaining solves collisions externally, every index points to a small dynamic list, so multiple keys can share the same slot without crowding.</p>
<p>Goal: Use linked lists (chains) to store colliding keys at the same hash index, keeping insert, search, and delete simple and efficient on average.</p>
</section>
<section id="how-does-it-work-plain-language-16" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-16">How Does It Work (Plain Language)?</h4>
<p>Each array index stores a pointer to a linked list of key-value pairs. When inserting:</p>
<ol type="1">
<li>Compute index = <code>hash(key) % capacity</code>.</li>
<li>Traverse chain to check if key exists.</li>
<li>If not, append new node to the front (or back).</li>
</ol>
<p>Searching and deleting follow the same index and chain.</p>
<p>Example (Capacity = 5)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Key</th>
<th>Hash(key)</th>
<th>Index</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>“cat”</td>
<td>2</td>
<td>2</td>
<td>Place in chain[2]</td>
</tr>
<tr class="even">
<td>2</td>
<td>“dog”</td>
<td>4</td>
<td>4</td>
<td>Place in chain[4]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>“bat”</td>
<td>2</td>
<td>2</td>
<td>Append to chain[2]</td>
</tr>
<tr class="even">
<td>4</td>
<td>“ant”</td>
<td>2</td>
<td>2</td>
<td>Append to chain[2]</td>
</tr>
</tbody>
</table>
<p>Table Structure</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Index</th>
<th>Chain</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>-</td>
</tr>
<tr class="even">
<td>1</td>
<td>-</td>
</tr>
<tr class="odd">
<td>2</td>
<td>“cat” → “bat” → “ant”</td>
</tr>
<tr class="even">
<td>3</td>
<td>-</td>
</tr>
<tr class="odd">
<td>4</td>
<td>“dog”</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-16" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-16">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CAPACITY </span><span class="dv">5</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>key<span class="op">;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>buckets<span class="op">[</span>CAPACITY<span class="op">];</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> HashTable<span class="op">;</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> hash<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> h <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(*</span>key<span class="op">)</span> h <span class="op">=</span> h <span class="op">*</span> <span class="dv">31</span> <span class="op">+</span> <span class="op">*</span>key<span class="op">++;</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> h <span class="op">%</span> CAPACITY<span class="op">;</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>HashTable<span class="op">*</span> ht_create<span class="op">()</span> <span class="op">{</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>HashTable<span class="op">));</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CAPACITY<span class="op">;</span> i<span class="op">++)</span> ht<span class="op">-&gt;</span>buckets<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ht<span class="op">;</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ht_insert<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>node <span class="op">=</span> ht<span class="op">-&gt;</span>buckets<span class="op">[</span>idx<span class="op">];</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>node<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>node<span class="op">-&gt;</span>key<span class="op">,</span> key<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span> node<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> node<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>new_node <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>key <span class="op">=</span> strdup<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>next <span class="op">=</span> ht<span class="op">-&gt;</span>buckets<span class="op">[</span>idx<span class="op">];</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>buckets<span class="op">[</span>idx<span class="op">]</span> <span class="op">=</span> new_node<span class="op">;</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ht_search<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>node <span class="op">=</span> ht<span class="op">-&gt;</span>buckets<span class="op">[</span>idx<span class="op">];</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>node<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>node<span class="op">-&gt;</span>key<span class="op">,</span> key<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span> <span class="op">*</span>out <span class="op">=</span> node<span class="op">-&gt;</span>value<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> node<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ht_delete<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>    Node curr <span class="op">=</span> <span class="op">&amp;</span>ht<span class="op">-&gt;</span>buckets<span class="op">[</span>idx<span class="op">];</span></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(*</span>curr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">((*</span>curr<span class="op">)-&gt;</span>key<span class="op">,</span> key<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>            Node <span class="op">*</span>tmp <span class="op">=</span> <span class="op">*</span>curr<span class="op">;</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>curr <span class="op">=</span> <span class="op">(*</span>curr<span class="op">)-&gt;</span>next<span class="op">;</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>tmp<span class="op">-&gt;</span>key<span class="op">);</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>tmp<span class="op">);</span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>        curr <span class="op">=</span> <span class="op">&amp;(*</span>curr<span class="op">)-&gt;</span>next<span class="op">;</span></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> ht_create<span class="op">();</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="st">"cat"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="st">"bat"</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>    ht_insert<span class="op">(</span>ht<span class="op">,</span> <span class="st">"ant"</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ht_search<span class="op">(</span>ht<span class="op">,</span> <span class="st">"bat"</span><span class="op">,</span> <span class="op">&amp;</span>val<span class="op">))</span></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"bat: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>    ht_delete<span class="op">(</span>ht<span class="op">,</span> <span class="st">"bat"</span><span class="op">);</span></span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>ht_search<span class="op">(</span>ht<span class="op">,</span> <span class="st">"bat"</span><span class="op">,</span> <span class="op">&amp;</span>val<span class="op">))</span></span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"bat deleted</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ChainedHash:</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, size<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> size</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(size)]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, key):</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(key) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key, value):</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pair <span class="kw">in</span> <span class="va">self</span>.table[idx]:</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pair[<span class="dv">0</span>] <span class="op">==</span> key:</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                pair[<span class="dv">1</span>] <span class="op">=</span> value</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table[idx].append([key, value])</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, key):</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k, v <span class="kw">in</span> <span class="va">self</span>.table[idx]:</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> key:</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> v</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete(<span class="va">self</span>, key):</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table[idx] <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> <span class="va">self</span>.table[idx] <span class="cf">if</span> p[<span class="dv">0</span>] <span class="op">!=</span> key]</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>ht <span class="op">=</span> ChainedHash()</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>ht.insert(<span class="st">"cat"</span>, <span class="dv">1</span>)</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>ht.insert(<span class="st">"bat"</span>, <span class="dv">2</span>)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>ht.insert(<span class="st">"ant"</span>, <span class="dv">3</span>)</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ht.table)</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Search bat:"</span>, ht.search(<span class="st">"bat"</span>))</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>ht.delete(<span class="st">"bat"</span>)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ht.table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-16" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-16">Why It Matters</h4>
<ul>
<li>Simple and reliable collision handling</li>
<li>Load factor can exceed 1 (chains absorb overflow)</li>
<li>Deletion is straightforward (just remove node)</li>
<li>Performance stable even at high load (if hash spread is uniform)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-16" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-16">A Gentle Proof (Why It Works)</h4>
<p>Expected chain length = load factor <span class="math inline">\(\alpha = \frac{n}{m}\)</span>. Each operation traverses a single chain, so average cost = O(1 + α). Uniform hash distribution ensures α remains small → operations ≈ O(1).</p>
</section>
<section id="try-it-yourself-16" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-16">Try It Yourself</h4>
<ol type="1">
<li>Implement dynamic resizing when average chain length grows.</li>
<li>Compare prepend vs append strategies.</li>
<li>Measure average search steps as table fills.</li>
<li>Replace linked list with balanced tree (for high α).</li>
</ol>
</section>
<section id="test-cases-16" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-16">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Key</th>
<th>Index</th>
<th>Chain Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert</td>
<td>“cat”</td>
<td>2</td>
<td>[“cat”]</td>
<td></td>
</tr>
<tr class="even">
<td>insert</td>
<td>“bat”</td>
<td>2</td>
<td>[“bat”, “cat”]</td>
<td>collision</td>
</tr>
<tr class="odd">
<td>insert</td>
<td>“ant”</td>
<td>2</td>
<td>[“ant”, “bat”, “cat”]</td>
<td>chain grows</td>
</tr>
<tr class="even">
<td>search</td>
<td>“bat”</td>
<td>2</td>
<td>found</td>
<td></td>
</tr>
<tr class="odd">
<td>delete</td>
<td>“bat”</td>
<td>2</td>
<td>[“ant”, “cat”]</td>
<td>removed</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Many keys same index → long chains</li>
<li>Poor hash function → uneven distribution</li>
<li>Needs memory for pointers/nodes</li>
</ul>
</section>
<section id="complexity-16" class="level4">
<h4 class="anchored" data-anchor-id="complexity-16">Complexity</h4>
<ul>
<li>Time: average O(1), worst O(n) (all in one chain)</li>
<li>Space: O(n + m)</li>
</ul>
<p>Chained hashing turns collisions into conversation, if one bucket’s full, it just lines them up neatly in a list.</p>
</section>
</section>
<section id="perfect-hashing" class="level3">
<h3 class="anchored" data-anchor-id="perfect-hashing">218 Perfect Hashing</h3>
<p>Perfect hashing is the dream scenario for hash tables, no collisions at all. Every key maps to a unique slot, so lookups, inserts, and deletes all take O(1) time <em>worst case</em>, not just on average.</p>
<section id="what-problem-are-we-solving-17" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-17">What Problem Are We Solving?</h4>
<p>Most hashing strategies (linear probing, chaining, cuckoo) deal with collisions after they happen. Perfect hashing eliminates them entirely by designing a collision-free hash function for a fixed key set.</p>
<p>Goal: Construct a hash function <span class="math inline">\(h(k)\)</span> such that all keys map to distinct indices.</p>
</section>
<section id="how-does-it-work-plain-language-17" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-17">How Does It Work (Plain Language)?</h4>
<p>If the set of keys is known in advance (static set), we can carefully choose or build a hash function that gives each key a unique slot.</p>
<p>Two main types:</p>
<ol type="1">
<li>Perfect Hashing, no collisions.</li>
<li>Minimal Perfect Hashing, no collisions and table size = number of keys.</li>
</ol>
<p>Simple Example (Keys = {10, 24, 31, 17}, Capacity = 7)</p>
<p>Let’s find a function: <span class="math display">\[
h(k) = (a \cdot k + b) \bmod 7
\]</span> We can search for coefficients a and b that produce unique indices:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Key</th>
<th>h(k) = (2k + 1) mod 7</th>
<th>Index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>(21) % 7 = 0</td>
<td>0</td>
</tr>
<tr class="even">
<td>24</td>
<td>(49) % 7 = 0</td>
<td>❌ collision</td>
</tr>
<tr class="odd">
<td>31</td>
<td>(63) % 7 = 0</td>
<td>❌ collision</td>
</tr>
</tbody>
</table>
<p>So we try another pair (a=3, b=2):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Key</th>
<th>(3k + 2) mod 7</th>
<th>Index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>5</td>
<td>5</td>
</tr>
<tr class="even">
<td>24</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td>31</td>
<td>4</td>
<td>❌ collision</td>
</tr>
<tr class="even">
<td>17</td>
<td>6</td>
<td>6</td>
</tr>
</tbody>
</table>
<p>Eventually, we find a mapping with no repeats by adjusting parameters or using two-level construction.</p>
</section>
<section id="two-level-perfect-hashing" class="level4">
<h4 class="anchored" data-anchor-id="two-level-perfect-hashing">Two-Level Perfect Hashing</h4>
<p>Practical perfect hashing often uses a two-level scheme:</p>
<ol type="1">
<li>Top level: Hash keys into buckets.</li>
<li>Second level: Each bucket gets its own small hash table with its own perfect hash function.</li>
</ol>
<p>This ensures zero collisions overall, with total space ≈ O(n).</p>
<p>Process:</p>
<ul>
<li>Each bucket of size <em>b</em> gets a secondary table of size <em>b²</em>.</li>
<li>Use a second hash <span class="math inline">\(h_i\)</span> for that bucket to place all keys uniquely.</li>
</ul>
</section>
<section id="tiny-code-easy-version" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-version">Tiny Code (Easy Version)</h4>
<p>Python (Two-Level Static Perfect Hashing)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PerfectHash:</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, keys):</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> <span class="bu">len</span>(keys)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> <span class="va">self</span>.n</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.buckets <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.size)]</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.secondary <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> <span class="va">self</span>.size</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># First-level hashing</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> <span class="dv">3</span>, <span class="dv">5</span>  <span class="co"># fixed small hash parameters</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> h1(k): <span class="cf">return</span> (a <span class="op">*</span> k <span class="op">+</span> b) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Distribute keys into buckets</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> keys:</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.buckets[h1(k)].append(k)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Build second-level tables</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, bucket <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.buckets):</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> bucket:</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>            m <span class="op">=</span> <span class="bu">len</span>(bucket)  <span class="dv">2</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>            table <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> m</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>            found <span class="op">=</span> <span class="va">False</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="kw">not</span> found:</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>                found <span class="op">=</span> <span class="va">True</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>                a2, b2 <span class="op">=</span> random.randint(<span class="dv">1</span>, m <span class="op">-</span> <span class="dv">1</span>), random.randint(<span class="dv">0</span>, m <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>                <span class="kw">def</span> h2(k): <span class="cf">return</span> (a2 <span class="op">*</span> k <span class="op">+</span> b2) <span class="op">%</span> m</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>                table <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> m</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> k <span class="kw">in</span> bucket:</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>                    pos <span class="op">=</span> h2(k)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> table[pos] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>                        found <span class="op">=</span> <span class="va">False</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>                    table[pos] <span class="op">=</span> k</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.secondary[i] <span class="op">=</span> (table, a2, b2)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.h1 <span class="op">=</span> h1</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, key):</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="va">self</span>.h1(key)</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>        table, a2, b2 <span class="op">=</span> <span class="va">self</span>.secondary[i]</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> <span class="bu">len</span>(table)</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>        pos <span class="op">=</span> (a2 <span class="op">*</span> key <span class="op">+</span> b2) <span class="op">%</span> m</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> table[pos] <span class="op">==</span> key</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> [<span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">31</span>, <span class="dv">17</span>]</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>ph <span class="op">=</span> PerfectHash(keys)</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>([<span class="bu">len</span>(b) <span class="cf">for</span> b <span class="kw">in</span> ph.buckets])</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Search 24:"</span>, ph.search(<span class="dv">24</span>))</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Search 11:"</span>, ph.search(<span class="dv">11</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-17" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-17">Why It Matters</h4>
<ul>
<li>Guaranteed O(1) worst-case lookup</li>
<li>No clustering, no collisions, no chains</li>
<li>Ideal for static key sets (e.g.&nbsp;reserved keywords in a compiler, routing tables)</li>
<li>Memory predictable, access blazing fast</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-17" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-17">A Gentle Proof (Why It Works)</h4>
<p>Let <span class="math inline">\(n=|S|\)</span> be the number of keys.<br>
With a truly random hash family into <span class="math inline">\(m\)</span> buckets, the collision probability for two distinct keys is <span class="math inline">\(1/m\)</span>.</p>
<p>Choose <span class="math inline">\(m=n^2\)</span>. Then the expected number of collisions is <span class="math display">\[
\mathbb{E}[C]=\binom{n}{2}\cdot \frac{1}{m}
=\frac{n(n-1)}{2n^2}&lt;\tfrac12.
\]</span> By Markov, <span class="math inline">\(\Pr[C\ge1]\le \mathbb{E}[C]&lt;\tfrac12\)</span>, so <span class="math inline">\(\Pr[C=0]&gt;\tfrac12\)</span>.<br>
Therefore a collision-free hash exists. In practice, try random seeds until one has <span class="math inline">\(C=0\)</span>, or use a deterministic construction for perfect hashing.</p>
</section>
<section id="try-it-yourself-17" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-17">Try It Yourself</h4>
<ol type="1">
<li>Generate perfect hash for small static set {“if”, “else”, “for”, “while”}.</li>
<li>Build minimal perfect hash (table size = n).</li>
<li>Compare lookup times with standard dict.</li>
<li>Visualize second-level hash table sizes.</li>
</ol>
</section>
<section id="test-cases-17" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-17">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Keys</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>build</td>
<td>[10,24,31,17]</td>
<td>success</td>
<td>each slot unique</td>
</tr>
<tr class="even">
<td>search</td>
<td>24</td>
<td>True</td>
<td>found</td>
</tr>
<tr class="odd">
<td>search</td>
<td>11</td>
<td>False</td>
<td>not in table</td>
</tr>
<tr class="even">
<td>collisions</td>
<td>none</td>
<td></td>
<td>perfect mapping</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Works only for static sets (no dynamic inserts)</li>
<li>Building may require rehash trials</li>
<li>Memory ↑ with quadratic secondary tables</li>
</ul>
</section>
<section id="complexity-17" class="level4">
<h4 class="anchored" data-anchor-id="complexity-17">Complexity</h4>
<ul>
<li>Build: O(n²) (search for collision-free mapping)</li>
<li>Lookup: O(1)</li>
<li>Space: O(n) to O(n²) depending on method</li>
</ul>
<p>Perfect hashing is like finding the perfect key for every lock, built once, opens instantly, never collides.</p>
</section>
</section>
<section id="consistent-hashing" class="level3">
<h3 class="anchored" data-anchor-id="consistent-hashing">219 Consistent Hashing</h3>
<p>Consistent hashing is a collision-handling strategy designed for <em>distributed systems</em> rather than single in-memory tables. It ensures that when nodes (servers, caches, or shards) join or leave, only a small fraction of keys need to be remapped, making it the backbone of scalable, fault-tolerant architectures.</p>
<section id="what-problem-are-we-solving-18" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-18">What Problem Are We Solving?</h4>
<p>In traditional hashing (e.g.&nbsp;<code>hash(key) % n</code>), when the number of servers <code>n</code> changes, almost every key’s location changes. That’s disastrous for caching, databases, or load balancing.</p>
<p>Consistent hashing fixes this by mapping both keys and servers into the same hash space, and placing keys near their nearest server clockwise, minimizing reassignments when the system changes.</p>
<p>Goal: Achieve stable key distribution under dynamic server counts with minimal movement and good balance.</p>
</section>
<section id="how-does-it-work-plain-language-18" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-18">How Does It Work (Plain Language)?</h4>
<ol type="1">
<li>Imagine a hash ring, numbers 0 through (2^{m}-1) arranged in a circle.</li>
<li>Each node (server) and key is hashed to a position on the ring.</li>
<li>A key is assigned to the next server clockwise from its hash position.</li>
<li>When a node joins/leaves, only keys in its immediate region move.</li>
</ol>
<p>Example (Capacity = 2¹⁶)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Item</th>
<th>Hash</th>
<th>Placed On Ring</th>
<th>Owner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Node A</td>
<td>1000</td>
<td>•</td>
<td></td>
</tr>
<tr class="even">
<td>Node B</td>
<td>4000</td>
<td>•</td>
<td></td>
</tr>
<tr class="odd">
<td>Node C</td>
<td>8000</td>
<td>•</td>
<td></td>
</tr>
<tr class="even">
<td>Key K₁</td>
<td>1200</td>
<td>→ Node B</td>
<td></td>
</tr>
<tr class="odd">
<td>Key K₂</td>
<td>8500</td>
<td>→ Node A (wrap-around)</td>
<td></td>
</tr>
</tbody>
</table>
<p>If Node B leaves, only keys in its segment (1000–4000) move, everything else stays put.</p>
</section>
<section id="improving-load-balance" class="level4">
<h4 class="anchored" data-anchor-id="improving-load-balance">Improving Load Balance</h4>
<p>To prevent uneven distribution, each node is represented by multiple virtual nodes (vnodes), each vnode gets its own hash. This smooths the key spread across all nodes.</p>
<p>Example:</p>
<ul>
<li>Node A → hashes to 1000, 6000</li>
<li>Node B → hashes to 3000, 9000</li>
</ul>
<p>Keys are assigned to closest vnode clockwise.</p>
</section>
<section id="tiny-code-easy-versions-17" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-17">Tiny Code (Easy Versions)</h4>
<p>Python (Simple Consistent Hashing with Virtual Nodes)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bisect</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hash_fn(key):</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">int</span>(hashlib.md5(<span class="bu">str</span>(key).encode()).hexdigest(), <span class="dv">16</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ConsistentHash:</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, nodes<span class="op">=</span><span class="va">None</span>, vnodes<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ring <span class="op">=</span> []</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">map</span> <span class="op">=</span> {}</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.vnodes <span class="op">=</span> vnodes</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> nodes:</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> n <span class="kw">in</span> nodes:</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.add_node(n)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_node(<span class="va">self</span>, node):</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.vnodes):</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>            h <span class="op">=</span> hash_fn(<span class="ss">f"</span><span class="sc">{</span>node<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.<span class="bu">map</span>[h] <span class="op">=</span> node</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>            bisect.insort(<span class="va">self</span>.ring, h)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> remove_node(<span class="va">self</span>, node):</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.vnodes):</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>            h <span class="op">=</span> hash_fn(<span class="ss">f"</span><span class="sc">{</span>node<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ring.remove(h)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">del</span> <span class="va">self</span>.<span class="bu">map</span>[h]</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_node(<span class="va">self</span>, key):</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.ring:</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> hash_fn(key)</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> bisect.bisect(<span class="va">self</span>.ring, h) <span class="op">%</span> <span class="bu">len</span>(<span class="va">self</span>.ring)</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.<span class="bu">map</span>[<span class="va">self</span>.ring[idx]]</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>ch <span class="op">=</span> ConsistentHash([<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>], vnodes<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Key 42 -&gt;"</span>, ch.get_node(<span class="dv">42</span>))</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>ch.remove_node(<span class="st">"B"</span>)</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"After removing B, Key 42 -&gt;"</span>, ch.get_node(<span class="dv">42</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-18" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-18">Why It Matters</h4>
<ul>
<li>Minimizes key remapping when nodes change (≈ 1/n of keys move)</li>
<li>Enables elastic scaling for caches, DB shards, and distributed stores</li>
<li>Used in systems like Amazon Dynamo, Cassandra, Riak, and memcached clients</li>
<li>Balances load using virtual nodes</li>
<li>Decouples hash function from node count</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-18" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-18">A Gentle Proof (Why It Works)</h4>
<p>Let <span class="math inline">\(N\)</span> be the number of nodes and <span class="math inline">\(K\)</span> the number of keys.<br>
Each node is responsible for a fraction <span class="math inline">\(\frac{1}{N}\)</span> of the ring.</p>
<p>When one node leaves, only its segment’s keys move, about <span class="math inline">\(K/N\)</span>.<br>
So the expected remapping fraction is <span class="math inline">\(\frac{1}{N}\)</span>.</p>
<p>Adding virtual nodes (vnodes) increases uniformity.<br>
With <span class="math inline">\(V\)</span> vnodes per physical node, the variance of the per-node load fraction scales as <span class="math inline">\(\approx \frac{1}{V}\)</span>.</p>
</section>
<section id="try-it-yourself-18" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-18">Try It Yourself</h4>
<ol type="1">
<li>Add and remove nodes, track how many keys move.</li>
<li>Experiment with different vnode counts (1, 10, 100).</li>
<li>Visualize hash ring, mark nodes and key positions.</li>
<li>Simulate caching: assign 1000 keys, remove one node, count moves.</li>
</ol>
</section>
<section id="test-cases-18" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-18">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 15%">
<col style="width: 30%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Node(s)</th>
<th>Keys</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>add_nodes</td>
<td>A, B, C</td>
<td>[1..1000]</td>
<td>distributed evenly</td>
<td></td>
</tr>
<tr class="even">
<td>remove_node</td>
<td>B</td>
<td>[1..1000]</td>
<td>~1/3 keys moved</td>
<td>stability check</td>
</tr>
<tr class="odd">
<td>add_node</td>
<td>D</td>
<td>[1..1000]</td>
<td>~1/4 keys remapped</td>
<td></td>
</tr>
<tr class="even">
<td>lookup</td>
<td>42</td>
<td>-&gt; Node C</td>
<td>consistent mapping</td>
<td></td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Empty ring → return None</li>
<li>Duplicate nodes → handle via unique vnode IDs</li>
<li>Without vnodes → uneven load</li>
</ul>
</section>
<section id="complexity-18" class="level4">
<h4 class="anchored" data-anchor-id="complexity-18">Complexity</h4>
<ul>
<li>Lookup: <span class="math inline">\(O(\log n)\)</span> (binary search in the ring)<br>
</li>
<li>Insert/Delete node: <span class="math inline">\(O(v \log n)\)</span><br>
</li>
<li>Space: <span class="math inline">\(O(n \times v)\)</span></li>
</ul>
<p>Consistent hashing keeps order in the storm — servers may come and go, but most keys stay right where they belong.</p>
</section>
</section>
<section id="dynamic-rehashing" class="level3">
<h3 class="anchored" data-anchor-id="dynamic-rehashing">220 Dynamic Rehashing</h3>
<p>Dynamic rehashing is how a hash table gracefully adapts as data grows or shrinks. Instead of being trapped in a fixed-size array, the table <em>resizes itself</em>, rebuilding its layout so that load stays balanced and lookups remain fast.</p>
<section id="what-problem-are-we-solving-19" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-19">What Problem Are We Solving?</h4>
<p>When a hash table fills up, collisions become frequent, degrading performance to O(n). We need a mechanism to maintain a low load factor (ratio of elements to capacity) by resizing and rehashing automatically.</p>
<p>Goal: Detect when load factor crosses a threshold, allocate a larger array, and rehash all keys into their new positions efficiently.</p>
</section>
<section id="how-does-it-work-plain-language-19" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-19">How Does It Work (Plain Language)?</h4>
<ol type="1">
<li><p>Monitor load factor</p>
<p><span class="math display">\[
\alpha = \frac{n}{m}
\]</span> where <span class="math inline">\(n\)</span> is the number of elements and <span class="math inline">\(m\)</span> is the table size.</p></li>
<li><p>Trigger rehash</p>
<ul>
<li>If <span class="math inline">\(\alpha &gt; 0.75\)</span>, expand the table (for example, double the capacity).<br>
</li>
<li>If <span class="math inline">\(\alpha &lt; 0.25\)</span>, shrink it (optional).</li>
</ul></li>
<li><p>Rebuild</p>
<ul>
<li>Create a new table with the updated capacity.<br>
</li>
<li>Reinsert each key using the new hash function modulo the new capacity.</li>
</ul></li>
</ol>
<p>Example Steps</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Capacity</th>
<th>Items</th>
<th>Load Factor</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>4</td>
<td>2</td>
<td>0.5</td>
<td>ok</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>3</td>
<td>0.75</td>
<td>ok</td>
</tr>
<tr class="odd">
<td>3</td>
<td>4</td>
<td>4</td>
<td>1.0</td>
<td>resize to 8</td>
</tr>
<tr class="even">
<td>4</td>
<td>8</td>
<td>4</td>
<td>0.5</td>
<td>rehashed</td>
</tr>
</tbody>
</table>
<p>Every key gets new position because <code>hash(key) % new_capacity</code> changes.</p>
</section>
<section id="incremental-rehashing" class="level4">
<h4 class="anchored" data-anchor-id="incremental-rehashing">Incremental Rehashing</h4>
<p>Instead of rehashing all keys at once (costly spike), incremental rehashing spreads work across operations:</p>
<ul>
<li>Maintain both old and new tables.</li>
<li>Rehash a few entries per insert/search until old table empty.</li>
</ul>
<p>This keeps amortized O(1) performance, even during resize.</p>
</section>
<section id="tiny-code-easy-versions-18" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-18">Tiny Code (Easy Versions)</h4>
<p>C (Simple Doubling Rehash)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define INIT_CAP </span><span class="dv">4</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>keys<span class="op">;</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> size<span class="op">;</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count<span class="op">;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> HashTable<span class="op">;</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hash<span class="op">(</span><span class="dt">int</span> key<span class="op">,</span> <span class="dt">int</span> size<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> key <span class="op">%</span> size<span class="op">;</span> <span class="op">}</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>HashTable<span class="op">*</span> ht_create<span class="op">(</span><span class="dt">int</span> size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>HashTable<span class="op">));</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>keys <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">*</span> size<span class="op">);</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> size<span class="op">;</span> i<span class="op">++)</span> ht<span class="op">-&gt;</span>keys<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>size <span class="op">=</span> size<span class="op">;</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ht<span class="op">;</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ht_resize<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> new_size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Resizing from </span><span class="sc">%d</span><span class="st"> to </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> ht<span class="op">-&gt;</span>size<span class="op">,</span> new_size<span class="op">);</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>old_keys <span class="op">=</span> ht<span class="op">-&gt;</span>keys<span class="op">;</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> old_size <span class="op">=</span> ht<span class="op">-&gt;</span>size<span class="op">;</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>keys <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">*</span> new_size<span class="op">);</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> new_size<span class="op">;</span> i<span class="op">++)</span> ht<span class="op">-&gt;</span>keys<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>size <span class="op">=</span> new_size<span class="op">;</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> old_size<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>old_keys<span class="op">[</span>i<span class="op">]</span> <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> key <span class="op">=</span> old_keys<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">,</span> new_size<span class="op">);</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(</span>ht<span class="op">-&gt;</span>keys<span class="op">[</span>idx<span class="op">]</span> <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> idx <span class="op">=</span> <span class="op">(</span>idx <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> new_size<span class="op">;</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>keys<span class="op">[</span>idx<span class="op">]</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>            ht<span class="op">-&gt;</span>count<span class="op">++;</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>old_keys<span class="op">);</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ht_insert<span class="op">(</span>HashTable <span class="op">*</span>ht<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> load <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>ht<span class="op">-&gt;</span>count <span class="op">/</span> ht<span class="op">-&gt;</span>size<span class="op">;</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>load <span class="op">&gt;</span> <span class="fl">0.75</span><span class="op">)</span> ht_resize<span class="op">(</span>ht<span class="op">,</span> ht<span class="op">-&gt;</span>size <span class="op">*</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> idx <span class="op">=</span> hash<span class="op">(</span>key<span class="op">,</span> ht<span class="op">-&gt;</span>size<span class="op">);</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>ht<span class="op">-&gt;</span>keys<span class="op">[</span>idx<span class="op">]</span> <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> idx <span class="op">=</span> <span class="op">(</span>idx <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> ht<span class="op">-&gt;</span>size<span class="op">;</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>keys<span class="op">[</span>idx<span class="op">]</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>    ht<span class="op">-&gt;</span>count<span class="op">++;</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>ht <span class="op">=</span> ht_create<span class="op">(</span>INIT_CAP<span class="op">);</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> ht_insert<span class="op">(</span>ht<span class="op">,</span> i <span class="op">*</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> ht<span class="op">-&gt;</span>size<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> ht<span class="op">-&gt;</span>keys<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DynamicHash:</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, cap<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cap <span class="op">=</span> cap</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> cap</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, key):</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(key) <span class="op">%</span> <span class="va">self</span>.cap</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _rehash(<span class="va">self</span>, new_cap):</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>        old_table <span class="op">=</span> <span class="va">self</span>.table</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> new_cap</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cap <span class="op">=</span> new_cap</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> key <span class="kw">in</span> old_table:</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> key <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.insert(key)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key):</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.size <span class="op">/</span> <span class="va">self</span>.cap <span class="op">&gt;</span> <span class="fl">0.75</span>:</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._rehash(<span class="va">self</span>.cap <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">self</span>.table[idx] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">=</span> (idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="va">self</span>.cap</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table[idx] <span class="op">=</span> key</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>ht <span class="op">=</span> DynamicHash()</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">31</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">42</span>, <span class="dv">56</span>, <span class="dv">77</span>]:</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    ht.insert(k)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ht.table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-19" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-19">Why It Matters</h4>
<ul>
<li>Keeps load factor stable for O(1) operations</li>
<li>Prevents clustering in open addressing</li>
<li>Supports unbounded growth</li>
<li>Foundation for dynamic dictionaries, maps, caches</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-19" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-19">A Gentle Proof (Why It Works)</h4>
<p>If each rehash doubles capacity, total cost of N inserts = O(N). Each element is moved O(1) times (once per doubling), so amortized cost per insert is O(1).</p>
<p>Incremental rehashing further ensures no single operation is expensive, work spread evenly.</p>
</section>
<section id="try-it-yourself-19" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-19">Try It Yourself</h4>
<ol type="1">
<li>Add printouts to observe load factor at each insert.</li>
<li>Implement shrink when load &lt; 0.25.</li>
<li>Implement incremental rehash with two tables.</li>
<li>Compare doubling vs prime-capacity growth.</li>
</ol>
</section>
<section id="test-cases-19" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-19">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Capacity</th>
<th>Items</th>
<th>Load Factor</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>4</td>
<td>2</td>
<td>0.5</td>
<td>none</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>3</td>
<td>0.75</td>
<td>ok</td>
</tr>
<tr class="odd">
<td>3</td>
<td>4</td>
<td>4</td>
<td>1.0</td>
<td>resize</td>
</tr>
<tr class="even">
<td>4</td>
<td>8</td>
<td>4</td>
<td>0.5</td>
<td>rehashed</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Rehash must handle deleted slots correctly</li>
<li>Avoid resizing too frequently (hysteresis)</li>
<li>Keep hash function consistent across resizes</li>
</ul>
</section>
<section id="complexity-19" class="level4">
<h4 class="anchored" data-anchor-id="complexity-19">Complexity</h4>
<ul>
<li>Average Insert/Search/Delete: O(1)</li>
<li>Amortized Insert: O(1)</li>
<li>Worst-case Resize: O(n)</li>
</ul>
<p>Dynamic rehashing is the table’s heartbeat, it expands when full, contracts when idle, always keeping operations smooth and steady.</p>
</section>
</section>
</section>
<section id="section-23.-heaps" class="level2">
<h2 class="anchored" data-anchor-id="section-23.-heaps">Section 23. Heaps</h2>
<section id="binary-heap-insert" class="level3">
<h3 class="anchored" data-anchor-id="binary-heap-insert">221 Binary Heap Insert</h3>
<p>A binary heap is a complete binary tree stored in an array that maintains the heap property, each parent is smaller (min-heap) or larger (max-heap) than its children. The insert operation keeps the heap ordered by <em>bubbling up</em> the new element until it finds the right place.</p>
<section id="what-problem-are-we-solving-20" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-20">What Problem Are We Solving?</h4>
<p>We need a data structure that efficiently gives access to the minimum (or maximum) element, while supporting fast insertions.</p>
<p>A binary heap offers:</p>
<ul>
<li><code>O(1)</code> access to min/max</li>
<li><code>O(log n)</code> insertion and deletion</li>
<li><code>O(n)</code> build time for initial heap</li>
</ul>
<p>Goal: Insert a new element while maintaining the heap property and completeness.</p>
</section>
<section id="how-does-it-work-plain-language-20" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-20">How Does It Work (Plain Language)?</h4>
<p>A heap is stored as an array representing a complete binary tree. Each node at index <code>i</code> has:</p>
<ul>
<li>Parent: <code>(i - 1) / 2</code></li>
<li>Left child: <code>2i + 1</code></li>
<li>Right child: <code>2i + 2</code></li>
</ul>
<p>Insertion Steps (Min-Heap)</p>
<ol type="1">
<li>Append the new element at the end (bottom level, rightmost).</li>
<li>Compare it with its parent.</li>
<li>If smaller (min-heap) or larger (max-heap), swap.</li>
<li>Repeat until the heap property is restored.</li>
</ol>
<p>Example (Min-Heap)</p>
<p>Insert sequence: [10, 24, 5, 31]</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Array</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Start</td>
<td>[ ]</td>
<td>empty</td>
</tr>
<tr class="even">
<td>Insert 10</td>
<td>[10]</td>
<td>root only</td>
</tr>
<tr class="odd">
<td>Insert 24</td>
<td>[10, 24]</td>
<td>24 &gt; 10, no swap</td>
</tr>
<tr class="even">
<td>Insert 5</td>
<td>[10, 24, 5]</td>
<td>5 &lt; 10 → swap → [5, 24, 10]</td>
</tr>
<tr class="odd">
<td>Insert 31</td>
<td>[5, 24, 10, 31]</td>
<td>31 &gt; 24, no swap</td>
</tr>
</tbody>
</table>
<p>Final heap: [5, 24, 10, 31]</p>
<p>Tree view:</p>
<pre><code>        5
      /   \
    24     10
   /
 31</code></pre>
</section>
<section id="tiny-code-easy-versions-19" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-19">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX </span><span class="dv">100</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> arr<span class="op">[</span>MAX<span class="op">];</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> size<span class="op">;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> MinHeap<span class="op">;</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> swap<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tmp <span class="op">=</span> <span class="op">*</span>a<span class="op">;</span> <span class="op">*</span>a <span class="op">=</span> <span class="op">*</span>b<span class="op">;</span> <span class="op">*</span>b <span class="op">=</span> tmp<span class="op">;</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> heap_insert<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">,</span> <span class="dt">int</span> val<span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i <span class="op">=</span> h<span class="op">-&gt;</span>size<span class="op">++;</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// bubble up</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> parent <span class="op">=</span> <span class="op">(</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">]</span> <span class="op">&gt;=</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>parent<span class="op">])</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>        swap<span class="op">(&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>parent<span class="op">]);</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> parent<span class="op">;</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> heap_print<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> h<span class="op">-&gt;</span>size<span class="op">;</span> i<span class="op">++)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>    MinHeap h <span class="op">=</span> <span class="op">{.</span>size <span class="op">=</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> vals<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">31</span><span class="op">};</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span> heap_insert<span class="op">(&amp;</span>h<span class="op">,</span> vals<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>    heap_print<span class="op">(&amp;</span>h<span class="op">);</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MinHeap:</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.arr <span class="op">=</span> []</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parent(<span class="va">self</span>, i): <span class="cf">return</span> (i <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, val):</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.arr.append(val)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.arr) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> <span class="va">self</span>._parent(i)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.arr[i] <span class="op">&gt;=</span> <span class="va">self</span>.arr[p]:</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[i], <span class="va">self</span>.arr[p] <span class="op">=</span> <span class="va">self</span>.arr[p], <span class="va">self</span>.arr[i]</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> p</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>):</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(<span class="va">self</span>.arr)</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> MinHeap()</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">5</span>, <span class="dv">31</span>]:</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    h.insert(x)</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(h)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-20" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-20">Why It Matters</h4>
<ul>
<li>Fundamental for priority queues</li>
<li>Core of Dijkstra’s shortest path, Prim’s MST, and schedulers</li>
<li>Supports efficient <code>insert</code>, <code>extract-min/max</code>, and <code>peek</code></li>
<li>Used in heapsort and event-driven simulations</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-20" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-20">A Gentle Proof (Why It Works)</h4>
<p>Each insertion bubbles up at most height of heap = <span class="math inline">\(\log_2 n\)</span>. Since heap always remains complete, the structure is balanced, ensuring logarithmic operations.</p>
<p>Heap property is preserved because every swap ensures parent ≤ child (min-heap).</p>
</section>
<section id="try-it-yourself-20" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-20">Try It Yourself</h4>
<ol type="1">
<li>Insert elements in descending order → observe bubbling.</li>
<li>Switch comparisons for max-heap.</li>
<li>Print tree level by level after each insert.</li>
<li>Implement <code>extract_min()</code> to remove root and restore heap.</li>
</ol>
</section>
<section id="test-cases-20" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-20">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Output</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>[10, 24, 5, 31]</td>
<td>[5, 24, 10, 31]</td>
<td>min-heap property</td>
</tr>
<tr class="even">
<td>Insert</td>
<td>[3, 2, 1]</td>
<td>[1, 3, 2]</td>
<td>swap chain</td>
</tr>
<tr class="odd">
<td>Insert</td>
<td>[10]</td>
<td>[10]</td>
<td>single element</td>
</tr>
<tr class="even">
<td>Insert</td>
<td>[]</td>
<td>[x]</td>
<td>empty start</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Full array (static heap) → resize needed</li>
<li>Negative values → handled same</li>
<li>Duplicate keys → order preserved</li>
</ul>
</section>
<section id="complexity-20" class="level4">
<h4 class="anchored" data-anchor-id="complexity-20">Complexity</h4>
<ul>
<li>Insert: O(log n)</li>
<li>Search: O(n) (unsorted beyond heap property)</li>
<li>Space: O(n)</li>
</ul>
<p>Binary heap insertion is the heartbeat of priority queues, each element climbs to its rightful place, one gentle swap at a time.</p>
</section>
</section>
<section id="binary-heap-delete" class="level3">
<h3 class="anchored" data-anchor-id="binary-heap-delete">222 Binary Heap Delete</h3>
<p>Deleting from a binary heap means removing the root element (the minimum in a min-heap or maximum in a max-heap) while keeping both the heap property and complete tree structure intact. To do this, we swap the root with the last element, remove the last, and bubble down the new root until the heap is valid again.</p>
<section id="what-problem-are-we-solving-21" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-21">What Problem Are We Solving?</h4>
<p>We want to remove the highest-priority element quickly (min or max) from a heap, without breaking the structure.</p>
<p>In a min-heap, the smallest value always lives at index 0. In a max-heap, the largest value lives at index 0.</p>
<p>Goal: Efficiently remove the root and restore order in O(log n) time.</p>
</section>
<section id="how-does-it-work-plain-language-21" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-21">How Does It Work (Plain Language)?</h4>
<ol type="1">
<li><p>Swap root (index 0) with last element.</p></li>
<li><p>Remove last element (now root value is gone).</p></li>
<li><p>Heapify down (bubble down) from the root:</p>
<ul>
<li>Compare with children.</li>
<li>Swap with smaller (min-heap) or larger (max-heap) child.</li>
<li>Repeat until heap property restored.</li>
</ul></li>
</ol>
<p>Example (Min-Heap)</p>
<p>Start: <code>[5, 24, 10, 31]</code> Remove min (5):</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 61%">
<col style="width: 18%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Action</th>
<th>Array</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Swap root (5) with last (31)</td>
<td>[31, 24, 10, 5]</td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td>Remove last</td>
<td>[31, 24, 10]</td>
<td></td>
</tr>
<tr class="odd">
<td>3</td>
<td>Compare 31 with children (24, 10) → smallest = 10</td>
<td>swap</td>
<td>[10, 24, 31]</td>
</tr>
<tr class="even">
<td>4</td>
<td>Stop (31 &gt; no child)</td>
<td>[10, 24, 31]</td>
<td></td>
</tr>
</tbody>
</table>
<p>Result: <code>[10, 24, 31]</code>, still a valid min-heap.</p>
</section>
<section id="tiny-code-easy-versions-20" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-20">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX </span><span class="dv">100</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> arr<span class="op">[</span>MAX<span class="op">];</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> size<span class="op">;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> MinHeap<span class="op">;</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> swap<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tmp <span class="op">=</span> <span class="op">*</span>a<span class="op">;</span> <span class="op">*</span>a <span class="op">=</span> <span class="op">*</span>b<span class="op">;</span> <span class="op">*</span>b <span class="op">=</span> tmp<span class="op">;</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> heapify_down<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">,</span> <span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> smallest <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> left <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> right <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>i <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>left <span class="op">&lt;</span> h<span class="op">-&gt;</span>size <span class="op">&amp;&amp;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>left<span class="op">]</span> <span class="op">&lt;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>smallest<span class="op">])</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>        smallest <span class="op">=</span> left<span class="op">;</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>right <span class="op">&lt;</span> h<span class="op">-&gt;</span>size <span class="op">&amp;&amp;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>right<span class="op">]</span> <span class="op">&lt;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>smallest<span class="op">])</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>        smallest <span class="op">=</span> right<span class="op">;</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>smallest <span class="op">!=</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>        swap<span class="op">(&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>smallest<span class="op">]);</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>        heapify_down<span class="op">(</span>h<span class="op">,</span> smallest<span class="op">);</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> heap_delete_min<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>h<span class="op">-&gt;</span>size <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> root <span class="op">=</span> h<span class="op">-&gt;</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>    h<span class="op">-&gt;</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>h<span class="op">-&gt;</span>size <span class="op">-</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>    h<span class="op">-&gt;</span>size<span class="op">--;</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>    heapify_down<span class="op">(</span>h<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>    MinHeap h <span class="op">=</span> <span class="op">{.</span>arr <span class="op">=</span> <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">31</span><span class="op">},</span> <span class="op">.</span>size <span class="op">=</span> <span class="dv">4</span><span class="op">};</span></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val <span class="op">=</span> heap_delete_min<span class="op">(&amp;</span>h<span class="op">);</span></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Deleted: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> h<span class="op">.</span>size<span class="op">;</span> i<span class="op">++)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> h<span class="op">.</span>arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MinHeap:</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.arr <span class="op">=</span> []</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parent(<span class="va">self</span>, i): <span class="cf">return</span> (i <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _left(<span class="va">self</span>, i): <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _right(<span class="va">self</span>, i): <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, val):</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.arr.append(val)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.arr) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.arr[i] <span class="op">&lt;</span> <span class="va">self</span>.arr[<span class="va">self</span>._parent(i)]:</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> <span class="va">self</span>._parent(i)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[i], <span class="va">self</span>.arr[p] <span class="op">=</span> <span class="va">self</span>.arr[p], <span class="va">self</span>.arr[i]</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> p</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _heapify_down(<span class="va">self</span>, i):</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>        smallest <span class="op">=</span> i</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>        left, right <span class="op">=</span> <span class="va">self</span>._left(i), <span class="va">self</span>._right(i)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.arr)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> left <span class="op">&lt;</span> n <span class="kw">and</span> <span class="va">self</span>.arr[left] <span class="op">&lt;</span> <span class="va">self</span>.arr[smallest]:</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>            smallest <span class="op">=</span> left</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> right <span class="op">&lt;</span> n <span class="kw">and</span> <span class="va">self</span>.arr[right] <span class="op">&lt;</span> <span class="va">self</span>.arr[smallest]:</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>            smallest <span class="op">=</span> right</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> smallest <span class="op">!=</span> i:</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[i], <span class="va">self</span>.arr[smallest] <span class="op">=</span> <span class="va">self</span>.arr[smallest], <span class="va">self</span>.arr[i]</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._heapify_down(smallest)</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete_min(<span class="va">self</span>):</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.arr:</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> <span class="va">self</span>.arr[<span class="dv">0</span>]</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>        last <span class="op">=</span> <span class="va">self</span>.arr.pop()</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.arr:</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[<span class="dv">0</span>] <span class="op">=</span> last</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._heapify_down(<span class="dv">0</span>)</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> root</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> MinHeap()</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="dv">5</span>, <span class="dv">24</span>, <span class="dv">10</span>, <span class="dv">31</span>]:</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>    h.insert(x)</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Before:"</span>, h.arr)</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Deleted:"</span>, h.delete_min())</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"After:"</span>, h.arr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-21" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-21">Why It Matters</h4>
<ul>
<li>Key operation in priority queues</li>
<li>Core of Dijkstra’s and Prim’s algorithms</li>
<li>Basis of heap sort (repeated delete-min)</li>
<li>Ensures efficient extraction of extreme element</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-21" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-21">A Gentle Proof (Why It Works)</h4>
<p>Each delete operation:</p>
<ul>
<li>Constant-time root removal</li>
<li>Logarithmic heapify-down (height of tree = log n) → Total cost: O(log n)</li>
</ul>
<p>The heap property holds because every swap moves a larger (min-heap) or smaller (max-heap) element down to children, ensuring local order at each step.</p>
</section>
<section id="try-it-yourself-21" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-21">Try It Yourself</h4>
<ol type="1">
<li>Delete repeatedly to sort the array (heap sort).</li>
<li>Try max-heap delete (reverse comparisons).</li>
<li>Visualize swaps after each deletion.</li>
<li>Test on ascending/descending input sequences.</li>
</ol>
</section>
<section id="test-cases-21" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-21">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Input</th>
<th>Operation</th>
<th>Output</th>
<th>Heap After</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[5,24,10,31]</td>
<td>delete</td>
<td>5</td>
<td>[10,24,31]</td>
<td>valid</td>
</tr>
<tr class="even">
<td>[1,3,2]</td>
<td>delete</td>
<td>1</td>
<td>[2,3]</td>
<td>OK</td>
</tr>
<tr class="odd">
<td>[10]</td>
<td>delete</td>
<td>10</td>
<td>[]</td>
<td>empty heap</td>
</tr>
<tr class="even">
<td>[]</td>
<td>delete</td>
<td>None</td>
<td>[]</td>
<td>safe</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Empty heap → return sentinel</li>
<li>Single element → clears heap</li>
<li>Duplicates handled naturally</li>
</ul>
</section>
<section id="complexity-21" class="level4">
<h4 class="anchored" data-anchor-id="complexity-21">Complexity</h4>
<ul>
<li>Delete root: O(log n)</li>
<li>Space: O(n)</li>
</ul>
<p>Deleting from a heap is like removing the top card from a neat stack, replace it, sift it down, and balance restored.</p>
</section>
</section>
<section id="build-heap-heapify" class="level3">
<h3 class="anchored" data-anchor-id="build-heap-heapify">223 Build Heap (Heapify)</h3>
<p>Heapify (Build Heap) is the process of constructing a valid binary heap from an unsorted array in O(n) time. Instead of inserting elements one by one, we reorganize the array <em>in place</em> so every parent satisfies the heap property.</p>
<section id="what-problem-are-we-solving-22" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-22">What Problem Are We Solving?</h4>
<p>If we insert each element individually into an empty heap, total time is O(n log n). But we can do better. By heapifying from the bottom up, we can build the entire heap in O(n), crucial for heapsort and initializing priority queues efficiently.</p>
<p>Goal: Turn any array into a valid min-heap or max-heap quickly.</p>
</section>
<section id="how-does-it-work-plain-language-22" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-22">How Does It Work (Plain Language)?</h4>
<p>A heap stored in an array represents a complete binary tree:</p>
<ul>
<li>For node <code>i</code>, children are <code>2i + 1</code> and <code>2i + 2</code></li>
</ul>
<p>To build the heap:</p>
<ol type="1">
<li>Start from the last non-leaf node = <code>(n / 2) - 1</code>.</li>
<li>Apply heapify-down (sift down) to ensure the subtree rooted at <code>i</code> satisfies heap property.</li>
<li>Move upwards to the root, repeating the process.</li>
</ol>
<p>Each subtree becomes a valid heap, and when done, the whole array is a heap.</p>
<p>Example (Min-Heap)</p>
<p>Start: <code>[31, 10, 24, 5, 12, 7]</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>i</th>
<th>Subtree</th>
<th>Action</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Start</td>
<td>-</td>
<td>full array</td>
<td>-</td>
<td>[31, 10, 24, 5, 12, 7]</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>(24, 7)</td>
<td>24 &gt; 7 → swap</td>
<td>[31, 10, 7, 5, 12, 24]</td>
</tr>
<tr class="odd">
<td>2</td>
<td>1</td>
<td>(10, 5, 12)</td>
<td>10 &gt; 5 → swap</td>
<td>[31, 5, 7, 10, 12, 24]</td>
</tr>
<tr class="even">
<td>3</td>
<td>0</td>
<td>(31, 5, 7)</td>
<td>31 &gt; 5 → swap</td>
<td>[5, 31, 7, 10, 12, 24]</td>
</tr>
<tr class="odd">
<td>4</td>
<td>1</td>
<td>(31, 10, 12)</td>
<td>31 &gt; 10 → swap</td>
<td>[5, 10, 7, 31, 12, 24]</td>
</tr>
</tbody>
</table>
<p>Final heap: [5, 10, 7, 31, 12, 24]</p>
</section>
<section id="tiny-code-easy-versions-21" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-21">Tiny Code (Easy Versions)</h4>
<p>C (Bottom-Up Build Heap)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX </span><span class="dv">100</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> arr<span class="op">[</span>MAX<span class="op">];</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> size<span class="op">;</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> MinHeap<span class="op">;</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> swap<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tmp <span class="op">=</span> <span class="op">*</span>a<span class="op">;</span> <span class="op">*</span>a <span class="op">=</span> <span class="op">*</span>b<span class="op">;</span> <span class="op">*</span>b <span class="op">=</span> tmp<span class="op">;</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> heapify_down<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">,</span> <span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> smallest <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> left <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> right <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>left <span class="op">&lt;</span> h<span class="op">-&gt;</span>size <span class="op">&amp;&amp;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>left<span class="op">]</span> <span class="op">&lt;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>smallest<span class="op">])</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>        smallest <span class="op">=</span> left<span class="op">;</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>right <span class="op">&lt;</span> h<span class="op">-&gt;</span>size <span class="op">&amp;&amp;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>right<span class="op">]</span> <span class="op">&lt;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>smallest<span class="op">])</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>        smallest <span class="op">=</span> right<span class="op">;</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>smallest <span class="op">!=</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>        swap<span class="op">(&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>smallest<span class="op">]);</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>        heapify_down<span class="op">(</span>h<span class="op">,</span> smallest<span class="op">);</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> build_heap<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> h<span class="op">-&gt;</span>size <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>        heapify_down<span class="op">(</span>h<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>    MinHeap h <span class="op">=</span> <span class="op">{.</span>arr <span class="op">=</span> <span class="op">{</span><span class="dv">31</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">7</span><span class="op">},</span> <span class="op">.</span>size <span class="op">=</span> <span class="dv">6</span><span class="op">};</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>    build_heap<span class="op">(&amp;</span>h<span class="op">);</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> h<span class="op">.</span>size<span class="op">;</span> i<span class="op">++)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> h<span class="op">.</span>arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MinHeap:</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, arr):</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.arr <span class="op">=</span> arr</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> <span class="bu">len</span>(arr)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.build_heap()</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _left(<span class="va">self</span>, i): <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _right(<span class="va">self</span>, i): <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _heapify_down(<span class="va">self</span>, i):</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        smallest <span class="op">=</span> i</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        l, r <span class="op">=</span> <span class="va">self</span>._left(i), <span class="va">self</span>._right(i)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> l <span class="op">&lt;</span> <span class="va">self</span>.size <span class="kw">and</span> <span class="va">self</span>.arr[l] <span class="op">&lt;</span> <span class="va">self</span>.arr[smallest]:</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>            smallest <span class="op">=</span> l</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r <span class="op">&lt;</span> <span class="va">self</span>.size <span class="kw">and</span> <span class="va">self</span>.arr[r] <span class="op">&lt;</span> <span class="va">self</span>.arr[smallest]:</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>            smallest <span class="op">=</span> r</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> smallest <span class="op">!=</span> i:</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[i], <span class="va">self</span>.arr[smallest] <span class="op">=</span> <span class="va">self</span>.arr[smallest], <span class="va">self</span>.arr[i]</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._heapify_down(smallest)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_heap(<span class="va">self</span>):</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.size <span class="op">//</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._heapify_down(i)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> [<span class="dv">31</span>, <span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">5</span>, <span class="dv">12</span>, <span class="dv">7</span>]</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> MinHeap(arr)</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(h.arr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-22" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-22">Why It Matters</h4>
<ul>
<li>Builds a valid heap in O(n) (not O(n log n))</li>
<li>Used in heapsort initialization</li>
<li>Efficient for constructing priority queues from bulk data</li>
<li>Guarantees balanced tree structure automatically</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-22" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-22">A Gentle Proof (Why It Works)</h4>
<p>Each node at depth <code>d</code> takes O(height) = O(log(n/d)) work. There are more nodes at lower depths (less work each), fewer at top (more work each). Sum across levels yields O(n) total time, not O(n log n).</p>
<p>Hence, bottom-up heapify is asymptotically optimal.</p>
</section>
<section id="try-it-yourself-22" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-22">Try It Yourself</h4>
<ol type="1">
<li>Run with different array sizes, random orders.</li>
<li>Compare time vs inserting one-by-one.</li>
<li>Flip comparisons for max-heap.</li>
<li>Visualize swaps as a tree.</li>
</ol>
</section>
<section id="test-cases-22" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-22">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Input</th>
<th>Output</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[31,10,24,5,12,7]</td>
<td>[5,10,7,31,12,24]</td>
<td>valid min-heap</td>
</tr>
<tr class="even">
<td>[3,2,1]</td>
<td>[1,2,3]</td>
<td>heapified</td>
</tr>
<tr class="odd">
<td>[10]</td>
<td>[10]</td>
<td>single</td>
</tr>
<tr class="even">
<td>[]</td>
<td>[]</td>
<td>empty safe</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Already heap → no change</li>
<li>Reverse-sorted input → many swaps</li>
<li>Duplicates handled correctly</li>
</ul>
</section>
<section id="complexity-22" class="level4">
<h4 class="anchored" data-anchor-id="complexity-22">Complexity</h4>
<ul>
<li>Time: O(n)</li>
<li>Space: O(1) (in-place)</li>
</ul>
<p>Heapify is the quiet craftsman, shaping chaos into order with gentle swaps from the ground up.</p>
</section>
</section>
<section id="heap-sort" class="level3">
<h3 class="anchored" data-anchor-id="heap-sort">224 Heap Sort</h3>
<p>Heap Sort is a classic comparison-based sorting algorithm that uses a binary heap to organize data and extract elements in sorted order. By building a max-heap (or min-heap) and repeatedly removing the root, we achieve a fully sorted array in O(n log n) time, with no extra space.</p>
<section id="what-problem-are-we-solving-23" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-23">What Problem Are We Solving?</h4>
<p>We want a fast, in-place sorting algorithm that:</p>
<ul>
<li>Doesn’t require recursion (like mergesort)</li>
<li>Has predictable O(n log n) behavior</li>
<li>Avoids worst-case quadratic time (like quicksort)</li>
</ul>
<p>Goal: Use the heap’s structure to repeatedly select the next largest (or smallest) element efficiently.</p>
</section>
<section id="how-does-it-work-plain-language-23" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-23">How Does It Work (Plain Language)?</h4>
<ol type="1">
<li><p>Build a max-heap from the unsorted array.</p></li>
<li><p>Repeat until heap is empty:</p>
<ul>
<li>Swap root (max element) with last element.</li>
<li>Reduce heap size by one.</li>
<li>Heapify-down the new root to restore heap property.</li>
</ul></li>
</ol>
<p>The array becomes sorted in ascending order (for max-heap).</p>
<p>Example (Ascending Sort)</p>
<p>Start: <code>[5, 31, 10, 24, 7]</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Action</th>
<th>Array</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Build max-heap</td>
<td>[31, 24, 10, 5, 7]</td>
</tr>
<tr class="even">
<td>2</td>
<td>Swap 31 ↔︎ 7, heapify</td>
<td>[24, 7, 10, 5, 31]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Swap 24 ↔︎ 5, heapify</td>
<td>[10, 7, 5, 24, 31]</td>
</tr>
<tr class="even">
<td>4</td>
<td>Swap 10 ↔︎ 5, heapify</td>
<td>[5, 7, 10, 24, 31]</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Sorted</td>
<td>[5, 7, 10, 24, 31]</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-22" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-22">Tiny Code (Easy Versions)</h4>
<p>C (In-place Heap Sort)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> swap<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tmp <span class="op">=</span> <span class="op">*</span>a<span class="op">;</span> <span class="op">*</span>a <span class="op">=</span> <span class="op">*</span>b<span class="op">;</span> <span class="op">*</span>b <span class="op">=</span> tmp<span class="op">;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> heapify<span class="op">(</span><span class="dt">int</span> arr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> largest <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> left <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> right <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>i <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>left <span class="op">&lt;</span> n <span class="op">&amp;&amp;</span> arr<span class="op">[</span>left<span class="op">]</span> <span class="op">&gt;</span> arr<span class="op">[</span>largest<span class="op">])</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>        largest <span class="op">=</span> left<span class="op">;</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>right <span class="op">&lt;</span> n <span class="op">&amp;&amp;</span> arr<span class="op">[</span>right<span class="op">]</span> <span class="op">&gt;</span> arr<span class="op">[</span>largest<span class="op">])</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>        largest <span class="op">=</span> right<span class="op">;</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>largest <span class="op">!=</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>        swap<span class="op">(&amp;</span>arr<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>arr<span class="op">[</span>largest<span class="op">]);</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>        heapify<span class="op">(</span>arr<span class="op">,</span> n<span class="op">,</span> largest<span class="op">);</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> heap_sort<span class="op">(</span><span class="dt">int</span> arr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// build max-heap</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> n <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>        heapify<span class="op">(</span>arr<span class="op">,</span> n<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// extract elements</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> n <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span> <span class="op">{</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>        swap<span class="op">(&amp;</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">],</span> <span class="op">&amp;</span>arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>        heapify<span class="op">(</span>arr<span class="op">,</span> i<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> arr<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="dv">31</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> <span class="dv">7</span><span class="op">};</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span>arr<span class="op">)/</span><span class="kw">sizeof</span><span class="op">(</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>    heap_sort<span class="op">(</span>arr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heapify(arr, n, i):</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    largest <span class="op">=</span> i</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    l, r <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>i <span class="op">+</span> <span class="dv">1</span>, <span class="dv">2</span><span class="op">*</span>i <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="op">&lt;</span> n <span class="kw">and</span> arr[l] <span class="op">&gt;</span> arr[largest]:</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>        largest <span class="op">=</span> l</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> r <span class="op">&lt;</span> n <span class="kw">and</span> arr[r] <span class="op">&gt;</span> arr[largest]:</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        largest <span class="op">=</span> r</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> largest <span class="op">!=</span> i:</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        arr[i], arr[largest] <span class="op">=</span> arr[largest], arr[i]</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        heapify(arr, n, largest)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heap_sort(arr):</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(arr)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># build max-heap</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n<span class="op">//</span><span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        heapify(arr, n, i)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n <span class="op">-</span> <span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>        arr[<span class="dv">0</span>], arr[i] <span class="op">=</span> arr[i], arr[<span class="dv">0</span>]</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>        heapify(arr, i, <span class="dv">0</span>)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> [<span class="dv">5</span>, <span class="dv">31</span>, <span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">7</span>]</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>heap_sort(arr)</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(arr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-23" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-23">Why It Matters</h4>
<ul>
<li>Guaranteed O(n log n) runtime (worst-case safe)</li>
<li>In-place, no extra arrays</li>
<li>Great teaching example of heap structure in action</li>
<li>Used in systems with strict space limits</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-23" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-23">A Gentle Proof (Why It Works)</h4>
<ol type="1">
<li>Building the heap = O(n) (bottom-up heapify).</li>
<li>Each extraction = O(log n), repeated n times → O(n log n).</li>
<li>Heap property ensures root always holds largest element.</li>
</ol>
<p>So final array is sorted after repeated root extractions.</p>
</section>
<section id="try-it-yourself-23" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-23">Try It Yourself</h4>
<ol type="1">
<li>Switch comparisons for min-heap sort (descending).</li>
<li>Print array after each swap to see process.</li>
<li>Compare with quicksort and mergesort.</li>
<li>Test large random arrays.</li>
</ol>
</section>
<section id="test-cases-23" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-23">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Input</th>
<th>Output</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[5,31,10,24,7]</td>
<td>[5,7,10,24,31]</td>
<td>ascending</td>
</tr>
<tr class="even">
<td>[10,9,8,7]</td>
<td>[7,8,9,10]</td>
<td>reverse input</td>
</tr>
<tr class="odd">
<td>[3]</td>
<td>[3]</td>
<td>single</td>
</tr>
<tr class="even">
<td>[]</td>
<td>[]</td>
<td>empty</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Repeated values handled fine</li>
<li>Already sorted input still O(n log n)</li>
<li>Stable? ❌ (order not preserved)</li>
</ul>
</section>
<section id="complexity-23" class="level4">
<h4 class="anchored" data-anchor-id="complexity-23">Complexity</h4>
<ul>
<li>Time: O(n log n)</li>
<li>Space: O(1)</li>
<li>Stable: No</li>
</ul>
<p>Heap sort is the mountain climber’s algorithm, pulling the biggest to the top, one step at a time, until order reigns from summit to base.</p>
</section>
</section>
<section id="min-heap-implementation" class="level3">
<h3 class="anchored" data-anchor-id="min-heap-implementation">225 Min Heap Implementation</h3>
<p>A min-heap is a binary tree where each parent is smaller than or equal to its children. Stored compactly in an array, it guarantees O(1) access to the smallest element and O(log n) insertion and deletion, perfect for priority queues and scheduling systems.</p>
<section id="what-problem-are-we-solving-24" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-24">What Problem Are We Solving?</h4>
<p>We need a data structure that:</p>
<ul>
<li>Quickly gives us the minimum element</li>
<li>Supports efficient insertions and deletions</li>
<li>Maintains order dynamically</li>
</ul>
<p>A min-heap achieves this balance, always keeping the smallest element at the root while remaining compact and complete.</p>
</section>
<section id="how-does-it-work-plain-language-24" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-24">How Does It Work (Plain Language)?</h4>
<p>A binary min-heap is stored as an array, where:</p>
<ul>
<li><code>parent(i) = (i - 1) / 2</code></li>
<li><code>left(i) = 2i + 1</code></li>
<li><code>right(i) = 2i + 2</code></li>
</ul>
<p>Operations:</p>
<ol type="1">
<li><p>Insert(x):</p>
<ul>
<li>Add <code>x</code> at the end.</li>
<li>“Bubble up” while <code>x &lt; parent(x)</code>.</li>
</ul></li>
<li><p>ExtractMin():</p>
<ul>
<li>Remove root.</li>
<li>Move last element to root.</li>
<li>“Bubble down” while parent &gt; smallest child.</li>
</ul></li>
<li><p>Peek():</p>
<ul>
<li>Return <code>arr[0]</code>.</li>
</ul></li>
</ol>
<p>Example</p>
<p>Start: <code>[ ]</code> Insert sequence: 10, 24, 5, 31, 7</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Action</th>
<th>Array</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>insert 10</td>
<td>[10]</td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td>insert 24</td>
<td>[10, 24]</td>
<td></td>
</tr>
<tr class="odd">
<td>3</td>
<td>insert 5</td>
<td>bubble up → swap with 10</td>
<td>[5, 24, 10]</td>
</tr>
<tr class="even">
<td>4</td>
<td>insert 31</td>
<td>[5, 24, 10, 31]</td>
<td></td>
</tr>
<tr class="odd">
<td>5</td>
<td>insert 7</td>
<td>[5, 7, 10, 31, 24]</td>
<td></td>
</tr>
</tbody>
</table>
<p>ExtractMin:</p>
<ul>
<li>Swap root with last (5 ↔︎ 24) → <code>[24, 7, 10, 31, 5]</code></li>
<li>Remove last → <code>[24, 7, 10, 31]</code></li>
<li>Bubble down → <code>[7, 24, 10, 31]</code></li>
</ul>
</section>
<section id="tiny-code-easy-versions-23" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-23">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb52"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX </span><span class="dv">100</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> arr<span class="op">[</span>MAX<span class="op">];</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> size<span class="op">;</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> MinHeap<span class="op">;</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> swap<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tmp <span class="op">=</span> <span class="op">*</span>a<span class="op">;</span> <span class="op">*</span>a <span class="op">=</span> <span class="op">*</span>b<span class="op">;</span> <span class="op">*</span>b <span class="op">=</span> tmp<span class="op">;</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> heapify_up<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">,</span> <span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> parent <span class="op">=</span> <span class="op">(</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">]</span> <span class="op">&gt;=</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>parent<span class="op">])</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>        swap<span class="op">(&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>parent<span class="op">]);</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> parent<span class="op">;</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> heapify_down<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">,</span> <span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> smallest <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> left <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> right <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>i <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>left <span class="op">&lt;</span> h<span class="op">-&gt;</span>size <span class="op">&amp;&amp;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>left<span class="op">]</span> <span class="op">&lt;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>smallest<span class="op">])</span> smallest <span class="op">=</span> left<span class="op">;</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>right <span class="op">&lt;</span> h<span class="op">-&gt;</span>size <span class="op">&amp;&amp;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>right<span class="op">]</span> <span class="op">&lt;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>smallest<span class="op">])</span> smallest <span class="op">=</span> right<span class="op">;</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>smallest <span class="op">!=</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>        swap<span class="op">(&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>smallest<span class="op">]);</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>        heapify_down<span class="op">(</span>h<span class="op">,</span> smallest<span class="op">);</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> insert<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">,</span> <span class="dt">int</span> val<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>    h<span class="op">-&gt;</span>arr<span class="op">[</span>h<span class="op">-&gt;</span>size<span class="op">]</span> <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>    heapify_up<span class="op">(</span>h<span class="op">,</span> h<span class="op">-&gt;</span>size<span class="op">);</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>    h<span class="op">-&gt;</span>size<span class="op">++;</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> extract_min<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>h<span class="op">-&gt;</span>size <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> root <span class="op">=</span> h<span class="op">-&gt;</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>    h<span class="op">-&gt;</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> h<span class="op">-&gt;</span>arr<span class="op">[--</span>h<span class="op">-&gt;</span>size<span class="op">];</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>    heapify_down<span class="op">(</span>h<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> peek<span class="op">(</span>MinHeap <span class="op">*</span>h<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> h<span class="op">-&gt;</span>size <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> h<span class="op">-&gt;</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>    MinHeap h <span class="op">=</span> <span class="op">{.</span>size <span class="op">=</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> vals<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">31</span><span class="op">,</span> <span class="dv">7</span><span class="op">};</span></span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> insert<span class="op">(&amp;</span>h<span class="op">,</span> vals<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Min: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> peek<span class="op">(&amp;</span>h<span class="op">));</span></span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Extracted: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> extract_min<span class="op">(&amp;</span>h<span class="op">));</span></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> h<span class="op">.</span>size<span class="op">;</span> i<span class="op">++)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> h<span class="op">.</span>arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MinHeap:</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.arr <span class="op">=</span> []</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parent(<span class="va">self</span>, i): <span class="cf">return</span> (i <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _left(<span class="va">self</span>, i): <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _right(<span class="va">self</span>, i): <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, val):</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.arr.append(val)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.arr) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.arr[i] <span class="op">&lt;</span> <span class="va">self</span>.arr[<span class="va">self</span>._parent(i)]:</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> <span class="va">self</span>._parent(i)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[i], <span class="va">self</span>.arr[p] <span class="op">=</span> <span class="va">self</span>.arr[p], <span class="va">self</span>.arr[i]</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> p</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_min(<span class="va">self</span>):</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.arr:</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> <span class="va">self</span>.arr[<span class="dv">0</span>]</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>        last <span class="op">=</span> <span class="va">self</span>.arr.pop()</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.arr:</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[<span class="dv">0</span>] <span class="op">=</span> last</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._heapify_down(<span class="dv">0</span>)</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> root</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _heapify_down(<span class="va">self</span>, i):</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>        smallest <span class="op">=</span> i</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>        l, r <span class="op">=</span> <span class="va">self</span>._left(i), <span class="va">self</span>._right(i)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> l <span class="op">&lt;</span> <span class="bu">len</span>(<span class="va">self</span>.arr) <span class="kw">and</span> <span class="va">self</span>.arr[l] <span class="op">&lt;</span> <span class="va">self</span>.arr[smallest]:</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>            smallest <span class="op">=</span> l</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r <span class="op">&lt;</span> <span class="bu">len</span>(<span class="va">self</span>.arr) <span class="kw">and</span> <span class="va">self</span>.arr[r] <span class="op">&lt;</span> <span class="va">self</span>.arr[smallest]:</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>            smallest <span class="op">=</span> r</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> smallest <span class="op">!=</span> i:</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[i], <span class="va">self</span>.arr[smallest] <span class="op">=</span> <span class="va">self</span>.arr[smallest], <span class="va">self</span>.arr[i]</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._heapify_down(smallest)</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> peek(<span class="va">self</span>):</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.arr[<span class="dv">0</span>] <span class="cf">if</span> <span class="va">self</span>.arr <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> MinHeap()</span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">5</span>, <span class="dv">31</span>, <span class="dv">7</span>]:</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>    h.insert(x)</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Heap:"</span>, h.arr)</span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Min:"</span>, h.peek())</span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Extracted:"</span>, h.extract_min())</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"After:"</span>, h.arr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-24" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-24">Why It Matters</h4>
<ul>
<li>Backbone of priority queues, Dijkstra’s, Prim’s, A*</li>
<li>Always gives minimum element in O(1)</li>
<li>Compact array-based structure (no pointers)</li>
<li>Excellent for dynamic, ordered sets</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-24" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-24">A Gentle Proof (Why It Works)</h4>
<p>Each insertion or deletion affects only a single path (height = log n). Since every swap improves local order, heap property restored in O(log n). At any time, parent ≤ children → global min at root.</p>
</section>
<section id="try-it-yourself-24" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-24">Try It Yourself</h4>
<ol type="1">
<li>Implement a max-heap variant.</li>
<li>Track the number of swaps per insert.</li>
<li>Combine with heap sort by repeated extract_min.</li>
<li>Visualize heap as a tree diagram.</li>
</ol>
</section>
<section id="test-cases-24" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-24">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Output</th>
<th>Heap After</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>[10,24,5,31,7]</td>
<td>-</td>
<td>[5,7,10,31,24]</td>
<td>valid</td>
</tr>
<tr class="even">
<td>Peek</td>
<td>-</td>
<td>5</td>
<td>[5,7,10,31,24]</td>
<td>smallest</td>
</tr>
<tr class="odd">
<td>ExtractMin</td>
<td>-</td>
<td>5</td>
<td>[7,24,10,31]</td>
<td>reordered</td>
</tr>
<tr class="even">
<td>Empty Extract</td>
<td>[]</td>
<td>None</td>
<td>[]</td>
<td>safe</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Duplicates → handled fine</li>
<li>Empty heap → return sentinel</li>
<li>Negative numbers → no problem</li>
</ul>
</section>
<section id="complexity-24" class="level4">
<h4 class="anchored" data-anchor-id="complexity-24">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>ExtractMin</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Peek</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>A min-heap is the quiet organizer, always keeping the smallest task at the top, ready when you are.</p>
</section>
</section>
<section id="max-heap-implementation" class="level3">
<h3 class="anchored" data-anchor-id="max-heap-implementation">226 Max Heap Implementation</h3>
<p>A max-heap is a binary tree where each parent is greater than or equal to its children. Stored compactly in an array, it guarantees O(1) access to the largest element and O(log n) insertion and deletion, making it ideal for scheduling, leaderboards, and priority-based systems.</p>
<section id="what-problem-are-we-solving-25" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-25">What Problem Are We Solving?</h4>
<p>We want a data structure that efficiently maintains a dynamic set of elements while allowing us to:</p>
<ul>
<li>Access the largest element quickly</li>
<li>Insert and delete efficiently</li>
<li>Maintain order automatically</li>
</ul>
<p>A max-heap does exactly that, it always bubbles the biggest element to the top.</p>
</section>
<section id="how-does-it-work-plain-language-25" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-25">How Does It Work (Plain Language)?</h4>
<p>A binary max-heap is stored as an array, with these relationships:</p>
<ul>
<li><code>parent(i) = (i - 1) / 2</code></li>
<li><code>left(i) = 2i + 1</code></li>
<li><code>right(i) = 2i + 2</code></li>
</ul>
<p>Operations:</p>
<ol type="1">
<li><p>Insert(x):</p>
<ul>
<li>Add <code>x</code> at the end.</li>
<li>“Bubble up” while <code>x &gt; parent(x)</code>.</li>
</ul></li>
<li><p>ExtractMax():</p>
<ul>
<li>Remove root (maximum).</li>
<li>Move last element to root.</li>
<li>“Bubble down” while parent &lt; larger child.</li>
</ul></li>
<li><p>Peek():</p>
<ul>
<li>Return <code>arr[0]</code> (max element).</li>
</ul></li>
</ol>
<p>Example</p>
<p>Start: <code>[ ]</code> Insert sequence: 10, 24, 5, 31, 7</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Action</th>
<th>Array</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>insert 10</td>
<td>[10]</td>
</tr>
<tr class="even">
<td>2</td>
<td>insert 24</td>
<td>bubble up → [24, 10]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>insert 5</td>
<td>[24, 10, 5]</td>
</tr>
<tr class="even">
<td>4</td>
<td>insert 31</td>
<td>bubble up → [31, 24, 5, 10]</td>
</tr>
<tr class="odd">
<td>5</td>
<td>insert 7</td>
<td>[31, 24, 5, 10, 7]</td>
</tr>
</tbody>
</table>
<p>ExtractMax:</p>
<ul>
<li>Swap root with last (31 ↔︎ 7): <code>[7, 24, 5, 10, 31]</code></li>
<li>Remove last: <code>[7, 24, 5, 10]</code></li>
<li>Bubble down: swap 7 ↔︎ 24 → <code>[24, 10, 5, 7]</code></li>
</ul>
</section>
<section id="tiny-code-easy-versions-24" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-24">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX </span><span class="dv">100</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> arr<span class="op">[</span>MAX<span class="op">];</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> size<span class="op">;</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> MaxHeap<span class="op">;</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> swap<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tmp <span class="op">=</span> <span class="op">*</span>a<span class="op">;</span> <span class="op">*</span>a <span class="op">=</span> <span class="op">*</span>b<span class="op">;</span> <span class="op">*</span>b <span class="op">=</span> tmp<span class="op">;</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> heapify_up<span class="op">(</span>MaxHeap <span class="op">*</span>h<span class="op">,</span> <span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> parent <span class="op">=</span> <span class="op">(</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">]</span> <span class="op">&lt;=</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>parent<span class="op">])</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>        swap<span class="op">(&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>parent<span class="op">]);</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> parent<span class="op">;</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> heapify_down<span class="op">(</span>MaxHeap <span class="op">*</span>h<span class="op">,</span> <span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> largest <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> left <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> right <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>left <span class="op">&lt;</span> h<span class="op">-&gt;</span>size <span class="op">&amp;&amp;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>left<span class="op">]</span> <span class="op">&gt;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>largest<span class="op">])</span> largest <span class="op">=</span> left<span class="op">;</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>right <span class="op">&lt;</span> h<span class="op">-&gt;</span>size <span class="op">&amp;&amp;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>right<span class="op">]</span> <span class="op">&gt;</span> h<span class="op">-&gt;</span>arr<span class="op">[</span>largest<span class="op">])</span> largest <span class="op">=</span> right<span class="op">;</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>largest <span class="op">!=</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>        swap<span class="op">(&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>h<span class="op">-&gt;</span>arr<span class="op">[</span>largest<span class="op">]);</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>        heapify_down<span class="op">(</span>h<span class="op">,</span> largest<span class="op">);</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> insert<span class="op">(</span>MaxHeap <span class="op">*</span>h<span class="op">,</span> <span class="dt">int</span> val<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>    h<span class="op">-&gt;</span>arr<span class="op">[</span>h<span class="op">-&gt;</span>size<span class="op">]</span> <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>    heapify_up<span class="op">(</span>h<span class="op">,</span> h<span class="op">-&gt;</span>size<span class="op">);</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>    h<span class="op">-&gt;</span>size<span class="op">++;</span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> extract_max<span class="op">(</span>MaxHeap <span class="op">*</span>h<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>h<span class="op">-&gt;</span>size <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> root <span class="op">=</span> h<span class="op">-&gt;</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>    h<span class="op">-&gt;</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> h<span class="op">-&gt;</span>arr<span class="op">[--</span>h<span class="op">-&gt;</span>size<span class="op">];</span></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>    heapify_down<span class="op">(</span>h<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> peek<span class="op">(</span>MaxHeap <span class="op">*</span>h<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> h<span class="op">-&gt;</span>size <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> h<span class="op">-&gt;</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a>    MaxHeap h <span class="op">=</span> <span class="op">{.</span>size <span class="op">=</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> vals<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">31</span><span class="op">,</span> <span class="dv">7</span><span class="op">};</span></span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> insert<span class="op">(&amp;</span>h<span class="op">,</span> vals<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Max: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> peek<span class="op">(&amp;</span>h<span class="op">));</span></span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Extracted: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> extract_max<span class="op">(&amp;</span>h<span class="op">));</span></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> h<span class="op">.</span>size<span class="op">;</span> i<span class="op">++)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> h<span class="op">.</span>arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MaxHeap:</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.arr <span class="op">=</span> []</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parent(<span class="va">self</span>, i): <span class="cf">return</span> (i <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _left(<span class="va">self</span>, i): <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _right(<span class="va">self</span>, i): <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, val):</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.arr.append(val)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.arr) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.arr[i] <span class="op">&gt;</span> <span class="va">self</span>.arr[<span class="va">self</span>._parent(i)]:</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> <span class="va">self</span>._parent(i)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[i], <span class="va">self</span>.arr[p] <span class="op">=</span> <span class="va">self</span>.arr[p], <span class="va">self</span>.arr[i]</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> p</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_max(<span class="va">self</span>):</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.arr:</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> <span class="va">self</span>.arr[<span class="dv">0</span>]</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>        last <span class="op">=</span> <span class="va">self</span>.arr.pop()</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.arr:</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[<span class="dv">0</span>] <span class="op">=</span> last</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._heapify_down(<span class="dv">0</span>)</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> root</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _heapify_down(<span class="va">self</span>, i):</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>        largest <span class="op">=</span> i</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>        l, r <span class="op">=</span> <span class="va">self</span>._left(i), <span class="va">self</span>._right(i)</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> l <span class="op">&lt;</span> <span class="bu">len</span>(<span class="va">self</span>.arr) <span class="kw">and</span> <span class="va">self</span>.arr[l] <span class="op">&gt;</span> <span class="va">self</span>.arr[largest]:</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>            largest <span class="op">=</span> l</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r <span class="op">&lt;</span> <span class="bu">len</span>(<span class="va">self</span>.arr) <span class="kw">and</span> <span class="va">self</span>.arr[r] <span class="op">&gt;</span> <span class="va">self</span>.arr[largest]:</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>            largest <span class="op">=</span> r</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> largest <span class="op">!=</span> i:</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.arr[i], <span class="va">self</span>.arr[largest] <span class="op">=</span> <span class="va">self</span>.arr[largest], <span class="va">self</span>.arr[i]</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._heapify_down(largest)</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> peek(<span class="va">self</span>):</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.arr[<span class="dv">0</span>] <span class="cf">if</span> <span class="va">self</span>.arr <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> MaxHeap()</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">24</span>, <span class="dv">5</span>, <span class="dv">31</span>, <span class="dv">7</span>]:</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>    h.insert(x)</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Heap:"</span>, h.arr)</span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Max:"</span>, h.peek())</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Extracted:"</span>, h.extract_max())</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"After:"</span>, h.arr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-25" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-25">Why It Matters</h4>
<ul>
<li>Priority queues that need fast access to maximum</li>
<li>Scheduling highest-priority tasks</li>
<li>Tracking largest elements dynamically</li>
<li>Used in heap sort, selection problems, top-k queries</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-25" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-25">A Gentle Proof (Why It Works)</h4>
<p>Each operation adjusts at most height = log n levels. Since all swaps move greater elements upward, heap property (parent ≥ children) is restored in logarithmic time. Thus the root always holds the maximum.</p>
</section>
<section id="try-it-yourself-25" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-25">Try It Yourself</h4>
<ol type="1">
<li>Convert to min-heap by flipping comparisons.</li>
<li>Use heap to implement k-largest elements finder.</li>
<li>Trace swaps after each insert/delete.</li>
<li>Visualize heap as a tree diagram.</li>
</ol>
</section>
<section id="test-cases-25" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-25">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 24%">
<col style="width: 10%">
<col style="width: 24%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Output</th>
<th>Heap After</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>[10,24,5,31,7]</td>
<td>-</td>
<td>[31,24,5,10,7]</td>
<td>max at root</td>
</tr>
<tr class="even">
<td>Peek</td>
<td>-</td>
<td>31</td>
<td>[31,24,5,10,7]</td>
<td>largest</td>
</tr>
<tr class="odd">
<td>ExtractMax</td>
<td>-</td>
<td>31</td>
<td>[24,10,5,7]</td>
<td>heap fixed</td>
</tr>
<tr class="even">
<td>Empty Extract</td>
<td>[]</td>
<td>None</td>
<td>[]</td>
<td>safe</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Duplicates → handled fine</li>
<li>Empty heap → sentinel</li>
<li>Negative numbers → valid</li>
</ul>
</section>
<section id="complexity-25" class="level4">
<h4 class="anchored" data-anchor-id="complexity-25">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>ExtractMax</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Peek</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>A max-heap is the summit keeper, always crowning the greatest, ensuring the hierarchy remains true from root to leaf.</p>
</section>
</section>
<section id="fibonacci-heap-insertdelete" class="level3">
<h3 class="anchored" data-anchor-id="fibonacci-heap-insertdelete">227 Fibonacci Heap Insert/Delete</h3>
<p>A Fibonacci heap is a meldable heap optimized for very fast amortized operations. It keeps a collection of heap-ordered trees with minimal structural work on most operations, banking work for occasional consolidations. Classic result: <code>insert</code>, <code>find-min</code>, and <code>decrease-key</code> run in O(1) amortized, while <code>extract-min</code> runs in O(log n) amortized.</p>
<section id="what-problem-are-we-solving-26" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-26">What Problem Are We Solving?</h4>
<p>We want ultra fast priority queue ops in algorithms that call <code>decrease-key</code> a lot, like Dijkstra and Prim. Binary and pairing heaps give <code>decrease-key</code> in <code>O(log n)</code> or good constants, but Fibonacci heaps achieve amortized O(1) for <code>insert</code> and <code>decrease-key</code>, improving theoretical bounds.</p>
<p>Goal: Maintain a set of heap-ordered trees where most updates only touch a few pointers, delaying consolidation until <code>extract-min</code>.</p>
</section>
<section id="how-does-it-work-plain-language-26" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-26">How Does It Work (Plain Language)?</h4>
<p>Structure highlights</p>
<ul>
<li>A root list of trees, each obeying min-heap order.</li>
<li>A pointer to the global minimum root.</li>
<li>Each node stores degree, parent, child, and a mark bit used by <code>decrease-key</code>.</li>
<li>Root list is a circular doubly linked list, children lists are similar.</li>
</ul>
<p>Core ideas</p>
<ul>
<li>Insert adds a 1 node tree into the root list and updates <code>min</code> if needed.</li>
<li>Delete is typically implemented as <code>decrease-key(x, -inf)</code> then <code>extract-min</code>.</li>
<li>Extract-min removes the min root, promotes its children to the root list, then consolidates roots by linking trees of equal degree until all root degrees are unique.</li>
</ul>
</section>
<section id="how-does-insert-work" class="level4">
<h4 class="anchored" data-anchor-id="how-does-insert-work">How Does Insert Work</h4>
<p>Steps for <code>insert(x)</code></p>
<ol type="1">
<li>Make a singleton node <code>x</code>.</li>
<li>Splice <code>x</code> into the root list.</li>
<li>Update <code>min</code> if <code>x.key &lt; min.key</code>.</li>
</ol>
<p>Example Steps (Root List View)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Action</th>
<th>Root List</th>
<th>Min</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>insert 12</td>
<td>[12]</td>
<td>12</td>
</tr>
<tr class="even">
<td>2</td>
<td>insert 7</td>
<td>[12, 7]</td>
<td>7</td>
</tr>
<tr class="odd">
<td>3</td>
<td>insert 25</td>
<td>[12, 7, 25]</td>
<td>7</td>
</tr>
<tr class="even">
<td>4</td>
<td>insert 3</td>
<td>[12, 7, 25, 3]</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>All inserts are O(1) pointer splices.</p>
</section>
<section id="how-does-delete-work" class="level4">
<h4 class="anchored" data-anchor-id="how-does-delete-work">How Does Delete Work</h4>
<p>To delete an arbitrary node <code>x</code>, standard approach</p>
<ol type="1">
<li><code>decrease-key(x, -inf)</code> so <code>x</code> becomes the minimum.</li>
<li><code>extract-min()</code> to remove it.</li>
</ol>
<p>Delete inherits the <code>extract-min</code> cost.</p>
</section>
<section id="tiny-code-educational-skeleton" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-educational-skeleton">Tiny Code (Educational Skeleton)</h4>
<p>This is a minimal sketch to illustrate structure and the two requested operations. It omits full <code>decrease-key</code> and cascading cuts to keep focus. In practice, a complete Fibonacci heap also implements <code>decrease-key</code> and <code>extract-min</code> with consolidation arrays.</p>
<p>Python (didactic skeleton for insert and delete via extract-min path)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FibNode:</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.degree <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mark <span class="op">=</span> <span class="va">False</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.parent <span class="op">=</span> <span class="va">None</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.child <span class="op">=</span> <span class="va">None</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># circular doubly linked list pointers</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">self</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> <span class="va">self</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _splice(a, b):</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert node b to the right of node a in a circular list</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    b.right <span class="op">=</span> a.right</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    b.left <span class="op">=</span> a</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    a.right.left <span class="op">=</span> b</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    a.right <span class="op">=</span> b</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _remove_from_list(x):</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    x.left.right <span class="op">=</span> x.right</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    x.right.left <span class="op">=</span> x.left</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    x.left <span class="op">=</span> x.right <span class="op">=</span> x</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FibHeap:</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">min</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key):</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> FibNode(key)</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.<span class="bu">min</span> <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.<span class="bu">min</span> <span class="op">=</span> x</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>            _splice(<span class="va">self</span>.<span class="bu">min</span>, x)</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> x.key <span class="op">&lt;</span> <span class="va">self</span>.<span class="bu">min</span>.key:</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.<span class="bu">min</span> <span class="op">=</span> x</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _merge_root_list(<span class="va">self</span>, other_min):</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> other_min <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># concat circular lists: self.min and other_min</span></span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> <span class="va">self</span>.<span class="bu">min</span></span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> other_min</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>        a_right <span class="op">=</span> a.right</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>        b_left <span class="op">=</span> b.left</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>        a.right <span class="op">=</span> b</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>        b.left <span class="op">=</span> a</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>        a_right.left <span class="op">=</span> b_left</span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>        b_left.right <span class="op">=</span> a_right</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> b.key <span class="op">&lt;</span> <span class="va">self</span>.<span class="bu">min</span>.key:</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.<span class="bu">min</span> <span class="op">=</span> b</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_min(<span class="va">self</span>):</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> <span class="va">self</span>.<span class="bu">min</span></span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> z <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># promote children to root list</span></span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> z.child:</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> z.child</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>            nodes <span class="op">=</span> []</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>            cur <span class="op">=</span> c</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>                nodes.append(cur)</span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>                cur <span class="op">=</span> cur.right</span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> cur <span class="op">==</span> c:</span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> x <span class="kw">in</span> nodes:</span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a>                x.parent <span class="op">=</span> <span class="va">None</span></span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>                _remove_from_list(x)</span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>                _splice(z, x)  <span class="co"># into root list near z</span></span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>        <span class="co"># remove z from root list</span></span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> z.right <span class="op">==</span> z:</span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.<span class="bu">min</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a>            nxt <span class="op">=</span> z.right</span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a>            _remove_from_list(z)</span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.<span class="bu">min</span> <span class="op">=</span> nxt</span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._consolidate()  <span class="co"># real impl would link equal degree trees</span></span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> z.key</span>
<span id="cb56-83"><a href="#cb56-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-84"><a href="#cb56-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _consolidate(<span class="va">self</span>):</span>
<span id="cb56-85"><a href="#cb56-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Placeholder: a full implementation uses an array A[0..floor(log_phi n)]</span></span>
<span id="cb56-86"><a href="#cb56-86" aria-hidden="true" tabindex="-1"></a>        <span class="co"># to link roots of equal degree until all degrees unique.</span></span>
<span id="cb56-87"><a href="#cb56-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb56-88"><a href="#cb56-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-89"><a href="#cb56-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete(<span class="va">self</span>, node):</span>
<span id="cb56-90"><a href="#cb56-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In full Fibonacci heap:</span></span>
<span id="cb56-91"><a href="#cb56-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># decrease_key(node, -inf), then extract_min</span></span>
<span id="cb56-92"><a href="#cb56-92" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Here we approximate by manual min-bump if node is the min</span></span>
<span id="cb56-93"><a href="#cb56-93" aria-hidden="true" tabindex="-1"></a>        <span class="co"># and ignore cascading cuts for brevity.</span></span>
<span id="cb56-94"><a href="#cb56-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For correctness in real use, implement decrease_key and cuts.</span></span>
<span id="cb56-95"><a href="#cb56-95" aria-hidden="true" tabindex="-1"></a>        node.key <span class="op">=</span> <span class="bu">float</span>(<span class="st">"-inf"</span>)</span>
<span id="cb56-96"><a href="#cb56-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.<span class="bu">min</span> <span class="kw">and</span> node.key <span class="op">&lt;</span> <span class="va">self</span>.<span class="bu">min</span>.key:</span>
<span id="cb56-97"><a href="#cb56-97" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.<span class="bu">min</span> <span class="op">=</span> node</span>
<span id="cb56-98"><a href="#cb56-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.extract_min()</span>
<span id="cb56-99"><a href="#cb56-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-100"><a href="#cb56-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb56-101"><a href="#cb56-101" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> FibHeap()</span>
<span id="cb56-102"><a href="#cb56-102" aria-hidden="true" tabindex="-1"></a>n1 <span class="op">=</span> H.insert(<span class="dv">12</span>)</span>
<span id="cb56-103"><a href="#cb56-103" aria-hidden="true" tabindex="-1"></a>n2 <span class="op">=</span> H.insert(<span class="dv">7</span>)</span>
<span id="cb56-104"><a href="#cb56-104" aria-hidden="true" tabindex="-1"></a>n3 <span class="op">=</span> H.insert(<span class="dv">25</span>)</span>
<span id="cb56-105"><a href="#cb56-105" aria-hidden="true" tabindex="-1"></a>n4 <span class="op">=</span> H.insert(<span class="dv">3</span>)</span>
<span id="cb56-106"><a href="#cb56-106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Extracted min:"</span>, H.extract_min())  <span class="co"># 3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Note This skeleton shows how <code>insert</code> stitches into the root list and how <code>extract_min</code> would promote children. A production version must implement <code>decrease-key</code> with cascading cuts and <code>_consolidate</code> that links trees of equal degree.</p>
</section>
<section id="why-it-matters-26" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-26">Why It Matters</h4>
<ul>
<li>Theoretical speedups for graph algorithms heavy on <code>decrease-key</code></li>
<li>Meld operation can be O(1) by concatenating root lists</li>
<li>Amortized guarantees backed by potential function analysis</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-26" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-26">A Gentle Proof (Why It Works)</h4>
<p>Amortized analysis uses a potential function based on number of trees in the root list and number of marked nodes.</p>
<ul>
<li><code>insert</code> only adds a root and maybe updates <code>min</code>, decreasing or slightly increasing potential, so O(1) amortized.</li>
<li><code>decrease-key</code> cuts a node and possibly cascades parent cuts, but marks bound the total number of cascades over a sequence, giving O(1) amortized.</li>
<li><code>extract-min</code> triggers consolidation. The number of distinct degrees is O(log n), so linking costs O(log n) amortized.</li>
</ul>
</section>
<section id="try-it-yourself-26" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-26">Try It Yourself</h4>
<ol type="1">
<li>Complete <code>_consolidate</code> with an array indexed by degree, linking roots of equal degree until unique.</li>
<li>Implement <code>decrease_key(x, new_key)</code> with cut and cascading cut rules.</li>
<li>Add <code>union(H1, H2)</code> that concatenates root lists and picks the smaller <code>min</code>.</li>
<li>Benchmark against binary and pairing heaps on workloads with many <code>decrease-key</code> operations.</li>
</ol>
</section>
<section id="test-cases-26" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-26">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 19%">
<col style="width: 22%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Expected</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert</td>
<td>12, 7, 25, 3</td>
<td>min = 3</td>
<td>simple root list updates</td>
</tr>
<tr class="even">
<td>extract_min</td>
<td>after above</td>
<td>returns 3</td>
<td>children promoted, consolidate</td>
</tr>
<tr class="odd">
<td>delete(node)</td>
<td>delete 7</td>
<td>7 removed</td>
<td>via decrease to minus infinity then extract</td>
</tr>
<tr class="even">
<td>meld</td>
<td>union of two heaps</td>
<td>new min = min(m1, m2)</td>
<td>O(1) concat</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Extract from empty heap returns None</li>
<li>Duplicate keys are fine</li>
<li>Large inserts without extract build many small trees until consolidation</li>
</ul>
</section>
<section id="complexity-26" class="level4">
<h4 class="anchored" data-anchor-id="complexity-26">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Amortized Time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>find-min</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>decrease-key</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>extract-min</td>
<td>O(log n)</td>
</tr>
<tr class="odd">
<td>delete</td>
<td>O(log n) via decrease then extract</td>
</tr>
</tbody>
</table>
<p>Fibonacci heaps trade strict order for lazy elegance. Most ops are tiny pointer shuffles, and the heavy lifting happens rarely during consolidation.</p>
</section>
</section>
<section id="pairing-heap-merge" class="level3">
<h3 class="anchored" data-anchor-id="pairing-heap-merge">228 Pairing Heap Merge</h3>
<p>A pairing heap is a simple, pointer-based, meldable heap that is famously fast in practice. Its secret weapon is the merge operation: link two heap roots by making the larger-key root a child of the smaller-key root. Many other operations reduce to a small number of merges.</p>
<section id="what-problem-are-we-solving-27" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-27">What Problem Are We Solving?</h4>
<p>We want a priority queue with a tiny constant factor and very simple code, while keeping theoretical guarantees close to Fibonacci heaps. Pairing heaps offer extremely quick <code>insert</code>, <code>meld</code>, and often <code>decrease-key</code>, with <code>delete-min</code> powered by a lightweight multi-merge.</p>
<p>Goal: Represent a heap as a tree of nodes and implement merge so that all higher-level operations can be expressed as sequences of merges.</p>
</section>
<section id="how-does-it-work-plain-language-27" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-27">How Does It Work (Plain Language)?</h4>
<p>Each node has: key, first child, and next sibling. The heap is just a pointer to the root. To merge two heaps <code>A</code> and <code>B</code>:</p>
<ol type="1">
<li>If one is empty, return the other.</li>
<li>Compare roots.</li>
<li>Make the larger-root heap the new child of the smaller-root heap by linking it as the smaller root’s first child.</li>
</ol>
<p>Other ops via merge</p>
<ul>
<li><p>Insert(x): make a 1-node heap and <code>merge(root, x)</code>.</p></li>
<li><p>Find-min: the root’s key.</p></li>
<li><p>Delete-min: remove the root, then merge its children in two passes</p>
<ol type="1">
<li>Left to right, pairwise merge adjacent siblings.</li>
<li>Right to left, merge the resulting heaps back into one.</li>
</ol></li>
<li><p>Decrease-key(x, new): cut <code>x</code> from its place, set <code>x.key = new</code>, then <code>merge(root, x)</code>.</p></li>
</ul>
<p>Example Steps (Merge only)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Heap A (root)</th>
<th>Heap B (root)</th>
<th>Action</th>
<th>New Root</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>7</td>
<td>12</td>
<td>link 12 under 7</td>
<td>7</td>
</tr>
<tr class="even">
<td>2</td>
<td>7</td>
<td>3</td>
<td>link 7 under 3</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>3</td>
<td>9</td>
<td>link 9 under 3</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>Resulting root is the minimum of all merged heaps.</p>
</section>
<section id="tiny-code-easy-versions-25" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-25">Tiny Code (Easy Versions)</h4>
<p>C (merge, insert, find-min, delete-min two-pass)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">;</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>child<span class="op">;</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>sibling<span class="op">;</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> make_node<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span> n<span class="op">-&gt;</span>child <span class="op">=</span> NULL<span class="op">;</span> n<span class="op">-&gt;</span>sibling <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> merge<span class="op">(</span>Node<span class="op">*</span> a<span class="op">,</span> Node<span class="op">*</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>a<span class="op">)</span> <span class="cf">return</span> b<span class="op">;</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>b<span class="op">)</span> <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b<span class="op">-&gt;</span>key <span class="op">&lt;</span> a<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span> Node<span class="op">*</span> t <span class="op">=</span> a<span class="op">;</span> a <span class="op">=</span> b<span class="op">;</span> b <span class="op">=</span> t<span class="op">;</span> <span class="op">}</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// make b the first child of a</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>sibling <span class="op">=</span> a<span class="op">-&gt;</span>child<span class="op">;</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>child <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merge<span class="op">(</span>root<span class="op">,</span> make_node<span class="op">(</span>key<span class="op">));</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> merge_pairs<span class="op">(</span>Node<span class="op">*</span> first<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>first <span class="op">||</span> <span class="op">!</span>first<span class="op">-&gt;</span>sibling<span class="op">)</span> <span class="cf">return</span> first<span class="op">;</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> a <span class="op">=</span> first<span class="op">;</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> b <span class="op">=</span> first<span class="op">-&gt;</span>sibling<span class="op">;</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> rest <span class="op">=</span> b<span class="op">-&gt;</span>sibling<span class="op">;</span></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>sibling <span class="op">=</span> b<span class="op">-&gt;</span>sibling <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merge<span class="op">(</span>merge<span class="op">(</span>a<span class="op">,</span> b<span class="op">),</span> merge_pairs<span class="op">(</span>rest<span class="op">));</span></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> delete_min<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> root<span class="op">-&gt;</span>key<span class="op">;</span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> new_root <span class="op">=</span> merge_pairs<span class="op">(</span>root<span class="op">-&gt;</span>child<span class="op">);</span></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_root<span class="op">;</span></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> h <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> insert<span class="op">(</span>h<span class="op">,</span> <span class="dv">7</span><span class="op">);</span></span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> insert<span class="op">(</span>h<span class="op">,</span> <span class="dv">12</span><span class="op">);</span></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> insert<span class="op">(</span>h<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> insert<span class="op">(</span>h<span class="op">,</span> <span class="dv">9</span><span class="op">);</span></span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> m<span class="op">;</span></span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> delete_min<span class="op">(</span>h<span class="op">,</span> <span class="op">&amp;</span>m<span class="op">);</span></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Deleted min: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> m<span class="op">);</span> <span class="co">// 3</span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (succinct pairing heap)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">__slots__</span> <span class="op">=</span> (<span class="st">"key"</span>, <span class="st">"child"</span>, <span class="st">"sibling"</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.child <span class="op">=</span> <span class="va">None</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sibling <span class="op">=</span> <span class="va">None</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge(a, b):</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> a: <span class="cf">return</span> b</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> b: <span class="cf">return</span> a</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> b.key <span class="op">&lt;</span> a.key:</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> b, a</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    b.sibling <span class="op">=</span> a.child</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    a.child <span class="op">=</span> b</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_pairs(first):</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> first <span class="kw">or</span> <span class="kw">not</span> first.sibling:</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> first</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>    a, b, rest <span class="op">=</span> first, first.sibling, first.sibling.sibling</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    a.sibling <span class="op">=</span> b.sibling <span class="op">=</span> <span class="va">None</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merge(merge(a, b), merge_pairs(rest))</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PairingHeap:</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>): <span class="va">self</span>.root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find_min(<span class="va">self</span>): <span class="cf">return</span> <span class="va">None</span> <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.root <span class="cf">else</span> <span class="va">self</span>.root.key</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, x):</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.root <span class="op">=</span> merge(<span class="va">self</span>.root, Node(x))</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> meld(<span class="va">self</span>, other):</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.root <span class="op">=</span> merge(<span class="va">self</span>.root, other.root)</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete_min(<span class="va">self</span>):</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.root: <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> <span class="va">self</span>.root.key</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.root <span class="op">=</span> merge_pairs(<span class="va">self</span>.root.child)</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> m</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> PairingHeap()</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="dv">7</span>, <span class="dv">12</span>, <span class="dv">3</span>, <span class="dv">9</span>]:</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>    h.insert(x)</span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(h.find_min())      <span class="co"># 3</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(h.delete_min())    <span class="co"># 3</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(h.find_min())      <span class="co"># 7</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-27" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-27">Why It Matters</h4>
<ul>
<li>Incredibly simple code yet high performance in practice</li>
<li>Meld is constant time pointer work</li>
<li>Excellent for workloads mixing frequent inserts and decrease-keys</li>
<li>A strong practical alternative to Fibonacci heaps</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-27" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-27">A Gentle Proof (Why It Works)</h4>
<p>Merge correctness</p>
<ul>
<li>After linking, the smaller root remains parent, so heap order holds at the root and along the newly attached subtree.</li>
</ul>
<p>Delete-min two-pass</p>
<ul>
<li>Pairwise merges reduce the number of trees while keeping roots small.</li>
<li>The second right-to-left fold merges larger partial heaps into a single heap.</li>
<li>Analyses show <code>delete-min</code> runs in O(log n) amortized; <code>insert</code> and <code>meld</code> in O(1) amortized.</li>
<li><code>decrease-key</code> is conjectured O(1) amortized in practice and near that in theory under common models.</li>
</ul>
</section>
<section id="try-it-yourself-27" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-27">Try It Yourself</h4>
<ol type="1">
<li>Implement <code>decrease_key(node, new_key)</code>: cut the node from its parent and <code>merge(root, node)</code> after lowering its key.</li>
<li>Add a handle table to access nodes for fast decrease-key.</li>
<li>Benchmark against binary and Fibonacci heaps on Dijkstra workloads.</li>
<li>Visualize delete-min’s two-pass pairing on random trees.</li>
</ol>
</section>
<section id="test-cases-27" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-27">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 20%">
<col style="width: 32%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Output</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>insert</td>
<td>7, 12, 3, 9</td>
<td>min = 3</td>
<td>root tracks global min</td>
</tr>
<tr class="even">
<td>meld</td>
<td>meld two heaps</td>
<td>new min is min of both</td>
<td>constant-time link</td>
</tr>
<tr class="odd">
<td>delete_min</td>
<td>after above</td>
<td>3</td>
<td>two-pass pairing</td>
</tr>
<tr class="even">
<td>delete_min</td>
<td>next</td>
<td>7</td>
<td>heap restructures</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Merging with empty heap returns the other heap</li>
<li>Duplicate keys behave naturally</li>
<li>Single-node heap deletes to empty safely</li>
</ul>
</section>
<section id="complexity-27" class="level4">
<h4 class="anchored" data-anchor-id="complexity-27">Complexity</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 62%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Amortized Time</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>meld</td>
<td>O(1)</td>
<td>core primitive</td>
</tr>
<tr class="even">
<td>insert</td>
<td>O(1)</td>
<td>merge singleton</td>
</tr>
<tr class="odd">
<td>find-min</td>
<td>O(1)</td>
<td>root key</td>
</tr>
<tr class="even">
<td>delete-min</td>
<td>O(log n)</td>
<td>two-pass merge</td>
</tr>
<tr class="odd">
<td>decrease-key</td>
<td>O(1) practical, near O(1) amortized in models</td>
<td>cut+merge</td>
</tr>
</tbody>
</table>
<p>Pairing heaps make merging feel effortless: one comparison, a couple of pointers, and you are done.</p>
</section>
</section>
<section id="binomial-heap-merge" class="level3">
<h3 class="anchored" data-anchor-id="binomial-heap-merge">229 Binomial Heap Merge</h3>
<p>A binomial heap is a set of binomial trees that act like a binary counter for priority queues. The star move is merge: combining two heaps is like adding two binary numbers. Trees of the same degree collide, you link one under the other, and carry to the next degree.</p>
<section id="what-problem-are-we-solving-28" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-28">What Problem Are We Solving?</h4>
<p>We want a priority queue that supports fast meld (union) while keeping simple, provable bounds. Binomial heaps deliver:</p>
<ul>
<li><code>meld</code> in O(log n)</li>
<li><code>insert</code> in O(1) amortized by melding a 1-node heap</li>
<li><code>find-min</code> in O(log n)</li>
<li><code>delete-min</code> in O(log n) via a meld with reversed children</li>
</ul>
<p>Goal: Represent the heap as a sorted list of binomial trees and merge two heaps by walking these lists, linking equal-degree roots.</p>
</section>
<section id="how-does-it-work-plain-language-28" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-28">How Does It Work (Plain Language)?</h4>
<p>Binomial tree facts</p>
<ul>
<li>A binomial tree of degree <code>k</code> has <code>2^k</code> nodes.</li>
<li>Each degree occurs at most once in a binomial heap.</li>
<li>Roots are kept in increasing order of degree.</li>
</ul>
<p>Merging two heaps H1 and H2</p>
<ol type="1">
<li>Merge the root lists by degree like a sorted list merge.</li>
<li>Walk the combined list. Whenever two consecutive trees have the same degree, link them: make the larger-key root a child of the smaller-key root, increasing the degree by 1.</li>
<li>Use a carry idea just like binary addition.</li>
</ol>
<p>Link(u, v)</p>
<ul>
<li>Precondition: <code>degree(u) == degree(v)</code>.</li>
<li>After linking, <code>min(u.key, v.key)</code> becomes parent and degree increases by 1.</li>
</ul>
<p>Example Steps (degrees in parentheses)</p>
<p>Start</p>
<ul>
<li>H1 roots: [2(0), 7(1), 12(3)]</li>
<li>H2 roots: [3(0), 9(2)]</li>
</ul>
<p>1 Merge lists by degree</p>
<ul>
<li>Combined: [2(0), 3(0), 7(1), 9(2), 12(3)]</li>
</ul>
<p>2 Resolve equal degrees</p>
<ul>
<li>Link 2(0) and 3(0) under min root → 2 becomes parent: 2(1)</li>
<li>Now list: [2(1), 7(1), 9(2), 12(3)]</li>
<li>Link 2(1) and 7(1) → 2 becomes parent: 2(2)</li>
<li>Now list: [2(2), 9(2), 12(3)]</li>
<li>Link 2(2) and 9(2) → 2 becomes parent: 2(3)</li>
<li>Now list: [2(3), 12(3)]</li>
<li>Link 2(3) and 12(3) → 2 becomes parent: 2(4)</li>
</ul>
<p>Final heap has root list [2(4)] with 2 as global min.</p>
</section>
<section id="tiny-code-easy-versions-26" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-26">Tiny Code (Easy Versions)</h4>
<p>C (merge plus link, minimal skeleton)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb59"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">;</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> degree<span class="op">;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node<span class="op">*</span> parent<span class="op">;</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node<span class="op">*</span> child<span class="op">;</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node<span class="op">*</span> sibling<span class="op">;</span> <span class="co">// next root or next sibling in child list</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> make_node<span class="op">(</span><span class="dt">int</span> key<span class="op">){</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> x <span class="op">=</span> calloc<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Make 'y' a child of 'x' assuming x-&gt;key &lt;= y-&gt;key and degree equal</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> link_tree<span class="op">(</span>Node<span class="op">*</span> x<span class="op">,</span> Node<span class="op">*</span> y<span class="op">){</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>parent <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>sibling <span class="op">=</span> x<span class="op">-&gt;</span>child<span class="op">;</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>child <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>degree <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Merge root lists by degree (no linking yet)</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> merge_root_lists<span class="op">(</span>Node<span class="op">*</span> a<span class="op">,</span> Node<span class="op">*</span> b<span class="op">){</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(!</span>a<span class="op">)</span> <span class="cf">return</span> b<span class="op">;</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(!</span>b<span class="op">)</span> <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>    Node dummy <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> tail <span class="op">=</span> <span class="op">&amp;</span>dummy<span class="op">;</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>a <span class="op">&amp;&amp;</span> b<span class="op">){</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>a<span class="op">-&gt;</span>degree <span class="op">&lt;=</span> b<span class="op">-&gt;</span>degree<span class="op">){</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>            tail<span class="op">-&gt;</span>sibling <span class="op">=</span> a<span class="op">;</span> a <span class="op">=</span> a<span class="op">-&gt;</span>sibling<span class="op">;</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span><span class="cf">else</span><span class="op">{</span></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>            tail<span class="op">-&gt;</span>sibling <span class="op">=</span> b<span class="op">;</span> b <span class="op">=</span> b<span class="op">-&gt;</span>sibling<span class="op">;</span></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>        tail <span class="op">=</span> tail<span class="op">-&gt;</span>sibling<span class="op">;</span></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>    tail<span class="op">-&gt;</span>sibling <span class="op">=</span> a <span class="op">?</span> a <span class="op">:</span> b<span class="op">;</span></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dummy<span class="op">.</span>sibling<span class="op">;</span></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a><span class="co">// Union with carry logic</span></span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> binomial_union<span class="op">(</span>Node<span class="op">*</span> h1<span class="op">,</span> Node<span class="op">*</span> h2<span class="op">){</span></span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> head <span class="op">=</span> merge_root_lists<span class="op">(</span>h1<span class="op">,</span> h2<span class="op">);</span></span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(!</span>head<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> prev <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> curr <span class="op">=</span> head<span class="op">;</span></span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> next <span class="op">=</span> curr<span class="op">-&gt;</span>sibling<span class="op">;</span></span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>next<span class="op">){</span></span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>curr<span class="op">-&gt;</span>degree <span class="op">!=</span> next<span class="op">-&gt;</span>degree <span class="op">||</span> <span class="op">(</span>next<span class="op">-&gt;</span>sibling <span class="op">&amp;&amp;</span> next<span class="op">-&gt;</span>sibling<span class="op">-&gt;</span>degree <span class="op">==</span> curr<span class="op">-&gt;</span>degree<span class="op">)){</span></span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>            prev <span class="op">=</span> curr<span class="op">;</span></span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a>            curr <span class="op">=</span> next<span class="op">;</span></span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span><span class="cf">else</span><span class="op">{</span></span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>curr<span class="op">-&gt;</span>key <span class="op">&lt;=</span> next<span class="op">-&gt;</span>key<span class="op">){</span></span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>                curr<span class="op">-&gt;</span>sibling <span class="op">=</span> next<span class="op">-&gt;</span>sibling<span class="op">;</span></span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>                curr <span class="op">=</span> link_tree<span class="op">(</span>curr<span class="op">,</span> next<span class="op">);</span></span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span><span class="cf">else</span><span class="op">{</span></span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span><span class="op">(</span>prev<span class="op">)</span> prev<span class="op">-&gt;</span>sibling <span class="op">=</span> next<span class="op">;</span></span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> head <span class="op">=</span> next<span class="op">;</span></span>
<span id="cb59-65"><a href="#cb59-65" aria-hidden="true" tabindex="-1"></a>                curr <span class="op">=</span> link_tree<span class="op">(</span>next<span class="op">,</span> curr<span class="op">);</span></span>
<span id="cb59-66"><a href="#cb59-66" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb59-67"><a href="#cb59-67" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-68"><a href="#cb59-68" aria-hidden="true" tabindex="-1"></a>        next <span class="op">=</span> curr<span class="op">-&gt;</span>sibling<span class="op">;</span></span>
<span id="cb59-69"><a href="#cb59-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb59-70"><a href="#cb59-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> head<span class="op">;</span></span>
<span id="cb59-71"><a href="#cb59-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb59-72"><a href="#cb59-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-73"><a href="#cb59-73" aria-hidden="true" tabindex="-1"></a><span class="co">// Convenience: insert by union with 1-node heap</span></span>
<span id="cb59-74"><a href="#cb59-74" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert<span class="op">(</span>Node<span class="op">*</span> heap<span class="op">,</span> <span class="dt">int</span> key<span class="op">){</span></span>
<span id="cb59-75"><a href="#cb59-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> binomial_union<span class="op">(</span>heap<span class="op">,</span> make_node<span class="op">(</span>key<span class="op">));</span></span>
<span id="cb59-76"><a href="#cb59-76" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb59-77"><a href="#cb59-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-78"><a href="#cb59-78" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">){</span></span>
<span id="cb59-79"><a href="#cb59-79" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> h1 <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb59-80"><a href="#cb59-80" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> h2 <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb59-81"><a href="#cb59-81" aria-hidden="true" tabindex="-1"></a>    h1 <span class="op">=</span> insert<span class="op">(</span>h1<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb59-82"><a href="#cb59-82" aria-hidden="true" tabindex="-1"></a>    h1 <span class="op">=</span> insert<span class="op">(</span>h1<span class="op">,</span> <span class="dv">7</span><span class="op">);</span></span>
<span id="cb59-83"><a href="#cb59-83" aria-hidden="true" tabindex="-1"></a>    h1 <span class="op">=</span> insert<span class="op">(</span>h1<span class="op">,</span> <span class="dv">12</span><span class="op">);</span> <span class="co">// degrees will normalize after unions</span></span>
<span id="cb59-84"><a href="#cb59-84" aria-hidden="true" tabindex="-1"></a>    h2 <span class="op">=</span> insert<span class="op">(</span>h2<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb59-85"><a href="#cb59-85" aria-hidden="true" tabindex="-1"></a>    h2 <span class="op">=</span> insert<span class="op">(</span>h2<span class="op">,</span> <span class="dv">9</span><span class="op">);</span></span>
<span id="cb59-86"><a href="#cb59-86" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> h <span class="op">=</span> binomial_union<span class="op">(</span>h1<span class="op">,</span> h2<span class="op">);</span></span>
<span id="cb59-87"><a href="#cb59-87" aria-hidden="true" tabindex="-1"></a>    <span class="co">// h now holds the merged heap; find-min is a scan of root list</span></span>
<span id="cb59-88"><a href="#cb59-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>Node<span class="op">*</span> r <span class="op">=</span> h<span class="op">;</span> r<span class="op">;</span> r <span class="op">=</span> r<span class="op">-&gt;</span>sibling<span class="op">)</span></span>
<span id="cb59-89"><a href="#cb59-89" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"root key=</span><span class="sc">%d</span><span class="st"> deg=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> r<span class="op">-&gt;</span>key<span class="op">,</span> r<span class="op">-&gt;</span>degree<span class="op">);</span></span>
<span id="cb59-90"><a href="#cb59-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb59-91"><a href="#cb59-91" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (succinct union and link)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">__slots__</span> <span class="op">=</span> (<span class="st">"key"</span>, <span class="st">"degree"</span>, <span class="st">"parent"</span>, <span class="st">"child"</span>, <span class="st">"sibling"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.degree <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.parent <span class="op">=</span> <span class="va">None</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.child <span class="op">=</span> <span class="va">None</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sibling <span class="op">=</span> <span class="va">None</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> link_tree(x, y):</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assume x.key &lt;= y.key and degrees equal</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    y.parent <span class="op">=</span> x</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>    y.sibling <span class="op">=</span> x.child</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    x.child <span class="op">=</span> y</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>    x.degree <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_root_lists(a, b):</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> a: <span class="cf">return</span> b</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> b: <span class="cf">return</span> a</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>    dummy <span class="op">=</span> Node(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> dummy</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> a <span class="kw">and</span> b:</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> a.degree <span class="op">&lt;=</span> b.degree:</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>            t.sibling, a <span class="op">=</span> a, a.sibling</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>            t.sibling, b <span class="op">=</span> b, b.sibling</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> t.sibling</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>    t.sibling <span class="op">=</span> a <span class="cf">if</span> a <span class="cf">else</span> b</span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dummy.sibling</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> binomial_union(h1, h2):</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>    head <span class="op">=</span> merge_root_lists(h1, h2)</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> head: <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>    prev, curr, nxt <span class="op">=</span> <span class="va">None</span>, head, head.sibling</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> nxt:</span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> curr.degree <span class="op">!=</span> nxt.degree <span class="kw">or</span> (nxt.sibling <span class="kw">and</span> nxt.sibling.degree <span class="op">==</span> curr.degree):</span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>            prev, curr, nxt <span class="op">=</span> curr, nxt, nxt.sibling</span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> curr.key <span class="op">&lt;=</span> nxt.key:</span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>                curr.sibling <span class="op">=</span> nxt.sibling</span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>                curr <span class="op">=</span> link_tree(curr, nxt)</span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a>                nxt <span class="op">=</span> curr.sibling</span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> prev: prev.sibling <span class="op">=</span> nxt</span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>: head <span class="op">=</span> nxt</span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a>                curr <span class="op">=</span> link_tree(nxt, curr)</span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>                nxt <span class="op">=</span> curr.sibling</span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> head</span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(heap, key):</span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> binomial_union(heap, Node(key))</span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a>h1 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">12</span>]:</span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a>    h1 <span class="op">=</span> insert(h1, x)</span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a>h2 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="dv">3</span>, <span class="dv">9</span>]:</span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a>    h2 <span class="op">=</span> insert(h2, x)</span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> binomial_union(h1, h2)</span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a>roots <span class="op">=</span> []</span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> h</span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> r:</span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a>    roots.append((r.key, r.degree))</span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> r.sibling</span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(roots)  <span class="co"># e.g. [(2, 4)] or a small set of unique degrees with min root smallest</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-28" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-28">Why It Matters</h4>
<ul>
<li>Meld-friendly: merging heaps is first-class, not an afterthought</li>
<li>Clean, provable bounds with a binary-counter intuition</li>
<li>Foundation for Fibonacci heaps and variations</li>
<li>Great when frequent melds are required in algorithms or multi-queue systems</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-28" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-28">A Gentle Proof (Why It Works)</h4>
<p>Merging root lists produces degrees in nondecreasing order. Linking only happens between adjacent roots of the same degree, producing exactly one tree of each degree after all carries settle. This mirrors binary addition: each link corresponds to carrying a 1 to the next bit. Since the maximum degree is O(log n), the merge performs O(log n) links and scans, giving O(log n) time.</p>
</section>
<section id="try-it-yourself-28" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-28">Try It Yourself</h4>
<ol type="1">
<li>Implement <code>find_min</code> by scanning root list and keep a pointer to the min root.</li>
<li>Implement <code>delete_min</code>: remove min root, reverse its child list into a separate heap, then <code>union</code>.</li>
<li>Add <code>decrease_key</code> by cutting and reinserting a node in the root list, then fixing parent order.</li>
<li>Compare union time with binary heap and pairing heap on large random workloads.</li>
</ol>
</section>
<section id="test-cases-28" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-28">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 20%">
<col style="width: 14%">
<col style="width: 25%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Case</th>
<th>H1 Roots (deg)</th>
<th>H2 Roots (deg)</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Simple merge</td>
<td>[2(0), 7(1)]</td>
<td>[3(0)]</td>
<td>roots unique after link</td>
<td>2 becomes parent of 3</td>
</tr>
<tr class="even">
<td>Chain of carries</td>
<td>[2(0), 7(1), 12(3)]</td>
<td>[3(0), 9(2)]</td>
<td>single root 2(4)</td>
<td>cascading links</td>
</tr>
<tr class="odd">
<td>Insert by union</td>
<td>H with roots</td>
<td>plus [x(0)]</td>
<td>merged in O(1) amortized</td>
<td>single carry possible</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Merging with empty heap returns the other heap</li>
<li>Duplicate keys work; tie break arbitrarily</li>
<li>Maintain stable sibling pointers when linking</li>
</ul>
</section>
<section id="complexity-28" class="level4">
<h4 class="anchored" data-anchor-id="complexity-28">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>meld (union)</td>
<td>O(log n)</td>
</tr>
<tr class="even">
<td>insert</td>
<td>O(1) amortized via union with 1-node heap</td>
</tr>
<tr class="odd">
<td>find-min</td>
<td>O(log n) scan or keep pointer for O(1) peek</td>
</tr>
<tr class="even">
<td>delete-min</td>
<td>O(log n)</td>
</tr>
<tr class="odd">
<td>decrease-key</td>
<td>O(log n) typical implementation</td>
</tr>
</tbody>
</table>
<p>Merging binomial heaps feels like adding binary numbers: equal degrees collide, link, and carry forward until the structure is tidy and the minimum stands at a root.</p>
</section>
</section>
<section id="leftist-heap-merge" class="level3">
<h3 class="anchored" data-anchor-id="leftist-heap-merge">230 Leftist Heap Merge</h3>
<p>A leftist heap is a binary tree heap optimized for efficient merges. Its structure skews to the left so that merging two heaps can be done recursively in O(log n) time. The clever trick is storing each node’s null path length (npl), ensuring the shortest path to a null child is always on the right, which keeps merges shallow.</p>
<section id="what-problem-are-we-solving-29" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-29">What Problem Are We Solving?</h4>
<p>We want a merge-friendly heap with simpler structure than Fibonacci or pairing heaps but faster merges than standard binary heaps. The leftist heap is a sweet spot: fast merges, simple code, and still supports all key heap operations.</p>
<p>Goal: Design a heap that keeps its shortest subtree on the right, so recursive merges stay logarithmic.</p>
</section>
<section id="how-does-it-work-plain-language-29" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-29">How Does It Work (Plain Language)?</h4>
<p>Each node stores:</p>
<ul>
<li><code>key</code> – value used for ordering</li>
<li><code>left</code>, <code>right</code> – child pointers</li>
<li><code>npl</code> – null path length (distance to nearest null)</li>
</ul>
<p>Rules:</p>
<ol type="1">
<li>Heap order: parent key ≤ child keys (min-heap)</li>
<li>Leftist property: <code>npl(left) ≥ npl(right)</code></li>
</ol>
<p>Merge(a, b):</p>
<ol type="1">
<li>If one is null, return the other.</li>
<li>Compare roots, smaller root becomes new root.</li>
<li>Recursively merge <code>a.right</code> and <code>b</code>.</li>
<li>After merge, swap children if needed to keep leftist property.</li>
<li>Update <code>npl</code>.</li>
</ol>
<p>Other operations via merge</p>
<ul>
<li>Insert(x): merge heap with single-node heap <code>x</code>.</li>
<li>DeleteMin(): merge left and right subtrees of root.</li>
</ul>
<p>Example (Min-Heap Merge)</p>
<p>Heap A: root 3</p>
<pre><code>   3
  / \
 5   9</code></pre>
<p>Heap B: root 4</p>
<pre><code>  4
 / \
 8  10</code></pre>
<p>Merge(3, 4):</p>
<ul>
<li>3 &lt; 4 → new root 3</li>
<li>Merge right(9) with heap 4</li>
<li>After merge:</li>
</ul>
<pre><code>     3
    / \
   5   4
      / \
     8  10
        /
       9</code></pre>
<p>Rebalance by swapping if right’s npl &gt; left’s → ensures leftist shape.</p>
</section>
<section id="tiny-code-easy-versions-27" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-27">Tiny Code (Easy Versions)</h4>
<p>C (Merge, Insert, Delete-Min)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">;</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> npl<span class="op">;</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">;</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> make_node<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>npl <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>left <span class="op">=</span> n<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> npl<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> x <span class="op">?</span> x<span class="op">-&gt;</span>npl <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> merge<span class="op">(</span>Node<span class="op">*</span> a<span class="op">,</span> Node<span class="op">*</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>a<span class="op">)</span> <span class="cf">return</span> b<span class="op">;</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>b<span class="op">)</span> <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b<span class="op">-&gt;</span>key <span class="op">&lt;</span> a<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span> Node<span class="op">*</span> t <span class="op">=</span> a<span class="op">;</span> a <span class="op">=</span> b<span class="op">;</span> b <span class="op">=</span> t<span class="op">;</span> <span class="op">}</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>right <span class="op">=</span> merge<span class="op">(</span>a<span class="op">-&gt;</span>right<span class="op">,</span> b<span class="op">);</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// maintain leftist property</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>npl<span class="op">(</span>a<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">&lt;</span> npl<span class="op">(</span>a<span class="op">-&gt;</span>right<span class="op">))</span> <span class="op">{</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>        Node<span class="op">*</span> t <span class="op">=</span> a<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>        a<span class="op">-&gt;</span>left <span class="op">=</span> a<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>        a<span class="op">-&gt;</span>right <span class="op">=</span> t<span class="op">;</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>npl <span class="op">=</span> npl<span class="op">(</span>a<span class="op">-&gt;</span>right<span class="op">)</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert<span class="op">(</span>Node<span class="op">*</span> h<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merge<span class="op">(</span>h<span class="op">,</span> make_node<span class="op">(</span>key<span class="op">));</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> delete_min<span class="op">(</span>Node<span class="op">*</span> h<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>h<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> h<span class="op">-&gt;</span>key<span class="op">;</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> new_root <span class="op">=</span> merge<span class="op">(</span>h<span class="op">-&gt;</span>left<span class="op">,</span> h<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>h<span class="op">);</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_root<span class="op">;</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> h1 <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> vals<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">4</span><span class="op">};</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>        h1 <span class="op">=</span> insert<span class="op">(</span>h1<span class="op">,</span> vals<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> m<span class="op">;</span></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>    h1 <span class="op">=</span> delete_min<span class="op">(</span>h1<span class="op">,</span> <span class="op">&amp;</span>m<span class="op">);</span></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Deleted min: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> m<span class="op">);</span></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">__slots__</span> <span class="op">=</span> (<span class="st">"key"</span>, <span class="st">"npl"</span>, <span class="st">"left"</span>, <span class="st">"right"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.npl <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">None</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> npl(x): <span class="cf">return</span> x.npl <span class="cf">if</span> x <span class="cf">else</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge(a, b):</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> a: <span class="cf">return</span> b</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> b: <span class="cf">return</span> a</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> b.key <span class="op">&lt;</span> a.key:</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> b, a</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    a.right <span class="op">=</span> merge(a.right, b)</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># enforce leftist property</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> npl(a.left) <span class="op">&lt;</span> npl(a.right):</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>        a.left, a.right <span class="op">=</span> a.right, a.left</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    a.npl <span class="op">=</span> npl(a.right) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(h, key):</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merge(h, Node(key))</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> delete_min(h):</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> h: <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> h.key</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> merge(h.left, h.right)</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> m, h</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="va">None</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">9</span>, <span class="dv">7</span>, <span class="dv">4</span>]:</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> insert(h, x)</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>m, h <span class="op">=</span> delete_min(h)</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Deleted min:"</span>, m)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-29" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-29">Why It Matters</h4>
<ul>
<li>Fast merge with simple recursion</li>
<li>Ideal for priority queues with frequent unions</li>
<li>Cleaner implementation than Fibonacci heaps</li>
<li>Guarantees logarithmic merge and delete-min</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-29" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-29">A Gentle Proof (Why It Works)</h4>
<p>The null path length (npl) ensures that the right spine is always the shortest. Therefore, each merge step recurses down only one right path, not both. This bounds recursion depth by O(log n). Every other operation (insert, delete-min) is defined as a small number of merges, hence O(log n).</p>
</section>
<section id="try-it-yourself-29" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-29">Try It Yourself</h4>
<ol type="1">
<li>Trace the merge process for two 3-node heaps.</li>
<li>Visualize <code>npl</code> values after each step.</li>
<li>Implement <code>find_min()</code> (just return root key).</li>
<li>Try making a max-heap variant by flipping comparisons.</li>
</ol>
</section>
<section id="test-cases-29" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-29">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 21%">
<col style="width: 16%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Output</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>[5,3,9,7,4]</td>
<td>root=3</td>
<td>min-heap property holds</td>
</tr>
<tr class="even">
<td>DeleteMin</td>
<td>remove 3</td>
<td>new root=4</td>
<td>leftist property maintained</td>
</tr>
<tr class="odd">
<td>Merge</td>
<td>[3,5] + [4,6]</td>
<td>root=3</td>
<td>right spine ≤ log n</td>
</tr>
<tr class="even">
<td>Empty merge</td>
<td>None + [5]</td>
<td>[5]</td>
<td>safe</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Merge with null heap → returns the other</li>
<li>Duplicate keys → ties fine</li>
<li>Single node → npl = 0</li>
</ul>
</section>
<section id="complexity-29" class="level4">
<h4 class="anchored" data-anchor-id="complexity-29">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Merge</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Insert</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>DeleteMin</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>FindMin</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>The leftist heap is like a river always bending toward the left, shaping itself so merges flow swiftly and naturally.</p>
</section>
</section>
</section>
<section id="section-24.-balanced-trees" class="level2">
<h2 class="anchored" data-anchor-id="section-24.-balanced-trees">Section 24. Balanced Trees</h2>
<section id="avl-tree-insert" class="level3">
<h3 class="anchored" data-anchor-id="avl-tree-insert">231 AVL Tree Insert</h3>
<p>An AVL tree is a self-balancing binary search tree where the height difference (balance factor) between the left and right subtrees of any node is at most 1. This invariant guarantees O(log n) lookup, insertion, and deletion, making AVL trees a classic example of maintaining order dynamically.</p>
<section id="what-problem-are-we-solving-30" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-30">What Problem Are We Solving?</h4>
<p>Ordinary binary search trees can become skewed (like linked lists) after unlucky insertions, degrading performance to O(n). The AVL tree restores balance automatically after each insertion, ensuring searches and updates stay fast.</p>
<p>Goal: Maintain a balanced search tree by rotating nodes after insertions so that height difference ≤ 1 everywhere.</p>
</section>
<section id="how-does-it-work-plain-language-30" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-30">How Does It Work (Plain Language)?</h4>
<ol type="1">
<li>Insert the key as in a normal BST.</li>
<li>Walk back up the recursion updating heights.</li>
<li>Check balance factor = <code>height(left) - height(right)</code>.</li>
<li>If it’s outside {−1, 0, +1}, perform one of four rotations to restore balance:</li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 40%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th>Case</th>
<th>Pattern</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Left-Left (LL)</td>
<td>Inserted into left-left subtree</td>
<td>Rotate right</td>
</tr>
<tr class="even">
<td>Right-Right (RR)</td>
<td>Inserted into right-right subtree</td>
<td>Rotate left</td>
</tr>
<tr class="odd">
<td>Left-Right (LR)</td>
<td>Inserted into left-right subtree</td>
<td>Rotate left at child, then right</td>
</tr>
<tr class="even">
<td>Right-Left (RL)</td>
<td>Inserted into right-left subtree</td>
<td>Rotate right at child, then left</td>
</tr>
</tbody>
</table>
<p>Example</p>
<p>Insert 30, 20, 10</p>
<ul>
<li>30 → root</li>
<li>20 → left of 30</li>
<li>10 → left of 20 → imbalance at 30: balance factor = 2 → LL case → right rotate on 30</li>
</ul>
<p>Balanced tree:</p>
<pre><code>     20
    /  \
   10   30</code></pre>
</section>
<section id="step-by-step-example" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-example">Step-by-Step Example</h4>
<p>Insert sequence: 10, 20, 30, 40, 50</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 29%">
<col style="width: 18%">
<col style="width: 14%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Insert</th>
<th>Tree (in-order)</th>
<th>Imbalance</th>
<th>Rotation</th>
<th>Root After</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>10</td>
<td>[10]</td>
<td>-</td>
<td>-</td>
<td>10</td>
</tr>
<tr class="even">
<td>2</td>
<td>20</td>
<td>[10,20]</td>
<td>balanced</td>
<td>-</td>
<td>10</td>
</tr>
<tr class="odd">
<td>3</td>
<td>30</td>
<td>[10,20,30]</td>
<td>at 10 (RR)</td>
<td>left</td>
<td>20</td>
</tr>
<tr class="even">
<td>4</td>
<td>40</td>
<td>[10,20,30,40]</td>
<td>balanced</td>
<td>-</td>
<td>20</td>
</tr>
<tr class="odd">
<td>5</td>
<td>50</td>
<td>[10,20,30,40,50]</td>
<td>at 20 (RR)</td>
<td>left</td>
<td>30</td>
</tr>
</tbody>
</table>
<p>Balanced final tree:</p>
<pre><code>     30
    /  \
   20   40
  /       \
 10        50</code></pre>
</section>
<section id="tiny-code-easy-versions-28" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-28">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">,</span> height<span class="op">;</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">;</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> height<span class="op">(</span>Node<span class="op">*</span> n<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">?</span> n<span class="op">-&gt;</span>height <span class="op">:</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> max<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">&gt;</span> b <span class="op">?</span> a <span class="op">:</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> new_node<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>left <span class="op">=</span> n<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_right<span class="op">(</span>Node<span class="op">*</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> x <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> T2 <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> T2<span class="op">;</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>y<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>y<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>x<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>x<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_left<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> y <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> T2 <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> T2<span class="op">;</span></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>x<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>x<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>y<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>y<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y<span class="op">;</span></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> balance<span class="op">(</span>Node<span class="op">*</span> n<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">?</span> height<span class="op">(</span>n<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">-</span> height<span class="op">(</span>n<span class="op">-&gt;</span>right<span class="op">)</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert<span class="op">(</span>Node<span class="op">*</span> node<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>node<span class="op">)</span> <span class="cf">return</span> new_node<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> node<span class="op">-&gt;</span>key<span class="op">)</span> node<span class="op">-&gt;</span>left <span class="op">=</span> insert<span class="op">(</span>node<span class="op">-&gt;</span>left<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>key <span class="op">&gt;</span> node<span class="op">-&gt;</span>key<span class="op">)</span> node<span class="op">-&gt;</span>right <span class="op">=</span> insert<span class="op">(</span>node<span class="op">-&gt;</span>right<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">return</span> node<span class="op">;</span> <span class="co">// no duplicates</span></span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>node<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>node<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> bf <span class="op">=</span> balance<span class="op">(</span>node<span class="op">);</span></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// LL</span></span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> key <span class="op">&lt;</span> node<span class="op">-&gt;</span>left<span class="op">-&gt;</span>key<span class="op">)</span></span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_right<span class="op">(</span>node<span class="op">);</span></span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">// RR</span></span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&amp;&amp;</span> key <span class="op">&gt;</span> node<span class="op">-&gt;</span>right<span class="op">-&gt;</span>key<span class="op">)</span></span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_left<span class="op">(</span>node<span class="op">);</span></span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// LR</span></span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> key <span class="op">&gt;</span> node<span class="op">-&gt;</span>left<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>left <span class="op">=</span> rotate_left<span class="op">(</span>node<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_right<span class="op">(</span>node<span class="op">);</span></span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb68-62"><a href="#cb68-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">// RL</span></span>
<span id="cb68-63"><a href="#cb68-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&amp;&amp;</span> key <span class="op">&lt;</span> node<span class="op">-&gt;</span>right<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-64"><a href="#cb68-64" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>right <span class="op">=</span> rotate_right<span class="op">(</span>node<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb68-65"><a href="#cb68-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_left<span class="op">(</span>node<span class="op">);</span></span>
<span id="cb68-66"><a href="#cb68-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb68-67"><a href="#cb68-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> node<span class="op">;</span></span>
<span id="cb68-68"><a href="#cb68-68" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb68-69"><a href="#cb68-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-70"><a href="#cb68-70" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> inorder<span class="op">(</span>Node<span class="op">*</span> root<span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-71"><a href="#cb68-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb68-72"><a href="#cb68-72" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb68-73"><a href="#cb68-73" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> root<span class="op">-&gt;</span>key<span class="op">);</span></span>
<span id="cb68-74"><a href="#cb68-74" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb68-75"><a href="#cb68-75" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb68-76"><a href="#cb68-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-77"><a href="#cb68-77" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-78"><a href="#cb68-78" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> root <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb68-79"><a href="#cb68-79" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> keys<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">};</span></span>
<span id="cb68-80"><a href="#cb68-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb68-81"><a href="#cb68-81" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> insert<span class="op">(</span>root<span class="op">,</span> keys<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb68-82"><a href="#cb68-82" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb68-83"><a href="#cb68-83" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb68-84"><a href="#cb68-84" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.height <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> height(n): <span class="cf">return</span> n.height <span class="cf">if</span> n <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> balance(n): <span class="cf">return</span> height(n.left) <span class="op">-</span> height(n.right) <span class="cf">if</span> n <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_right(y):</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    x, T2 <span class="op">=</span> y.left, y.left.right</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    x.right, y.left <span class="op">=</span> y, T2</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    y.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(y.left), height(y.right))</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    x.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(x.left), height(x.right))</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_left(x):</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    y, T2 <span class="op">=</span> x.right, x.right.left</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>    y.left, x.right <span class="op">=</span> x, T2</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    x.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(x.left), height(x.right))</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    y.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(y.left), height(y.right))</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(node, key):</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> node: <span class="cf">return</span> Node(key)</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> key <span class="op">&lt;</span> node.key: node.left <span class="op">=</span> insert(node.left, key)</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> key <span class="op">&gt;</span> node.key: node.right <span class="op">=</span> insert(node.right, key)</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: <span class="cf">return</span> node</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>    node.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(node.left), height(node.right))</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    bf <span class="op">=</span> balance(node)</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> key <span class="op">&lt;</span> node.left.key:  <span class="co"># LL</span></span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_right(node)</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> key <span class="op">&gt;</span> node.right.key:  <span class="co"># RR</span></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_left(node)</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> key <span class="op">&gt;</span> node.left.key:  <span class="co"># LR</span></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>        node.left <span class="op">=</span> rotate_left(node.left)</span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_right(node)</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> key <span class="op">&lt;</span> node.right.key:  <span class="co"># RL</span></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>        node.right <span class="op">=</span> rotate_right(node.right)</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_left(node)</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> node</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inorder(root):</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root: <span class="cf">return</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>    inorder(root.left)</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(root.key, end<span class="op">=</span><span class="st">' '</span>)</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>    inorder(root.right)</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>]:</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> insert(root, k)</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>inorder(root)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-30" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-30">Why It Matters</h4>
<ul>
<li>Guarantees O(log n) operations</li>
<li>Prevents degeneration into linear chains</li>
<li>Clear rotation-based balancing logic</li>
<li>Basis for other balanced trees (e.g., Red-Black)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-30" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-30">A Gentle Proof (Why It Works)</h4>
<p>Each insertion may unbalance at most one node, the lowest ancestor of the inserted node. A single rotation (or double rotation) restores the balance factor of that node to {−1, 0, +1}, and updates all affected heights in constant time. Thus each insertion performs O(1) rotations, O(log n) recursive updates.</p>
</section>
<section id="try-it-yourself-30" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-30">Try It Yourself</h4>
<ol type="1">
<li>Insert 30, 20, 10 → LL case</li>
<li>Insert 10, 30, 20 → LR case</li>
<li>Insert 30, 10, 20 → RL case</li>
<li>Insert 10, 20, 30 → RR case</li>
<li>Draw each tree before and after rotation</li>
</ol>
</section>
<section id="test-cases-30" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-30">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Sequence</th>
<th>Rotation Type</th>
<th>Final Root</th>
<th>Height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[30, 20, 10]</td>
<td>LL</td>
<td>20</td>
<td>2</td>
</tr>
<tr class="even">
<td>[10, 30, 20]</td>
<td>LR</td>
<td>20</td>
<td>2</td>
</tr>
<tr class="odd">
<td>[30, 10, 20]</td>
<td>RL</td>
<td>20</td>
<td>2</td>
</tr>
<tr class="even">
<td>[10, 20, 30]</td>
<td>RR</td>
<td>20</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Duplicate keys ignored</li>
<li>Insertion into empty tree → new node</li>
<li>All ascending or descending inserts → balanced via rotations</li>
</ul>
</section>
<section id="complexity-30" class="level4">
<h4 class="anchored" data-anchor-id="complexity-30">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(log n)</td>
<td>O(h) recursion</td>
</tr>
<tr class="even">
<td>Search</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
</tbody>
</table>
<p>The AVL tree is a careful gardener, pruning imbalance wherever it grows, so your searches always find a straight path.</p>
</section>
</section>
<section id="avl-tree-delete" class="level3">
<h3 class="anchored" data-anchor-id="avl-tree-delete">232 AVL Tree Delete</h3>
<p>Deleting a node in an AVL tree is like removing a block from a carefully balanced tower, you take it out, then perform rotations to restore equilibrium. The key is to combine BST deletion rules with balance factor checks and rebalancing up the path.</p>
<section id="what-problem-are-we-solving-31" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-31">What Problem Are We Solving?</h4>
<p>Deletion in a plain BST can break the shape, making it skewed and inefficient. In an AVL tree, we want to:</p>
<ol type="1">
<li>Remove a node (using standard BST deletion)</li>
<li>Recalculate heights and balance factors</li>
<li>Restore balance with rotations</li>
</ol>
<p>This ensures the tree remains height-balanced, keeping operations at O(log n).</p>
</section>
<section id="how-does-it-work-plain-language-31" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-31">How Does It Work (Plain Language)?</h4>
<ol type="1">
<li><p>Find the node as in a normal BST.</p></li>
<li><p>Delete it:</p>
<ul>
<li>If leaf → remove directly.</li>
<li>If one child → replace with child.</li>
<li>If two children → find inorder successor, copy its value, delete it recursively.</li>
</ul></li>
<li><p>Walk upward, update height and balance factor at each ancestor.</p></li>
<li><p>Apply one of four rotation cases if unbalanced:</p></li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 49%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Case</th>
<th>Condition</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>LL</td>
<td>balance &gt; 1 and balance(left) ≥ 0</td>
<td>Rotate right</td>
</tr>
<tr class="even">
<td>LR</td>
<td>balance &gt; 1 and balance(left) &lt; 0</td>
<td>Rotate left at child, then right</td>
</tr>
<tr class="odd">
<td>RR</td>
<td>balance &lt; -1 and balance(right) ≤ 0</td>
<td>Rotate left</td>
</tr>
<tr class="even">
<td>RL</td>
<td>balance &lt; -1 and balance(right) &gt; 0</td>
<td>Rotate right at child, then left</td>
</tr>
</tbody>
</table>
</section>
<section id="example" class="level4">
<h4 class="anchored" data-anchor-id="example">Example</h4>
<p>Delete 10 from</p>
<pre><code>     20
    /  \
   10   30</code></pre>
<ul>
<li>Remove leaf 10</li>
<li>Node 20: balance = 0 → balanced</li>
</ul>
<p>Now delete 30:</p>
<pre><code>    20
   /
 10</code></pre>
<ul>
<li>balance(20) = +1 → still balanced</li>
</ul>
<p>Delete 10 next:</p>
<pre><code>20</code></pre>
<p>Tree becomes single node, still AVL.</p>
</section>
<section id="step-by-step-example-1" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-example-1">Step-by-Step Example</h4>
<p>Insert [10, 20, 30, 40, 50, 25] Then delete 40</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Action</th>
<th>Imbalance</th>
<th>Rotation</th>
<th>Root</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Delete 40</td>
<td>at 30 (balance = -2)</td>
<td>RL</td>
<td>30</td>
</tr>
<tr class="even">
<td>2</td>
<td>After rotate</td>
<td>balanced</td>
<td>-</td>
<td>30</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-29" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-29">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb73"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">,</span> height<span class="op">;</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">;</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> height<span class="op">(</span>Node<span class="op">*</span> n<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">?</span> n<span class="op">-&gt;</span>height <span class="op">:</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> max<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">&gt;</span> b <span class="op">?</span> a <span class="op">:</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> new_node<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span> n<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>left <span class="op">=</span> n<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_right<span class="op">(</span>Node<span class="op">*</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> x <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> T2 <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> T2<span class="op">;</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>y<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>y<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>x<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>x<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_left<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> y <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> T2 <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> T2<span class="op">;</span></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>x<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>x<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>y<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>y<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y<span class="op">;</span></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> balance<span class="op">(</span>Node<span class="op">*</span> n<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">?</span> height<span class="op">(</span>n<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">-</span> height<span class="op">(</span>n<span class="op">-&gt;</span>right<span class="op">)</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> min_node<span class="op">(</span>Node<span class="op">*</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> cur <span class="op">=</span> n<span class="op">;</span></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>cur<span class="op">-&gt;</span>left<span class="op">)</span> cur <span class="op">=</span> cur<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cur<span class="op">;</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> new_node<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> root<span class="op">-&gt;</span>left <span class="op">=</span> insert<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>key <span class="op">&gt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> root<span class="op">-&gt;</span>right <span class="op">=</span> insert<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a>    root<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> bf <span class="op">=</span> balance<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Rebalance</span></span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> key <span class="op">&lt;</span> root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>key<span class="op">)</span> <span class="cf">return</span> rotate_right<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&amp;&amp;</span> key <span class="op">&gt;</span> root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>key<span class="op">)</span> <span class="cf">return</span> rotate_left<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> key <span class="op">&gt;</span> root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>left <span class="op">=</span> rotate_left<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_right<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&amp;&amp;</span> key <span class="op">&lt;</span> root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>right <span class="op">=</span> rotate_right<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_left<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-70"><a href="#cb73-70" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> delete<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-71"><a href="#cb73-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb73-72"><a href="#cb73-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-73"><a href="#cb73-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> root<span class="op">-&gt;</span>left <span class="op">=</span> delete<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb73-74"><a href="#cb73-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>key <span class="op">&gt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> root<span class="op">-&gt;</span>right <span class="op">=</span> delete<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb73-75"><a href="#cb73-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb73-76"><a href="#cb73-76" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Node with one or no child</span></span>
<span id="cb73-77"><a href="#cb73-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>root<span class="op">-&gt;</span>left <span class="op">||</span> <span class="op">!</span>root<span class="op">-&gt;</span>right<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-78"><a href="#cb73-78" aria-hidden="true" tabindex="-1"></a>            Node<span class="op">*</span> tmp <span class="op">=</span> root<span class="op">-&gt;</span>left <span class="op">?</span> root<span class="op">-&gt;</span>left <span class="op">:</span> root<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb73-79"><a href="#cb73-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>tmp<span class="op">)</span> <span class="op">{</span> tmp <span class="op">=</span> root<span class="op">;</span> root <span class="op">=</span> NULL<span class="op">;</span> <span class="op">}</span></span>
<span id="cb73-80"><a href="#cb73-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="op">*</span>root <span class="op">=</span> <span class="op">*</span>tmp<span class="op">;</span></span>
<span id="cb73-81"><a href="#cb73-81" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>tmp<span class="op">);</span></span>
<span id="cb73-82"><a href="#cb73-82" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb73-83"><a href="#cb73-83" aria-hidden="true" tabindex="-1"></a>            Node<span class="op">*</span> tmp <span class="op">=</span> min_node<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb73-84"><a href="#cb73-84" aria-hidden="true" tabindex="-1"></a>            root<span class="op">-&gt;</span>key <span class="op">=</span> tmp<span class="op">-&gt;</span>key<span class="op">;</span></span>
<span id="cb73-85"><a href="#cb73-85" aria-hidden="true" tabindex="-1"></a>            root<span class="op">-&gt;</span>right <span class="op">=</span> delete<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">,</span> tmp<span class="op">-&gt;</span>key<span class="op">);</span></span>
<span id="cb73-86"><a href="#cb73-86" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb73-87"><a href="#cb73-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb73-88"><a href="#cb73-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb73-89"><a href="#cb73-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-90"><a href="#cb73-90" aria-hidden="true" tabindex="-1"></a>    root<span class="op">-&gt;</span>height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>height<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">),</span> height<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">));</span></span>
<span id="cb73-91"><a href="#cb73-91" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> bf <span class="op">=</span> balance<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-92"><a href="#cb73-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-93"><a href="#cb73-93" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Rebalance</span></span>
<span id="cb73-94"><a href="#cb73-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> balance<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb73-95"><a href="#cb73-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_right<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-96"><a href="#cb73-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> balance<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-97"><a href="#cb73-97" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>left <span class="op">=</span> rotate_left<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb73-98"><a href="#cb73-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_right<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-99"><a href="#cb73-99" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb73-100"><a href="#cb73-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&amp;&amp;</span> balance<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">)</span> <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb73-101"><a href="#cb73-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_left<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-102"><a href="#cb73-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&amp;&amp;</span> balance<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-103"><a href="#cb73-103" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>right <span class="op">=</span> rotate_right<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb73-104"><a href="#cb73-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_left<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-105"><a href="#cb73-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb73-106"><a href="#cb73-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb73-107"><a href="#cb73-107" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb73-108"><a href="#cb73-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-109"><a href="#cb73-109" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> inorder<span class="op">(</span>Node<span class="op">*</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-110"><a href="#cb73-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>r<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb73-111"><a href="#cb73-111" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>r<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb73-112"><a href="#cb73-112" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> r<span class="op">-&gt;</span>key<span class="op">);</span></span>
<span id="cb73-113"><a href="#cb73-113" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>r<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb73-114"><a href="#cb73-114" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb73-115"><a href="#cb73-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-116"><a href="#cb73-116" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-117"><a href="#cb73-117" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> root <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb73-118"><a href="#cb73-118" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> keys<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">25</span><span class="op">};</span></span>
<span id="cb73-119"><a href="#cb73-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">6</span><span class="op">;</span> i<span class="op">++)</span> root <span class="op">=</span> insert<span class="op">(</span>root<span class="op">,</span> keys<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb73-120"><a href="#cb73-120" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> delete<span class="op">(</span>root<span class="op">,</span> <span class="dv">40</span><span class="op">);</span></span>
<span id="cb73-121"><a href="#cb73-121" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb73-122"><a href="#cb73-122" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb73-123"><a href="#cb73-123" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.height <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> height(n): <span class="cf">return</span> n.height <span class="cf">if</span> n <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> balance(n): <span class="cf">return</span> height(n.left) <span class="op">-</span> height(n.right) <span class="cf">if</span> n <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_right(y):</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    x, T2 <span class="op">=</span> y.left, y.left.right</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    x.right, y.left <span class="op">=</span> y, T2</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    y.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(y.left), height(y.right))</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    x.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(x.left), height(x.right))</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_left(x):</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    y, T2 <span class="op">=</span> x.right, x.right.left</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    y.left, x.right <span class="op">=</span> x, T2</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    x.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(x.left), height(x.right))</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>    y.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(y.left), height(y.right))</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_node(n):</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> n.left: n <span class="op">=</span> n.left</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(r, k):</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> r: <span class="cf">return</span> Node(k)</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> k <span class="op">&lt;</span> r.key: r.left <span class="op">=</span> insert(r.left, k)</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> k <span class="op">&gt;</span> r.key: r.right <span class="op">=</span> insert(r.right, k)</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: <span class="cf">return</span> r</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>    r.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(r.left), height(r.right))</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>    bf <span class="op">=</span> balance(r)</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> k <span class="op">&lt;</span> r.left.key: <span class="cf">return</span> rotate_right(r)</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> k <span class="op">&gt;</span> r.right.key: <span class="cf">return</span> rotate_left(r)</span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> k <span class="op">&gt;</span> r.left.key:</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>        r.left <span class="op">=</span> rotate_left(r.left)<span class="op">;</span> <span class="cf">return</span> rotate_right(r)</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> k <span class="op">&lt;</span> r.right.key:</span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>        r.right <span class="op">=</span> rotate_right(r.right)<span class="op">;</span> <span class="cf">return</span> rotate_left(r)</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> delete(r, k):</span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> r: <span class="cf">return</span> r</span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> k <span class="op">&lt;</span> r.key: r.left <span class="op">=</span> delete(r.left, k)</span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> k <span class="op">&gt;</span> r.key: r.right <span class="op">=</span> delete(r.right, k)</span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> r.left: <span class="cf">return</span> r.right</span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="kw">not</span> r.right: <span class="cf">return</span> r.left</span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> min_node(r.right)</span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a>        r.key <span class="op">=</span> temp.key</span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a>        r.right <span class="op">=</span> delete(r.right, temp.key)</span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a>    r.height <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">max</span>(height(r.left), height(r.right))</span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a>    bf <span class="op">=</span> balance(r)</span>
<span id="cb74-55"><a href="#cb74-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> balance(r.left) <span class="op">&gt;=</span> <span class="dv">0</span>: <span class="cf">return</span> rotate_right(r)</span>
<span id="cb74-56"><a href="#cb74-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> balance(r.left) <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb74-57"><a href="#cb74-57" aria-hidden="true" tabindex="-1"></a>        r.left <span class="op">=</span> rotate_left(r.left)<span class="op">;</span> <span class="cf">return</span> rotate_right(r)</span>
<span id="cb74-58"><a href="#cb74-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> balance(r.right) <span class="op">&lt;=</span> <span class="dv">0</span>: <span class="cf">return</span> rotate_left(r)</span>
<span id="cb74-59"><a href="#cb74-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bf <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> balance(r.right) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb74-60"><a href="#cb74-60" aria-hidden="true" tabindex="-1"></a>        r.right <span class="op">=</span> rotate_right(r.right)<span class="op">;</span> <span class="cf">return</span> rotate_left(r)</span>
<span id="cb74-61"><a href="#cb74-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r</span>
<span id="cb74-62"><a href="#cb74-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-63"><a href="#cb74-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inorder(r):</span>
<span id="cb74-64"><a href="#cb74-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> r: <span class="cf">return</span></span>
<span id="cb74-65"><a href="#cb74-65" aria-hidden="true" tabindex="-1"></a>    inorder(r.left)<span class="op">;</span> <span class="bu">print</span>(r.key, end<span class="op">=</span><span class="st">' '</span>)<span class="op">;</span> inorder(r.right)</span>
<span id="cb74-66"><a href="#cb74-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-67"><a href="#cb74-67" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb74-68"><a href="#cb74-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">25</span>]:</span>
<span id="cb74-69"><a href="#cb74-69" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> insert(root, k)</span>
<span id="cb74-70"><a href="#cb74-70" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> delete(root, <span class="dv">40</span>)</span>
<span id="cb74-71"><a href="#cb74-71" aria-hidden="true" tabindex="-1"></a>inorder(root)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-31" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-31">Why It Matters</h4>
<ul>
<li>Keeps search, insert, delete all O(log n)</li>
<li>Auto-rebalances after removal</li>
<li>Shows how rotations maintain structure consistency</li>
<li>Foundation for all balanced trees (like Red-Black, AVL variants)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-31" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-31">A Gentle Proof (Why It Works)</h4>
<p>Every deletion changes subtree height by at most 1. Each ancestor’s balance factor is recomputed; if imbalance found, a single rotation (or double rotation) restores balance. At most O(log n) nodes are visited, and each fix is O(1).</p>
</section>
<section id="try-it-yourself-31" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-31">Try It Yourself</h4>
<ol type="1">
<li>Build [10, 20, 30, 40, 50, 25], then delete 50</li>
<li>Observe RR rotation at 30</li>
<li>Delete 10, check rebalancing at 20</li>
<li>Delete all sequentially, confirm sorted order</li>
</ol>
</section>
<section id="test-cases-31" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-31">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Insert Sequence</th>
<th>Delete</th>
<th>Rotation</th>
<th>Root After</th>
<th>Balanced</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[10,20,30,40,50,25]</td>
<td>40</td>
<td>RL</td>
<td>30</td>
<td>✅</td>
</tr>
<tr class="even">
<td>[10,20,30]</td>
<td>10</td>
<td>RR</td>
<td>20</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>[30,20,10]</td>
<td>30</td>
<td>LL</td>
<td>20</td>
<td>✅</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Deleting from empty tree → safe</li>
<li>Single node → becomes NULL</li>
<li>Duplicate keys → ignored</li>
</ul>
</section>
<section id="complexity-31" class="level4">
<h4 class="anchored" data-anchor-id="complexity-31">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Delete</td>
<td>O(log n)</td>
<td>O(h) recursion</td>
</tr>
<tr class="even">
<td>Search</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
<tr class="odd">
<td>Insert</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
</tbody>
</table>
<p>An AVL deletion is a gentle art, remove the key, rebalance the branches, and harmony is restored.</p>
</section>
</section>
<section id="red-black-tree-insert" class="level3">
<h3 class="anchored" data-anchor-id="red-black-tree-insert">233 Red-Black Tree Insert</h3>
<p>A Red-Black Tree (RBT) is a self-balancing binary search tree that uses color bits (red or black) to control balance indirectly. Unlike AVL trees that balance by height, RBTs balance by color rules, allowing more flexible, faster insertions with fewer rotations.</p>
<section id="what-problem-are-we-solving-32" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-32">What Problem Are We Solving?</h4>
<p>A plain BST can degrade into a linked list with O(n) operations. An RBT maintains a near-balanced height, ensuring O(log n) for search, insert, and delete. Instead of exact height balance like AVL, RBTs enforce color invariants that keep paths roughly equal.</p>
</section>
<section id="red-black-tree-properties" class="level4">
<h4 class="anchored" data-anchor-id="red-black-tree-properties">Red-Black Tree Properties</h4>
<ol type="1">
<li>Each node is red or black.</li>
<li>The root is always black.</li>
<li>Null (NIL) nodes are considered black.</li>
<li>No two consecutive red nodes (no red parent with red child).</li>
<li>Every path from a node to its descendant NIL nodes has the same number of black nodes.</li>
</ol>
<p>These rules guarantee height ≤ 2 × log₂(n + 1).</p>
</section>
<section id="how-does-it-work-plain-language-32" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-32">How Does It Work (Plain Language)?</h4>
<ol type="1">
<li>Insert node like in a normal BST (color it red).</li>
<li>Fix violations if any property breaks.</li>
<li>Use rotations and recoloring based on where the red node appears.</li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 44%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th>Case</th>
<th>Condition</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Case 1</td>
<td>New node is root</td>
<td>Recolor black</td>
</tr>
<tr class="even">
<td>Case 2</td>
<td>Parent black</td>
<td>No fix needed</td>
</tr>
<tr class="odd">
<td>Case 3</td>
<td>Parent red, Uncle red</td>
<td>Recolor parent &amp; uncle black, grandparent red</td>
</tr>
<tr class="even">
<td>Case 4</td>
<td>Parent red, Uncle black, Triangle (LR/RL)</td>
<td>Rotate to line up</td>
</tr>
<tr class="odd">
<td>Case 5</td>
<td>Parent red, Uncle black, Line (LL/RR)</td>
<td>Rotate and recolor grandparent</td>
</tr>
</tbody>
</table>
</section>
<section id="example-1" class="level4">
<h4 class="anchored" data-anchor-id="example-1">Example</h4>
<p>Insert sequence: 10, 20, 30</p>
<ol type="1">
<li>Insert 10 → root → black</li>
<li>Insert 20 → red child → balanced</li>
<li>Insert 30 → red parent (20) → Case 5 (RR) → rotate left on 10 → recolor root black, children red</li>
</ol>
<p>Result:</p>
<pre><code>    20(B)
   /    \
10(R)   30(R)</code></pre>
</section>
<section id="step-by-step-example-2" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-example-2">Step-by-Step Example</h4>
<p>Insert [7, 3, 18, 10, 22, 8, 11, 26]</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 47%">
<col style="width: 28%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Insert</th>
<th>Violation</th>
<th>Fix</th>
<th>Root</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>7</td>
<td>root</td>
<td>make black</td>
<td>7(B)</td>
</tr>
<tr class="even">
<td>2</td>
<td>3</td>
<td>parent black</td>
<td>none</td>
<td>7(B)</td>
</tr>
<tr class="odd">
<td>3</td>
<td>18</td>
<td>parent black</td>
<td>none</td>
<td>7(B)</td>
</tr>
<tr class="even">
<td>4</td>
<td>10</td>
<td>parent red, uncle red</td>
<td>recolor, move up</td>
<td>7(B)</td>
</tr>
<tr class="odd">
<td>5</td>
<td>22</td>
<td>parent black</td>
<td>none</td>
<td>7(B)</td>
</tr>
<tr class="even">
<td>6</td>
<td>8</td>
<td>parent red, uncle red</td>
<td>recolor</td>
<td>7(B)</td>
</tr>
<tr class="odd">
<td>7</td>
<td>11</td>
<td>parent red, uncle black, LR</td>
<td>rotate + recolor</td>
<td>7(B)</td>
</tr>
<tr class="even">
<td>8</td>
<td>26</td>
<td>parent black</td>
<td>none</td>
<td>7(B)</td>
</tr>
</tbody>
</table>
<p>Final tree balanced by color invariants.</p>
</section>
<section id="tiny-code-easy-versions-30" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-30">Tiny Code (Easy Versions)</h4>
<p>C (Simplified)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb76"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span> RED<span class="op">,</span> BLACK <span class="op">}</span> Color<span class="op">;</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">;</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    Color color<span class="op">;</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">,</span> <span class="op">*</span>parent<span class="op">;</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> new_node<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>left <span class="op">=</span> n<span class="op">-&gt;</span>right <span class="op">=</span> n<span class="op">-&gt;</span>parent <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> rotate_left<span class="op">(</span>Node root<span class="op">,</span> Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> y <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>y<span class="op">-&gt;</span>left<span class="op">)</span> y<span class="op">-&gt;</span>left<span class="op">-&gt;</span>parent <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>parent <span class="op">=</span> x<span class="op">-&gt;</span>parent<span class="op">;</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>x<span class="op">-&gt;</span>parent<span class="op">)</span> <span class="op">*</span>root <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>left<span class="op">)</span> x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>left <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>parent <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> rotate_right<span class="op">(</span>Node root<span class="op">,</span> Node<span class="op">*</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> x <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">-&gt;</span>right<span class="op">)</span> x<span class="op">-&gt;</span>right<span class="op">-&gt;</span>parent <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>parent <span class="op">=</span> y<span class="op">-&gt;</span>parent<span class="op">;</span></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>y<span class="op">-&gt;</span>parent<span class="op">)</span> <span class="op">*</span>root <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>y <span class="op">==</span> y<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>left<span class="op">)</span> y<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> y<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>right <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>parent <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> fix_violation<span class="op">(</span>Node root<span class="op">,</span> Node<span class="op">*</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>z<span class="op">-&gt;</span>parent <span class="op">&amp;&amp;</span> z<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color <span class="op">==</span> RED<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>        Node<span class="op">*</span> gp <span class="op">=</span> z<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>parent<span class="op">;</span></span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>z<span class="op">-&gt;</span>parent <span class="op">==</span> gp<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a>            Node<span class="op">*</span> uncle <span class="op">=</span> gp<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>uncle <span class="op">&amp;&amp;</span> uncle<span class="op">-&gt;</span>color <span class="op">==</span> RED<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a>                z<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a>                uncle<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a>                gp<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a>                z <span class="op">=</span> gp<span class="op">;</span></span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>z <span class="op">==</span> z<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>right<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a>                    z <span class="op">=</span> z<span class="op">-&gt;</span>parent<span class="op">;</span></span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a>                    rotate_left<span class="op">(</span>root<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true" tabindex="-1"></a>                z<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true" tabindex="-1"></a>                gp<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true" tabindex="-1"></a>                rotate_right<span class="op">(</span>root<span class="op">,</span> gp<span class="op">);</span></span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true" tabindex="-1"></a>            Node<span class="op">*</span> uncle <span class="op">=</span> gp<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>uncle <span class="op">&amp;&amp;</span> uncle<span class="op">-&gt;</span>color <span class="op">==</span> RED<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true" tabindex="-1"></a>                z<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true" tabindex="-1"></a>                uncle<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb76-68"><a href="#cb76-68" aria-hidden="true" tabindex="-1"></a>                gp<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb76-69"><a href="#cb76-69" aria-hidden="true" tabindex="-1"></a>                z <span class="op">=</span> gp<span class="op">;</span></span>
<span id="cb76-70"><a href="#cb76-70" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb76-71"><a href="#cb76-71" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>z <span class="op">==</span> z<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-72"><a href="#cb76-72" aria-hidden="true" tabindex="-1"></a>                    z <span class="op">=</span> z<span class="op">-&gt;</span>parent<span class="op">;</span></span>
<span id="cb76-73"><a href="#cb76-73" aria-hidden="true" tabindex="-1"></a>                    rotate_right<span class="op">(</span>root<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb76-74"><a href="#cb76-74" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb76-75"><a href="#cb76-75" aria-hidden="true" tabindex="-1"></a>                z<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb76-76"><a href="#cb76-76" aria-hidden="true" tabindex="-1"></a>                gp<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb76-77"><a href="#cb76-77" aria-hidden="true" tabindex="-1"></a>                rotate_left<span class="op">(</span>root<span class="op">,</span> gp<span class="op">);</span></span>
<span id="cb76-78"><a href="#cb76-78" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb76-79"><a href="#cb76-79" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb76-80"><a href="#cb76-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb76-81"><a href="#cb76-81" aria-hidden="true" tabindex="-1"></a>    <span class="op">(*</span>root<span class="op">)-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb76-82"><a href="#cb76-82" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb76-83"><a href="#cb76-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-84"><a href="#cb76-84" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> bst_insert<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> Node<span class="op">*</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-85"><a href="#cb76-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> z<span class="op">;</span></span>
<span id="cb76-86"><a href="#cb76-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>z<span class="op">-&gt;</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-87"><a href="#cb76-87" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>left <span class="op">=</span> bst_insert<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb76-88"><a href="#cb76-88" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>parent <span class="op">=</span> root<span class="op">;</span></span>
<span id="cb76-89"><a href="#cb76-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>z<span class="op">-&gt;</span>key <span class="op">&gt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-90"><a href="#cb76-90" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>right <span class="op">=</span> bst_insert<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb76-91"><a href="#cb76-91" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>parent <span class="op">=</span> root<span class="op">;</span></span>
<span id="cb76-92"><a href="#cb76-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb76-93"><a href="#cb76-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb76-94"><a href="#cb76-94" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb76-95"><a href="#cb76-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-96"><a href="#cb76-96" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> insert<span class="op">(</span>Node root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-97"><a href="#cb76-97" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> z <span class="op">=</span> new_node<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb76-98"><a href="#cb76-98" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>root <span class="op">=</span> bst_insert<span class="op">(*</span>root<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb76-99"><a href="#cb76-99" aria-hidden="true" tabindex="-1"></a>    fix_violation<span class="op">(</span>root<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb76-100"><a href="#cb76-100" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb76-101"><a href="#cb76-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-102"><a href="#cb76-102" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> inorder<span class="op">(</span>Node<span class="op">*</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-103"><a href="#cb76-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>r<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb76-104"><a href="#cb76-104" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>r<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb76-105"><a href="#cb76-105" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">(</span><span class="sc">%c</span><span class="st">) "</span><span class="op">,</span> r<span class="op">-&gt;</span>key<span class="op">,</span> r<span class="op">-&gt;</span>color <span class="op">==</span> RED <span class="op">?</span> <span class="ch">'R'</span> <span class="op">:</span> <span class="ch">'B'</span><span class="op">);</span></span>
<span id="cb76-106"><a href="#cb76-106" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>r<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb76-107"><a href="#cb76-107" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb76-108"><a href="#cb76-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-109"><a href="#cb76-109" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-110"><a href="#cb76-110" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> root <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb76-111"><a href="#cb76-111" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> keys<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">};</span></span>
<span id="cb76-112"><a href="#cb76-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> insert<span class="op">(&amp;</span>root<span class="op">,</span> keys<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb76-113"><a href="#cb76-113" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb76-114"><a href="#cb76-114" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb76-115"><a href="#cb76-115" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (Simplified)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key, color<span class="op">=</span><span class="st">"R"</span>, parent<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.color <span class="op">=</span> color</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.parent <span class="op">=</span> parent</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_left(root, x):</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x.right</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y.left</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y.left: y.left.parent <span class="op">=</span> x</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    y.parent <span class="op">=</span> x.parent</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> x.parent: root <span class="op">=</span> y</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">==</span> x.parent.left: x.parent.left <span class="op">=</span> y</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: x.parent.right <span class="op">=</span> y</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>    x.parent <span class="op">=</span> y</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_right(root, y):</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> y.left</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x.right</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x.right: x.right.parent <span class="op">=</span> y</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>    x.parent <span class="op">=</span> y.parent</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> y.parent: root <span class="op">=</span> x</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> y <span class="op">==</span> y.parent.left: y.parent.left <span class="op">=</span> x</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: y.parent.right <span class="op">=</span> x</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>    y.parent <span class="op">=</span> x</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fix_violation(root, z):</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> z.parent <span class="kw">and</span> z.parent.color <span class="op">==</span> <span class="st">"R"</span>:</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>        gp <span class="op">=</span> z.parent.parent</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> z.parent <span class="op">==</span> gp.left:</span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>            uncle <span class="op">=</span> gp.right</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> uncle <span class="kw">and</span> uncle.color <span class="op">==</span> <span class="st">"R"</span>:</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>                z.parent.color <span class="op">=</span> uncle.color <span class="op">=</span> <span class="st">"B"</span></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>                gp.color <span class="op">=</span> <span class="st">"R"</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>                z <span class="op">=</span> gp</span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> z <span class="op">==</span> z.parent.right:</span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>                    z <span class="op">=</span> z.parent</span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a>                    root <span class="op">=</span> rotate_left(root, z)</span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a>                z.parent.color <span class="op">=</span> <span class="st">"B"</span></span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>                gp.color <span class="op">=</span> <span class="st">"R"</span></span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a>                root <span class="op">=</span> rotate_right(root, gp)</span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>            uncle <span class="op">=</span> gp.left</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> uncle <span class="kw">and</span> uncle.color <span class="op">==</span> <span class="st">"R"</span>:</span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a>                z.parent.color <span class="op">=</span> uncle.color <span class="op">=</span> <span class="st">"B"</span></span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a>                gp.color <span class="op">=</span> <span class="st">"R"</span></span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a>                z <span class="op">=</span> gp</span>
<span id="cb77-54"><a href="#cb77-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb77-55"><a href="#cb77-55" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> z <span class="op">==</span> z.parent.left:</span>
<span id="cb77-56"><a href="#cb77-56" aria-hidden="true" tabindex="-1"></a>                    z <span class="op">=</span> z.parent</span>
<span id="cb77-57"><a href="#cb77-57" aria-hidden="true" tabindex="-1"></a>                    root <span class="op">=</span> rotate_right(root, z)</span>
<span id="cb77-58"><a href="#cb77-58" aria-hidden="true" tabindex="-1"></a>                z.parent.color <span class="op">=</span> <span class="st">"B"</span></span>
<span id="cb77-59"><a href="#cb77-59" aria-hidden="true" tabindex="-1"></a>                gp.color <span class="op">=</span> <span class="st">"R"</span></span>
<span id="cb77-60"><a href="#cb77-60" aria-hidden="true" tabindex="-1"></a>                root <span class="op">=</span> rotate_left(root, gp)</span>
<span id="cb77-61"><a href="#cb77-61" aria-hidden="true" tabindex="-1"></a>    root.color <span class="op">=</span> <span class="st">"B"</span></span>
<span id="cb77-62"><a href="#cb77-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb77-63"><a href="#cb77-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-64"><a href="#cb77-64" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bst_insert(root, z):</span>
<span id="cb77-65"><a href="#cb77-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root: <span class="cf">return</span> z</span>
<span id="cb77-66"><a href="#cb77-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> z.key <span class="op">&lt;</span> root.key:</span>
<span id="cb77-67"><a href="#cb77-67" aria-hidden="true" tabindex="-1"></a>        root.left <span class="op">=</span> bst_insert(root.left, z)</span>
<span id="cb77-68"><a href="#cb77-68" aria-hidden="true" tabindex="-1"></a>        root.left.parent <span class="op">=</span> root</span>
<span id="cb77-69"><a href="#cb77-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> z.key <span class="op">&gt;</span> root.key:</span>
<span id="cb77-70"><a href="#cb77-70" aria-hidden="true" tabindex="-1"></a>        root.right <span class="op">=</span> bst_insert(root.right, z)</span>
<span id="cb77-71"><a href="#cb77-71" aria-hidden="true" tabindex="-1"></a>        root.right.parent <span class="op">=</span> root</span>
<span id="cb77-72"><a href="#cb77-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb77-73"><a href="#cb77-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-74"><a href="#cb77-74" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(root, key):</span>
<span id="cb77-75"><a href="#cb77-75" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> Node(key)</span>
<span id="cb77-76"><a href="#cb77-76" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> bst_insert(root, z)</span>
<span id="cb77-77"><a href="#cb77-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fix_violation(root, z)</span>
<span id="cb77-78"><a href="#cb77-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-79"><a href="#cb77-79" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inorder(r):</span>
<span id="cb77-80"><a href="#cb77-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> r: <span class="cf">return</span></span>
<span id="cb77-81"><a href="#cb77-81" aria-hidden="true" tabindex="-1"></a>    inorder(r.left)</span>
<span id="cb77-82"><a href="#cb77-82" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>r<span class="sc">.</span>key<span class="sc">}</span><span class="ss">(</span><span class="sc">{</span>r<span class="sc">.</span>color<span class="sc">}</span><span class="ss">)"</span>, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb77-83"><a href="#cb77-83" aria-hidden="true" tabindex="-1"></a>    inorder(r.right)</span>
<span id="cb77-84"><a href="#cb77-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-85"><a href="#cb77-85" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb77-86"><a href="#cb77-86" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>]:</span>
<span id="cb77-87"><a href="#cb77-87" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> insert(root, k)</span>
<span id="cb77-88"><a href="#cb77-88" aria-hidden="true" tabindex="-1"></a>inorder(root)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-32" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-32">Why It Matters</h4>
<ul>
<li>Fewer rotations than AVL</li>
<li>Guarantees O(log n) for all operations</li>
<li>Used in real systems: Linux kernel, Java <code>TreeMap</code>, C++ <code>map</code></li>
<li>Easy insertion logic using coloring + rotation</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-32" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-32">A Gentle Proof (Why It Works)</h4>
<p>The black-height invariant ensures every path length is between <code>h</code> and <code>2h</code>. Balancing via recolor + single rotation ensures logarithmic height. Each insert requires at most 2 rotations, O(log n) traversal.</p>
</section>
<section id="try-it-yourself-32" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-32">Try It Yourself</h4>
<ol type="1">
<li>Insert [10, 20, 30] → RR rotation</li>
<li>Insert [30, 15, 10] → LL rotation</li>
<li>Insert [10, 15, 5] → recolor, no rotation</li>
<li>Draw colors, confirm invariants</li>
</ol>
</section>
<section id="test-cases-32" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-32">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Sequence</th>
<th>Rotations</th>
<th>Root</th>
<th>Black Height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[10,20,30]</td>
<td>Left</td>
<td>20(B)</td>
<td>2</td>
</tr>
<tr class="even">
<td>[7,3,18,10,22,8,11,26]</td>
<td>Mixed</td>
<td>7(B)</td>
<td>3</td>
</tr>
<tr class="odd">
<td>[1,2,3,4,5]</td>
<td>Multiple recolor+rot</td>
<td>2(B)</td>
<td>3</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-32" class="level4">
<h4 class="anchored" data-anchor-id="complexity-32">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(log n)</td>
<td>O(1) rotations</td>
</tr>
<tr class="even">
<td>Search</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td>O(log n)</td>
<td>O(1) rotations</td>
</tr>
</tbody>
</table>
<p>The Red-Black Tree paints order into chaos, each red spark balanced by a calm black shadow.</p>
</section>
</section>
<section id="red-black-tree-delete" class="level3">
<h3 class="anchored" data-anchor-id="red-black-tree-delete">234 Red-Black Tree Delete</h3>
<p>Deletion in a Red-Black Tree (RBT) is a delicate operation: remove a node, then restore balance by adjusting colors and rotations to maintain all five RBT invariants. While insertion fixes “too much red,” deletion often fixes “too much black.”</p>
<section id="what-problem-are-we-solving-33" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-33">What Problem Are We Solving?</h4>
<p>After deleting a node from an RBT, the black-height property may break (some paths lose a black node). Our goal: restore all red-black invariants while keeping time complexity O(log n).</p>
</section>
<section id="red-black-properties-reminder" class="level4">
<h4 class="anchored" data-anchor-id="red-black-properties-reminder">Red-Black Properties (Reminder)</h4>
<ol type="1">
<li>Root is black.</li>
<li>Every node is red or black.</li>
<li>All NIL leaves are black.</li>
<li>Red nodes cannot have red children.</li>
<li>Every path from a node to NIL descendants has the same number of black nodes.</li>
</ol>
</section>
<section id="how-does-it-work-plain-language-33" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-33">How Does It Work (Plain Language)?</h4>
<ol type="1">
<li>Perform standard BST deletion.</li>
<li>Track if the removed node was black (this might cause “double black” issue).</li>
<li>Fix violations moving upward until the tree is balanced again.</li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 55%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th>Case</th>
<th>Condition</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Node is red</td>
<td>Simply remove (no rebalance)</td>
</tr>
<tr class="even">
<td>2</td>
<td>Node is black, child red</td>
<td>Replace and recolor child black</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Node is black, child black (“double black”)</td>
<td>Use sibling cases below</td>
</tr>
</tbody>
</table>
<p>Double Black Fix Cases</p>
<table class="caption-top table">
<colgroup>
<col style="width: 3%">
<col style="width: 41%">
<col style="width: 55%">
</colgroup>
<thead>
<tr class="header">
<th>Case</th>
<th>Description</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Sibling red</td>
<td>Rotate and recolor to make sibling black</td>
</tr>
<tr class="even">
<td>2</td>
<td>Sibling black, both children black</td>
<td>Recolor sibling red, move double black up</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Sibling black, near child red, far child black</td>
<td>Rotate sibling toward node, swap colors</td>
</tr>
<tr class="even">
<td>4</td>
<td>Sibling black, far child red</td>
<td>Rotate parent, recolor sibling and parent, set far child black</td>
</tr>
</tbody>
</table>
</section>
<section id="example-2" class="level4">
<h4 class="anchored" data-anchor-id="example-2">Example</h4>
<p>Delete <code>30</code> from:</p>
<pre><code>     20(B)
    /    \
 10(R)   30(R)</code></pre>
<ul>
<li>30 is red → remove directly</li>
<li>No property violated</li>
</ul>
<p>Delete <code>10</code>:</p>
<pre><code>     20(B)
    /
   NIL</code></pre>
<p>10 was red → simple remove → tree valid</p>
<p>Delete <code>20</code>: Tree becomes empty → fine</p>
</section>
<section id="step-by-step-example-3" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-example-3">Step-by-Step Example</h4>
<p>Insert [10, 20, 30, 15, 25] Delete 20</p>
<table class="caption-top table">
<colgroup>
<col style="width: 4%">
<col style="width: 14%">
<col style="width: 27%">
<col style="width: 47%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Action</th>
<th>Violation</th>
<th>Fix</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Delete 20</td>
<td>double black at 25</td>
<td>sibling 10 black, far child red → Case 4</td>
<td>rotate</td>
</tr>
<tr class="even">
<td>2</td>
<td>After rotate</td>
<td>all properties restored</td>
<td>-</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-simplified" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-simplified">Tiny Code (Simplified)</h4>
<p>C (Conceptual)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb80"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">// This snippet omits full BST insertion for brevity.</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span> RED<span class="op">,</span> BLACK <span class="op">}</span> Color<span class="op">;</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">;</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    Color color<span class="op">;</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">,</span> <span class="op">*</span>parent<span class="op">;</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Utility: get sibling</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> sibling<span class="op">(</span>Node<span class="op">*</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>n<span class="op">-&gt;</span>parent<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n <span class="op">==</span> n<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>left <span class="op">?</span> n<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>right <span class="op">:</span> n<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> fix_delete<span class="op">(</span>Node root<span class="op">,</span> Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>x <span class="op">!=</span> <span class="op">*</span>root <span class="op">&amp;&amp;</span> <span class="op">(!</span>x <span class="op">||</span> x<span class="op">-&gt;</span>color <span class="op">==</span> BLACK<span class="op">))</span> <span class="op">{</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>        Node<span class="op">*</span> s <span class="op">=</span> sibling<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">{</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>color <span class="op">==</span> RED<span class="op">)</span> <span class="op">{</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>                s<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>                x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>                rotate_left<span class="op">(</span>root<span class="op">,</span> x<span class="op">-&gt;</span>parent<span class="op">);</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>                s <span class="op">=</span> x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((!</span>s<span class="op">-&gt;</span>left <span class="op">||</span> s<span class="op">-&gt;</span>left<span class="op">-&gt;</span>color <span class="op">==</span> BLACK<span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>                <span class="op">(!</span>s<span class="op">-&gt;</span>right <span class="op">||</span> s<span class="op">-&gt;</span>right<span class="op">-&gt;</span>color <span class="op">==</span> BLACK<span class="op">))</span> <span class="op">{</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>                s<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> x<span class="op">-&gt;</span>parent<span class="op">;</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(!</span>s<span class="op">-&gt;</span>right <span class="op">||</span> s<span class="op">-&gt;</span>right<span class="op">-&gt;</span>color <span class="op">==</span> BLACK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>left<span class="op">)</span> s<span class="op">-&gt;</span>left<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>                    s<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>                    rotate_right<span class="op">(</span>root<span class="op">,</span> s<span class="op">);</span></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>                    s <span class="op">=</span> x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>                s<span class="op">-&gt;</span>color <span class="op">=</span> x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color<span class="op">;</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>                x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>right<span class="op">)</span> s<span class="op">-&gt;</span>right<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>                rotate_left<span class="op">(</span>root<span class="op">,</span> x<span class="op">-&gt;</span>parent<span class="op">);</span></span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> <span class="op">*</span>root<span class="op">;</span></span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>            <span class="co">// mirror logic for right child</span></span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>color <span class="op">==</span> RED<span class="op">)</span> <span class="op">{</span></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>                s<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>                x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>                rotate_right<span class="op">(</span>root<span class="op">,</span> x<span class="op">-&gt;</span>parent<span class="op">);</span></span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>                s <span class="op">=</span> x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((!</span>s<span class="op">-&gt;</span>left <span class="op">||</span> s<span class="op">-&gt;</span>left<span class="op">-&gt;</span>color <span class="op">==</span> BLACK<span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>                <span class="op">(!</span>s<span class="op">-&gt;</span>right <span class="op">||</span> s<span class="op">-&gt;</span>right<span class="op">-&gt;</span>color <span class="op">==</span> BLACK<span class="op">))</span> <span class="op">{</span></span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>                s<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> x<span class="op">-&gt;</span>parent<span class="op">;</span></span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(!</span>s<span class="op">-&gt;</span>left <span class="op">||</span> s<span class="op">-&gt;</span>left<span class="op">-&gt;</span>color <span class="op">==</span> BLACK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>right<span class="op">)</span> s<span class="op">-&gt;</span>right<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a>                    s<span class="op">-&gt;</span>color <span class="op">=</span> RED<span class="op">;</span></span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a>                    rotate_left<span class="op">(</span>root<span class="op">,</span> s<span class="op">);</span></span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a>                    s <span class="op">=</span> x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a>                s<span class="op">-&gt;</span>color <span class="op">=</span> x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color<span class="op">;</span></span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a>                x<span class="op">-&gt;</span>parent<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>s<span class="op">-&gt;</span>left<span class="op">)</span> s<span class="op">-&gt;</span>left<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb80-65"><a href="#cb80-65" aria-hidden="true" tabindex="-1"></a>                rotate_right<span class="op">(</span>root<span class="op">,</span> x<span class="op">-&gt;</span>parent<span class="op">);</span></span>
<span id="cb80-66"><a href="#cb80-66" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> <span class="op">*</span>root<span class="op">;</span></span>
<span id="cb80-67"><a href="#cb80-67" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb80-68"><a href="#cb80-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb80-69"><a href="#cb80-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb80-70"><a href="#cb80-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">)</span> x<span class="op">-&gt;</span>color <span class="op">=</span> BLACK<span class="op">;</span></span>
<span id="cb80-71"><a href="#cb80-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (Simplified Pseudocode)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fix_delete(root, x):</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> x <span class="op">!=</span> root <span class="kw">and</span> (<span class="kw">not</span> x <span class="kw">or</span> x.color <span class="op">==</span> <span class="st">"B"</span>):</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x <span class="op">==</span> x.parent.left:</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>            s <span class="op">=</span> x.parent.right</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> s.color <span class="op">==</span> <span class="st">"R"</span>:</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>                s.color, x.parent.color <span class="op">=</span> <span class="st">"B"</span>, <span class="st">"R"</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>                root <span class="op">=</span> rotate_left(root, x.parent)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>                s <span class="op">=</span> x.parent.right</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">all</span>(c <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> c.color <span class="op">==</span> <span class="st">"B"</span> <span class="cf">for</span> c <span class="kw">in</span> [s.left, s.right]):</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>                s.color <span class="op">=</span> <span class="st">"R"</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> x.parent</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> s.right <span class="kw">or</span> s.right.color <span class="op">==</span> <span class="st">"B"</span>:</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> s.left: s.left.color <span class="op">=</span> <span class="st">"B"</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>                    s.color <span class="op">=</span> <span class="st">"R"</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>                    root <span class="op">=</span> rotate_right(root, s)</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>                    s <span class="op">=</span> x.parent.right</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>                s.color, x.parent.color <span class="op">=</span> x.parent.color, <span class="st">"B"</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> s.right: s.right.color <span class="op">=</span> <span class="st">"B"</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>                root <span class="op">=</span> rotate_left(root, x.parent)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> root</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># mirror logic</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>            ...</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x: x.color <span class="op">=</span> <span class="st">"B"</span></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-33" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-33">Why It Matters</h4>
<ul>
<li>Preserves logarithmic height after deletion</li>
<li>Used in core data structures (<code>std::map</code>, <code>TreeSet</code>)</li>
<li>Demonstrates color logic as a soft balancing scheme</li>
<li>Handles edge cases gracefully via double black fix</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-33" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-33">A Gentle Proof (Why It Works)</h4>
<p>When a black node is removed, one path loses a black count. The fix cases re-distribute black heights using rotations and recolors. Each loop iteration moves double-black upward, O(log n) steps.</p>
</section>
<section id="try-it-yourself-33" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-33">Try It Yourself</h4>
<ol type="1">
<li>Build [10, 20, 30, 15, 25, 5]. Delete 10 (leaf).</li>
<li>Delete 30 (red leaf) → no fix.</li>
<li>Delete 20 (black node with one child) → recolor fix.</li>
<li>Visualize each case: sibling red, sibling black with red child.</li>
</ol>
</section>
<section id="test-cases-33" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-33">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Insert Sequence</th>
<th>Delete</th>
<th>Case Triggered</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[10,20,30]</td>
<td>20</td>
<td>Case 4</td>
<td>Rotate &amp; recolor</td>
</tr>
<tr class="even">
<td>[7,3,18,10,22,8,11,26]</td>
<td>18</td>
<td>Case 2</td>
<td>Recolor sibling</td>
</tr>
<tr class="odd">
<td>[10,5,1]</td>
<td>5</td>
<td>Case 1</td>
<td>Rotate parent</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-33" class="level4">
<h4 class="anchored" data-anchor-id="complexity-33">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Delete</td>
<td>O(log n)</td>
<td>O(1) rotations</td>
</tr>
<tr class="even">
<td>Insert</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Search</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
</tbody>
</table>
<p>A Red-Black delete is like a careful tune-up, one color at a time, harmony restored across every path.</p>
</section>
</section>
<section id="splay-tree-access" class="level3">
<h3 class="anchored" data-anchor-id="splay-tree-access">235 Splay Tree Access</h3>
<p>A Splay Tree is a self-adjusting binary search tree that brings frequently accessed elements closer to the root through splaying, a series of tree rotations. Unlike AVL or Red-Black trees, it doesn’t maintain strict balance but guarantees amortized O(log n) performance for access, insert, and delete.</p>
<section id="what-problem-are-we-solving-34" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-34">What Problem Are We Solving?</h4>
<p>In many workloads, some elements are accessed far more frequently than others. Ordinary BSTs give no advantage for “hot” keys, while balanced trees maintain shape but not recency. A Splay Tree optimizes for temporal locality: recently accessed items move near the root, making repeated access faster.</p>
</section>
<section id="how-does-it-work-plain-language-34" class="level4">
<h4 class="anchored" data-anchor-id="how-does-it-work-plain-language-34">How Does It Work (Plain Language)?</h4>
<p>Whenever you access a node (via search, insert, or delete), perform a splay operation, repeatedly rotate the node toward the root according to its position and parent relationships.</p>
<p>The three rotation patterns:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 46%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th>Case</th>
<th>Structure</th>
<th>Operation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Zig</td>
<td>Node is child of root</td>
<td>Single rotation</td>
</tr>
<tr class="even">
<td>Zig-Zig</td>
<td>Node and parent are both left or both right children</td>
<td>Double rotation (rotate parent, then grandparent)</td>
</tr>
<tr class="odd">
<td>Zig-Zag</td>
<td>Node and parent are opposite children</td>
<td>Double rotation (rotate node twice upward)</td>
</tr>
</tbody>
</table>
<p>After splaying, the accessed node becomes the root.</p>
</section>
<section id="example-3" class="level4">
<h4 class="anchored" data-anchor-id="example-3">Example</h4>
<p>Access sequence: 10, 20, 30</p>
<ol type="1">
<li>Insert 10 (root)</li>
<li>Insert 20 → 20 right of 10</li>
<li>Access 20 → Zig rotation → 20 becomes root</li>
<li>Insert 30 → 30 right of 20</li>
<li>Access 30 → Zig rotation → 30 root</li>
</ol>
<p>Resulting tree (after all accesses):</p>
<pre><code>   30
  /
20
/
10</code></pre>
<p>Frequently used nodes rise to the top automatically.</p>
</section>
<section id="step-by-step-example-4" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-example-4">Step-by-Step Example</h4>
<p>Start with keys [5, 3, 8, 1, 4, 7, 9]. Access key 1.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 18%">
<col style="width: 32%">
<col style="width: 27%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Case</th>
<th>Rotation</th>
<th>New Root</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Access 1</td>
<td>Zig-Zig (left-left)</td>
<td>Rotate 3, then 5</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>After splay</td>
<td>-</td>
<td>-</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Final tree: 1 becomes root, path shortened for next access.</p>
</section>
<section id="tiny-code-easy-versions-31" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-31">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb83"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">;</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">;</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> new_node<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>left <span class="op">=</span> n<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_right<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> y <span class="op">=</span> x<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>left <span class="op">=</span> y<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>right <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y<span class="op">;</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_left<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> y <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y<span class="op">;</span></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> splay<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root <span class="op">||</span> root<span class="op">-&gt;</span>key <span class="op">==</span> key<span class="op">)</span> <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Key in left subtree</span></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>root<span class="op">-&gt;</span>left<span class="op">)</span> <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>            root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>left <span class="op">=</span> splay<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>left<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>key <span class="op">&gt;</span> root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a>            root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>right <span class="op">=</span> splay<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>right<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>right<span class="op">)</span></span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a>                root<span class="op">-&gt;</span>left <span class="op">=</span> rotate_left<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-44"><a href="#cb83-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> root<span class="op">-&gt;</span>left <span class="op">?</span> rotate_right<span class="op">(</span>root<span class="op">)</span> <span class="op">:</span> root<span class="op">;</span></span>
<span id="cb83-45"><a href="#cb83-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb83-46"><a href="#cb83-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Key in right subtree</span></span>
<span id="cb83-47"><a href="#cb83-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb83-48"><a href="#cb83-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>root<span class="op">-&gt;</span>right<span class="op">)</span> <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb83-49"><a href="#cb83-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>key <span class="op">&gt;</span> root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-50"><a href="#cb83-50" aria-hidden="true" tabindex="-1"></a>            root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>right <span class="op">=</span> splay<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>right<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb83-51"><a href="#cb83-51" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb83-52"><a href="#cb83-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-53"><a href="#cb83-53" aria-hidden="true" tabindex="-1"></a>            root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>left <span class="op">=</span> splay<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>left<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb83-54"><a href="#cb83-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>left<span class="op">)</span></span>
<span id="cb83-55"><a href="#cb83-55" aria-hidden="true" tabindex="-1"></a>                root<span class="op">-&gt;</span>right <span class="op">=</span> rotate_right<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb83-56"><a href="#cb83-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-57"><a href="#cb83-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> root<span class="op">-&gt;</span>right <span class="op">?</span> rotate_left<span class="op">(</span>root<span class="op">)</span> <span class="op">:</span> root<span class="op">;</span></span>
<span id="cb83-58"><a href="#cb83-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb83-59"><a href="#cb83-59" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb83-60"><a href="#cb83-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-61"><a href="#cb83-61" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-62"><a href="#cb83-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> new_node<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb83-63"><a href="#cb83-63" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> splay<span class="op">(</span>root<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb83-64"><a href="#cb83-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>root<span class="op">-&gt;</span>key <span class="op">==</span> key<span class="op">)</span> <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb83-65"><a href="#cb83-65" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> new_node<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb83-66"><a href="#cb83-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-67"><a href="#cb83-67" aria-hidden="true" tabindex="-1"></a>        n<span class="op">-&gt;</span>right <span class="op">=</span> root<span class="op">;</span></span>
<span id="cb83-68"><a href="#cb83-68" aria-hidden="true" tabindex="-1"></a>        n<span class="op">-&gt;</span>left <span class="op">=</span> root<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb83-69"><a href="#cb83-69" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>left <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb83-70"><a href="#cb83-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb83-71"><a href="#cb83-71" aria-hidden="true" tabindex="-1"></a>        n<span class="op">-&gt;</span>left <span class="op">=</span> root<span class="op">;</span></span>
<span id="cb83-72"><a href="#cb83-72" aria-hidden="true" tabindex="-1"></a>        n<span class="op">-&gt;</span>right <span class="op">=</span> root<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb83-73"><a href="#cb83-73" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb83-74"><a href="#cb83-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb83-75"><a href="#cb83-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb83-76"><a href="#cb83-76" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb83-77"><a href="#cb83-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-78"><a href="#cb83-78" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> inorder<span class="op">(</span>Node<span class="op">*</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-79"><a href="#cb83-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>r<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb83-80"><a href="#cb83-80" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>r<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb83-81"><a href="#cb83-81" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> r<span class="op">-&gt;</span>key<span class="op">);</span></span>
<span id="cb83-82"><a href="#cb83-82" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>r<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb83-83"><a href="#cb83-83" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb83-84"><a href="#cb83-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-85"><a href="#cb83-85" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-86"><a href="#cb83-86" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> root <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb83-87"><a href="#cb83-87" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> keys<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">9</span><span class="op">};</span></span>
<span id="cb83-88"><a href="#cb83-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">7</span><span class="op">;</span> i<span class="op">++)</span> root <span class="op">=</span> insert<span class="op">(</span>root<span class="op">,</span> keys<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb83-89"><a href="#cb83-89" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> splay<span class="op">(</span>root<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb83-90"><a href="#cb83-90" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb83-91"><a href="#cb83-91" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb83-92"><a href="#cb83-92" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_right(x):</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x.left</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    x.left <span class="op">=</span> y.right</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    y.right <span class="op">=</span> x</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_left(x):</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x.right</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y.left</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> splay(root, key):</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root <span class="kw">or</span> root.key <span class="op">==</span> key:</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> root</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> key <span class="op">&lt;</span> root.key:</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> root.left:</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> root</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="op">&lt;</span> root.left.key:</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>            root.left.left <span class="op">=</span> splay(root.left.left, key)</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right(root)</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> key <span class="op">&gt;</span> root.left.key:</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>            root.left.right <span class="op">=</span> splay(root.left.right, key)</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> root.left.right:</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>                root.left <span class="op">=</span> rotate_left(root.left)</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_right(root) <span class="cf">if</span> root.left <span class="cf">else</span> root</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> root.right:</span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> root</span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="op">&gt;</span> root.right.key:</span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>            root.right.right <span class="op">=</span> splay(root.right.right, key)</span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left(root)</span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> key <span class="op">&lt;</span> root.right.key:</span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>            root.right.left <span class="op">=</span> splay(root.right.left, key)</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> root.right.left:</span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>                root.right <span class="op">=</span> rotate_right(root.right)</span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rotate_left(root) <span class="cf">if</span> root.right <span class="cf">else</span> root</span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(root, key):</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root:</span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(key)</span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> splay(root, key)</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> root.key <span class="op">==</span> key:</span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> root</span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> Node(key)</span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> key <span class="op">&lt;</span> root.key:</span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>        n.right <span class="op">=</span> root</span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>        n.left <span class="op">=</span> root.left</span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a>        root.left <span class="op">=</span> <span class="va">None</span></span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a>        n.left <span class="op">=</span> root</span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a>        n.right <span class="op">=</span> root.right</span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a>        root.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n</span>
<span id="cb84-60"><a href="#cb84-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-61"><a href="#cb84-61" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inorder(r):</span>
<span id="cb84-62"><a href="#cb84-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> r: <span class="cf">return</span></span>
<span id="cb84-63"><a href="#cb84-63" aria-hidden="true" tabindex="-1"></a>    inorder(r.left)</span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(r.key, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a>    inorder(r.right)</span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb84-68"><a href="#cb84-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">8</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>]:</span>
<span id="cb84-69"><a href="#cb84-69" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> insert(root, k)</span>
<span id="cb84-70"><a href="#cb84-70" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> splay(root, <span class="dv">1</span>)</span>
<span id="cb84-71"><a href="#cb84-71" aria-hidden="true" tabindex="-1"></a>inorder(root)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-34" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-34">Why It Matters</h4>
<ul>
<li>Amortized O(log n) performance</li>
<li>Adapts dynamically to access patterns</li>
<li>Ideal for caches, text editors, network routing tables</li>
<li>Simple logic: no height or color tracking needed</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-34" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-34">A Gentle Proof (Why It Works)</h4>
<p>Each splay operation may take O(h), but the amortized cost across multiple operations is O(log n). Accessing frequently used elements keeps them near the root, improving future operations.</p>
</section>
<section id="try-it-yourself-34" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-34">Try It Yourself</h4>
<ol type="1">
<li>Build [5, 3, 8, 1, 4, 7, 9]</li>
<li>Access 1 → Observe Zig-Zig rotation</li>
<li>Access 8 → Observe Zig-Zag</li>
<li>Insert 10 → check rebalancing</li>
<li>Access 7 repeatedly → moves to root</li>
</ol>
</section>
<section id="test-cases-34" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-34">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Sequence</th>
<th>Access</th>
<th>Case</th>
<th>Root After</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[5,3,8,1,4]</td>
<td>1</td>
<td>Zig-Zig</td>
<td>1</td>
</tr>
<tr class="even">
<td>[10,20,30]</td>
<td>30</td>
<td>Zig</td>
<td>30</td>
</tr>
<tr class="odd">
<td>[5,3,8,1,4]</td>
<td>4</td>
<td>Zig-Zag</td>
<td>4</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-34" class="level4">
<h4 class="anchored" data-anchor-id="complexity-34">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Access</td>
<td>Amortized O(log n)</td>
<td>O(h) recursion</td>
</tr>
<tr class="even">
<td>Insert</td>
<td>Amortized O(log n)</td>
<td>O(h)</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td>Amortized O(log n)</td>
<td>O(h)</td>
</tr>
</tbody>
</table>
<p>The Splay Tree is like a memory, the more you touch something, the closer it stays to you.</p>
</section>
</section>
<section id="treap-insert" class="level3">
<h3 class="anchored" data-anchor-id="treap-insert">236 Treap Insert</h3>
<p>A Treap (Tree + Heap) is a brilliant hybrid: it’s a binary search tree by keys and a heap by priorities. Every node carries a key and a random priority. By combining ordering on keys with random heap priorities, the treap stays <em>balanced on average</em>, no strict rotations like AVL or color rules like Red-Black trees needed.</p>
<section id="what-problem-are-we-solving-35" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-35">What Problem Are We Solving?</h4>
<p>We want a simple balanced search tree with expected O(log n) performance, but without maintaining height or color properties explicitly. Treaps solve this by assigning random priorities, keeping the structure balanced <em>in expectation</em>.</p>
</section>
<section id="how-it-works-plain-language" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language">How It Works (Plain Language)</h4>
<p>Each node <code>(key, priority)</code> must satisfy:</p>
<ul>
<li>BST property: <code>key(left) &lt; key &lt; key(right)</code></li>
<li>Heap property: <code>priority(parent) &lt; priority(children)</code> (min-heap or max-heap convention)</li>
</ul>
<p>Insert like a normal BST by key, then fix heap property by rotations if the priority is violated.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Rule</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Insert node by key (like BST)</td>
</tr>
<tr class="even">
<td>2</td>
<td>Assign a random priority</td>
</tr>
<tr class="odd">
<td>3</td>
<td>While parent priority &gt; node priority → rotate node up</td>
</tr>
</tbody>
</table>
<p>This randomization ensures expected logarithmic height.</p>
</section>
<section id="example-4" class="level4">
<h4 class="anchored" data-anchor-id="example-4">Example</h4>
<p>Insert sequence (key, priority):</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 11%">
<col style="width: 44%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Key</th>
<th>Priority</th>
<th>Structure</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>(50, 15)</td>
<td>root</td>
<td>50</td>
</tr>
<tr class="even">
<td>2</td>
<td>(30, 10)</td>
<td>smaller priority → rotate right</td>
<td>30(root) → 50(right child)</td>
</tr>
<tr class="odd">
<td>3</td>
<td>(70, 25)</td>
<td>stays right of 50</td>
<td>balanced</td>
</tr>
</tbody>
</table>
<p>Result (BST by key, min-heap by priority):</p>
<pre><code>     (30,10)
         \
         (50,15)
             \
             (70,25)</code></pre>
</section>
<section id="step-by-step-example-5" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-example-5">Step-by-Step Example</h4>
<p>Insert keys: [40, 20, 60, 10, 30, 50, 70] Priorities: [80, 90, 70, 100, 85, 60, 75]</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Key</th>
<th>Priority</th>
<th>Rotation</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>40</td>
<td>80</td>
<td>root</td>
<td>40</td>
</tr>
<tr class="even">
<td>20</td>
<td>90</td>
<td>none</td>
<td>left child</td>
</tr>
<tr class="odd">
<td>60</td>
<td>70</td>
<td>rotate left (heap fix)</td>
<td>60 root</td>
</tr>
<tr class="even">
<td>10</td>
<td>100</td>
<td>none</td>
<td>leaf</td>
</tr>
<tr class="odd">
<td>30</td>
<td>85</td>
<td>none</td>
<td>under 20</td>
</tr>
<tr class="even">
<td>50</td>
<td>60</td>
<td>rotate left</td>
<td>50 root</td>
</tr>
<tr class="odd">
<td>70</td>
<td>75</td>
<td>none</td>
<td>leaf</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-32" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-32">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb86"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">,</span> priority<span class="op">;</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">;</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> new_node<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>priority <span class="op">=</span> rand<span class="op">()</span> <span class="op">%</span> <span class="dv">100</span><span class="op">;</span> <span class="co">// random priority</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>left <span class="op">=</span> n<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_right<span class="op">(</span>Node<span class="op">*</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> x <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_left<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> y <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y<span class="op">;</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> new_node<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>left <span class="op">=</span> insert<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>priority <span class="op">&lt;</span> root<span class="op">-&gt;</span>priority<span class="op">)</span></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>key <span class="op">&gt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>right <span class="op">=</span> insert<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>priority <span class="op">&lt;</span> root<span class="op">-&gt;</span>priority<span class="op">)</span></span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> inorder<span class="op">(</span>Node<span class="op">*</span> root<span class="op">)</span> <span class="op">{</span></span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"(</span><span class="sc">%d</span><span class="st">,</span><span class="sc">%d</span><span class="st">) "</span><span class="op">,</span> root<span class="op">-&gt;</span>key<span class="op">,</span> root<span class="op">-&gt;</span>priority<span class="op">);</span></span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">(</span>time<span class="op">(</span>NULL<span class="op">));</span></span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> root <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> keys<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">40</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">60</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">70</span><span class="op">};</span></span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">7</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> insert<span class="op">(</span>root<span class="op">,</span> keys<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.priority <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_right(y):</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> y.left</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x.right</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_left(x):</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x.right</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y.left</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(root, key):</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root:</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(key)</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> key <span class="op">&lt;</span> root.key:</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>        root.left <span class="op">=</span> insert(root.left, key)</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> root.left.priority <span class="op">&lt;</span> root.priority:</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right(root)</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> key <span class="op">&gt;</span> root.key:</span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>        root.right <span class="op">=</span> insert(root.right, key)</span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> root.right.priority <span class="op">&lt;</span> root.priority:</span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left(root)</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inorder(root):</span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root: <span class="cf">return</span></span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>    inorder(root.left)</span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"(</span><span class="sc">{</span>root<span class="sc">.</span>key<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>root<span class="sc">.</span>priority<span class="sc">}</span><span class="ss">)"</span>, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>    inorder(root.right)</span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">40</span>, <span class="dv">20</span>, <span class="dv">60</span>, <span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>]:</span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> insert(root, k)</span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a>inorder(root)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-35" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-35">Why It Matters</h4>
<ul>
<li>Simple implementation with expected balance</li>
<li>Probabilistic alternative to AVL / Red-Black</li>
<li>Great for randomized data structures and Cartesian tree applications</li>
<li>No explicit height or color tracking</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-35" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-35">A Gentle Proof (Why It Works)</h4>
<p>Random priorities imply random structure; the probability of a node being high in the tree drops exponentially with depth. Hence, expected height is O(log n) with high probability.</p>
</section>
<section id="try-it-yourself-35" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-35">Try It Yourself</h4>
<ol type="1">
<li>Insert keys [10, 20, 30, 40] with random priorities.</li>
<li>Observe random structure (not sorted by insertion).</li>
<li>Change priority generator → test skewness.</li>
<li>Visualize both BST and heap invariants.</li>
</ol>
</section>
<section id="test-cases-35" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-35">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Keys</th>
<th>Priorities</th>
<th>Resulting Root</th>
<th>Height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[10,20,30]</td>
<td>[5,3,4]</td>
<td>20</td>
<td>2</td>
</tr>
<tr class="even">
<td>[5,2,8,1,3]</td>
<td>random</td>
<td>varies</td>
<td>~log n</td>
</tr>
<tr class="odd">
<td>[1..100]</td>
<td>random</td>
<td>balanced</td>
<td>O(log n)</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-35" class="level4">
<h4 class="anchored" data-anchor-id="complexity-35">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(log n) expected</td>
<td>O(h) recursion</td>
</tr>
<tr class="even">
<td>Search</td>
<td>O(log n) expected</td>
<td>O(h)</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td>O(log n) expected</td>
<td>O(h)</td>
</tr>
</tbody>
</table>
<p>A Treap dances to the rhythm of chance, balancing order with randomness to stay nimble and fair.</p>
</section>
</section>
<section id="treap-delete" class="level3">
<h3 class="anchored" data-anchor-id="treap-delete">237 Treap Delete</h3>
<p>Deleting from a Treap blends the best of both worlds: BST search for locating the node and heap-based rotations to remove it while keeping balance. Instead of rebalancing explicitly, we rotate the target node downward until it becomes a leaf, then remove it.</p>
<section id="what-problem-are-we-solving-36" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-36">What Problem Are We Solving?</h4>
<p>We want to delete a key while preserving both:</p>
<ul>
<li>BST property: keys in order</li>
<li>Heap property: priorities follow min-/max-heap rule</li>
</ul>
<p>Treaps handle this by rotating down the target node until it has at most one child, then removing it directly.</p>
</section>
<section id="how-it-works-plain-language-1" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-1">How It Works (Plain Language)</h4>
<ol type="1">
<li><p>Search for the node by key (BST search).</p></li>
<li><p>Once found, rotate it downward until it has ≤ 1 child:</p>
<ul>
<li>Rotate left if right child’s priority &lt; left child’s priority</li>
<li>Rotate right otherwise</li>
</ul></li>
<li><p>Remove it once it’s a leaf or single-child node.</p></li>
</ol>
<p>Because priorities are random, the tree remains balanced <em>in expectation</em>.</p>
</section>
<section id="example-5" class="level4">
<h4 class="anchored" data-anchor-id="example-5">Example</h4>
<p>Treap (key, priority):</p>
<pre><code>      (40,20)
     /      \
 (30,10)   (50,25)</code></pre>
<p>Delete 40:</p>
<ul>
<li>Compare children: (30,10) &lt; (50,25) → rotate right on 40</li>
<li>New root (30,10)</li>
<li>40 now right child → continue rotation if needed → eventually becomes leaf → delete</li>
</ul>
<p>New structure maintains BST + heap properties.</p>
</section>
<section id="step-by-step-example-6" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-example-6">Step-by-Step Example</h4>
<p>Start with nodes:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Key</th>
<th>Priority</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>40</td>
<td>50</td>
</tr>
<tr class="even">
<td>20</td>
<td>60</td>
</tr>
<tr class="odd">
<td>60</td>
<td>70</td>
</tr>
<tr class="even">
<td>10</td>
<td>90</td>
</tr>
<tr class="odd">
<td>30</td>
<td>80</td>
</tr>
<tr class="even">
<td>50</td>
<td>65</td>
</tr>
<tr class="odd">
<td>70</td>
<td>75</td>
</tr>
</tbody>
</table>
<p>Delete 40:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 38%">
<col style="width: 24%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Node</th>
<th>Action</th>
<th>Rotation</th>
<th>Root</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>40</td>
<td>Compare children priorities</td>
<td>Left child higher</td>
<td>Rotate right</td>
</tr>
<tr class="even">
<td>2</td>
<td>30</td>
<td>Now parent of 40</td>
<td>40 demoted</td>
<td>Continue if needed</td>
</tr>
<tr class="odd">
<td>3</td>
<td>40</td>
<td>Becomes leaf</td>
<td>Remove</td>
<td>30</td>
</tr>
</tbody>
</table>
<p>Final root: (30,80) All properties hold.</p>
</section>
<section id="tiny-code-easy-versions-33" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-33">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb89"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">,</span> priority<span class="op">;</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">;</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> new_node<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>priority <span class="op">=</span> rand<span class="op">()</span> <span class="op">%</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>left <span class="op">=</span> n<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_right<span class="op">(</span>Node<span class="op">*</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> x <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_left<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> y <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y<span class="op">;</span></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> new_node<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>left <span class="op">=</span> insert<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>priority <span class="op">&lt;</span> root<span class="op">-&gt;</span>priority<span class="op">)</span></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>key <span class="op">&gt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>right <span class="op">=</span> insert<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>priority <span class="op">&lt;</span> root<span class="op">-&gt;</span>priority<span class="op">)</span></span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> delete<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span></span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>left <span class="op">=</span> delete<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>key <span class="op">&gt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span></span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>right <span class="op">=</span> delete<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Found node to delete</span></span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>root<span class="op">-&gt;</span>left <span class="op">&amp;&amp;</span> <span class="op">!</span>root<span class="op">-&gt;</span>right<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(!</span>root<span class="op">-&gt;</span>left<span class="op">)</span></span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(!</span>root<span class="op">-&gt;</span>right<span class="op">)</span></span>
<span id="cb89-61"><a href="#cb89-61" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb89-62"><a href="#cb89-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">-&gt;</span>priority <span class="op">&lt;</span> root<span class="op">-&gt;</span>right<span class="op">-&gt;</span>priority<span class="op">)</span></span>
<span id="cb89-63"><a href="#cb89-63" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb89-64"><a href="#cb89-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb89-65"><a href="#cb89-65" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb89-66"><a href="#cb89-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-67"><a href="#cb89-67" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> delete<span class="op">(</span>root<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb89-68"><a href="#cb89-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb89-69"><a href="#cb89-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb89-70"><a href="#cb89-70" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb89-71"><a href="#cb89-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-72"><a href="#cb89-72" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> inorder<span class="op">(</span>Node<span class="op">*</span> root<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-73"><a href="#cb89-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb89-74"><a href="#cb89-74" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb89-75"><a href="#cb89-75" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"(</span><span class="sc">%d</span><span class="st">,</span><span class="sc">%d</span><span class="st">) "</span><span class="op">,</span> root<span class="op">-&gt;</span>key<span class="op">,</span> root<span class="op">-&gt;</span>priority<span class="op">);</span></span>
<span id="cb89-76"><a href="#cb89-76" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb89-77"><a href="#cb89-77" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb89-78"><a href="#cb89-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-79"><a href="#cb89-79" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-80"><a href="#cb89-80" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">(</span>time<span class="op">(</span>NULL<span class="op">));</span></span>
<span id="cb89-81"><a href="#cb89-81" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> root <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb89-82"><a href="#cb89-82" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> keys<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">40</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">60</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">70</span><span class="op">};</span></span>
<span id="cb89-83"><a href="#cb89-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">7</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb89-84"><a href="#cb89-84" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> insert<span class="op">(</span>root<span class="op">,</span> keys<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb89-85"><a href="#cb89-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-86"><a href="#cb89-86" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Before deletion:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb89-87"><a href="#cb89-87" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb89-88"><a href="#cb89-88" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb89-89"><a href="#cb89-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-90"><a href="#cb89-90" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> delete<span class="op">(</span>root<span class="op">,</span> <span class="dv">40</span><span class="op">);</span></span>
<span id="cb89-91"><a href="#cb89-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-92"><a href="#cb89-92" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"After deleting 40:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb89-93"><a href="#cb89-93" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb89-94"><a href="#cb89-94" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb89-95"><a href="#cb89-95" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.priority <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_right(y):</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> y.left</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x.right</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_left(x):</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x.right</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y.left</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(root, key):</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root:</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(key)</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> key <span class="op">&lt;</span> root.key:</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>        root.left <span class="op">=</span> insert(root.left, key)</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> root.left.priority <span class="op">&lt;</span> root.priority:</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right(root)</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> key <span class="op">&gt;</span> root.key:</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>        root.right <span class="op">=</span> insert(root.right, key)</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> root.right.priority <span class="op">&lt;</span> root.priority:</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left(root)</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> delete(root, key):</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root:</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> key <span class="op">&lt;</span> root.key:</span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>        root.left <span class="op">=</span> delete(root.left, key)</span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> key <span class="op">&gt;</span> root.key:</span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>        root.right <span class="op">=</span> delete(root.right, key)</span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> root.left <span class="kw">and</span> <span class="kw">not</span> root.right:</span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="kw">not</span> root.left:</span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left(root)</span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="kw">not</span> root.right:</span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right(root)</span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> root.left.priority <span class="op">&lt;</span> root.right.priority:</span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right(root)</span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left(root)</span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> delete(root, key)</span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inorder(root):</span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root: <span class="cf">return</span></span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a>    inorder(root.left)</span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"(</span><span class="sc">{</span>root<span class="sc">.</span>key<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>root<span class="sc">.</span>priority<span class="sc">}</span><span class="ss">)"</span>, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb90-59"><a href="#cb90-59" aria-hidden="true" tabindex="-1"></a>    inorder(root.right)</span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb90-62"><a href="#cb90-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">40</span>,<span class="dv">20</span>,<span class="dv">60</span>,<span class="dv">10</span>,<span class="dv">30</span>,<span class="dv">50</span>,<span class="dv">70</span>]:</span>
<span id="cb90-63"><a href="#cb90-63" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> insert(root, k)</span>
<span id="cb90-64"><a href="#cb90-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Before:"</span>, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb90-65"><a href="#cb90-65" aria-hidden="true" tabindex="-1"></a>inorder(root)</span>
<span id="cb90-66"><a href="#cb90-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb90-67"><a href="#cb90-67" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> delete(root, <span class="dv">40</span>)</span>
<span id="cb90-68"><a href="#cb90-68" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"After:"</span>, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb90-69"><a href="#cb90-69" aria-hidden="true" tabindex="-1"></a>inorder(root)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-36" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-36">Why It Matters</h4>
<ul>
<li>No explicit rebalancing, rotations emerge from heap priorities</li>
<li>Expected O(log n) deletion</li>
<li>Natural, simple structure for randomized search trees</li>
<li>Used in randomized algorithms, dynamic sets, and order-statistics</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-36" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-36">A Gentle Proof (Why It Works)</h4>
<p>At each step, the node rotates toward a child with smaller priority, preserving heap property. Expected height remains O(log n) due to independent random priorities.</p>
</section>
<section id="try-it-yourself-36" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-36">Try It Yourself</h4>
<ol type="1">
<li>Build treap with [10, 20, 30, 40, 50].</li>
<li>Delete 30 → observe rotations to leaf.</li>
<li>Delete 10 (root) → rotation chooses smaller-priority child.</li>
<li>Repeat deletions, verify BST + heap invariants hold.</li>
</ol>
</section>
<section id="test-cases-36" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-36">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 38%">
<col style="width: 10%">
<col style="width: 19%">
<col style="width: 14%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th>Keys</th>
<th>Delete</th>
<th>Rotations</th>
<th>Balanced</th>
<th>Root After</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[40,20,60,10,30,50,70]</td>
<td>40</td>
<td>Right, Left</td>
<td>✅</td>
<td>30</td>
</tr>
<tr class="even">
<td>[10,20,30]</td>
<td>20</td>
<td>Left</td>
<td>✅</td>
<td>10</td>
</tr>
<tr class="odd">
<td>[50,30,70,20,40,60,80]</td>
<td>30</td>
<td>Right</td>
<td>✅</td>
<td>50</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-36" class="level4">
<h4 class="anchored" data-anchor-id="complexity-36">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Delete</td>
<td>O(log n) expected</td>
<td>O(h) recursion</td>
</tr>
<tr class="even">
<td>Insert</td>
<td>O(log n) expected</td>
<td>O(h)</td>
</tr>
<tr class="odd">
<td>Search</td>
<td>O(log n) expected</td>
<td>O(h)</td>
</tr>
</tbody>
</table>
<p>The Treap deletes gracefully, rotating away until the target fades like a falling leaf, leaving balance behind.</p>
</section>
</section>
<section id="weight-balanced-tree" class="level3">
<h3 class="anchored" data-anchor-id="weight-balanced-tree">238 Weight Balanced Tree</h3>
<p>A Weight Balanced Tree (WBT) maintains balance not by height or color, but by subtree sizes (or “weights”). Each node keeps track of how many elements are in its left and right subtrees, and balance is enforced by requiring their weights to stay within a constant ratio.</p>
<section id="what-problem-are-we-solving-37" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-37">What Problem Are We Solving?</h4>
<p>In ordinary BSTs, imbalance can grow as keys are inserted in sorted order, degrading performance to O(n). Weight Balanced Trees fix this by keeping subtree sizes within a safe range. They are particularly useful when you need order-statistics (like “find the k-th element”) or split/merge operations that depend on sizes rather than heights.</p>
</section>
<section id="how-it-works-plain-language-2" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-2">How It Works (Plain Language)</h4>
<p>Each node maintains a weight = total number of nodes in its subtree. When inserting or deleting, you update weights and check the balance condition:</p>
<p>If</p>
<pre><code>weight(left) ≤ α × weight(node)
weight(right) ≤ α × weight(node)</code></pre>
<p>for some balance constant α (e.g., 0.7), then the tree is considered balanced.</p>
<p>If not, perform rotations (like AVL) to restore balance.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 87%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Steps</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>Insert like BST → Update weights → If ratio violated → Rotate</td>
</tr>
<tr class="even">
<td>Delete</td>
<td>Remove node → Update weights → If ratio violated → Rebuild or rotate</td>
</tr>
<tr class="odd">
<td>Search</td>
<td>BST search (weights guide decisions for rank queries)</td>
</tr>
</tbody>
</table>
<p>Because weights reflect actual sizes, the tree ensures O(log n) expected height.</p>
</section>
<section id="example-6" class="level4">
<h4 class="anchored" data-anchor-id="example-6">Example</h4>
<p>Let’s use α = 0.7</p>
<p>Insert [10, 20, 30, 40, 50]</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 23%">
<col style="width: 16%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Insert</th>
<th>Weight(left)</th>
<th>Weight(right)</th>
<th>Balanced?</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>10</td>
<td>0</td>
<td>0</td>
<td>✅</td>
<td>-</td>
</tr>
<tr class="even">
<td>2</td>
<td>20</td>
<td>1</td>
<td>0</td>
<td>✅</td>
<td>-</td>
</tr>
<tr class="odd">
<td>3</td>
<td>30</td>
<td>2</td>
<td>0</td>
<td>❌</td>
<td>Rotate left</td>
</tr>
<tr class="even">
<td>4</td>
<td>40</td>
<td>3</td>
<td>0</td>
<td>❌</td>
<td>Rotate left</td>
</tr>
<tr class="odd">
<td>5</td>
<td>50</td>
<td>4</td>
<td>0</td>
<td>❌</td>
<td>Rotate left</td>
</tr>
</tbody>
</table>
<p>Tree remains balanced by rotations once left-right ratio exceeds α.</p>
</section>
<section id="step-by-step-example-7" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-example-7">Step-by-Step Example</h4>
<p>Insert [1, 2, 3, 4, 5] with α = 0.7</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Action</th>
<th>Weights</th>
<th>Balanced?</th>
<th>Rotation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Insert 1</td>
<td>(0,0)</td>
<td>✅</td>
<td>-</td>
</tr>
<tr class="even">
<td>2</td>
<td>Insert 2</td>
<td>(1,0)</td>
<td>✅</td>
<td>-</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Insert 3</td>
<td>(2,0)</td>
<td>❌</td>
<td>Left Rotate</td>
</tr>
<tr class="even">
<td>4</td>
<td>Insert 4</td>
<td>(3,0)</td>
<td>❌</td>
<td>Left Rotate</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Insert 5</td>
<td>(4,0)</td>
<td>❌</td>
<td>Left Rotate</td>
</tr>
</tbody>
</table>
<p>Tree remains height-balanced based on weights.</p>
</section>
<section id="tiny-code-easy-versions-34" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-34">Tiny Code (Easy Versions)</h4>
<p>C (Simplified)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb92"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">;</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> size<span class="op">;</span> <span class="co">// weight = size of subtree</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">;</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> size<span class="op">(</span>Node<span class="op">*</span> n<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">?</span> n<span class="op">-&gt;</span>size <span class="op">:</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> new_node<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>size <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>left <span class="op">=</span> n<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_left<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> y <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>size <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> size<span class="op">(</span>x<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">+</span> size<span class="op">(</span>x<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>size <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> size<span class="op">(</span>y<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">+</span> size<span class="op">(</span>y<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y<span class="op">;</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_right<span class="op">(</span>Node<span class="op">*</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> x <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>size <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> size<span class="op">(</span>y<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">+</span> size<span class="op">(</span>y<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>size <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> size<span class="op">(</span>x<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">+</span> size<span class="op">(</span>x<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">;</span></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> balanced<span class="op">(</span>Node<span class="op">*</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>n<span class="op">)</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> l <span class="op">=</span> size<span class="op">(</span>n<span class="op">-&gt;</span>left<span class="op">),</span> r <span class="op">=</span> size<span class="op">(</span>n<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> l <span class="op">&lt;=</span> alpha <span class="op">*</span> n<span class="op">-&gt;</span>size <span class="op">&amp;&amp;</span> r <span class="op">&lt;=</span> alpha <span class="op">*</span> n<span class="op">-&gt;</span>size<span class="op">;</span></span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> new_node<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> root<span class="op">-&gt;</span>left <span class="op">=</span> insert<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>key <span class="op">&gt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span> root<span class="op">-&gt;</span>right <span class="op">=</span> insert<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a>    root<span class="op">-&gt;</span>size <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> size<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">+</span> size<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>balanced<span class="op">(</span>root<span class="op">))</span> <span class="op">{</span></span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>size<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">)</span> <span class="op">&gt;</span> size<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">))</span></span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> inorder<span class="op">(</span>Node<span class="op">*</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>n<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>n<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">(</span><span class="sc">%d</span><span class="st">) "</span><span class="op">,</span> n<span class="op">-&gt;</span>key<span class="op">,</span> n<span class="op">-&gt;</span>size<span class="op">);</span></span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>n<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> root <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> keys<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">};</span></span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> insert<span class="op">(</span>root<span class="op">,</span> keys<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (Simplified)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> size(n): <span class="cf">return</span> n.size <span class="cf">if</span> n <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update(n):</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n:</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>        n.size <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> size(n.left) <span class="op">+</span> size(n.right)</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_left(x):</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x.right</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y.left</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>    update(x)</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>    update(y)</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_right(y):</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> y.left</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x.right</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>    update(y)</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>    update(x)</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> balanced(n):</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">not</span> n <span class="kw">or</span> (size(n.left) <span class="op">&lt;=</span> alpha <span class="op">*</span> n.size <span class="kw">and</span> size(n.right) <span class="op">&lt;=</span> alpha <span class="op">*</span> n.size)</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(root, key):</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root: <span class="cf">return</span> Node(key)</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> key <span class="op">&lt;</span> root.key: root.left <span class="op">=</span> insert(root.left, key)</span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> key <span class="op">&gt;</span> root.key: root.right <span class="op">=</span> insert(root.right, key)</span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>    update(root)</span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> balanced(root):</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> size(root.left) <span class="op">&gt;</span> size(root.right):</span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_right(root)</span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> rotate_left(root)</span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inorder(n):</span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> n: <span class="cf">return</span></span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a>    inorder(n.left)</span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>n<span class="sc">.</span>key<span class="sc">}</span><span class="ss">(</span><span class="sc">{</span>n<span class="sc">.</span>size<span class="sc">}</span><span class="ss">)"</span>, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a>    inorder(n.right)</span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>]:</span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> insert(root, k)</span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a>inorder(root)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-37" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-37">Why It Matters</h4>
<ul>
<li>Balances based on true subtree size, not height</li>
<li>Excellent for order-statistics (<code>kth</code>, <code>rank</code>)</li>
<li>Supports split, merge, and range queries naturally</li>
<li>Deterministic balancing without randomness</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-37" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-37">A Gentle Proof (Why It Works)</h4>
<p>Maintaining weight ratios guarantees logarithmic height. If <code>α</code> &lt; 1, each subtree has ≤ α × n nodes, so height ≤ log₁/α(n) → O(log n).</p>
</section>
<section id="try-it-yourself-37" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-37">Try It Yourself</h4>
<ol type="1">
<li>Build [10, 20, 30, 40, 50] with α = 0.7.</li>
<li>Print sizes at each node.</li>
<li>Delete 20 → rebalance by rotation.</li>
<li>Try α = 0.6 and α = 0.8 → compare shapes.</li>
</ol>
</section>
<section id="test-cases-37" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-37">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Sequence</th>
<th>α</th>
<th>Balanced?</th>
<th>Height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[10,20,30,40,50]</td>
<td>0.7</td>
<td>✅</td>
<td>log n</td>
</tr>
<tr class="even">
<td>[1..100]</td>
<td>0.7</td>
<td>✅</td>
<td>O(log n)</td>
</tr>
<tr class="odd">
<td>[sorted 1..10]</td>
<td>0.6</td>
<td>✅</td>
<td>~4</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-37" class="level4">
<h4 class="anchored" data-anchor-id="complexity-37">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
<tr class="even">
<td>Delete</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
<tr class="odd">
<td>Search</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
</tbody>
</table>
<p>A Weight Balanced Tree is like a tightrope walker, always adjusting its stance to keep perfect equilibrium, no matter how the sequence unfolds.</p>
</section>
</section>
<section id="scapegoat-tree-rebuild" class="level3">
<h3 class="anchored" data-anchor-id="scapegoat-tree-rebuild">239 Scapegoat Tree Rebuild</h3>
<p>A Scapegoat Tree is a binary search tree that maintains balance by occasionally rebuilding entire subtrees.<br>
Instead of performing rotations on every insertion, it monitors the depth of nodes.<br>
When a node’s depth exceeds the allowed limit, the algorithm locates a <em>scapegoat</em> ancestor whose subtree is too unbalanced, flattens that subtree into a sorted list, and rebuilds it into a perfectly balanced tree.</p>
<p>With a balance parameter <span class="math inline">\(\alpha\)</span> in <span class="math inline">\((0.5, 1)\)</span>, a Scapegoat Tree guarantees: - <span class="math inline">\(O(\log n)\)</span> amortized time for insertions and deletions<br>
- <span class="math inline">\(O(\log n)\)</span> worst-case height</p>
<section id="what-problem-are-we-solving-38" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-38">What Problem Are We Solving?</h4>
<p>Standard BSTs can become skewed and degrade to O(n). Rotational trees like AVL and Red Black maintain strict local invariants but add per update overhead. Scapegoat trees choose a middle path</p>
<ul>
<li>Do nothing most of the time</li>
<li>Occasionally rebuild an entire subtree when a global bound is exceeded</li>
</ul>
<p>Goal Keep height near <span class="math inline">\(\log_{1/\alpha} n\)</span> while keeping code simple and rotations out of the hot path.</p>
</section>
<section id="how-it-works-plain-language-3" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-3">How It Works (Plain Language)</h4>
<p>Parameters and invariants</p>
<ul>
<li>Choose <span class="math inline">\(\alpha \in (0.5, 1)\)</span> such as <span class="math inline">\(\alpha = \tfrac{2}{3}\)</span></li>
<li>Maintain <code>n</code> = current size and <code>n_max</code> = maximum size since the last global rebuild</li>
<li>Height bound: if an insertion lands deeper than <span class="math inline">\(\lfloor \log_{1/\alpha} n \rfloor\)</span>, the tree is too tall</li>
</ul>
<p>Insert algorithm</p>
<ol type="1">
<li>Insert like a normal BST and track the path length <code>depth</code>.</li>
<li>If <code>depth</code> is within the allowed bound, stop.</li>
<li>Otherwise, walk up to find the scapegoat node <code>s</code> such that<br>
<span class="math display">\[
\max\big(\text{size}(s.\text{left}),\ \text{size}(s.\text{right})\big) &gt; \alpha \cdot \text{size}(s)
\]</span></li>
<li>Rebuild the subtree rooted at <code>s</code> into a perfectly balanced BST in time linear in that subtree’s size.</li>
</ol>
<p>Delete algorithm</p>
<ul>
<li>Perform a normal BST delete.<br>
</li>
<li>Decrement <code>n</code>.<br>
</li>
<li>If <span class="math inline">\(n &lt; \alpha \cdot n_{\text{max}}\)</span>, rebuild the entire tree and set <span class="math inline">\(n_{\text{max}} = n\)</span>.</li>
</ul>
<p>Why rebuilding works</p>
<ul>
<li>Rebuilding performs an inorder traversal to collect nodes into a sorted array, then constructs a balanced BST from that array.<br>
</li>
<li>Rebuilds are infrequent, and their costs are amortized over many cheap insertions and deletions, ensuring logarithmic time on average.</li>
</ul>
</section>
<section id="example-walkthrough" class="level4">
<h4 class="anchored" data-anchor-id="example-walkthrough">Example Walkthrough</h4>
<p>Let <span class="math inline">\(\alpha = \tfrac{2}{3}\)</span>.</p>
<p>Insert the keys <code>[10, 20, 30, 40, 50, 60]</code> in ascending order.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 12%">
<col style="width: 28%">
<col style="width: 26%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Action</th>
<th>Depth vs bound</th>
<th>Scapegoat found</th>
<th>Rebuild</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>insert 10</td>
<td>depth 0 within</td>
<td>none</td>
<td>no</td>
</tr>
<tr class="even">
<td>2</td>
<td>insert 20</td>
<td>depth 1 within</td>
<td>none</td>
<td>no</td>
</tr>
<tr class="odd">
<td>3</td>
<td>insert 30</td>
<td>depth 2 within</td>
<td>none</td>
<td>no</td>
</tr>
<tr class="even">
<td>4</td>
<td>insert 40</td>
<td>depth 3 exceeds bound</td>
<td>ancestor violates α</td>
<td>rebuild that subtree</td>
</tr>
<tr class="odd">
<td>5</td>
<td>insert 50</td>
<td>likely within</td>
<td>none</td>
<td>no</td>
</tr>
<tr class="even">
<td>6</td>
<td>insert 60</td>
<td>if depth exceeds</td>
<td>find ancestor</td>
<td>rebuild subtree</td>
</tr>
</tbody>
</table>
<p>The occasional rebuild produces a nearly perfect BST despite sorted input.</p>
</section>
<section id="tiny-code-easy-versions-35" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-35">Tiny Code (Easy Versions)</h4>
<p>Python (concise reference implementation)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> log, floor</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">__slots__</span> <span class="op">=</span> (<span class="st">"key"</span>, <span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"size"</span>)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">None</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> size(x): <span class="cf">return</span> x.size <span class="cf">if</span> x <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update(x): </span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x: x.size <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> size(x.left) <span class="op">+</span> size(x.right)</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flatten_inorder(x, arr):</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> x: <span class="cf">return</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>    flatten_inorder(x.left, arr)</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>    arr.append(x)</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>    flatten_inorder(x.right, arr)</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_balanced(nodes, lo, hi):</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> lo <span class="op">&gt;=</span> hi: <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>    mid <span class="op">=</span> (lo <span class="op">+</span> hi) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> nodes[mid]</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>    root.left <span class="op">=</span> build_balanced(nodes, lo, mid)</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>    root.right <span class="op">=</span> build_balanced(nodes, mid <span class="op">+</span> <span class="dv">1</span>, hi)</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>    update(root)</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ScapegoatTree:</span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, alpha<span class="op">=</span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span>):</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.alpha <span class="op">=</span> alpha</span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_max <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _log_alpha(<span class="va">self</span>, n):</span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># height bound floor(log_{1/alpha} n)</span></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> n <span class="op">&lt;=</span> <span class="dv">1</span>: <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> floor(log(n, <span class="dv">1</span> <span class="op">/</span> <span class="va">self</span>.alpha))</span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _find_and_rebuild(<span class="va">self</span>, path):</span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># path is list of nodes from root to inserted node</span></span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(path) <span class="op">-</span> <span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> path[i]</span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a>            l, r <span class="op">=</span> size(x.left), size(x.right)</span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">max</span>(l, r) <span class="op">&gt;</span> <span class="va">self</span>.alpha <span class="op">*</span> size(x):</span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a>                <span class="co"># rebuild subtree rooted at x and reattach to parent</span></span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a>                nodes <span class="op">=</span> []</span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a>                flatten_inorder(x, nodes)</span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a>                new_sub <span class="op">=</span> build_balanced(nodes, <span class="dv">0</span>, <span class="bu">len</span>(nodes))</span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.root <span class="op">=</span> new_sub</span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a>                    p <span class="op">=</span> path[i <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> p.left <span class="kw">is</span> x: p.left <span class="op">=</span> new_sub</span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: p.right <span class="op">=</span> new_sub</span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># fix sizes upward from parent</span></span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">-</span> <span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a>                        update(path[j])</span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb94-62"><a href="#cb94-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-63"><a href="#cb94-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key):</span>
<span id="cb94-64"><a href="#cb94-64" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb94-65"><a href="#cb94-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_max <span class="op">=</span> <span class="bu">max</span>(<span class="va">self</span>.n_max, <span class="va">self</span>.n)</span>
<span id="cb94-66"><a href="#cb94-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.root:</span>
<span id="cb94-67"><a href="#cb94-67" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.root <span class="op">=</span> Node(key)</span>
<span id="cb94-68"><a href="#cb94-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb94-69"><a href="#cb94-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-70"><a href="#cb94-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># standard BST insert with path tracking</span></span>
<span id="cb94-71"><a href="#cb94-71" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> []</span>
<span id="cb94-72"><a href="#cb94-72" aria-hidden="true" tabindex="-1"></a>        cur <span class="op">=</span> <span class="va">self</span>.root</span>
<span id="cb94-73"><a href="#cb94-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> cur:</span>
<span id="cb94-74"><a href="#cb94-74" aria-hidden="true" tabindex="-1"></a>            path.append(cur)</span>
<span id="cb94-75"><a href="#cb94-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> key <span class="op">&lt;</span> cur.key:</span>
<span id="cb94-76"><a href="#cb94-76" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> cur.left: cur <span class="op">=</span> cur.left</span>
<span id="cb94-77"><a href="#cb94-77" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb94-78"><a href="#cb94-78" aria-hidden="true" tabindex="-1"></a>                    cur.left <span class="op">=</span> Node(key)</span>
<span id="cb94-79"><a href="#cb94-79" aria-hidden="true" tabindex="-1"></a>                    path.append(cur.left)</span>
<span id="cb94-80"><a href="#cb94-80" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb94-81"><a href="#cb94-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> key <span class="op">&gt;</span> cur.key:</span>
<span id="cb94-82"><a href="#cb94-82" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> cur.right: cur <span class="op">=</span> cur.right</span>
<span id="cb94-83"><a href="#cb94-83" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb94-84"><a href="#cb94-84" aria-hidden="true" tabindex="-1"></a>                    cur.right <span class="op">=</span> Node(key)</span>
<span id="cb94-85"><a href="#cb94-85" aria-hidden="true" tabindex="-1"></a>                    path.append(cur.right)</span>
<span id="cb94-86"><a href="#cb94-86" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb94-87"><a href="#cb94-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb94-88"><a href="#cb94-88" aria-hidden="true" tabindex="-1"></a>                <span class="co"># duplicate ignore</span></span>
<span id="cb94-89"><a href="#cb94-89" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.n <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb94-90"><a href="#cb94-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb94-91"><a href="#cb94-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># update sizes</span></span>
<span id="cb94-92"><a href="#cb94-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> node <span class="kw">in</span> <span class="bu">reversed</span>(path[:<span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb94-93"><a href="#cb94-93" aria-hidden="true" tabindex="-1"></a>            update(node)</span>
<span id="cb94-94"><a href="#cb94-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-95"><a href="#cb94-95" aria-hidden="true" tabindex="-1"></a>        <span class="co"># depth check and possible rebuild</span></span>
<span id="cb94-96"><a href="#cb94-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(path) <span class="op">-</span> <span class="dv">1</span> <span class="op">&gt;</span> <span class="va">self</span>._log_alpha(<span class="va">self</span>.n):</span>
<span id="cb94-97"><a href="#cb94-97" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._find_and_rebuild(path)</span>
<span id="cb94-98"><a href="#cb94-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-99"><a href="#cb94-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _join_left_max(<span class="va">self</span>, t):</span>
<span id="cb94-100"><a href="#cb94-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># remove and return max node from subtree t, plus the new subtree</span></span>
<span id="cb94-101"><a href="#cb94-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> t.right:</span>
<span id="cb94-102"><a href="#cb94-102" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> t, t.left</span>
<span id="cb94-103"><a href="#cb94-103" aria-hidden="true" tabindex="-1"></a>        m, t.right <span class="op">=</span> <span class="va">self</span>._join_left_max(t.right)</span>
<span id="cb94-104"><a href="#cb94-104" aria-hidden="true" tabindex="-1"></a>        update(t)</span>
<span id="cb94-105"><a href="#cb94-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> m, t</span>
<span id="cb94-106"><a href="#cb94-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-107"><a href="#cb94-107" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete(<span class="va">self</span>, key):</span>
<span id="cb94-108"><a href="#cb94-108" aria-hidden="true" tabindex="-1"></a>        <span class="co"># standard BST delete</span></span>
<span id="cb94-109"><a href="#cb94-109" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _del(x, key):</span>
<span id="cb94-110"><a href="#cb94-110" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> x: <span class="cf">return</span> <span class="va">None</span>, <span class="va">False</span></span>
<span id="cb94-111"><a href="#cb94-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> key <span class="op">&lt;</span> x.key:</span>
<span id="cb94-112"><a href="#cb94-112" aria-hidden="true" tabindex="-1"></a>                x.left, removed <span class="op">=</span> _del(x.left, key)</span>
<span id="cb94-113"><a href="#cb94-113" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> key <span class="op">&gt;</span> x.key:</span>
<span id="cb94-114"><a href="#cb94-114" aria-hidden="true" tabindex="-1"></a>                x.right, removed <span class="op">=</span> _del(x.right, key)</span>
<span id="cb94-115"><a href="#cb94-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb94-116"><a href="#cb94-116" aria-hidden="true" tabindex="-1"></a>                removed <span class="op">=</span> <span class="va">True</span></span>
<span id="cb94-117"><a href="#cb94-117" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> x.left: <span class="cf">return</span> x.right, <span class="va">True</span></span>
<span id="cb94-118"><a href="#cb94-118" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> x.right: <span class="cf">return</span> x.left, <span class="va">True</span></span>
<span id="cb94-119"><a href="#cb94-119" aria-hidden="true" tabindex="-1"></a>                <span class="co"># replace with predecessor</span></span>
<span id="cb94-120"><a href="#cb94-120" aria-hidden="true" tabindex="-1"></a>                m, x.left <span class="op">=</span> <span class="va">self</span>._join_left_max(x.left)</span>
<span id="cb94-121"><a href="#cb94-121" aria-hidden="true" tabindex="-1"></a>                m.left, m.right <span class="op">=</span> x.left, x.right</span>
<span id="cb94-122"><a href="#cb94-122" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> m</span>
<span id="cb94-123"><a href="#cb94-123" aria-hidden="true" tabindex="-1"></a>            update(x)</span>
<span id="cb94-124"><a href="#cb94-124" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> x, removed</span>
<span id="cb94-125"><a href="#cb94-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-126"><a href="#cb94-126" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.root, removed <span class="op">=</span> _del(<span class="va">self</span>.root, key)</span>
<span id="cb94-127"><a href="#cb94-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> removed: <span class="cf">return</span></span>
<span id="cb94-128"><a href="#cb94-128" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb94-129"><a href="#cb94-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.n <span class="op">&lt;</span> <span class="va">self</span>.alpha <span class="op">*</span> <span class="va">self</span>.n_max:</span>
<span id="cb94-130"><a href="#cb94-130" aria-hidden="true" tabindex="-1"></a>            <span class="co"># global rebuild</span></span>
<span id="cb94-131"><a href="#cb94-131" aria-hidden="true" tabindex="-1"></a>            nodes <span class="op">=</span> []</span>
<span id="cb94-132"><a href="#cb94-132" aria-hidden="true" tabindex="-1"></a>            flatten_inorder(<span class="va">self</span>.root, nodes)</span>
<span id="cb94-133"><a href="#cb94-133" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.root <span class="op">=</span> build_balanced(nodes, <span class="dv">0</span>, <span class="bu">len</span>(nodes))</span>
<span id="cb94-134"><a href="#cb94-134" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.n_max <span class="op">=</span> <span class="va">self</span>.n</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>C (outline of the rebuild idea)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb95"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Sketch only: show rebuild path</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co">// 1) Do BST insert while recording path stack</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 2) If depth &gt; bound, walk path upward to find scapegoat</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 3) Inorder-copy subtree nodes to an array</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co">// 4) Recursively rebuild balanced subtree from that array</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 5) Reattach rebuilt subtree to parent and fix sizes up the path</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-38" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-38">Why It Matters</h4>
<ul>
<li>Simple balancing approach with rare but powerful subtree rebuilds<br>
</li>
<li>Well suited for workloads where insertions arrive in bursts and frequent rotations are undesirable<br>
</li>
<li>Guarantees height <span class="math inline">\(O(\log n)\)</span> with a tunable constant controlled by <span class="math inline">\(\alpha\)</span><br>
</li>
<li>The inorder-based rebuild process makes ordered operations efficient and easy to implement</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-38" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-38">A Gentle Proof (Why It Works)</h4>
<p>Let <span class="math inline">\(\alpha \in (0.5, 1)\)</span>.</p>
<ul>
<li>Height bound: if height exceeds <span class="math inline">\(\log_{1/\alpha} n\)</span>, a scapegoat exists since some ancestor must violate <span class="math inline">\(\max\{|L|,\ |R|\} \le \alpha\,|T|\)</span>.</li>
<li>Amortization: each node participates in <span class="math inline">\(O(1)\)</span> rebuilds with <span class="math inline">\(\Theta(\text{size of its subtree})\)</span> work, so the total cost over <span class="math inline">\(m\)</span> operations is <span class="math inline">\(O(m \log n)\)</span>.</li>
<li>Deletion rule: rebuilding when <span class="math inline">\(n &lt; \alpha\,n_{\max}\)</span> prevents slack from accumulating.</li>
</ul>
</section>
<section id="try-it-yourself-38" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-38">Try It Yourself</h4>
<ol type="1">
<li>Insert ascending keys to trigger rebuilds with <span class="math inline">\(\alpha = \tfrac{2}{3}\)</span></li>
<li>Delete many keys so that <span class="math inline">\(n &lt; \alpha\,n_{\max}\)</span> and observe the global rebuild trigger</li>
<li>Experiment with different <span class="math inline">\(\alpha\)</span> values</li>
<li>Add an order statistic query using stored subtree sizes</li>
</ol>
</section>
<section id="test-cases-38" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-38">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 31%">
<col style="width: 4%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>α</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert ascending</td>
<td>[1..1000]</td>
<td>0.66</td>
<td>Height stays O(log n) with periodic rebuilds</td>
</tr>
<tr class="even">
<td>Mixed ops</td>
<td>random inserts and deletes</td>
<td>0.7</td>
<td>Amortized O(log n) per op</td>
</tr>
<tr class="odd">
<td>Shrink check</td>
<td>insert 1..200, delete 101..200</td>
<td>0.7</td>
<td>Global rebuild when size drops below α n_max</td>
</tr>
<tr class="even">
<td>Duplicate insert</td>
<td>insert 42 twice</td>
<td>0.66</td>
<td>size unchanged after second insert</td>
</tr>
</tbody>
</table>
<p>Edge Cases</p>
<ul>
<li>Rebuilding an empty or singleton subtree is a no-op<br>
</li>
<li>Duplicate keys are ignored or handled according to policy<br>
</li>
<li>Choose <span class="math inline">\(\alpha &gt; 0.5\)</span> to guarantee the existence of a scapegoat</li>
</ul>
</section>
<section id="complexity-38" class="level4">
<h4 class="anchored" data-anchor-id="complexity-38">Complexity</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td>O(h) worst, O(log n) amortized</td>
<td>O(1) extra</td>
</tr>
<tr class="even">
<td>Insert</td>
<td>Amortized O(log n)</td>
<td>O(1) extra plus rebuild buffer</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td>Amortized O(log n)</td>
<td>O(1) extra plus rebuild buffer</td>
</tr>
<tr class="even">
<td>Rebuild subtree</td>
<td>O(k) for k nodes in subtree</td>
<td>O(k) temporary array</td>
</tr>
</tbody>
</table>
<p>Scapegoat trees wait calmly until imbalance is undeniable, then rebuild decisively. The result is a BST that stays lean with minimal fuss.</p>
</section>
</section>
<section id="aa-tree" class="level3">
<h3 class="anchored" data-anchor-id="aa-tree">240 AA Tree</h3>
<p>An AA Tree is a simplified version of a red-black tree that maintains balance using a single level value per node (instead of color). It enforces balance by a small set of easy-to-code rules using two operations, <code>skew</code> and <code>split</code>. The simplicity of AA trees makes them a popular teaching and practical implementation choice when you want red-black performance without complex cases.</p>
<section id="what-problem-are-we-solving-39" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-39">What Problem Are We Solving?</h4>
<p>We want a balanced binary search tree with</p>
<ul>
<li>O(log n) time for insert/search/delete</li>
<li>Simpler code than red-black or AVL</li>
<li>Fewer rotation cases</li>
</ul>
<p>AA trees achieve this by using levels (like black-heights in RBTs) to enforce structure, ensuring a balanced shape with one rotation per fix.</p>
</section>
<section id="how-it-works-plain-language-4" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-4">How It Works (Plain Language)</h4>
<p>Each node has</p>
<ul>
<li><code>key</code>: stored value</li>
<li><code>level</code>: like black height (root = 1)</li>
</ul>
<p>AA-tree invariants:</p>
<ol type="1">
<li>Left child level &lt; node level</li>
<li>Right child level ≤ node level</li>
<li>Right-right grandchild level &lt; node level</li>
<li>Every leaf has level 1</li>
</ol>
<p>To restore balance after insert/delete, apply skew and split operations:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 53%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Rule</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Skew</td>
<td>If left.level == node.level</td>
<td>Rotate right</td>
</tr>
<tr class="even">
<td>Split</td>
<td>If right.right.level == node.level</td>
<td>Rotate left, level++</td>
</tr>
</tbody>
</table>
</section>
<section id="example-7" class="level4">
<h4 class="anchored" data-anchor-id="example-7">Example</h4>
<p>Insert keys [10, 20, 30]</p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 18%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Tree</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>10 (lvl 1)</td>
<td>-</td>
</tr>
<tr class="even">
<td>2</td>
<td>10 → 20</td>
<td>Skew none</td>
</tr>
<tr class="odd">
<td>3</td>
<td>10 → 20 → 30</td>
<td>Right-right violation → Split → Rotate left on 10</td>
</tr>
</tbody>
</table>
<p>Result:</p>
<pre><code>    20 (2)
   /  \
 10(1) 30(1)</code></pre>
</section>
<section id="step-by-step-example-8" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-example-8">Step-by-Step Example</h4>
<p>Insert [30, 20, 10, 25]</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 13%">
<col style="width: 42%">
<col style="width: 27%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Insertion</th>
<th>Violation</th>
<th>Fix</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>30</td>
<td>none</td>
<td>-</td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td>20</td>
<td>left child level = node level</td>
<td>Skew → Rotate right</td>
<td></td>
</tr>
<tr class="odd">
<td>3</td>
<td>10</td>
<td>deeper left</td>
<td>Skew &amp; Split</td>
<td>20 root</td>
</tr>
<tr class="even">
<td>4</td>
<td>25</td>
<td>insert right of 20</td>
<td>Split if needed</td>
<td>balanced</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-36" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-36">Tiny Code (Easy Versions)</h4>
<p>C</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb97"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">;</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> level<span class="op">;</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">;</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> new_node<span class="op">(</span><span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>level <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>left <span class="op">=</span> n<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_left<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> y <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y<span class="op">;</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> rotate_right<span class="op">(</span>Node<span class="op">*</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> x <span class="op">=</span> y<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>    y<span class="op">-&gt;</span>left <span class="op">=</span> x<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>    x<span class="op">-&gt;</span>right <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> skew<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x <span class="op">&amp;&amp;</span> x<span class="op">-&gt;</span>left <span class="op">&amp;&amp;</span> x<span class="op">-&gt;</span>left<span class="op">-&gt;</span>level <span class="op">==</span> x<span class="op">-&gt;</span>level<span class="op">)</span></span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> rotate_right<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> split<span class="op">(</span>Node<span class="op">*</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x <span class="op">&amp;&amp;</span> x<span class="op">-&gt;</span>right <span class="op">&amp;&amp;</span> x<span class="op">-&gt;</span>right<span class="op">-&gt;</span>right <span class="op">&amp;&amp;</span> x<span class="op">-&gt;</span>right<span class="op">-&gt;</span>right<span class="op">-&gt;</span>level <span class="op">==</span> x<span class="op">-&gt;</span>level<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> rotate_left<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a>        x<span class="op">-&gt;</span>level<span class="op">++;</span></span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb97-43"><a href="#cb97-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb97-44"><a href="#cb97-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-45"><a href="#cb97-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-46"><a href="#cb97-46" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> insert<span class="op">(</span>Node<span class="op">*</span> root<span class="op">,</span> <span class="dt">int</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-47"><a href="#cb97-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>root<span class="op">)</span> <span class="cf">return</span> new_node<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb97-48"><a href="#cb97-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span></span>
<span id="cb97-49"><a href="#cb97-49" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>left <span class="op">=</span> insert<span class="op">(</span>root<span class="op">-&gt;</span>left<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb97-50"><a href="#cb97-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>key <span class="op">&gt;</span> root<span class="op">-&gt;</span>key<span class="op">)</span></span>
<span id="cb97-51"><a href="#cb97-51" aria-hidden="true" tabindex="-1"></a>        root<span class="op">-&gt;</span>right <span class="op">=</span> insert<span class="op">(</span>root<span class="op">-&gt;</span>right<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb97-52"><a href="#cb97-52" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> skew<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb97-53"><a href="#cb97-53" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> split<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb97-54"><a href="#cb97-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root<span class="op">;</span></span>
<span id="cb97-55"><a href="#cb97-55" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-56"><a href="#cb97-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-57"><a href="#cb97-57" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> inorder<span class="op">(</span>Node<span class="op">*</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-58"><a href="#cb97-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>r<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb97-59"><a href="#cb97-59" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>r<span class="op">-&gt;</span>left<span class="op">);</span></span>
<span id="cb97-60"><a href="#cb97-60" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"(</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">) "</span><span class="op">,</span> r<span class="op">-&gt;</span>key<span class="op">,</span> r<span class="op">-&gt;</span>level<span class="op">);</span></span>
<span id="cb97-61"><a href="#cb97-61" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>r<span class="op">-&gt;</span>right<span class="op">);</span></span>
<span id="cb97-62"><a href="#cb97-62" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-63"><a href="#cb97-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-64"><a href="#cb97-64" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-65"><a href="#cb97-65" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> root <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb97-66"><a href="#cb97-66" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> keys<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">25</span><span class="op">};</span></span>
<span id="cb97-67"><a href="#cb97-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb97-68"><a href="#cb97-68" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> insert<span class="op">(</span>root<span class="op">,</span> keys<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb97-69"><a href="#cb97-69" aria-hidden="true" tabindex="-1"></a>    inorder<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb97-70"><a href="#cb97-70" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb97-71"><a href="#cb97-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.level <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">None</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_left(x):</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x.right</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y.left</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rotate_right(y):</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> y.left</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>    y.left <span class="op">=</span> x.right</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>    x.right <span class="op">=</span> y</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> skew(x):</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="kw">and</span> x.left <span class="kw">and</span> x.left.level <span class="op">==</span> x.level:</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> rotate_right(x)</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split(x):</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="kw">and</span> x.right <span class="kw">and</span> x.right.right <span class="kw">and</span> x.right.right.level <span class="op">==</span> x.level:</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> rotate_left(x)</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>        x.level <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(root, key):</span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root:</span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(key)</span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> key <span class="op">&lt;</span> root.key:</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>        root.left <span class="op">=</span> insert(root.left, key)</span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> key <span class="op">&gt;</span> root.key:</span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>        root.right <span class="op">=</span> insert(root.right, key)</span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> skew(root)</span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> split(root)</span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inorder(r):</span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> r: <span class="cf">return</span></span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a>    inorder(r.left)</span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"(</span><span class="sc">{</span>r<span class="sc">.</span>key<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>r<span class="sc">.</span>level<span class="sc">}</span><span class="ss">)"</span>, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a>    inorder(r.right)</span>
<span id="cb98-47"><a href="#cb98-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-48"><a href="#cb98-48" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb98-49"><a href="#cb98-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">15</span>, <span class="dv">25</span>]:</span>
<span id="cb98-50"><a href="#cb98-50" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> insert(root, k)</span>
<span id="cb98-51"><a href="#cb98-51" aria-hidden="true" tabindex="-1"></a>inorder(root)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-39" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-39">Why It Matters</h4>
<ul>
<li>Simpler than red-black</li>
<li>Only two balancing functions (skew, split)</li>
<li>Maintains O(log n) performance</li>
<li>Great teaching and reference structure for self-balancing BSTs</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-39" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-39">A Gentle Proof (Why It Works)</h4>
<p>AA-trees are a special case of red-black trees where</p>
<ul>
<li>Right-leaning red links represent level</li>
<li>Skew fixes left-leaning reds</li>
<li>Split fixes two consecutive rights</li>
</ul>
<p>These rules ensure black-height invariants and logarithmic height.</p>
</section>
<section id="try-it-yourself-39" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-39">Try It Yourself</h4>
<ol type="1">
<li>Insert ascending keys → observe periodic right rotations</li>
<li>Draw tree after each step → check levels</li>
<li>Compare structure to equivalent red-black tree</li>
<li>Modify split condition → see imbalance appear</li>
</ol>
</section>
<section id="test-cases-39" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-39">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Input Keys</th>
<th>Expected Root</th>
<th>Height</th>
<th>Balanced?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[10,20,30]</td>
<td>20</td>
<td>2</td>
<td>✅</td>
</tr>
<tr class="even">
<td>[1..10]</td>
<td>4–5</td>
<td>~log n</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>[30,20,10,25]</td>
<td>20</td>
<td>3</td>
<td>✅</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-39" class="level4">
<h4 class="anchored" data-anchor-id="complexity-39">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
<tr class="even">
<td>Search</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td>O(log n)</td>
<td>O(h)</td>
</tr>
</tbody>
</table>
<p>AA Trees blend red-black efficiency with AVL simplicity, balanced, elegant, and easy to reason about.</p>
</section>
</section>
</section>
<section id="section-25.-segment-trees-and-fenwick-trees" class="level2">
<h2 class="anchored" data-anchor-id="section-25.-segment-trees-and-fenwick-trees">Section 25. Segment Trees and Fenwick Trees</h2>
<section id="build-segment-tree" class="level3">
<h3 class="anchored" data-anchor-id="build-segment-tree">241 Build Segment Tree</h3>
<p>A segment tree is a binary tree over an array that stores range information for fast queries and updates. Building it means constructing the tree from the base array so each node summarizes a segment, like a sum, min, max, or gcd. The classic build time is O(n) and it enables O(log n) queries and updates.</p>
<section id="what-problem-are-we-solving-40" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-40">What Problem Are We Solving?</h4>
<p>We want to answer range questions quickly</p>
<ul>
<li>Sum on [l, r]</li>
<li>Min or max on [l, r]</li>
<li>Counts or bitwise ops on [l, r]</li>
</ul>
<p>If we precompute a segment tree, each internal node stores the merge of its two children. Then queries and updates touch only O(log n) nodes.</p>
<p>Goal Turn an array <code>A[0..n-1]</code> into a tree <code>T</code> where <code>T[v]</code> summarizes a segment <code>A[L..R]</code>.</p>
</section>
<section id="how-it-works-plain-language-5" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-5">How It Works (Plain Language)</h4>
<p>Represent the tree in an array (1 indexed for simplicity)</p>
<ul>
<li>Node <code>v</code> covers segment <code>[L, R]</code></li>
<li>Left child <code>2v</code> covers <code>[L, mid]</code></li>
<li>Right child <code>2v+1</code> covers <code>[mid+1, R]</code></li>
<li><code>T[v] = merge(T[2v], T[2v+1])</code> where <code>merge</code> is sum, min, max, etc.</li>
</ul>
<p>Build Steps</p>
<ol type="1">
<li>If <code>L == R</code>, store the leaf value <code>A[L]</code> in <code>T[v]</code>.</li>
<li>Else split at <code>mid</code>, recursively build left and right, then <code>T[v] = merge(left, right)</code>.</li>
</ol>
<p>Example Build (sum)</p>
<p>Array <code>A = [2, 1, 3, 4]</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node v</th>
<th>Segment [L,R]</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>[0,3]</td>
<td>10</td>
</tr>
<tr class="even">
<td>2</td>
<td>[0,1]</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>[2,3]</td>
<td>7</td>
</tr>
<tr class="even">
<td>4</td>
<td>[0,0]</td>
<td>2</td>
</tr>
<tr class="odd">
<td>5</td>
<td>[1,1]</td>
<td>1</td>
</tr>
<tr class="even">
<td>6</td>
<td>[2,2]</td>
<td>3</td>
</tr>
<tr class="odd">
<td>7</td>
<td>[3,3]</td>
<td>4</td>
</tr>
</tbody>
</table>
<p><code>merge = sum</code>, so <code>T[1] = 3 + 7 = 10</code>, leaves store the original values.</p>
<p>Another Example Build (min)</p>
<p>Array <code>A = [5, 2, 6, 1]</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node v</th>
<th>Segment [L,R]</th>
<th>Value (min)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>[0,3]</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>[0,1]</td>
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>[2,3]</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>[0,0]</td>
<td>5</td>
</tr>
<tr class="odd">
<td>5</td>
<td>[1,1]</td>
<td>2</td>
</tr>
<tr class="even">
<td>6</td>
<td>[2,2]</td>
<td>6</td>
</tr>
<tr class="odd">
<td>7</td>
<td>[3,3]</td>
<td>1</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-37" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-37">Tiny Code (Easy Versions)</h4>
<p>C (iterative storage size 4n, recursive build for sum)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb99"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100000</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> A<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> T<span class="op">[</span><span class="dv">4</span><span class="op">*</span>MAXN<span class="op">];</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> merge<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">,</span> <span class="dt">long</span> <span class="dt">long</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> build<span class="op">(</span><span class="dt">int</span> v<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">)</span> <span class="op">{</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>L <span class="op">==</span> R<span class="op">)</span> <span class="op">{</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>        T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> A<span class="op">[</span>L<span class="op">];</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>L <span class="op">+</span> R<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">,</span> L<span class="op">,</span> mid<span class="op">);</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> R<span class="op">);</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>    T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> merge<span class="op">(</span>T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">],</span> T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>    A<span class="op">[</span><span class="dv">0</span><span class="op">]=</span><span class="dv">2</span><span class="op">;</span> A<span class="op">[</span><span class="dv">1</span><span class="op">]=</span><span class="dv">1</span><span class="op">;</span> A<span class="op">[</span><span class="dv">2</span><span class="op">]=</span><span class="dv">3</span><span class="op">;</span> A<span class="op">[</span><span class="dv">3</span><span class="op">]=</span><span class="dv">4</span><span class="op">;</span></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> n<span class="op">-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> v <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> v <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> v<span class="op">++)</span> printf<span class="op">(</span><span class="st">"T[</span><span class="sc">%d</span><span class="st">]=</span><span class="sc">%lld\n</span><span class="st">"</span><span class="op">,</span> v<span class="op">,</span> T<span class="op">[</span>v<span class="op">]);</span></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (sum segment tree, recursive build)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build(arr):</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(arr)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> size <span class="op">&lt;</span> n:</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>        size <span class="op">&lt;&lt;=</span> <span class="dv">1</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    T <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> (<span class="dv">2</span> <span class="op">*</span> size)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># leaves</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>        T[size <span class="op">+</span> i] <span class="op">=</span> arr[i]</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># internal nodes</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(size <span class="op">-</span> <span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>        T[v] <span class="op">=</span> T[<span class="dv">2</span><span class="op">*</span>v] <span class="op">+</span> T[<span class="dv">2</span><span class="op">*</span>v <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T, size  <span class="co"># T is 1..size*2-1, leaves start at index size</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>]</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>T, base <span class="op">=</span> build(A)</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a><span class="co"># T[1] holds sum of all, T[base+i] holds A[i]</span></span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Root sum:"</span>, T[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Notes</p>
<ul>
<li>The C version shows classic recursive top down build.</li>
<li>The Python version shows an iterative bottom up build using a power of two base, also O(n).</li>
</ul>
</section>
<section id="why-it-matters-40" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-40">Why It Matters</h4>
<ul>
<li><p>Preprocessing time O(n) enables</p>
<ul>
<li>Range queries in O(log n)</li>
<li>Point updates in O(log n)</li>
</ul></li>
<li><p>Choice of <code>merge</code> adapts the tree to many tasks</p>
<ul>
<li>sum, min, max, gcd, bitwise and, custom structs</li>
</ul></li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-40" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-40">A Gentle Proof (Why It Works)</h4>
<p>Each element appears in exactly one leaf and contributes to O(1) nodes per level. The tree has O(log n) levels. Total number of nodes built is at most 2n, so total work is O(n).</p>
</section>
<section id="try-it-yourself-40" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-40">Try It Yourself</h4>
<ol type="1">
<li>Change <code>merge</code> to <code>min</code> or <code>max</code> and rebuild.</li>
<li>Build then verify that <code>T[1]</code> equals <code>sum(A)</code>.</li>
<li>Print the tree level by level to visualize segments.</li>
<li>Extend the structure to support point update and range query.</li>
</ol>
</section>
<section id="test-cases-40" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-40">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 30%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th>Array A</th>
<th>Merge</th>
<th>Expected Root T[1]</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[2,1,3,4]</td>
<td>sum</td>
<td>10</td>
<td>basic sum tree</td>
</tr>
<tr class="even">
<td>[5,2,6,1]</td>
<td>min</td>
<td>1</td>
<td>switch merge to min</td>
</tr>
<tr class="odd">
<td>[7]</td>
<td>sum</td>
<td>7</td>
<td>single element</td>
</tr>
<tr class="even">
<td>[]</td>
<td>sum</td>
<td>0 or no tree</td>
<td>handle empty as special case</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-40" class="level4">
<h4 class="anchored" data-anchor-id="complexity-40">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Phase</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(log n)</td>
<td>O(1) extra</td>
</tr>
<tr class="odd">
<td>Point update</td>
<td>O(log n)</td>
<td>O(1) extra</td>
</tr>
</tbody>
</table>
<p>Build once, answer fast forever. A segment tree turns an array into a range answering machine.</p>
</section>
</section>
<section id="range-sum-query" class="level3">
<h3 class="anchored" data-anchor-id="range-sum-query">242 Range Sum Query</h3>
<p>A Range Sum Query (RSQ) retrieves the sum of elements in a subarray <code>[L, R]</code> using a segment tree. Once the tree is built, each query runs in O(log n) time, by combining results from the minimal set of segments covering <code>[L, R]</code>.</p>
<section id="what-problem-are-we-solving-41" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-41">What Problem Are We Solving?</h4>
<p>Given an array <code>A[0..n-1]</code>, we want to answer queries like</p>
<pre><code>sum(A[L..R])  </code></pre>
<p>quickly, without recalculating from scratch each time.</p>
<p>Naive approach: O(R–L+1) per query Segment tree approach: O(log n) per query after O(n) build.</p>
</section>
<section id="how-it-works-plain-language-6" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-6">How It Works (Plain Language)</h4>
<p>We maintain a segment tree <code>T</code> built as before (<code>T[v]</code> = sum of segment). To answer <code>query(v, L, R, qL, qR)</code></p>
<ol type="1">
<li>If segment <code>[L, R]</code> is fully outside <code>[qL, qR]</code>, return 0.</li>
<li>If segment <code>[L, R]</code> is fully inside, return <code>T[v]</code>.</li>
<li>Otherwise, split at <code>mid</code> and combine results from left and right children.</li>
</ol>
<p>So each query visits only O(log n) nodes, each exactly covering part of the query range.</p>
</section>
<section id="example-8" class="level4">
<h4 class="anchored" data-anchor-id="example-8">Example</h4>
<p>Array: <code>A = [2, 1, 3, 4, 5]</code></p>
<p>Query: sum on [1,3] (1-based: elements 1..3 = 1+3+4=8)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 22%">
<col style="width: 8%">
<col style="width: 36%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>Node v</th>
<th>Segment [L,R]</th>
<th>Value</th>
<th>Relationship to [1,3]</th>
<th>Contribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>[0,4]</td>
<td>15</td>
<td>overlaps</td>
<td>recurse</td>
</tr>
<tr class="even">
<td>2</td>
<td>[0,2]</td>
<td>6</td>
<td>overlaps</td>
<td>recurse</td>
</tr>
<tr class="odd">
<td>3</td>
<td>[3,4]</td>
<td>9</td>
<td>overlaps</td>
<td>recurse</td>
</tr>
<tr class="even">
<td>4</td>
<td>[0,1]</td>
<td>3</td>
<td>partial</td>
<td>recurse</td>
</tr>
<tr class="odd">
<td>5</td>
<td>[2,2]</td>
<td>3</td>
<td>inside</td>
<td>+3</td>
</tr>
<tr class="even">
<td>8</td>
<td>[0,0]</td>
<td>2</td>
<td>outside</td>
<td>skip</td>
</tr>
<tr class="odd">
<td>9</td>
<td>[1,1]</td>
<td>1</td>
<td>inside</td>
<td>+1</td>
</tr>
<tr class="even">
<td>6</td>
<td>[3,3]</td>
<td>4</td>
<td>inside</td>
<td>+4</td>
</tr>
<tr class="odd">
<td>7</td>
<td>[4,4]</td>
<td>5</td>
<td>outside</td>
<td>skip</td>
</tr>
</tbody>
</table>
<p>Sum = 1 + 3 + 4 = 8 ✅</p>
</section>
<section id="step-by-step-table-for-clarity" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-table-for-clarity">Step-by-Step Table (for clarity)</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Current Segment</th>
<th>Covered?</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>[0,4]</td>
<td>Overlaps [1,3]</td>
<td>Split</td>
</tr>
<tr class="even">
<td>2</td>
<td>[0,2]</td>
<td>Overlaps [1,3]</td>
<td>Split</td>
</tr>
<tr class="odd">
<td>3</td>
<td>[3,4]</td>
<td>Overlaps [1,3]</td>
<td>Split</td>
</tr>
<tr class="even">
<td>4</td>
<td>[0,1]</td>
<td>Overlaps</td>
<td>Split</td>
</tr>
<tr class="odd">
<td>5</td>
<td>[0,0]</td>
<td>Outside</td>
<td>Return 0</td>
</tr>
<tr class="even">
<td>6</td>
<td>[1,1]</td>
<td>Inside</td>
<td>Return 1</td>
</tr>
<tr class="odd">
<td>7</td>
<td>[2,2]</td>
<td>Inside</td>
<td>Return 3</td>
</tr>
<tr class="even">
<td>8</td>
<td>[3,3]</td>
<td>Inside</td>
<td>Return 4</td>
</tr>
<tr class="odd">
<td>9</td>
<td>[4,4]</td>
<td>Outside</td>
<td>Return 0</td>
</tr>
</tbody>
</table>
<p>Total = 1+3+4 = 8</p>
</section>
<section id="tiny-code-easy-versions-38" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-38">Tiny Code (Easy Versions)</h4>
<p>C (Recursive RSQ)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb102"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100000</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> A<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> T<span class="op">[</span><span class="dv">4</span><span class="op">*</span>MAXN<span class="op">];</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> merge<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">,</span> <span class="dt">long</span> <span class="dt">long</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> build<span class="op">(</span><span class="dt">int</span> v<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">)</span> <span class="op">{</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>L <span class="op">==</span> R<span class="op">)</span> <span class="op">{</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>        T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> A<span class="op">[</span>L<span class="op">];</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>L <span class="op">+</span> R<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">,</span> L<span class="op">,</span> mid<span class="op">);</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> R<span class="op">);</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>    T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> merge<span class="op">(</span>T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">],</span> T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> query<span class="op">(</span><span class="dt">int</span> v<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">,</span> <span class="dt">int</span> qL<span class="op">,</span> <span class="dt">int</span> qR<span class="op">)</span> <span class="op">{</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>qR <span class="op">&lt;</span> L <span class="op">||</span> R <span class="op">&lt;</span> qL<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// disjoint</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>qL <span class="op">&lt;=</span> L <span class="op">&amp;&amp;</span> R <span class="op">&lt;=</span> qR<span class="op">)</span> <span class="cf">return</span> T<span class="op">[</span>v<span class="op">];</span> <span class="co">// fully covered</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>L <span class="op">+</span> R<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> left <span class="op">=</span> query<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">,</span> L<span class="op">,</span> mid<span class="op">,</span> qL<span class="op">,</span> qR<span class="op">);</span></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> right <span class="op">=</span> query<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> R<span class="op">,</span> qL<span class="op">,</span> qR<span class="op">);</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merge<span class="op">(</span>left<span class="op">,</span> right<span class="op">);</span></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> Avals<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">2</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">5</span><span class="op">};</span></span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>n<span class="op">;</span>i<span class="op">++)</span> A<span class="op">[</span>i<span class="op">]=</span>Avals<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> n<span class="op">-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Sum [1,3] = </span><span class="sc">%lld\n</span><span class="st">"</span><span class="op">,</span> query<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>n<span class="op">-</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">));</span> <span class="co">// expect 8</span></span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (Iterative)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build(arr):</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(arr)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> size <span class="op">&lt;</span> n:</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>        size <span class="op">&lt;&lt;=</span> <span class="dv">1</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    T <span class="op">=</span> [<span class="dv">0</span>]<span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>size)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># leaves</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>        T[size<span class="op">+</span>i] <span class="op">=</span> arr[i]</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># parents</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(size<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>        T[v] <span class="op">=</span> T[<span class="dv">2</span><span class="op">*</span>v] <span class="op">+</span> T[<span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T, size</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> query(T, base, l, r):</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>    l <span class="op">+=</span> base</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>    r <span class="op">+=</span> base</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> l <span class="op">&lt;=</span> r:</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> l <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>            res <span class="op">+=</span> T[l]</span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>            l <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>            res <span class="op">+=</span> T[r]</span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>            r <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>        l <span class="op">//=</span> <span class="dv">2</span></span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>        r <span class="op">//=</span> <span class="dv">2</span></span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a>T, base <span class="op">=</span> build(A)</span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sum [1,3] ="</span>, query(T, base, <span class="dv">1</span>, <span class="dv">3</span>))  <span class="co"># expect 8</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-41" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-41">Why It Matters</h4>
<ul>
<li><p>Enables fast range queries on static or dynamic arrays.</p></li>
<li><p>Foundation for many extensions:</p>
<ul>
<li>Range min/max query (change merge)</li>
<li>Lazy propagation (for range updates)</li>
<li>2D and persistent trees</li>
</ul></li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-41" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-41">A Gentle Proof (Why It Works)</h4>
<p>Each level of recursion splits into disjoint segments. At most 2 segments per level are added to the result. Depth = O(log n), so total work = O(log n).</p>
</section>
<section id="try-it-yourself-41" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-41">Try It Yourself</h4>
<ol type="1">
<li>Query different [L, R] ranges after build.</li>
<li>Replace <code>merge</code> with <code>min()</code> or <code>max()</code> and verify results.</li>
<li>Combine queries to verify overlapping segments are counted once.</li>
<li>Add update operation to change elements and re-query.</li>
</ol>
</section>
<section id="test-cases-41" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-41">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Array A</th>
<th>Query [L,R]</th>
<th>Expected</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[2,1,3,4,5]</td>
<td>[1,3]</td>
<td>8</td>
<td>1+3+4</td>
</tr>
<tr class="even">
<td>[5,5,5,5]</td>
<td>[0,3]</td>
<td>20</td>
<td>uniform</td>
</tr>
<tr class="odd">
<td>[1,2,3,4,5]</td>
<td>[2,4]</td>
<td>12</td>
<td>3+4+5</td>
</tr>
<tr class="even">
<td>[7]</td>
<td>[0,0]</td>
<td>7</td>
<td>single element</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-41" class="level4">
<h4 class="anchored" data-anchor-id="complexity-41">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Query</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Build</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr class="odd">
<td>Update</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>Segment trees let you ask <em>“what’s in this range?”</em>, and get the answer fast, no matter how big the array.</p>
</section>
</section>
<section id="range-update-lazy-propagation-technique" class="level3">
<h3 class="anchored" data-anchor-id="range-update-lazy-propagation-technique">243 Range Update (Lazy Propagation Technique)</h3>
<p>A range update modifies all elements in a segment <code>[L, R]</code> efficiently. Without optimization, you’d touch every element, O(n). With lazy propagation, you defer work, storing pending updates in a separate array, achieving O(log n) time per update and query.</p>
<p>This pattern is essential when many updates overlap, like adding +5 to every element in [2, 6] repeatedly.</p>
<section id="what-problem-are-we-solving-42" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-42">What Problem Are We Solving?</h4>
<p>We want to efficiently support both:</p>
<ol type="1">
<li>Range updates: Add or set a value over <code>[L, R]</code></li>
<li>Range queries: Get sum/min/max over <code>[L, R]</code></li>
</ol>
<p>Naive solution: O(R–L+1) per update. Lazy propagation: O(log n) per update/query.</p>
<p>Example goal:</p>
<pre><code>add +3 to A[2..5]
then query sum(A[0..7])</code></pre>
</section>
<section id="how-it-works-plain-language-7" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-7">How It Works (Plain Language)</h4>
<p>Each segment node <code>T[v]</code> stores summary (e.g.&nbsp;sum). Each node <code>lazy[v]</code> stores pending update (not yet pushed to children).</p>
<p>When updating <code>[L, R]</code>:</p>
<ul>
<li>If node’s segment is fully inside, apply update directly to <code>T[v]</code> and mark <code>lazy[v]</code> (no recursion).</li>
<li>If partially overlapping, push pending updates down, then recurse.</li>
</ul>
<p>When querying <code>[L, R]</code>:</p>
<ul>
<li>Push any pending updates first</li>
<li>Combine child results as usual</li>
</ul>
<p>This way, each node is updated at most once per path, giving O(log n).</p>
</section>
<section id="example-9" class="level4">
<h4 class="anchored" data-anchor-id="example-9">Example</h4>
<p>Array: <code>A = [1, 2, 3, 4, 5, 6, 7, 8]</code> Build tree for sum.</p>
<p>Step 1: Range update <code>[2, 5]</code> += 3</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node</th>
<th>Segment</th>
<th>Action</th>
<th>lazy[]</th>
<th>T[] sum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>[0,7]</td>
<td>overlaps → recurse</td>
<td>0</td>
<td>unchanged</td>
</tr>
<tr class="even">
<td>2</td>
<td>[0,3]</td>
<td>overlaps → recurse</td>
<td>0</td>
<td>unchanged</td>
</tr>
<tr class="odd">
<td>3</td>
<td>[4,7]</td>
<td>overlaps → recurse</td>
<td>0</td>
<td>unchanged</td>
</tr>
<tr class="even">
<td>4</td>
<td>[0,1]</td>
<td>outside</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>5</td>
<td>[2,3]</td>
<td>inside → add +3×2=6</td>
<td>lazy[5]=3</td>
<td>T[5]+=6</td>
</tr>
<tr class="even">
<td>6</td>
<td>[4,5]</td>
<td>inside → add +3×2=6</td>
<td>lazy[6]=3</td>
<td>T[6]+=6</td>
</tr>
</tbody>
</table>
<p>Later queries automatically apply +3 to affected subranges.</p>
</section>
<section id="step-by-step-example-9" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-example-9">Step-by-Step Example</h4>
<p>Let’s trace two operations:</p>
<ol type="1">
<li><code>update(2,5,+3)</code></li>
<li><code>query(0,7)</code></li>
</ol>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Action</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td>sum = [1,2,3,4,5,6,7,8] → 36</td>
<td>T[1]=36</td>
</tr>
<tr class="even">
<td>Update</td>
<td>mark lazy for segments fully in [2,5]</td>
<td>T[v]+=3×len</td>
</tr>
<tr class="odd">
<td>Query</td>
<td>propagate lazy before using T[v]</td>
<td>sum = 36 + 3×4 = 48</td>
</tr>
</tbody>
</table>
<p>Result after update: total = 48 ✅</p>
</section>
<section id="tiny-code-easy-versions-39" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-39">Tiny Code (Easy Versions)</h4>
<p>C (Recursive, sum tree with lazy add)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb105"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100000</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> A<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> T<span class="op">[</span><span class="dv">4</span><span class="op">*</span>MAXN<span class="op">],</span> lazy<span class="op">[</span><span class="dv">4</span><span class="op">*</span>MAXN<span class="op">];</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> merge<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">,</span> <span class="dt">long</span> <span class="dt">long</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> build<span class="op">(</span><span class="dt">int</span> v<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">)</span> <span class="op">{</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>L <span class="op">==</span> R<span class="op">)</span> <span class="op">{</span> T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> A<span class="op">[</span>L<span class="op">];</span> <span class="cf">return</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>L <span class="op">+</span> R<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">,</span> L<span class="op">,</span> mid<span class="op">);</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> R<span class="op">);</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>    T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> merge<span class="op">(</span>T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">],</span> T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> push<span class="op">(</span><span class="dt">int</span> v<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">)</span> <span class="op">{</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>lazy<span class="op">[</span>v<span class="op">]</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>        T<span class="op">[</span>v<span class="op">]</span> <span class="op">+=</span> lazy<span class="op">[</span>v<span class="op">]</span> <span class="op">*</span> <span class="op">(</span>R <span class="op">-</span> L <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>L <span class="op">!=</span> R<span class="op">)</span> <span class="op">{</span></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>            lazy<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">]</span> <span class="op">+=</span> lazy<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>            lazy<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">]</span> <span class="op">+=</span> lazy<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>        lazy<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> update<span class="op">(</span><span class="dt">int</span> v<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">,</span> <span class="dt">int</span> qL<span class="op">,</span> <span class="dt">int</span> qR<span class="op">,</span> <span class="dt">int</span> val<span class="op">)</span> <span class="op">{</span></span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>    push<span class="op">(</span>v<span class="op">,</span> L<span class="op">,</span> R<span class="op">);</span></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>qR <span class="op">&lt;</span> L <span class="op">||</span> R <span class="op">&lt;</span> qL<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>qL <span class="op">&lt;=</span> L <span class="op">&amp;&amp;</span> R <span class="op">&lt;=</span> qR<span class="op">)</span> <span class="op">{</span></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>        lazy<span class="op">[</span>v<span class="op">]</span> <span class="op">+=</span> val<span class="op">;</span></span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>        push<span class="op">(</span>v<span class="op">,</span> L<span class="op">,</span> R<span class="op">);</span></span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>L <span class="op">+</span> R<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a>    update<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">,</span> L<span class="op">,</span> mid<span class="op">,</span> qL<span class="op">,</span> qR<span class="op">,</span> val<span class="op">);</span></span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a>    update<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> R<span class="op">,</span> qL<span class="op">,</span> qR<span class="op">,</span> val<span class="op">);</span></span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a>    T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> merge<span class="op">(</span>T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">],</span> T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> query<span class="op">(</span><span class="dt">int</span> v<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">,</span> <span class="dt">int</span> qL<span class="op">,</span> <span class="dt">int</span> qR<span class="op">)</span> <span class="op">{</span></span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a>    push<span class="op">(</span>v<span class="op">,</span> L<span class="op">,</span> R<span class="op">);</span></span>
<span id="cb105-44"><a href="#cb105-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>qR <span class="op">&lt;</span> L <span class="op">||</span> R <span class="op">&lt;</span> qL<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb105-45"><a href="#cb105-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>qL <span class="op">&lt;=</span> L <span class="op">&amp;&amp;</span> R <span class="op">&lt;=</span> qR<span class="op">)</span> <span class="cf">return</span> T<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb105-46"><a href="#cb105-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>L <span class="op">+</span> R<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb105-47"><a href="#cb105-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merge<span class="op">(</span>query<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">,</span> L<span class="op">,</span> mid<span class="op">,</span> qL<span class="op">,</span> qR<span class="op">),</span> query<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> R<span class="op">,</span> qL<span class="op">,</span> qR<span class="op">));</span></span>
<span id="cb105-48"><a href="#cb105-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb105-49"><a href="#cb105-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-50"><a href="#cb105-50" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb105-51"><a href="#cb105-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="cb105-52"><a href="#cb105-52" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> vals<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">6</span><span class="op">,</span><span class="dv">7</span><span class="op">,</span><span class="dv">8</span><span class="op">};</span></span>
<span id="cb105-53"><a href="#cb105-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>n<span class="op">;</span>i<span class="op">++)</span> A<span class="op">[</span>i<span class="op">]=</span>vals<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb105-54"><a href="#cb105-54" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>n<span class="op">-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb105-55"><a href="#cb105-55" aria-hidden="true" tabindex="-1"></a>    update<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>n<span class="op">-</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb105-56"><a href="#cb105-56" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Sum [0,7] = </span><span class="sc">%lld\n</span><span class="st">"</span><span class="op">,</span> query<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>n<span class="op">-</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">7</span><span class="op">));</span> <span class="co">// expect 48</span></span>
<span id="cb105-57"><a href="#cb105-57" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (Iterative version)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LazySegTree:</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, arr):</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(arr)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>        size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> size <span class="op">&lt;</span> n: size <span class="op">&lt;&lt;=</span> <span class="dv">1</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> n<span class="op">;</span> <span class="va">self</span>.size <span class="op">=</span> size</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.T <span class="op">=</span> [<span class="dv">0</span>]<span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>size)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.lazy <span class="op">=</span> [<span class="dv">0</span>]<span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>size)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n): <span class="va">self</span>.T[size<span class="op">+</span>i] <span class="op">=</span> arr[i]</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.T[i] <span class="op">=</span> <span class="va">self</span>.T[<span class="dv">2</span><span class="op">*</span>i] <span class="op">+</span> <span class="va">self</span>.T[<span class="dv">2</span><span class="op">*</span>i<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _apply(<span class="va">self</span>, v, val, length):</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.T[v] <span class="op">+=</span> val <span class="op">*</span> length</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">&lt;</span> <span class="va">self</span>.size:</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.lazy[v] <span class="op">+=</span> val</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _push(<span class="va">self</span>, v, length):</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.lazy[v]:</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._apply(<span class="dv">2</span><span class="op">*</span>v, <span class="va">self</span>.lazy[v], length<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._apply(<span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span>, <span class="va">self</span>.lazy[v], length<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.lazy[v] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update(<span class="va">self</span>, l, r, val):</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _upd(v, L, R):</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> r <span class="op">&lt;</span> L <span class="kw">or</span> R <span class="op">&lt;</span> l: <span class="cf">return</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l <span class="op">&lt;=</span> L <span class="kw">and</span> R <span class="op">&lt;=</span> r:</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._apply(v, val, R<span class="op">-</span>L<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._push(v, R<span class="op">-</span>L<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>            mid <span class="op">=</span> (L<span class="op">+</span>R)<span class="op">//</span><span class="dv">2</span></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>            _upd(<span class="dv">2</span><span class="op">*</span>v, L, mid)</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>            _upd(<span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span>, mid<span class="op">+</span><span class="dv">1</span>, R)</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.T[v] <span class="op">=</span> <span class="va">self</span>.T[<span class="dv">2</span><span class="op">*</span>v] <span class="op">+</span> <span class="va">self</span>.T[<span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>        _upd(<span class="dv">1</span>, <span class="dv">0</span>, <span class="va">self</span>.size<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> query(<span class="va">self</span>, l, r):</span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _qry(v, L, R):</span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> r <span class="op">&lt;</span> L <span class="kw">or</span> R <span class="op">&lt;</span> l: <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l <span class="op">&lt;=</span> L <span class="kw">and</span> R <span class="op">&lt;=</span> r:</span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.T[v]</span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._push(v, R<span class="op">-</span>L<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a>            mid <span class="op">=</span> (L<span class="op">+</span>R)<span class="op">//</span><span class="dv">2</span></span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> _qry(<span class="dv">2</span><span class="op">*</span>v, L, mid) <span class="op">+</span> _qry(<span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span>, mid<span class="op">+</span><span class="dv">1</span>, R)</span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> _qry(<span class="dv">1</span>, <span class="dv">0</span>, <span class="va">self</span>.size<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>]</span>
<span id="cb106-48"><a href="#cb106-48" aria-hidden="true" tabindex="-1"></a>st <span class="op">=</span> LazySegTree(A)</span>
<span id="cb106-49"><a href="#cb106-49" aria-hidden="true" tabindex="-1"></a>st.update(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">3</span>)</span>
<span id="cb106-50"><a href="#cb106-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sum [0,7] ="</span>, st.query(<span class="dv">0</span>,<span class="dv">7</span>))  <span class="co"># expect 48</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-42" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-42">Why It Matters</h4>
<ul>
<li>Crucial for problems with many overlapping updates</li>
<li>Used in range-add, range-assign, interval covering, and 2D extensions</li>
<li>Foundation for Segment Tree Beats</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-42" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-42">A Gentle Proof (Why It Works)</h4>
<p>Each update marks at most one node per level as “lazy.” When queried later, we “push” those updates downward once. Each node’s pending updates applied O(1) times → total cost O(log n).</p>
</section>
<section id="try-it-yourself-42" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-42">Try It Yourself</h4>
<ol type="1">
<li>Build <code>[1,2,3,4,5]</code> → update [1,3] += 2 → query sum [0,4] → expect 21</li>
<li>Update [0,4] += 1 → query [2,4] → expect 3+2+2+1+1 = 15</li>
<li>Combine multiple updates → verify cumulative results</li>
</ol>
</section>
<section id="test-cases-42" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-42">Test Cases</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 27%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Array</th>
<th>Query</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>update [2,5] += 3</td>
<td>[1,2,3,4,5,6,7,8]</td>
<td>sum [0,7]</td>
<td>48</td>
</tr>
<tr class="even">
<td>update [0,3] += 2</td>
<td>[5,5,5,5]</td>
<td>sum [1,2]</td>
<td>14</td>
</tr>
<tr class="odd">
<td>two updates</td>
<td>[1,1,1,1,1]</td>
<td>[1,3] +1, [2,4] +2</td>
<td>[1,3] sum = 10</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-42" class="level4">
<h4 class="anchored" data-anchor-id="complexity-42">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Range update</td>
<td>O(log n)</td>
<td>O(n)</td>
</tr>
<tr class="even">
<td>Range query</td>
<td>O(log n)</td>
<td>O(n)</td>
</tr>
<tr class="odd">
<td>Build</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
</tbody>
</table>
<p>Lazy propagation, work smarter, not harder. Apply only what’s needed, when it’s needed.</p>
</section>
</section>
<section id="point-update" class="level3">
<h3 class="anchored" data-anchor-id="point-update">244 Point Update</h3>
<p>A point update changes a single element in the array and updates all relevant segment tree nodes along the path to the root. This operation ensures the segment tree remains consistent for future range queries.</p>
<p>Unlike range updates (which mark many elements at once), point updates touch only O(log n) nodes, one per level.</p>
<section id="what-problem-are-we-solving-43" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-43">What Problem Are We Solving?</h4>
<p>Given a segment tree built over <code>A[0..n-1]</code>, we want to:</p>
<ul>
<li>Change one element: <code>A[pos] = new_value</code></li>
<li>Reflect the change in the segment tree so all range queries stay correct</li>
</ul>
<p>Goal: Update efficiently, no full rebuild</p>
<p>Naive: rebuild tree → O(n) Segment tree point update: O(log n)</p>
</section>
<section id="how-it-works-plain-language-8" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-8">How It Works (Plain Language)</h4>
<p>Every tree node <code>T[v]</code> represents a segment <code>[L, R]</code>. When <code>pos</code> lies within <code>[L, R]</code>, that node’s value might need adjustment.</p>
<p>Algorithm (recursive):</p>
<ol type="1">
<li><p>If <code>L == R == pos</code>, assign <code>A[pos] = val</code>, set <code>T[v] = val</code>.</p></li>
<li><p>Else, find <code>mid</code>.</p>
<ul>
<li>Recurse into left or right child depending on <code>pos</code>.</li>
<li>After child updates, recompute <code>T[v] = merge(T[2v], T[2v+1])</code>.</li>
</ul></li>
</ol>
<p>No lazy propagation needed, it’s a direct path down the tree.</p>
</section>
<section id="example-10" class="level4">
<h4 class="anchored" data-anchor-id="example-10">Example</h4>
<p>Array: <code>A = [2, 1, 3, 4]</code> Tree stores sum.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node</th>
<th>Range</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>[0,3]</td>
<td>10</td>
</tr>
<tr class="even">
<td>2</td>
<td>[0,1]</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>[2,3]</td>
<td>7</td>
</tr>
<tr class="even">
<td>4</td>
<td>[0,0]</td>
<td>2</td>
</tr>
<tr class="odd">
<td>5</td>
<td>[1,1]</td>
<td>1</td>
</tr>
<tr class="even">
<td>6</td>
<td>[2,2]</td>
<td>3</td>
</tr>
<tr class="odd">
<td>7</td>
<td>[3,3]</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>Operation: <code>A[1] = 5</code></p>
<p>Path: [1, 2, 5]</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Node</th>
<th>Old Value</th>
<th>New Value</th>
<th>Update</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Leaf</td>
<td>5</td>
<td>1</td>
<td>5</td>
<td>T[5]=5</td>
</tr>
<tr class="even">
<td>Parent</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>T[2]=2+5=7</td>
</tr>
<tr class="odd">
<td>Root</td>
<td>1</td>
<td>10</td>
<td>14</td>
<td>T[1]=7+7=14</td>
</tr>
</tbody>
</table>
<p>New array: <code>[2, 5, 3, 4]</code> New sum: 14 ✅</p>
</section>
<section id="step-by-step-trace" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-trace">Step-by-Step Trace</h4>
<pre><code>update(v=1, L=0, R=3, pos=1, val=5)
  mid=1
  -&gt; pos&lt;=mid → left child (v=2)
    update(v=2, L=0, R=1)
      mid=0
      -&gt; pos&gt;mid → right child (v=5)
        update(v=5, L=1, R=1)
        T[5]=5
      T[2]=merge(T[4]=2, T[5]=5)=7
  T[1]=merge(T[2]=7, T[3]=7)=14</code></pre>
</section>
<section id="tiny-code-easy-versions-40" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-40">Tiny Code (Easy Versions)</h4>
<p>C (Recursive, sum merge)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb108"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100000</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> A<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> T<span class="op">[</span><span class="dv">4</span><span class="op">*</span>MAXN<span class="op">];</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> merge<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">,</span> <span class="dt">long</span> <span class="dt">long</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> build<span class="op">(</span><span class="dt">int</span> v<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">)</span> <span class="op">{</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>L <span class="op">==</span> R<span class="op">)</span> <span class="op">{</span> T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> A<span class="op">[</span>L<span class="op">];</span> <span class="cf">return</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>L <span class="op">+</span> R<span class="op">)/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">,</span> L<span class="op">,</span> mid<span class="op">);</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> R<span class="op">);</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>    T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> merge<span class="op">(</span>T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">],</span> T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> point_update<span class="op">(</span><span class="dt">int</span> v<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">,</span> <span class="dt">int</span> pos<span class="op">,</span> <span class="dt">int</span> val<span class="op">)</span> <span class="op">{</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>L <span class="op">==</span> R<span class="op">)</span> <span class="op">{</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>        T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>        A<span class="op">[</span>pos<span class="op">]</span> <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>L <span class="op">+</span> R<span class="op">)/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pos <span class="op">&lt;=</span> mid<span class="op">)</span> point_update<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">,</span> L<span class="op">,</span> mid<span class="op">,</span> pos<span class="op">,</span> val<span class="op">);</span></span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> point_update<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> R<span class="op">,</span> pos<span class="op">,</span> val<span class="op">);</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>    T<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> merge<span class="op">(</span>T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">],</span> T<span class="op">[</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> query<span class="op">(</span><span class="dt">int</span> v<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">,</span> <span class="dt">int</span> qL<span class="op">,</span> <span class="dt">int</span> qR<span class="op">)</span> <span class="op">{</span></span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>qR <span class="op">&lt;</span> L <span class="op">||</span> R <span class="op">&lt;</span> qL<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>qL <span class="op">&lt;=</span> L <span class="op">&amp;&amp;</span> R <span class="op">&lt;=</span> qR<span class="op">)</span> <span class="cf">return</span> T<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>L <span class="op">+</span> R<span class="op">)/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merge<span class="op">(</span>query<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">,</span> L<span class="op">,</span> mid<span class="op">,</span> qL<span class="op">,</span> qR<span class="op">),</span> query<span class="op">(</span><span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> R<span class="op">,</span> qL<span class="op">,</span> qR<span class="op">));</span></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> vals<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">2</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">};</span></span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>n<span class="op">;</span>i<span class="op">++)</span> A<span class="op">[</span>i<span class="op">]=</span>vals<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>n<span class="op">-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Before: sum [0,3] = </span><span class="sc">%lld\n</span><span class="st">"</span><span class="op">,</span> query<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>n<span class="op">-</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">3</span><span class="op">));</span> <span class="co">// 10</span></span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>    point_update<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>n<span class="op">-</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">5</span><span class="op">);</span></span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"After:  sum [0,3] = </span><span class="sc">%lld\n</span><span class="st">"</span><span class="op">,</span> query<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>n<span class="op">-</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">3</span><span class="op">));</span> <span class="co">// 14</span></span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (Iterative)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build(arr):</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(arr)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> size <span class="op">&lt;</span> n: size <span class="op">&lt;&lt;=</span> <span class="dv">1</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    T <span class="op">=</span> [<span class="dv">0</span>]<span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>size)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>        T[size<span class="op">+</span>i] <span class="op">=</span> arr[i]</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(size<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>        T[v] <span class="op">=</span> T[<span class="dv">2</span><span class="op">*</span>v] <span class="op">+</span> T[<span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T, size</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update(T, base, pos, val):</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> base <span class="op">+</span> pos</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>    T[v] <span class="op">=</span> val</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>    v <span class="op">//=</span> <span class="dv">2</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> v <span class="op">&gt;=</span> <span class="dv">1</span>:</span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>        T[v] <span class="op">=</span> T[<span class="dv">2</span><span class="op">*</span>v] <span class="op">+</span> T[<span class="dv">2</span><span class="op">*</span>v<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>        v <span class="op">//=</span> <span class="dv">2</span></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> query(T, base, l, r):</span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>    l <span class="op">+=</span> base<span class="op">;</span> r <span class="op">+=</span> base</span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> l <span class="op">&lt;=</span> r:</span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> l<span class="op">%</span><span class="dv">2</span><span class="op">==</span><span class="dv">1</span>: res <span class="op">+=</span> T[l]<span class="op">;</span> l<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r<span class="op">%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span>: res <span class="op">+=</span> T[r]<span class="op">;</span> r<span class="op">-=</span><span class="dv">1</span></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>        l<span class="op">//=</span><span class="dv">2</span><span class="op">;</span> r<span class="op">//=</span><span class="dv">2</span></span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>]</span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a>T, base <span class="op">=</span> build(A)</span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Before:"</span>, query(T, base, <span class="dv">0</span>, <span class="dv">3</span>))  <span class="co"># 10</span></span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a>update(T, base, <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"After:"</span>, query(T, base, <span class="dv">0</span>, <span class="dv">3</span>))   <span class="co"># 14</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-43" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-43">Why It Matters</h4>
<ul>
<li>Foundation for dynamic data, quick local edits</li>
<li>Used in segment trees, Fenwick trees, and BIT</li>
<li>Great for applications like dynamic scoring, cumulative sums, real-time data updates</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-43" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-43">A Gentle Proof (Why It Works)</h4>
<p>Each level has 1 node affected by position <code>pos</code>. Tree height = O(log n). Thus, exactly O(log n) nodes recomputed.</p>
</section>
<section id="try-it-yourself-43" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-43">Try It Yourself</h4>
<ol type="1">
<li>Build <code>[2,1,3,4]</code>, update <code>A[2]=10</code> → sum [0,3]=17</li>
<li>Replace merge with <code>min</code> → update element → test queries</li>
<li>Compare time with full rebuild for large n</li>
</ol>
</section>
<section id="test-cases-43" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-43">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Input A</th>
<th>Update</th>
<th>Query</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[2,1,3,4]</td>
<td>A[1]=5</td>
<td>sum[0,3]</td>
<td>14</td>
</tr>
<tr class="even">
<td>[5,5,5]</td>
<td>A[2]=2</td>
<td>sum[0,2]</td>
<td>12</td>
</tr>
<tr class="odd">
<td>[1]</td>
<td>A[0]=9</td>
<td>sum[0,0]</td>
<td>9</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-43" class="level4">
<h4 class="anchored" data-anchor-id="complexity-43">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Point update</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Build</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
</tbody>
</table>
<p>A point update is like a ripple in a pond, a single change flows upward, keeping the whole structure in harmony.</p>
</section>
</section>
<section id="fenwick-tree-build" class="level3">
<h3 class="anchored" data-anchor-id="fenwick-tree-build">245 Fenwick Tree Build</h3>
<p>A Fenwick Tree, or Binary Indexed Tree (BIT), is a compact data structure for prefix queries and point updates. It’s perfect for cumulative sums, frequencies, or any associative operation. Building it efficiently sets the stage for O(log n) queries and updates.</p>
<p>Unlike segment trees, a Fenwick Tree uses clever index arithmetic to represent overlapping ranges in a single array.</p>
<section id="what-problem-are-we-solving-44" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-44">What Problem Are We Solving?</h4>
<p>We want to precompute a structure to:</p>
<ul>
<li>Answer prefix queries: <code>sum(0..i)</code></li>
<li>Support updates: <code>A[i] += delta</code></li>
</ul>
<p>Naive prefix sum array:</p>
<ul>
<li>Query: O(1)</li>
<li>Update: O(n)</li>
</ul>
<p>Fenwick Tree:</p>
<ul>
<li>Query: O(log n)</li>
<li>Update: O(log n)</li>
<li>Build: O(n)</li>
</ul>
</section>
<section id="how-it-works-plain-language-9" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-9">How It Works (Plain Language)</h4>
<p>A Fenwick Tree uses the last set bit (LSB) of an index to determine segment length.</p>
<p>Each node <code>BIT[i]</code> stores sum of range:</p>
<pre><code>(i - LSB(i) + 1) .. i</code></pre>
<p>So:</p>
<ul>
<li><code>BIT[1]</code> stores A[1]</li>
<li><code>BIT[2]</code> stores A[1..2]</li>
<li><code>BIT[3]</code> stores A[3]</li>
<li><code>BIT[4]</code> stores A[1..4]</li>
<li><code>BIT[5]</code> stores A[5]</li>
<li><code>BIT[6]</code> stores A[5..6]</li>
</ul>
<p>Prefix sum = sum of these overlapping ranges.</p>
</section>
<section id="example-11" class="level4">
<h4 class="anchored" data-anchor-id="example-11">Example</h4>
<p>Array <code>A = [2, 1, 3, 4, 5]</code> (1-indexed for clarity)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>i</th>
<th>A[i]</th>
<th>LSB(i)</th>
<th>Range Stored</th>
<th>BIT[i] (sum)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>1</td>
<td>[1]</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>2</td>
<td>[1..2]</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>3</td>
<td>1</td>
<td>[3]</td>
<td>3</td>
</tr>
<tr class="even">
<td>4</td>
<td>4</td>
<td>4</td>
<td>[1..4]</td>
<td>10</td>
</tr>
<tr class="odd">
<td>5</td>
<td>5</td>
<td>1</td>
<td>[5]</td>
<td>5</td>
</tr>
</tbody>
</table>
</section>
<section id="step-by-step-build-on" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-build-on">Step-by-Step Build (O(n))</h4>
<p>Iterate i from 1 to n:</p>
<ol type="1">
<li><code>BIT[i] += A[i]</code></li>
<li>Add <code>BIT[i]</code> to its parent: <code>BIT[i + LSB(i)] += BIT[i]</code></li>
</ol>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>i</th>
<th>LSB(i)</th>
<th>Update BIT[i+LSB(i)]</th>
<th>Result BIT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>1</td>
<td>BIT[2]+=2</td>
<td>[2,3,0,0,0]</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
<td>2</td>
<td>BIT[4]+=3</td>
<td>[2,3,0,3,0]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>3</td>
<td>1</td>
<td>BIT[4]+=3</td>
<td>[2,3,3,6,0]</td>
</tr>
<tr class="even">
<td>4</td>
<td>4</td>
<td>4</td>
<td>BIT[8]+=6 (ignore, out of range)</td>
<td>[2,3,3,6,0]</td>
</tr>
<tr class="odd">
<td>5</td>
<td>5</td>
<td>1</td>
<td>BIT[6]+=5 (ignore, out of range)</td>
<td>[2,3,3,6,5]</td>
</tr>
</tbody>
</table>
<p>Built BIT: <code>[2, 3, 3, 6, 5]</code> ✅</p>
</section>
<section id="tiny-code-easy-versions-41" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-41">Tiny Code (Easy Versions)</h4>
<p>C (O(n) Build)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb111"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100005</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> A<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> BIT<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">;</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> lsb<span class="op">(</span><span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> i <span class="op">&amp;</span> <span class="op">-</span>i<span class="op">;</span> <span class="op">}</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> build<span class="op">()</span> <span class="op">{</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>        BIT<span class="op">[</span>i<span class="op">]</span> <span class="op">+=</span> A<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> parent <span class="op">=</span> i <span class="op">+</span> lsb<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>parent <span class="op">&lt;=</span> n<span class="op">)</span></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>            BIT<span class="op">[</span>parent<span class="op">]</span> <span class="op">+=</span> BIT<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> prefix_sum<span class="op">(</span><span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> s <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>        s <span class="op">+=</span> BIT<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>        i <span class="op">-=</span> lsb<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> vals<span class="op">[</span><span class="dv">6</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">};</span> <span class="co">// 1-indexed</span></span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span>n<span class="op">;</span>i<span class="op">++)</span> A<span class="op">[</span>i<span class="op">]=</span>vals<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>    build<span class="op">();</span></span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Prefix sum [1..3] = </span><span class="sc">%lld\n</span><span class="st">"</span><span class="op">,</span> prefix_sum<span class="op">(</span><span class="dv">3</span><span class="op">));</span> <span class="co">// expect 6</span></span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (1-indexed)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build(A):</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(A) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    BIT <span class="op">=</span> [<span class="dv">0</span>]<span class="op">*</span>(n<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>        BIT[i] <span class="op">+=</span> A[i]</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>        parent <span class="op">=</span> i <span class="op">+</span> (i <span class="op">&amp;</span> <span class="op">-</span>i)</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> parent <span class="op">&lt;=</span> n:</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>            BIT[parent] <span class="op">+=</span> BIT[i]</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> BIT</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prefix_sum(BIT, i):</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>        s <span class="op">+=</span> BIT[i]</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>        i <span class="op">-=</span> (i <span class="op">&amp;</span> <span class="op">-</span>i)</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]  <span class="co"># 1-indexed</span></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>BIT <span class="op">=</span> build(A)</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"BIT ="</span>, BIT[<span class="dv">1</span>:])</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sum[1..3] ="</span>, prefix_sum(BIT, <span class="dv">3</span>))  <span class="co"># expect 6</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-44" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-44">Why It Matters</h4>
<ul>
<li>Lightweight alternative to segment tree</li>
<li>O(n) build, O(log n) query, O(log n) update</li>
<li>Used in frequency tables, inversion count, prefix queries, cumulative histograms</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-44" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-44">A Gentle Proof (Why It Works)</h4>
<p>Each index i contributes to at most log n BIT entries. Every BIT[i] stores sum of a disjoint range defined by LSB. Building with parent propagation ensures correct overlapping coverage.</p>
</section>
<section id="try-it-yourself-44" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-44">Try It Yourself</h4>
<ol type="1">
<li>Build BIT from [2, 1, 3, 4, 5] → query sum(3)=6</li>
<li>Update A[2]+=2 → prefix(3)=8</li>
<li>Compare with cumulative sum array for correctness</li>
</ol>
</section>
<section id="test-cases-44" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-44">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>A (1-indexed)</th>
<th>Query</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[2,1,3,4,5]</td>
<td>prefix(3)</td>
<td>6</td>
</tr>
<tr class="even">
<td>[5,5,5,5]</td>
<td>prefix(4)</td>
<td>20</td>
</tr>
<tr class="odd">
<td>[1]</td>
<td>prefix(1)</td>
<td>1</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-44" class="level4">
<h4 class="anchored" data-anchor-id="complexity-44">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Update</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>A Fenwick Tree is the art of doing less, storing just enough to make prefix sums lightning-fast.</p>
</section>
</section>
<section id="fenwick-update" class="level3">
<h3 class="anchored" data-anchor-id="fenwick-update">246 Fenwick Update</h3>
<p>A Fenwick Tree (Binary Indexed Tree) supports point updates, adjusting a single element and efficiently reflecting that change across all relevant cumulative sums. The update propagates upward through parent indices determined by the Least Significant Bit (LSB).</p>
<section id="what-problem-are-we-solving-45" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-45">What Problem Are We Solving?</h4>
<p>Given a built Fenwick Tree, we want to perform an operation like:</p>
<pre><code>A[pos] += delta</code></pre>
<p>and keep all prefix sums <code>sum(0..i)</code> consistent.</p>
<p>Naive approach: update every prefix → O(n) Fenwick Tree: propagate through selected indices → O(log n)</p>
</section>
<section id="how-it-works-plain-language-10" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-10">How It Works (Plain Language)</h4>
<p>In a Fenwick Tree, <code>BIT[i]</code> covers the range <code>(i - LSB(i) + 1) .. i</code>. So when we update <code>A[pos]</code>, we must add delta to all <code>BIT[i]</code> where <code>i</code> includes <code>pos</code> in its range.</p>
<p>Rule:</p>
<pre><code>for (i = pos; i &lt;= n; i += LSB(i))
    BIT[i] += delta</code></pre>
<ul>
<li>LSB(i) jumps to the next index covering <code>pos</code></li>
<li>Stops when index exceeds <code>n</code></li>
</ul>
</section>
<section id="example-12" class="level4">
<h4 class="anchored" data-anchor-id="example-12">Example</h4>
<p>Array <code>A = [2, 1, 3, 4, 5]</code> (1-indexed) BIT built as <code>[2, 3, 3, 10, 5]</code></p>
<p>Now perform update(2, +2) → A[2] = 3</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>i</th>
<th>LSB(i)</th>
<th>BIT[i] Change</th>
<th>New BIT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>2</td>
<td>BIT[2]+=2</td>
<td>[2,5,3,10,5]</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>4</td>
<td>BIT[4]+=2</td>
<td>[2,5,3,12,5]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>8</td>
<td>stop</td>
<td>-</td>
<td>done</td>
</tr>
</tbody>
</table>
<p>New prefix sums reflect updated array <code>[2,3,3,4,5]</code></p>
<p>Check prefix(3) = 2+3+3=8 ✅</p>
</section>
<section id="step-by-step-table" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-table">Step-by-Step Table</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Prefix</th>
<th>Old Sum</th>
<th>New Sum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>3</td>
<td>5</td>
</tr>
<tr class="odd">
<td>3</td>
<td>6</td>
<td>8</td>
</tr>
<tr class="even">
<td>4</td>
<td>10</td>
<td>12</td>
</tr>
<tr class="odd">
<td>5</td>
<td>15</td>
<td>17</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-42" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-42">Tiny Code (Easy Versions)</h4>
<p>C (Fenwick Update)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb115"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100005</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> BIT<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">;</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> lsb<span class="op">(</span><span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> i <span class="op">&amp;</span> <span class="op">-</span>i<span class="op">;</span> <span class="op">}</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> update<span class="op">(</span><span class="dt">int</span> pos<span class="op">,</span> <span class="dt">int</span> delta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> pos<span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> i <span class="op">+=</span> lsb<span class="op">(</span>i<span class="op">))</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>        BIT<span class="op">[</span>i<span class="op">]</span> <span class="op">+=</span> delta<span class="op">;</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> prefix_sum<span class="op">(</span><span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> s <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(;</span> i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">-=</span> lsb<span class="op">(</span>i<span class="op">))</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>        s <span class="op">+=</span> BIT<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Build from A = [2, 1, 3, 4, 5]</span></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>    BIT<span class="op">[</span><span class="dv">1</span><span class="op">]=</span><span class="dv">2</span><span class="op">;</span> BIT<span class="op">[</span><span class="dv">2</span><span class="op">]=</span><span class="dv">3</span><span class="op">;</span> BIT<span class="op">[</span><span class="dv">3</span><span class="op">]=</span><span class="dv">3</span><span class="op">;</span> BIT<span class="op">[</span><span class="dv">4</span><span class="op">]=</span><span class="dv">10</span><span class="op">;</span> BIT<span class="op">[</span><span class="dv">5</span><span class="op">]=</span><span class="dv">5</span><span class="op">;</span></span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>    update<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span> <span class="co">// A[2]+=2</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Sum [1..3] = </span><span class="sc">%lld\n</span><span class="st">"</span><span class="op">,</span> prefix_sum<span class="op">(</span><span class="dv">3</span><span class="op">));</span> <span class="co">// expect 8</span></span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (1-indexed)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update(BIT, n, pos, delta):</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> pos <span class="op">&lt;=</span> n:</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>        BIT[pos] <span class="op">+=</span> delta</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>        pos <span class="op">+=</span> (pos <span class="op">&amp;</span> <span class="op">-</span>pos)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prefix_sum(BIT, pos):</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> pos <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>        s <span class="op">+=</span> BIT[pos]</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>        pos <span class="op">-=</span> (pos <span class="op">&amp;</span> <span class="op">-</span>pos)</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>BIT <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">10</span>,<span class="dv">5</span>]  <span class="co"># built from [2,1,3,4,5]</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>update(BIT, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sum [1..3] ="</span>, prefix_sum(BIT, <span class="dv">3</span>))  <span class="co"># expect 8</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-45" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-45">Why It Matters</h4>
<ul>
<li>Enables real-time data updates with fast prefix queries</li>
<li>Simpler and more space-efficient than segment trees for sums</li>
<li>Core of many algorithms: inversion count, frequency accumulation, order statistics</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-45" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-45">A Gentle Proof (Why It Works)</h4>
<p>Each <code>BIT[i]</code> covers a fixed range <code>(i - LSB(i) + 1 .. i)</code>. If <code>pos</code> lies in that range, incrementing <code>BIT[i]</code> ensures correct future prefix sums. Since each update moves by LSB(i), at most log₂(n) steps occur.</p>
</section>
<section id="try-it-yourself-45" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-45">Try It Yourself</h4>
<ol type="1">
<li>Build BIT from <code>[2,1,3,4,5]</code> → update(2,+2)</li>
<li>Query prefix(3) → expect 8</li>
<li>Update(5, +5) → prefix(5) = 22</li>
<li>Chain multiple updates → verify incremental sums</li>
</ol>
</section>
<section id="test-cases-45" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-45">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>A (1-indexed)</th>
<th>Update</th>
<th>Query</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[2,1,3,4,5]</td>
<td>(2,+2)</td>
<td>sum[1..3]</td>
<td>8</td>
</tr>
<tr class="even">
<td>[5,5,5,5]</td>
<td>(4,+1)</td>
<td>sum[1..4]</td>
<td>21</td>
</tr>
<tr class="odd">
<td>[1,2,3,4,5]</td>
<td>(5,-2)</td>
<td>sum[1..5]</td>
<td>13</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-45" class="level4">
<h4 class="anchored" data-anchor-id="complexity-45">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Update</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Build</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
</tbody>
</table>
<p>Each update is a ripple that climbs the tree, keeping all prefix sums in perfect sync.</p>
</section>
</section>
<section id="fenwick-query" class="level3">
<h3 class="anchored" data-anchor-id="fenwick-query">247 Fenwick Query</h3>
<p>Once you’ve built or updated a Fenwick Tree (Binary Indexed Tree), you’ll want to extract useful information, usually prefix sums. The query operation walks downward through the tree using index arithmetic, gathering partial sums along the way.</p>
<p>This simple yet powerful routine turns a linear prefix-sum scan into an elegant O(log n) solution.</p>
<section id="what-problem-are-we-solving-46" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-46">What Problem Are We Solving?</h4>
<p>We need to compute:</p>
<pre><code>sum(1..i) = A[1] + A[2] + ... + A[i]</code></pre>
<p>efficiently, after updates.</p>
<p>In a Fenwick Tree, each index holds the sum of a segment determined by its LSB (Least Significant Bit). By moving downward (subtracting LSB each step), we collect disjoint ranges that together cover <code>[1..i]</code>.</p>
</section>
<section id="how-it-works-plain-language-11" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-11">How It Works (Plain Language)</h4>
<p>Each <code>BIT[i]</code> stores sum of range <code>(i - LSB(i) + 1 .. i)</code>. So to get the prefix sum, we combine all these segments by walking downward:</p>
<pre><code>sum = 0
while i &gt; 0:
    sum += BIT[i]
    i -= LSB(i)</code></pre>
<p>Key Insight:</p>
<ul>
<li>Update: moves upward (<code>i += LSB(i)</code>)</li>
<li>Query: moves downward (<code>i -= LSB(i)</code>)</li>
</ul>
<p>Together, they mirror each other like yin and yang of cumulative logic.</p>
</section>
<section id="example-13" class="level4">
<h4 class="anchored" data-anchor-id="example-13">Example</h4>
<p>Suppose we have <code>A = [2, 3, 3, 4, 5]</code> (1-indexed), Built BIT = [2, 5, 3, 12, 5]</p>
<p>Let’s compute <code>prefix_sum(5)</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>i</th>
<th>BIT[i]</th>
<th>LSB(i)</th>
<th>Accumulated Sum</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>5</td>
<td>5</td>
<td>1</td>
<td>5</td>
<td>Add BIT[5] (A[5])</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>12</td>
<td>4</td>
<td>17</td>
<td>Add BIT[4] (A[1..4])</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0</td>
<td>-</td>
<td>-</td>
<td>stop</td>
<td>done</td>
</tr>
</tbody>
</table>
<p>✅ <code>prefix_sum(5) = 17</code> matches <code>2+3+3+4+5=17</code></p>
<p>Now try <code>prefix_sum(3)</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>i</th>
<th>BIT[i]</th>
<th>LSB(i)</th>
<th>Sum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>3</td>
<td>3</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
<td>5</td>
<td>2</td>
<td>8</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0</td>
<td>-</td>
<td>-</td>
<td>stop</td>
</tr>
</tbody>
</table>
<p>✅ <code>prefix_sum(3) = 8</code></p>
</section>
<section id="tiny-code-easy-versions-43" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-43">Tiny Code (Easy Versions)</h4>
<p>C (Fenwick Query)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb119"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100005</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> BIT<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">;</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> lsb<span class="op">(</span><span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> i <span class="op">&amp;</span> <span class="op">-</span>i<span class="op">;</span> <span class="op">}</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> prefix_sum<span class="op">(</span><span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> s <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>        s <span class="op">+=</span> BIT<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>        i <span class="op">-=</span> lsb<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> B<span class="op">[</span><span class="dv">6</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="dv">5</span><span class="op">};</span> <span class="co">// built BIT</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span>n<span class="op">;</span>i<span class="op">++)</span> BIT<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> B<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Prefix sum [1..3] = </span><span class="sc">%lld\n</span><span class="st">"</span><span class="op">,</span> prefix_sum<span class="op">(</span><span class="dv">3</span><span class="op">));</span> <span class="co">// expect 8</span></span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Prefix sum [1..5] = </span><span class="sc">%lld\n</span><span class="st">"</span><span class="op">,</span> prefix_sum<span class="op">(</span><span class="dv">5</span><span class="op">));</span> <span class="co">// expect 17</span></span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (1-indexed)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prefix_sum(BIT, i):</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>        s <span class="op">+=</span> BIT[i]</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">-=</span> (i <span class="op">&amp;</span> <span class="op">-</span>i)</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>BIT <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">12</span>,<span class="dv">5</span>]</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"sum[1..3] ="</span>, prefix_sum(BIT, <span class="dv">3</span>))  <span class="co"># 8</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"sum[1..5] ="</span>, prefix_sum(BIT, <span class="dv">5</span>))  <span class="co"># 17</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-46" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-46">Why It Matters</h4>
<ul>
<li>Fast prefix sums after dynamic updates</li>
<li>Essential for frequency tables, order statistics, inversion count</li>
<li>Core to many competitive programming tricks (like “count less than k”)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-46" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-46">A Gentle Proof (Why It Works)</h4>
<p>Each index <code>i</code> contributes to a fixed set of BIT nodes. When querying, we collect all BIT segments that together form <code>[1..i]</code>. The LSB ensures no overlap, each range is disjoint. Total steps = number of bits set in <code>i</code> = O(log n).</p>
</section>
<section id="try-it-yourself-46" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-46">Try It Yourself</h4>
<ol type="1">
<li>Build BIT from <code>[2,3,3,4,5]</code></li>
<li>Query prefix_sum(3) → expect 8</li>
<li>Update(2,+2), query(3) → expect 10</li>
<li>Query prefix_sum(5) → confirm correctness</li>
</ol>
</section>
<section id="test-cases-46" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-46">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>A (1-indexed)</th>
<th>Query</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[2,3,3,4,5]</td>
<td>sum(3)</td>
<td>8</td>
</tr>
<tr class="even">
<td>[2,3,3,4,5]</td>
<td>sum(5)</td>
<td>17</td>
</tr>
<tr class="odd">
<td>[1,2,3,4,5]</td>
<td>sum(4)</td>
<td>10</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-46" class="level4">
<h4 class="anchored" data-anchor-id="complexity-46">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Query</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Update</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Build</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
</tbody>
</table>
<p>Fenwick query is the graceful descent, follow the bits down to gather every piece of the sum puzzle.</p>
</section>
</section>
<section id="segment-tree-merge" class="level3">
<h3 class="anchored" data-anchor-id="segment-tree-merge">248 Segment Tree Merge</h3>
<p>A Segment Tree can handle more than sums, it’s a versatile structure that can merge results from two halves of a range using any associative operation (sum, min, max, gcd, etc.). The merge function is the heart of the segment tree: it tells us how to combine child nodes into a parent node.</p>
<section id="what-problem-are-we-solving-47" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-47">What Problem Are We Solving?</h4>
<p>We want to combine results from left and right child intervals into one parent result. Without merge logic, the tree can’t aggregate data or answer queries.</p>
<p>For example:</p>
<ul>
<li>For sum queries → merge(a, b) = a + b</li>
<li>For min queries → merge(a, b) = min(a, b)</li>
<li>For gcd queries → merge(a, b) = gcd(a, b)</li>
</ul>
<p>So the merge function defines <em>what the tree means</em>.</p>
</section>
<section id="how-it-works-plain-language-12" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-12">How It Works (Plain Language)</h4>
<p>Each node represents a segment <code>[L, R]</code>. Its value is derived from its two children:</p>
<pre><code>node = merge(left_child, right_child)</code></pre>
<p>When you:</p>
<ul>
<li>Build: compute node from children recursively</li>
<li>Query: merge partial overlaps</li>
<li>Update: recompute affected nodes using merge</li>
</ul>
<p>So merge is the unifying rule that glues the tree together.</p>
</section>
<section id="example-sum-segment-tree" class="level4">
<h4 class="anchored" data-anchor-id="example-sum-segment-tree">Example (Sum Segment Tree)</h4>
<p>Array <code>A = [2, 1, 3, 4]</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node</th>
<th>Range</th>
<th>Left</th>
<th>Right</th>
<th>Merge (sum)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>root</td>
<td>[1..4]</td>
<td>6</td>
<td>4</td>
<td>10</td>
</tr>
<tr class="even">
<td>left</td>
<td>[1..2]</td>
<td>2</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td>right</td>
<td>[3..4]</td>
<td>3</td>
<td>4</td>
<td>7</td>
</tr>
</tbody>
</table>
<p>Each parent = sum(left, right)</p>
<p>Tree structure:</p>
<pre><code>          [1..4]=10
         /         \
   [1..2]=3       [3..4]=7
   /    \         /     \
$$1]=2 [2]=1   [3]=3   [4]=4</code></pre>
<p>Merge rule: <code>merge(a, b) = a + b</code></p>
</section>
<section id="example-min-segment-tree" class="level4">
<h4 class="anchored" data-anchor-id="example-min-segment-tree">Example (Min Segment Tree)</h4>
<p>Array <code>A = [5, 2, 7, 1]</code> Merge rule: <code>min(a, b)</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node</th>
<th>Range</th>
<th>Left</th>
<th>Right</th>
<th>Merge (min)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>root</td>
<td>[1..4]</td>
<td>2</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>left</td>
<td>[1..2]</td>
<td>5</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>right</td>
<td>[3..4]</td>
<td>7</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Result: root stores 1, the global minimum.</p>
</section>
<section id="tiny-code-easy-versions-44" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-44">Tiny Code (Easy Versions)</h4>
<p>C (Sum Segment Tree Merge)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb123"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100005</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> A<span class="op">[</span>MAXN<span class="op">],</span> tree<span class="op">[</span><span class="dv">4</span><span class="op">*</span>MAXN<span class="op">];</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">;</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> merge<span class="op">(</span><span class="dt">int</span> left<span class="op">,</span> <span class="dt">int</span> right<span class="op">)</span> <span class="op">{</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> left <span class="op">+</span> right<span class="op">;</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> build<span class="op">(</span><span class="dt">int</span> node<span class="op">,</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>l <span class="op">==</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>        tree<span class="op">[</span>node<span class="op">]</span> <span class="op">=</span> A<span class="op">[</span>l<span class="op">];</span></span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>l <span class="op">+</span> r<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span>node<span class="op">*</span><span class="dv">2</span><span class="op">,</span> l<span class="op">,</span> mid<span class="op">);</span></span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span>node<span class="op">*</span><span class="dv">2</span><span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> r<span class="op">);</span></span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>    tree<span class="op">[</span>node<span class="op">]</span> <span class="op">=</span> merge<span class="op">(</span>tree<span class="op">[</span>node<span class="op">*</span><span class="dv">2</span><span class="op">],</span> tree<span class="op">[</span>node<span class="op">*</span><span class="dv">2</span><span class="op">+</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> query<span class="op">(</span><span class="dt">int</span> node<span class="op">,</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> r<span class="op">,</span> <span class="dt">int</span> ql<span class="op">,</span> <span class="dt">int</span> qr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>qr <span class="op">&lt;</span> l <span class="op">||</span> ql <span class="op">&gt;</span> r<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// neutral element</span></span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ql <span class="op">&lt;=</span> l <span class="op">&amp;&amp;</span> r <span class="op">&lt;=</span> qr<span class="op">)</span> <span class="cf">return</span> tree<span class="op">[</span>node<span class="op">];</span></span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>l <span class="op">+</span> r<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> left <span class="op">=</span> query<span class="op">(</span>node<span class="op">*</span><span class="dv">2</span><span class="op">,</span> l<span class="op">,</span> mid<span class="op">,</span> ql<span class="op">,</span> qr<span class="op">);</span></span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> right <span class="op">=</span> query<span class="op">(</span>node<span class="op">*</span><span class="dv">2</span><span class="op">+</span><span class="dv">1</span><span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> r<span class="op">,</span> ql<span class="op">,</span> qr<span class="op">);</span></span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merge<span class="op">(</span>left<span class="op">,</span> right<span class="op">);</span></span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb123-32"><a href="#cb123-32" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb123-33"><a href="#cb123-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> vals<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">};</span></span>
<span id="cb123-34"><a href="#cb123-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span> i<span class="op">&lt;=</span>n<span class="op">;</span> i<span class="op">++)</span> A<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> vals<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb123-35"><a href="#cb123-35" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span>n<span class="op">);</span></span>
<span id="cb123-36"><a href="#cb123-36" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Sum [1..4] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> query<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span>n<span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">4</span><span class="op">));</span> <span class="co">// 10</span></span>
<span id="cb123-37"><a href="#cb123-37" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Sum [2..3] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> query<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span>n<span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">));</span> <span class="co">// 4</span></span>
<span id="cb123-38"><a href="#cb123-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge(a, b):</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b  <span class="co"># define operation here</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build(arr, tree, node, l, r):</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="op">==</span> r:</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>        tree[node] <span class="op">=</span> arr[l]</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    mid <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>    build(arr, tree, <span class="dv">2</span><span class="op">*</span>node, l, mid)</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    build(arr, tree, <span class="dv">2</span><span class="op">*</span>node<span class="op">+</span><span class="dv">1</span>, mid<span class="op">+</span><span class="dv">1</span>, r)</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>    tree[node] <span class="op">=</span> merge(tree[<span class="dv">2</span><span class="op">*</span>node], tree[<span class="dv">2</span><span class="op">*</span>node<span class="op">+</span><span class="dv">1</span>])</span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> query(tree, node, l, r, ql, qr):</span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> qr <span class="op">&lt;</span> l <span class="kw">or</span> ql <span class="op">&gt;</span> r:</span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>  <span class="co"># neutral element for sum</span></span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ql <span class="op">&lt;=</span> l <span class="kw">and</span> r <span class="op">&lt;=</span> qr:</span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> tree[node]</span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true" tabindex="-1"></a>    mid <span class="op">=</span> (l <span class="op">+</span> r)<span class="op">//</span><span class="dv">2</span></span>
<span id="cb124-19"><a href="#cb124-19" aria-hidden="true" tabindex="-1"></a>    left <span class="op">=</span> query(tree, <span class="dv">2</span><span class="op">*</span>node, l, mid, ql, qr)</span>
<span id="cb124-20"><a href="#cb124-20" aria-hidden="true" tabindex="-1"></a>    right <span class="op">=</span> query(tree, <span class="dv">2</span><span class="op">*</span>node<span class="op">+</span><span class="dv">1</span>, mid<span class="op">+</span><span class="dv">1</span>, r, ql, qr)</span>
<span id="cb124-21"><a href="#cb124-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merge(left, right)</span>
<span id="cb124-22"><a href="#cb124-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-23"><a href="#cb124-23" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>]</span>
<span id="cb124-24"><a href="#cb124-24" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb124-25"><a href="#cb124-25" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> [<span class="dv">0</span>]<span class="op">*</span>(<span class="dv">4</span><span class="op">*</span>n)</span>
<span id="cb124-26"><a href="#cb124-26" aria-hidden="true" tabindex="-1"></a>build(A, tree, <span class="dv">1</span>, <span class="dv">1</span>, n)</span>
<span id="cb124-27"><a href="#cb124-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sum[1..4] ="</span>, query(tree, <span class="dv">1</span>, <span class="dv">1</span>, n, <span class="dv">1</span>, <span class="dv">4</span>))  <span class="co"># 10</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-47" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-47">Why It Matters</h4>
<ul>
<li>Merge is the “soul” of the segment tree, define merge, and you define the tree’s purpose.</li>
<li>Flexible across many tasks: sums, min/max, GCD, XOR, matrix multiplication.</li>
<li>Unified pattern: build, query, update all rely on the same operation.</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-47" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-47">A Gentle Proof (Why It Works)</h4>
<p>Segment tree works by divide and conquer. If an operation is associative (like +, min, max, gcd), merging partial results yields the same answer as computing on the whole range. So as long as <code>merge(a, b)</code> = <code>merge(b, a)</code> and associative, correctness follows.</p>
</section>
<section id="try-it-yourself-47" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-47">Try It Yourself</h4>
<ol type="1">
<li>Replace merge with <code>min(a,b)</code> → build min segment tree</li>
<li>Replace merge with <code>max(a,b)</code> → build max segment tree</li>
<li>Replace merge with <code>__gcd(a,b)</code> → build gcd tree</li>
<li>Test <code>query(2,3)</code> after changing merge rule</li>
</ol>
</section>
<section id="test-cases-47" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-47">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>A</th>
<th>Operation</th>
<th>Query</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[2,1,3,4]</td>
<td>sum</td>
<td>[1..4]</td>
<td>10</td>
</tr>
<tr class="even">
<td>[5,2,7,1]</td>
<td>min</td>
<td>[1..4]</td>
<td>1</td>
</tr>
<tr class="odd">
<td>[3,6,9,12]</td>
<td>gcd</td>
<td>[2..4]</td>
<td>3</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-47" class="level4">
<h4 class="anchored" data-anchor-id="complexity-47">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(log n)</td>
<td>O(n)</td>
</tr>
<tr class="odd">
<td>Update</td>
<td>O(log n)</td>
<td>O(n)</td>
</tr>
</tbody>
</table>
<p>A merge function is the heartbeat of every segment tree, once you define it, your tree learns what “combine” means.</p>
</section>
</section>
<section id="persistent-segment-tree" class="level3">
<h3 class="anchored" data-anchor-id="persistent-segment-tree">249 Persistent Segment Tree</h3>
<p>A Persistent Segment Tree is a magical structure that lets you time-travel. Instead of overwriting nodes on update, it creates new versions while preserving old ones. Each update returns a new root, giving you full history and O(log n) access to every version.</p>
<section id="what-problem-are-we-solving-48" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-48">What Problem Are We Solving?</h4>
<p>We need a data structure that supports:</p>
<ul>
<li>Point updates without losing past state</li>
<li>Range queries on any historical version</li>
</ul>
<p>Use cases:</p>
<ul>
<li>Undo/rollback systems</li>
<li>Versioned databases</li>
<li>Offline queries (“What was sum[1..3] after the 2nd update?”)</li>
</ul>
<p>Each version is immutable, perfect for functional programming or auditability.</p>
</section>
<section id="how-it-works-plain-language-13" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-13">How It Works (Plain Language)</h4>
<p>A persistent segment tree clones only nodes along the path from root to updated leaf. All other nodes are shared.</p>
<p>For each update:</p>
<ol type="1">
<li>Create a new root.</li>
<li>Copy nodes along the path to the changed index.</li>
<li>Reuse unchanged subtrees.</li>
</ol>
<p>Result: O(log n) memory per version, not O(n).</p>
</section>
<section id="example-14" class="level4">
<h4 class="anchored" data-anchor-id="example-14">Example</h4>
<p>Array <code>A = [1, 2, 3, 4]</code></p>
<p>Version 0: built tree for <code>[1, 2, 3, 4]</code></p>
<ul>
<li>sum = 10</li>
</ul>
<p>Update A[2] = 5</p>
<ul>
<li>Create Version 1, copy path to A[2]</li>
<li>New sum = 1 + 5 + 3 + 4 = 13</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Version</th>
<th>A</th>
<th>Sum(1..4)</th>
<th>Sum(1..2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>[1,2,3,4]</td>
<td>10</td>
<td>3</td>
</tr>
<tr class="even">
<td>1</td>
<td>[1,5,3,4]</td>
<td>13</td>
<td>6</td>
</tr>
</tbody>
</table>
<p>Both versions exist side by side. Version 0 is unchanged. Version 1 reflects new value.</p>
</section>
<section id="visualization" class="level4">
<h4 class="anchored" data-anchor-id="visualization">Visualization</h4>
<pre><code>Version 0: root0
          /       \
      [1..2]=3   [3..4]=7
      /    \      /     \
   [1]=1 [2]=2 [3]=3 [4]=4

Version 1: root1 (new)
          /       \
  [1..2]=6*       [3..4]=7 (shared)
    /     \
$$1]=1   [2]=5*</code></pre>
<p>Asterisks mark newly created nodes.</p>
</section>
<section id="tiny-code-easy-version-1" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-version-1">Tiny Code (Easy Version)</h4>
<p>C (Pointer-based, sum tree)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb126"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">;</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> build<span class="op">(</span><span class="dt">int</span> arr<span class="op">[],</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> node <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>l <span class="op">==</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>val <span class="op">=</span> arr<span class="op">[</span>l<span class="op">];</span></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>left <span class="op">=</span> node<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node<span class="op">;</span></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>l <span class="op">+</span> r<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>left <span class="op">=</span> build<span class="op">(</span>arr<span class="op">,</span> l<span class="op">,</span> mid<span class="op">);</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>right <span class="op">=</span> build<span class="op">(</span>arr<span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> r<span class="op">);</span></span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>val <span class="op">=</span> node<span class="op">-&gt;</span>left<span class="op">-&gt;</span>val <span class="op">+</span> node<span class="op">-&gt;</span>right<span class="op">-&gt;</span>val<span class="op">;</span></span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> node<span class="op">;</span></span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-23"><a href="#cb126-23" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> update<span class="op">(</span>Node<span class="op">*</span> prev<span class="op">,</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> r<span class="op">,</span> <span class="dt">int</span> pos<span class="op">,</span> <span class="dt">int</span> new_val<span class="op">)</span> <span class="op">{</span></span>
<span id="cb126-24"><a href="#cb126-24" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> node <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb126-25"><a href="#cb126-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>l <span class="op">==</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb126-26"><a href="#cb126-26" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>val <span class="op">=</span> new_val<span class="op">;</span></span>
<span id="cb126-27"><a href="#cb126-27" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>left <span class="op">=</span> node<span class="op">-&gt;</span>right <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb126-28"><a href="#cb126-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node<span class="op">;</span></span>
<span id="cb126-29"><a href="#cb126-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb126-30"><a href="#cb126-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>l <span class="op">+</span> r<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb126-31"><a href="#cb126-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pos <span class="op">&lt;=</span> mid<span class="op">)</span> <span class="op">{</span></span>
<span id="cb126-32"><a href="#cb126-32" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>left <span class="op">=</span> update<span class="op">(</span>prev<span class="op">-&gt;</span>left<span class="op">,</span> l<span class="op">,</span> mid<span class="op">,</span> pos<span class="op">,</span> new_val<span class="op">);</span></span>
<span id="cb126-33"><a href="#cb126-33" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>right <span class="op">=</span> prev<span class="op">-&gt;</span>right<span class="op">;</span></span>
<span id="cb126-34"><a href="#cb126-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb126-35"><a href="#cb126-35" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>left <span class="op">=</span> prev<span class="op">-&gt;</span>left<span class="op">;</span></span>
<span id="cb126-36"><a href="#cb126-36" aria-hidden="true" tabindex="-1"></a>        node<span class="op">-&gt;</span>right <span class="op">=</span> update<span class="op">(</span>prev<span class="op">-&gt;</span>right<span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> r<span class="op">,</span> pos<span class="op">,</span> new_val<span class="op">);</span></span>
<span id="cb126-37"><a href="#cb126-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb126-38"><a href="#cb126-38" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>val <span class="op">=</span> node<span class="op">-&gt;</span>left<span class="op">-&gt;</span>val <span class="op">+</span> node<span class="op">-&gt;</span>right<span class="op">-&gt;</span>val<span class="op">;</span></span>
<span id="cb126-39"><a href="#cb126-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> node<span class="op">;</span></span>
<span id="cb126-40"><a href="#cb126-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb126-41"><a href="#cb126-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-42"><a href="#cb126-42" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> query<span class="op">(</span>Node<span class="op">*</span> node<span class="op">,</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> r<span class="op">,</span> <span class="dt">int</span> ql<span class="op">,</span> <span class="dt">int</span> qr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb126-43"><a href="#cb126-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>qr <span class="op">&lt;</span> l <span class="op">||</span> ql <span class="op">&gt;</span> r<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb126-44"><a href="#cb126-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ql <span class="op">&lt;=</span> l <span class="op">&amp;&amp;</span> r <span class="op">&lt;=</span> qr<span class="op">)</span> <span class="cf">return</span> node<span class="op">-&gt;</span>val<span class="op">;</span></span>
<span id="cb126-45"><a href="#cb126-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>l <span class="op">+</span> r<span class="op">)/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb126-46"><a href="#cb126-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> query<span class="op">(</span>node<span class="op">-&gt;</span>left<span class="op">,</span> l<span class="op">,</span> mid<span class="op">,</span> ql<span class="op">,</span> qr<span class="op">)</span></span>
<span id="cb126-47"><a href="#cb126-47" aria-hidden="true" tabindex="-1"></a>         <span class="op">+</span> query<span class="op">(</span>node<span class="op">-&gt;</span>right<span class="op">,</span> mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span> r<span class="op">,</span> ql<span class="op">,</span> qr<span class="op">);</span></span>
<span id="cb126-48"><a href="#cb126-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb126-49"><a href="#cb126-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-50"><a href="#cb126-50" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb126-51"><a href="#cb126-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> A<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">};</span> <span class="co">// 1-indexed</span></span>
<span id="cb126-52"><a href="#cb126-52" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> root0 <span class="op">=</span> build<span class="op">(</span>A<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb126-53"><a href="#cb126-53" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> root1 <span class="op">=</span> update<span class="op">(</span>root0<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb126-54"><a href="#cb126-54" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"v0 sum[1..2]=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> query<span class="op">(</span>root0<span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">));</span> <span class="co">// 3</span></span>
<span id="cb126-55"><a href="#cb126-55" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"v1 sum[1..2]=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> query<span class="op">(</span>root1<span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">));</span> <span class="co">// 6</span></span>
<span id="cb126-56"><a href="#cb126-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python (Recursive, sum tree)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, val<span class="op">=</span><span class="dv">0</span>, left<span class="op">=</span><span class="va">None</span>, right<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.val <span class="op">=</span> val</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> left</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> right</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build(arr, l, r):</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="op">==</span> r:</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(arr[l])</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>    mid <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>    left <span class="op">=</span> build(arr, l, mid)</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>    right <span class="op">=</span> build(arr, mid<span class="op">+</span><span class="dv">1</span>, r)</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Node(left.val <span class="op">+</span> right.val, left, right)</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update(prev, l, r, pos, val):</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="op">==</span> r:</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(val)</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>    mid <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pos <span class="op">&lt;=</span> mid:</span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(prev.val <span class="op">-</span> prev.left.val <span class="op">+</span> val,</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>                    update(prev.left, l, mid, pos, val),</span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>                    prev.right)</span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(prev.val <span class="op">-</span> prev.right.val <span class="op">+</span> val,</span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a>                    prev.left,</span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>                    update(prev.right, mid<span class="op">+</span><span class="dv">1</span>, r, pos, val))</span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> query(node, l, r, ql, qr):</span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> qr <span class="op">&lt;</span> l <span class="kw">or</span> ql <span class="op">&gt;</span> r: <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ql <span class="op">&lt;=</span> l <span class="kw">and</span> r <span class="op">&lt;=</span> qr: <span class="cf">return</span> node.val</span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>    mid <span class="op">=</span> (l <span class="op">+</span> r)<span class="op">//</span><span class="dv">2</span></span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> query(node.left, l, mid, ql, qr) <span class="op">+</span> query(node.right, mid<span class="op">+</span><span class="dv">1</span>, r, ql, qr)</span>
<span id="cb127-33"><a href="#cb127-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-34"><a href="#cb127-34" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]</span>
<span id="cb127-35"><a href="#cb127-35" aria-hidden="true" tabindex="-1"></a>root0 <span class="op">=</span> build(A, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb127-36"><a href="#cb127-36" aria-hidden="true" tabindex="-1"></a>root1 <span class="op">=</span> update(root0, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb127-37"><a href="#cb127-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"v0 sum[1..2] ="</span>, query(root0, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))  <span class="co"># 3</span></span>
<span id="cb127-38"><a href="#cb127-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"v1 sum[1..2] ="</span>, query(root1, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))  <span class="co"># 6</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-48" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-48">Why It Matters</h4>
<ul>
<li>Immutable versions → ideal for undo systems, snapshots, persistent databases</li>
<li>Saves memory (O(log n) per version)</li>
<li>Each version is fully functional and independent</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-48" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-48">A Gentle Proof (Why It Works)</h4>
<p>Each update affects O(log n) nodes. By copying only those nodes, we maintain O(log n) new memory. Because all old nodes remain referenced, no data is lost. Thus, each version is consistent and immutable.</p>
</section>
<section id="try-it-yourself-48" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-48">Try It Yourself</h4>
<ol type="1">
<li>Build version 0 with <code>[1,2,3,4]</code></li>
<li>Update(2,5) → version 1</li>
<li>Query sum(1,4) in both versions → 10, 13</li>
<li>Create version 2 by update(3,1)</li>
<li>Query sum(1,3) in each version</li>
</ol>
</section>
<section id="test-cases-48" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-48">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Version</th>
<th>A</th>
<th>Query</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>[1,2,3,4]</td>
<td>sum[1..2]</td>
<td>3</td>
</tr>
<tr class="even">
<td>1</td>
<td>[1,5,3,4]</td>
<td>sum[1..2]</td>
<td>6</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[1,5,1,4]</td>
<td>sum[1..3]</td>
<td>7</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-48" class="level4">
<h4 class="anchored" data-anchor-id="complexity-48">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space (per version)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr class="even">
<td>Update</td>
<td>O(log n)</td>
<td>O(log n)</td>
</tr>
<tr class="odd">
<td>Query</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>Each version of a persistent segment tree is a snapshot in time, perfect memory of every past, with no cost of forgetting.</p>
</section>
</section>
<section id="d-segment-tree" class="level3">
<h3 class="anchored" data-anchor-id="d-segment-tree">250 2D Segment Tree</h3>
<p>A 2D Segment Tree extends the classic segment tree into two dimensions, perfect for handling range queries over matrices, such as sums, minimums, or maximums across subrectangles.</p>
<p>It’s the data structure that lets you ask:</p>
<blockquote class="blockquote">
<p>“What’s the sum of elements in the rectangle (x1, y1) to (x2, y2)?” and still answer in O(log² n) time.</p>
</blockquote>
<section id="what-problem-are-we-solving-49" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-49">What Problem Are We Solving?</h4>
<p>We want to perform two operations efficiently on a 2D grid:</p>
<ol type="1">
<li>Range Query: sum/min/max over a submatrix</li>
<li>Point Update: modify one element and reflect the change</li>
</ol>
<p>Naive approach → O(n²) per query 2D Segment Tree → O(log² n) per query and update</p>
</section>
<section id="how-it-works-plain-language-14" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-14">How It Works (Plain Language)</h4>
<p>Think of a 2D segment tree as a segment tree of segment trees.</p>
<ol type="1">
<li>Outer tree partitions rows.</li>
<li>Each node of the outer tree holds an inner segment tree for its rows.</li>
</ol>
<p>Each node thus represents a rectangle in the matrix.</p>
<p>At build time:</p>
<ul>
<li>Combine children horizontally and vertically using a merge rule (like sum).</li>
</ul>
<p>At query time:</p>
<ul>
<li>Combine answers from nodes overlapping the query rectangle.</li>
</ul>
</section>
<section id="example-15" class="level4">
<h4 class="anchored" data-anchor-id="example-15">Example</h4>
<p>Matrix A (3×3):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>y=1</th>
<th>y=2</th>
<th>y=3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>x=1</td>
<td>2</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="even">
<td>x=2</td>
<td>4</td>
<td>5</td>
<td>6</td>
</tr>
<tr class="odd">
<td>x=3</td>
<td>7</td>
<td>8</td>
<td>9</td>
</tr>
</tbody>
</table>
<p>Query rectangle <code>(1,1)</code> to <code>(2,2)</code> → 2 + 1 + 4 + 5 = 12</p>
</section>
<section id="key-idea" class="level4">
<h4 class="anchored" data-anchor-id="key-idea">Key Idea</h4>
<p>For each row range, build a column segment tree. For each parent node (row range), merge children column trees:</p>
<pre><code>tree[x][y] = merge(tree[2*x][y], tree[2*x+1][y])</code></pre>
</section>
<section id="example-walkthrough-sum-tree" class="level4">
<h4 class="anchored" data-anchor-id="example-walkthrough-sum-tree">Example Walkthrough (Sum Tree)</h4>
<ol type="1">
<li><p>Build row segment tree</p></li>
<li><p>Inside each row node, build column segment tree</p></li>
<li><p>To query rectangle <code>(x1,y1)</code> to <code>(x2,y2)</code>:</p>
<ul>
<li>Query over x-range → merge vertical results</li>
<li>Inside each x-node, query y-range → merge horizontal results</li>
</ul></li>
</ol>
</section>
<section id="tiny-code-easy-version-2" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-version-2">Tiny Code (Easy Version)</h4>
<p>Python (Sum 2D Segment Tree)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SegmentTree2D:</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, mat):</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> <span class="bu">len</span>(mat)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.m <span class="op">=</span> <span class="bu">len</span>(mat[<span class="dv">0</span>])</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tree <span class="op">=</span> [[<span class="dv">0</span>]<span class="op">*</span>(<span class="dv">4</span><span class="op">*</span><span class="va">self</span>.m) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span><span class="op">*</span><span class="va">self</span>.n)]</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mat <span class="op">=</span> mat</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.build_x(<span class="dv">1</span>, <span class="dv">0</span>, <span class="va">self</span>.n<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> merge(<span class="va">self</span>, a, b):</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a <span class="op">+</span> b  <span class="co"># sum merge</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># build column tree for a fixed row range</span></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_y(<span class="va">self</span>, nodex, lx, rx, nodey, ly, ry):</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ly <span class="op">==</span> ry:</span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> lx <span class="op">==</span> rx:</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.tree[nodex][nodey] <span class="op">=</span> <span class="va">self</span>.mat[lx][ly]</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.tree[nodex][nodey] <span class="op">=</span> <span class="va">self</span>.merge(</span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.tree[<span class="dv">2</span><span class="op">*</span>nodex][nodey], <span class="va">self</span>.tree[<span class="dv">2</span><span class="op">*</span>nodex<span class="op">+</span><span class="dv">1</span>][nodey]</span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>        midy <span class="op">=</span> (ly <span class="op">+</span> ry)<span class="op">//</span><span class="dv">2</span></span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.build_y(nodex, lx, rx, <span class="dv">2</span><span class="op">*</span>nodey, ly, midy)</span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.build_y(nodex, lx, rx, <span class="dv">2</span><span class="op">*</span>nodey<span class="op">+</span><span class="dv">1</span>, midy<span class="op">+</span><span class="dv">1</span>, ry)</span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tree[nodex][nodey] <span class="op">=</span> <span class="va">self</span>.merge(</span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.tree[nodex][<span class="dv">2</span><span class="op">*</span>nodey], <span class="va">self</span>.tree[nodex][<span class="dv">2</span><span class="op">*</span>nodey<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># build row tree</span></span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_x(<span class="va">self</span>, nodex, lx, rx):</span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lx <span class="op">!=</span> rx:</span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a>            midx <span class="op">=</span> (lx <span class="op">+</span> rx)<span class="op">//</span><span class="dv">2</span></span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.build_x(<span class="dv">2</span><span class="op">*</span>nodex, lx, midx)</span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.build_x(<span class="dv">2</span><span class="op">*</span>nodex<span class="op">+</span><span class="dv">1</span>, midx<span class="op">+</span><span class="dv">1</span>, rx)</span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.build_y(nodex, lx, rx, <span class="dv">1</span>, <span class="dv">0</span>, <span class="va">self</span>.m<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-37"><a href="#cb129-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> query_y(<span class="va">self</span>, nodex, nodey, ly, ry, qly, qry):</span>
<span id="cb129-38"><a href="#cb129-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> qry <span class="op">&lt;</span> ly <span class="kw">or</span> qly <span class="op">&gt;</span> ry: <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb129-39"><a href="#cb129-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> qly <span class="op">&lt;=</span> ly <span class="kw">and</span> ry <span class="op">&lt;=</span> qry:</span>
<span id="cb129-40"><a href="#cb129-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.tree[nodex][nodey]</span>
<span id="cb129-41"><a href="#cb129-41" aria-hidden="true" tabindex="-1"></a>        midy <span class="op">=</span> (ly <span class="op">+</span> ry)<span class="op">//</span><span class="dv">2</span></span>
<span id="cb129-42"><a href="#cb129-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.merge(</span>
<span id="cb129-43"><a href="#cb129-43" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.query_y(nodex, <span class="dv">2</span><span class="op">*</span>nodey, ly, midy, qly, qry),</span>
<span id="cb129-44"><a href="#cb129-44" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.query_y(nodex, <span class="dv">2</span><span class="op">*</span>nodey<span class="op">+</span><span class="dv">1</span>, midy<span class="op">+</span><span class="dv">1</span>, ry, qly, qry)</span>
<span id="cb129-45"><a href="#cb129-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb129-46"><a href="#cb129-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-47"><a href="#cb129-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> query_x(<span class="va">self</span>, nodex, lx, rx, qlx, qrx, qly, qry):</span>
<span id="cb129-48"><a href="#cb129-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> qrx <span class="op">&lt;</span> lx <span class="kw">or</span> qlx <span class="op">&gt;</span> rx: <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb129-49"><a href="#cb129-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> qlx <span class="op">&lt;=</span> lx <span class="kw">and</span> rx <span class="op">&lt;=</span> qrx:</span>
<span id="cb129-50"><a href="#cb129-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.query_y(nodex, <span class="dv">1</span>, <span class="dv">0</span>, <span class="va">self</span>.m<span class="op">-</span><span class="dv">1</span>, qly, qry)</span>
<span id="cb129-51"><a href="#cb129-51" aria-hidden="true" tabindex="-1"></a>        midx <span class="op">=</span> (lx <span class="op">+</span> rx)<span class="op">//</span><span class="dv">2</span></span>
<span id="cb129-52"><a href="#cb129-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.merge(</span>
<span id="cb129-53"><a href="#cb129-53" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.query_x(<span class="dv">2</span><span class="op">*</span>nodex, lx, midx, qlx, qrx, qly, qry),</span>
<span id="cb129-54"><a href="#cb129-54" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.query_x(<span class="dv">2</span><span class="op">*</span>nodex<span class="op">+</span><span class="dv">1</span>, midx<span class="op">+</span><span class="dv">1</span>, rx, qlx, qrx, qly, qry)</span>
<span id="cb129-55"><a href="#cb129-55" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb129-56"><a href="#cb129-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-57"><a href="#cb129-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> query(<span class="va">self</span>, x1, y1, x2, y2):</span>
<span id="cb129-58"><a href="#cb129-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.query_x(<span class="dv">1</span>, <span class="dv">0</span>, <span class="va">self</span>.n<span class="op">-</span><span class="dv">1</span>, x1, x2, y1, y2)</span>
<span id="cb129-59"><a href="#cb129-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-60"><a href="#cb129-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb129-61"><a href="#cb129-61" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [</span>
<span id="cb129-62"><a href="#cb129-62" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>],</span>
<span id="cb129-63"><a href="#cb129-63" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>],</span>
<span id="cb129-64"><a href="#cb129-64" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]</span>
<span id="cb129-65"><a href="#cb129-65" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb129-66"><a href="#cb129-66" aria-hidden="true" tabindex="-1"></a>seg2d <span class="op">=</span> SegmentTree2D(A)</span>
<span id="cb129-67"><a href="#cb129-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(seg2d.query(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>))  <span class="co"># expect 12</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-49" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-49">Why It Matters</h4>
<ul>
<li>Supports 2D queries with log² complexity</li>
<li>Works for sum, min, max, gcd, XOR</li>
<li>A foundation for advanced 2D data structures (Fenwick 2D, KD-trees, etc.)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-49" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-49">A Gentle Proof (Why It Works)</h4>
<p>Segment tree correctness relies on associativity. In 2D, we extend this property across both dimensions. Each node represents a rectangular region; merging children yields correct aggregate for parent.</p>
</section>
<section id="try-it-yourself-49" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-49">Try It Yourself</h4>
<ol type="1">
<li>Build from 3×3 matrix</li>
<li>Query <code>(0,0)-(2,2)</code> → full sum</li>
<li>Query <code>(1,1)-(2,2)</code> → bottom-right 5+6+8+9=28</li>
<li>Modify A[1][2]=10, rebuild, recheck sum</li>
</ol>
</section>
<section id="test-cases-49" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-49">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Matrix</th>
<th>Query</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[[2,1,3],[4,5,6],[7,8,9]]</td>
<td>(0,0)-(1,1)</td>
<td>12</td>
</tr>
<tr class="even">
<td>[[2,1,3],[4,5,6],[7,8,9]]</td>
<td>(1,1)-(2,2)</td>
<td>28</td>
</tr>
<tr class="odd">
<td>[[1,2],[3,4]]</td>
<td>(0,0)-(1,1)</td>
<td>10</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-49" class="level4">
<h4 class="anchored" data-anchor-id="complexity-49">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td>O(n·m·log n·log m)</td>
<td>O(n·m)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(log² n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Update</td>
<td>O(log² n)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>A 2D segment tree is your grid-wise superpower, merging rectangles like puzzle pieces, one log at a time.</p>
</section>
</section>
</section>
<section id="section-26.-disjoint-set-union" class="level2">
<h2 class="anchored" data-anchor-id="section-26.-disjoint-set-union">Section 26. Disjoint Set Union</h2>
<section id="make-set" class="level3">
<h3 class="anchored" data-anchor-id="make-set">251 Make-Set</h3>
<p>The Make-Set operation is the starting point of the Disjoint Set Union (DSU), also known as Union-Find, a fundamental data structure for managing partitions of elements into disjoint sets.</p>
<p>Each element begins in its own set, serving as its own parent. Later operations (<code>Find</code> and <code>Union</code>) will merge and track relationships among them efficiently.</p>
<section id="what-problem-are-we-solving-50" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-50">What Problem Are We Solving?</h4>
<p>We need a way to represent a collection of disjoint sets, groups that don’t overlap, while supporting these operations:</p>
<ol type="1">
<li>Make-Set(x): create a new set containing only <code>x</code></li>
<li>Find(x): find representative (leader) of x’s set</li>
<li>Union(x, y): merge sets containing x and y</li>
</ol>
<p>This structure is the backbone of many graph algorithms like Kruskal’s MST, connected components, and clustering.</p>
</section>
<section id="how-it-works-plain-language-15" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-15">How It Works (Plain Language)</h4>
<p>Initially, each element is its own parent, a self-loop. We store two arrays (or maps):</p>
<ul>
<li><code>parent[x]</code> → points to x’s parent (initially itself)</li>
<li><code>rank[x]</code> or <code>size[x]</code> → helps balance unions later</li>
</ul>
<p>So:</p>
<pre><code>parent[x] = x  
rank[x] = 0</code></pre>
<p>Each element is an isolated tree. Over time, unions connect trees.</p>
</section>
<section id="example-16" class="level4">
<h4 class="anchored" data-anchor-id="example-16">Example</h4>
<p>Initialize <code>n = 5</code> elements: <code>{1, 2, 3, 4, 5}</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>x</th>
<th>parent[x]</th>
<th>rank[x]</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>0</td>
<td>own leader</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
<td>0</td>
<td>own leader</td>
</tr>
<tr class="odd">
<td>3</td>
<td>3</td>
<td>0</td>
<td>own leader</td>
</tr>
<tr class="even">
<td>4</td>
<td>4</td>
<td>0</td>
<td>own leader</td>
</tr>
<tr class="odd">
<td>5</td>
<td>5</td>
<td>0</td>
<td>own leader</td>
</tr>
</tbody>
</table>
<p>After all <code>Make-Set</code>, each element is in its own group:</p>
<pre><code>{1}, {2}, {3}, {4}, {5}</code></pre>
</section>
<section id="visualization-1" class="level4">
<h4 class="anchored" data-anchor-id="visualization-1">Visualization</h4>
<pre><code>1   2   3   4   5
↑   ↑   ↑   ↑   ↑
|   |   |   |   |
self self self self self</code></pre>
<p>Each node points to itself, five separate trees.</p>
</section>
<section id="tiny-code-easy-versions-45" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-45">Tiny Code (Easy Versions)</h4>
<p>C Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb133"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">1000</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> parent<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> rank_<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> make_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> v<span class="op">;</span>   <span class="co">// self parent</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>    rank_<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>    <span class="co">// initial rank</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>        make_set<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Initial sets:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Element </span><span class="sc">%d</span><span class="st">: parent=</span><span class="sc">%d</span><span class="st">, rank=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> parent<span class="op">[</span>i<span class="op">],</span> rank_<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_set(x, parent, rank):</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>    parent[x] <span class="op">=</span> x</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    rank[x] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>parent <span class="op">=</span> {}</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>rank <span class="op">=</span> {}</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    make_set(i, parent, rank)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parent:"</span>, parent)</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rank:"</span>, rank)</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Parent: {1:1, 2:2, 3:3, 4:4, 5:5}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-50" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-50">Why It Matters</h4>
<ul>
<li>The foundation of Disjoint Set Union</li>
<li>Enables efficient graph algorithms</li>
<li>A building block for Union by Rank and Path Compression</li>
<li>Every DSU begins with <code>Make-Set</code></li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-50" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-50">A Gentle Proof (Why It Works)</h4>
<p>Each element begins as a singleton. Since no pointers cross between elements, sets are disjoint. Subsequent <code>Union</code> operations preserve this property by merging trees, never duplicating nodes.</p>
<p>Thus, <code>Make-Set</code> guarantees:</p>
<ul>
<li>Each new node is independent</li>
<li>Parent pointers form valid forests</li>
</ul>
</section>
<section id="try-it-yourself-50" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-50">Try It Yourself</h4>
<ol type="1">
<li>Initialize <code>{1..5}</code> with <code>Make-Set</code></li>
<li>Print parent and rank arrays</li>
<li>Add <code>Union(1,2)</code> and check parent changes</li>
<li>Verify all parent[x] = x before unions</li>
</ol>
</section>
<section id="test-cases-50" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-50">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Input</th>
<th>Operation</th>
<th>Expected Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>n=3</td>
<td>Make-Set(1..3)</td>
<td>parent = [1,2,3]</td>
</tr>
<tr class="even">
<td>n=5</td>
<td>Make-Set(1..5)</td>
<td>rank = [0,0,0,0,0]</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-50" class="level4">
<h4 class="anchored" data-anchor-id="complexity-50">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Make-Set</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Find</td>
<td>O(α(n)) with compression</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Union</td>
<td>O(α(n)) with rank</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>The <code>Make-Set</code> step is your first move in the DSU dance, simple, constant time, and crucial for what follows.</p>
</section>
</section>
<section id="find" class="level3">
<h3 class="anchored" data-anchor-id="find">252 Find</h3>
<p>The Find operation is the heart of the Disjoint Set Union (DSU), also known as Union-Find. It locates the representative (leader) of the set containing a given element. Every element in the same set shares the same leader, this is how DSU identifies which elements belong together.</p>
<p>To make lookups efficient, <code>Find</code> uses a clever optimization called Path Compression, which flattens the structure of the tree so future queries become nearly constant time.</p>
<section id="what-problem-are-we-solving-51" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-51">What Problem Are We Solving?</h4>
<p>Given an element <code>x</code>, we want to determine which set it belongs to. Each set is represented by a root node (the leader).</p>
<p>We maintain a <code>parent[]</code> array such that:</p>
<ul>
<li><code>parent[x] = x</code> if <code>x</code> is the root (leader)</li>
<li>otherwise <code>parent[x] = parent of x</code></li>
</ul>
<p>The <code>Find(x)</code> operation recursively follows <code>parent[x]</code> pointers until it reaches the root.</p>
</section>
<section id="how-it-works-plain-language-16" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-16">How It Works (Plain Language)</h4>
<p>Think of each set as a tree, where the root is the representative.</p>
<p>For example:</p>
<pre><code>1 ← 2 ← 3    4 ← 5</code></pre>
<p>means <code>{1,2,3}</code> is one set, <code>{4,5}</code> is another. The Find(3) operation follows <code>3→2→1</code>, discovering 1 is the root.</p>
<p>Path Compression flattens the tree by pointing every node directly to the root, reducing depth and speeding up future finds.</p>
<p>After compression:</p>
<pre><code>1 ← 2   1 ← 3
4 ← 5</code></pre>
<p>Now <code>Find(3)</code> is O(1).</p>
</section>
<section id="example-17" class="level4">
<h4 class="anchored" data-anchor-id="example-17">Example</h4>
<p>Start:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>x</th>
<th>parent[x]</th>
<th>rank[x]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2</td>
<td>0</td>
</tr>
<tr class="even">
<td>4</td>
<td>4</td>
<td>0</td>
</tr>
<tr class="odd">
<td>5</td>
<td>4</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Perform <code>Find(3)</code>:</p>
<ol type="1">
<li>3 → parent[3] = 2</li>
<li>2 → parent[2] = 1</li>
<li>1 → root found</li>
</ol>
<p>Path compression rewires <code>parent[3] = 1</code></p>
<p>Result:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>x</th>
<th>parent[x]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td>5</td>
<td>4</td>
</tr>
</tbody>
</table>
</section>
<section id="visualization-2" class="level4">
<h4 class="anchored" data-anchor-id="visualization-2">Visualization</h4>
<p>Before compression:</p>
<pre><code>1  
↑  
2  
↑  
3</code></pre>
<p>After compression:</p>
<pre><code>1  
↑ ↑  
2 3</code></pre>
<p>Now all nodes point directly to root <code>1</code>.</p>
</section>
<section id="tiny-code-easy-versions-46" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-46">Tiny Code (Easy Versions)</h4>
<p>C Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb139"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">1000</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> parent<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> rank_<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> make_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>    rank_<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> find_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>v <span class="op">==</span> parent<span class="op">[</span>v<span class="op">])</span></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v<span class="op">;</span></span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Path compression</span></span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> find_set<span class="op">(</span>parent<span class="op">[</span>v<span class="op">]);</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> i<span class="op">++)</span> make_set<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Find(3) before: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> parent<span class="op">[</span><span class="dv">3</span><span class="op">]);</span></span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Root of 3: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> find_set<span class="op">(</span><span class="dv">3</span><span class="op">));</span></span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Find(3) after: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> parent<span class="op">[</span><span class="dv">3</span><span class="op">]);</span></span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_set(x, parent, rank):</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>    parent[x] <span class="op">=</span> x</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    rank[x] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_set(x, parent):</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> parent[x] <span class="op">!=</span> x:</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>        parent[x] <span class="op">=</span> find_set(parent[x], parent)  <span class="co"># Path compression</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent[x]</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>parent <span class="op">=</span> {}</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>rank <span class="op">=</span> {}</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>    make_set(i, parent, rank)</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>parent[<span class="dv">2</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>parent[<span class="dv">3</span>] <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Find(3) before:"</span>, parent)</span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Root of 3:"</span>, find_set(<span class="dv">3</span>, parent))</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Find(3) after:"</span>, parent)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-51" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-51">Why It Matters</h4>
<ul>
<li>Enables O(α(n)) almost-constant-time queries</li>
<li>Fundamental for Union-Find efficiency</li>
<li>Reduces tree height dramatically</li>
<li>Used in graph algorithms (Kruskal, connected components, etc.)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-51" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-51">A Gentle Proof (Why It Works)</h4>
<p>Every set is a rooted tree. Without compression, a sequence of unions could build a deep chain. With path compression, each <code>Find</code> flattens paths, ensuring amortized constant time per operation (Ackermann-inverse time).</p>
<p>So after repeated operations, DSU trees become very shallow.</p>
</section>
<section id="try-it-yourself-51" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-51">Try It Yourself</h4>
<ol type="1">
<li>Initialize <code>{1..5}</code></li>
<li>Set <code>parent[2]=1, parent[3]=2</code></li>
<li>Call <code>Find(3)</code> and observe compression</li>
<li>Check <code>parent[3] == 1</code> after</li>
</ol>
</section>
<section id="test-cases-51" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-51">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>parent before</th>
<th>Find(x)</th>
<th>parent after</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1,1,2]</td>
<td>Find(3)</td>
<td>[1,1,1]</td>
</tr>
<tr class="even">
<td>[1,2,3,4,5]</td>
<td>Find(5)</td>
<td>[1,2,3,4,5]</td>
</tr>
<tr class="odd">
<td>[1,1,1,1,1]</td>
<td>Find(3)</td>
<td>[1,1,1,1,1]</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-51" class="level4">
<h4 class="anchored" data-anchor-id="complexity-51">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time (Amortized)</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Find</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Make-Set</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Union</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>The Find operation is your compass, it always leads you to the leader of your set, and with path compression, it gets faster every step.</p>
</section>
</section>
<section id="union" class="level3">
<h3 class="anchored" data-anchor-id="union">253 Union</h3>
<p>The Union operation is what ties the Disjoint Set Union (DSU) together. After initializing sets with <code>Make-Set</code> and locating leaders with <code>Find</code>, <code>Union</code> merges two disjoint sets into one, a cornerstone of dynamic connectivity.</p>
<p>To keep the trees shallow and efficient, we combine it with heuristics like Union by Rank or Union by Size.</p>
<section id="what-problem-are-we-solving-52" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-52">What Problem Are We Solving?</h4>
<p>We want to merge the sets containing two elements <code>a</code> and <code>b</code>.</p>
<p>If <code>a</code> and <code>b</code> belong to different sets, their leaders (<code>Find(a)</code> and <code>Find(b)</code>) are different. The Union operation connects these leaders, ensuring both now share the same representative.</p>
<p>We must do it efficiently, no unnecessary tree height. That’s where Union by Rank comes in.</p>
</section>
<section id="how-it-works-plain-language-17" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-17">How It Works (Plain Language)</h4>
<ol type="1">
<li><p>Find roots of both elements:</p>
<pre><code>rootA = Find(a)
rootB = Find(b)</code></pre></li>
<li><p>If they’re already equal → same set, no action.</p></li>
<li><p>Otherwise, attach the shorter tree under the taller one:</p>
<ul>
<li>If <code>rank[rootA] &lt; rank[rootB]</code>: <code>parent[rootA] = rootB</code></li>
<li>Else if <code>rank[rootA] &gt; rank[rootB]</code>: <code>parent[rootB] = rootA</code></li>
<li>Else: <code>parent[rootB] = rootA</code>, and <code>rank[rootA]++</code></li>
</ul></li>
</ol>
<p>This keeps the resulting forest balanced, maintaining O(α(n)) time for operations.</p>
</section>
<section id="example-18" class="level4">
<h4 class="anchored" data-anchor-id="example-18">Example</h4>
<p>Initial sets: <code>{1}, {2}, {3}, {4}</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>x</th>
<th>parent[x]</th>
<th>rank[x]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
<td>0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>3</td>
<td>0</td>
</tr>
<tr class="even">
<td>4</td>
<td>4</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Perform <code>Union(1,2)</code> → attach 2 under 1</p>
<pre><code>parent[2] = 1  
rank[1] = 1</code></pre>
<p>Now sets: <code>{1,2}, {3}, {4}</code></p>
<p>Perform <code>Union(3,4)</code> → attach 4 under 3 Sets: <code>{1,2}, {3,4}</code></p>
<p>Then <code>Union(2,3)</code> → merge leaders (1 and 3) Attach lower rank under higher (both rank 1 → tie) → attach 3 under 1, rank[1] = 2</p>
<p>Final parent table:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>x</th>
<th>parent[x]</th>
<th>rank[x]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>3</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Now all are connected under root 1. ✅</p>
</section>
<section id="visualization-3" class="level4">
<h4 class="anchored" data-anchor-id="visualization-3">Visualization</h4>
<p>Start:</p>
<pre><code>1   2   3   4</code></pre>
<p>Union(1,2):</p>
<pre><code>  1
  |
  2</code></pre>
<p>Union(3,4):</p>
<pre><code>  3
  |
  4</code></pre>
<p>Union(2,3):</p>
<pre><code>    1
  / | \
 2  3  4</code></pre>
<p>All connected under 1.</p>
</section>
<section id="tiny-code-easy-versions-47" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-47">Tiny Code (Easy Versions)</h4>
<p>C Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb147"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">1000</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> parent<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> rank_<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> make_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>    rank_<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> find_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>v <span class="op">==</span> parent<span class="op">[</span>v<span class="op">])</span> <span class="cf">return</span> v<span class="op">;</span></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> find_set<span class="op">(</span>parent<span class="op">[</span>v<span class="op">]);</span> <span class="co">// path compression</span></span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> union_sets<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> find_set<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> find_set<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">!=</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>rank_<span class="op">[</span>a<span class="op">]</span> <span class="op">&lt;</span> rank_<span class="op">[</span>b<span class="op">])</span></span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a>            parent<span class="op">[</span>a<span class="op">]</span> <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb147-23"><a href="#cb147-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>rank_<span class="op">[</span>a<span class="op">]</span> <span class="op">&gt;</span> rank_<span class="op">[</span>b<span class="op">])</span></span>
<span id="cb147-24"><a href="#cb147-24" aria-hidden="true" tabindex="-1"></a>            parent<span class="op">[</span>b<span class="op">]</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb147-25"><a href="#cb147-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb147-26"><a href="#cb147-26" aria-hidden="true" tabindex="-1"></a>            parent<span class="op">[</span>b<span class="op">]</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb147-27"><a href="#cb147-27" aria-hidden="true" tabindex="-1"></a>            rank_<span class="op">[</span>a<span class="op">]++;</span></span>
<span id="cb147-28"><a href="#cb147-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb147-29"><a href="#cb147-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb147-30"><a href="#cb147-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb147-31"><a href="#cb147-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-32"><a href="#cb147-32" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb147-33"><a href="#cb147-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++)</span> make_set<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb147-34"><a href="#cb147-34" aria-hidden="true" tabindex="-1"></a>    union_sets<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb147-35"><a href="#cb147-35" aria-hidden="true" tabindex="-1"></a>    union_sets<span class="op">(</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb147-36"><a href="#cb147-36" aria-hidden="true" tabindex="-1"></a>    union_sets<span class="op">(</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb147-37"><a href="#cb147-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb147-38"><a href="#cb147-38" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Element </span><span class="sc">%d</span><span class="st">: parent=</span><span class="sc">%d</span><span class="st">, rank=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> parent<span class="op">[</span>i<span class="op">],</span> rank_<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb147-39"><a href="#cb147-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_set(x, parent, rank):</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>    parent[x] <span class="op">=</span> x</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    rank[x] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_set(x, parent):</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> parent[x] <span class="op">!=</span> x:</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>        parent[x] <span class="op">=</span> find_set(parent[x], parent)</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent[x]</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> union_sets(a, b, parent, rank):</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> find_set(a, parent)</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> find_set(b, parent)</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">!=</span> b:</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rank[a] <span class="op">&lt;</span> rank[b]:</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>            parent[a] <span class="op">=</span> b</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> rank[a] <span class="op">&gt;</span> rank[b]:</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a>            parent[b] <span class="op">=</span> a</span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>            parent[b] <span class="op">=</span> a</span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>            rank[a] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a>parent <span class="op">=</span> {}</span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a>rank <span class="op">=</span> {}</span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>): make_set(i, parent, rank)</span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a>union_sets(<span class="dv">1</span>,<span class="dv">2</span>,parent,rank)</span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a>union_sets(<span class="dv">3</span>,<span class="dv">4</span>,parent,rank)</span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a>union_sets(<span class="dv">2</span>,<span class="dv">3</span>,parent,rank)</span>
<span id="cb148-29"><a href="#cb148-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parent:"</span>, parent)</span>
<span id="cb148-30"><a href="#cb148-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rank:"</span>, rank)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-52" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-52">Why It Matters</h4>
<ul>
<li><p>Core operation in Union-Find</p></li>
<li><p>Enables dynamic set merging efficiently</p></li>
<li><p>Essential for graph algorithms:</p>
<ul>
<li>Kruskal’s Minimum Spanning Tree</li>
<li>Connected Components</li>
<li>Cycle Detection</li>
</ul></li>
</ul>
<p>Combining <code>Union by Rank</code> and <code>Path Compression</code> yields near-constant performance for huge datasets.</p>
</section>
<section id="a-gentle-proof-why-it-works-52" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-52">A Gentle Proof (Why It Works)</h4>
<p><code>Union</code> ensures disjointness:</p>
<ul>
<li>Only merges sets with different roots</li>
<li>Maintains one leader per set <code>Union by Rank</code> keeps trees balanced → tree height ≤ log n With path compression, amortized cost per operation is α(n), effectively constant for all practical n.</li>
</ul>
</section>
<section id="try-it-yourself-52" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-52">Try It Yourself</h4>
<ol type="1">
<li>Create 5 singleton sets</li>
<li>Union(1,2), Union(3,4), Union(2,3)</li>
<li>Verify all share same root</li>
<li>Inspect ranks before/after unions</li>
</ol>
</section>
<section id="test-cases-52" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-52">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operations</th>
<th>Expected Sets</th>
<th>Roots</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Make-Set(1..4)</td>
<td>{1},{2},{3},{4}</td>
<td>[1,2,3,4]</td>
</tr>
<tr class="even">
<td>Union(1,2)</td>
<td>{1,2}</td>
<td>[1,1,3,4]</td>
</tr>
<tr class="odd">
<td>Union(3,4)</td>
<td>{3,4}</td>
<td>[1,1,3,3]</td>
</tr>
<tr class="even">
<td>Union(2,3)</td>
<td>{1,2,3,4}</td>
<td>[1,1,1,1]</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-52" class="level4">
<h4 class="anchored" data-anchor-id="complexity-52">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time (Amortized)</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Union</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Find</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Make-Set</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p><code>Union</code> is the handshake between sets, careful, balanced, and lightning-fast when combined with smart optimizations.</p>
</section>
</section>
<section id="union-by-rank" class="level3">
<h3 class="anchored" data-anchor-id="union-by-rank">254 Union by Rank</h3>
<p>Union by Rank is a balancing strategy used in the Disjoint Set Union (DSU) structure to keep trees shallow. When merging two sets, instead of arbitrarily attaching one root under another, we attach the shorter tree (lower rank) under the taller tree (higher rank).</p>
<p>This small trick, combined with Path Compression, gives DSU its legendary near-constant performance, almost O(1) per operation.</p>
<section id="what-problem-are-we-solving-53" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-53">What Problem Are We Solving?</h4>
<p>Without balancing, repeated <code>Union</code> operations might create tall chains like:</p>
<pre><code>1 ← 2 ← 3 ← 4 ← 5</code></pre>
<p>In the worst case, <code>Find(x)</code> becomes O(n).</p>
<p>Union by Rank prevents this by maintaining a rough measure of tree height. Each <code>rank[root]</code> tracks the <em>approximate height</em> of its tree.</p>
<p>When merging:</p>
<ul>
<li>Attach the lower rank tree under the higher rank tree.</li>
<li>If ranks are equal, choose one as parent and increase its rank by 1.</li>
</ul>
</section>
<section id="how-it-works-plain-language-18" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-18">How It Works (Plain Language)</h4>
<p>Each node <code>x</code> has:</p>
<ul>
<li><code>parent[x]</code> → leader pointer</li>
<li><code>rank[x]</code> → estimate of tree height</li>
</ul>
<p>When performing <code>Union(a, b)</code>:</p>
<ol type="1">
<li><p><code>rootA = Find(a)</code></p></li>
<li><p><code>rootB = Find(b)</code></p></li>
<li><p>If ranks differ, attach smaller under larger:</p>
<pre><code>if rank[rootA] &lt; rank[rootB]:
    parent[rootA] = rootB
else if rank[rootA] &gt; rank[rootB]:
    parent[rootB] = rootA
else:
    parent[rootB] = rootA
    rank[rootA] += 1</code></pre></li>
</ol>
<p>This ensures the tree grows only when necessary.</p>
</section>
<section id="example-19" class="level4">
<h4 class="anchored" data-anchor-id="example-19">Example</h4>
<p>Start with <code>{1}, {2}, {3}, {4}</code> All have <code>rank = 0</code></p>
<p>Perform <code>Union(1,2)</code> → same rank → attach 2 under 1, increment rank[1]=1</p>
<pre><code>1
|
2</code></pre>
<p>Perform <code>Union(3,4)</code> → same rank → attach 4 under 3, increment rank[3]=1</p>
<pre><code>3
|
4</code></pre>
<p>Now Union(1,3) → both roots rank=1 → tie → attach 3 under 1, rank[1]=2</p>
<pre><code>   1(rank=2)
  / \
 2   3
     |
     4</code></pre>
<p>Tree height stays small, well-balanced.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Element</th>
<th>Parent</th>
<th>Rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>3</td>
<td>0</td>
</tr>
</tbody>
</table>
</section>
<section id="visualization-4" class="level4">
<h4 class="anchored" data-anchor-id="visualization-4">Visualization</h4>
<p>Before balancing:</p>
<pre><code>1 ← 2 ← 3 ← 4</code></pre>
<p>After union by rank:</p>
<pre><code>    1
   / \
  2   3
      |
      4</code></pre>
<p>Balanced and efficient ✅</p>
</section>
<section id="tiny-code-easy-versions-48" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-48">Tiny Code (Easy Versions)</h4>
<p>C Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb156"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">1000</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> parent<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> rank_<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> make_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>    rank_<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> find_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>v <span class="op">==</span> parent<span class="op">[</span>v<span class="op">])</span> <span class="cf">return</span> v<span class="op">;</span></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> find_set<span class="op">(</span>parent<span class="op">[</span>v<span class="op">]);</span> <span class="co">// Path compression</span></span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> union_by_rank<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> find_set<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> find_set<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">!=</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>rank_<span class="op">[</span>a<span class="op">]</span> <span class="op">&lt;</span> rank_<span class="op">[</span>b<span class="op">])</span> parent<span class="op">[</span>a<span class="op">]</span> <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>rank_<span class="op">[</span>a<span class="op">]</span> <span class="op">&gt;</span> rank_<span class="op">[</span>b<span class="op">])</span> parent<span class="op">[</span>b<span class="op">]</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>            parent<span class="op">[</span>b<span class="op">]</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>            rank_<span class="op">[</span>a<span class="op">]++;</span></span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++)</span> make_set<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a>    union_by_rank<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>    union_by_rank<span class="op">(</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a>    union_by_rank<span class="op">(</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Element </span><span class="sc">%d</span><span class="st">: parent=</span><span class="sc">%d</span><span class="st"> rank=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> parent<span class="op">[</span>i<span class="op">],</span> rank_<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_set(x, parent, rank):</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>    parent[x] <span class="op">=</span> x</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>    rank[x] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_set(x, parent):</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> parent[x] <span class="op">!=</span> x:</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>        parent[x] <span class="op">=</span> find_set(parent[x], parent)</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent[x]</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> union_by_rank(a, b, parent, rank):</span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> find_set(a, parent)</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> find_set(b, parent)</span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">!=</span> b:</span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rank[a] <span class="op">&lt;</span> rank[b]:</span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>            parent[a] <span class="op">=</span> b</span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> rank[a] <span class="op">&gt;</span> rank[b]:</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>            parent[b] <span class="op">=</span> a</span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>            parent[b] <span class="op">=</span> a</span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>            rank[a] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a>parent <span class="op">=</span> {}</span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>rank <span class="op">=</span> {}</span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>): make_set(i, parent, rank)</span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>union_by_rank(<span class="dv">1</span>,<span class="dv">2</span>,parent,rank)</span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>union_by_rank(<span class="dv">3</span>,<span class="dv">4</span>,parent,rank)</span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>union_by_rank(<span class="dv">2</span>,<span class="dv">3</span>,parent,rank)</span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parent:"</span>, parent)</span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rank:"</span>, rank)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-53" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-53">Why It Matters</h4>
<ul>
<li>Keeps trees balanced and shallow</li>
<li>Ensures amortized O(α(n)) performance</li>
<li>Critical for massive-scale connectivity problems</li>
<li>Used in Kruskal’s MST, Union-Find with rollback, and network clustering</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-53" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-53">A Gentle Proof (Why It Works)</h4>
<p>The rank grows only when two trees of equal height merge. Thus, the height of any tree is bounded by log₂ n. Combining this with Path Compression, the amortized complexity per operation becomes O(α(n)), where α(n) (inverse Ackermann function) &lt; 5 for all practical n.</p>
</section>
<section id="try-it-yourself-53" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-53">Try It Yourself</h4>
<ol type="1">
<li>Create 8 singleton sets</li>
<li>Perform unions in sequence: (1,2), (3,4), (1,3), (5,6), (7,8), (5,7), (1,5)</li>
<li>Observe ranks and parent structure</li>
</ol>
</section>
<section id="test-cases-53" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-53">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Result (Parent Array)</th>
<th>Rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Union(1,2)</td>
<td>[1,1,3,4]</td>
<td>[1,0,0,0]</td>
</tr>
<tr class="even">
<td>Union(3,4)</td>
<td>[1,1,3,3]</td>
<td>[1,0,1,0]</td>
</tr>
<tr class="odd">
<td>Union(2,3)</td>
<td>[1,1,1,3]</td>
<td>[2,0,1,0]</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-53" class="level4">
<h4 class="anchored" data-anchor-id="complexity-53">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time (Amortized)</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Union by Rank</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Find</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Make-Set</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>Union by Rank is the art of merging gracefully, always lifting smaller trees, keeping your forest light, flat, and fast.</p>
</section>
</section>
<section id="path-compression" class="level3">
<h3 class="anchored" data-anchor-id="path-compression">255 Path Compression</h3>
<p>Path Compression is the secret sauce that makes Disjoint Set Union (DSU) lightning fast. Every time you perform a <code>Find</code> operation, it <em>flattens</em> the structure by making each visited node point directly to the root. Over time, this transforms deep trees into almost flat structures, turning expensive lookups into near-constant time.</p>
<section id="what-problem-are-we-solving-54" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-54">What Problem Are We Solving?</h4>
<p>In a basic DSU, <code>Find(x)</code> follows parent pointers up the tree until it reaches the root. Without compression, frequent unions can form long chains:</p>
<pre><code>1 ← 2 ← 3 ← 4 ← 5</code></pre>
<p>A <code>Find(5)</code> would take 5 steps. Multiply this over many queries, and performance tanks.</p>
<p>Path Compression fixes this inefficiency by <em>rewiring</em> all nodes on the search path to the root directly, effectively flattening the tree.</p>
</section>
<section id="how-it-works-plain-language-19" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-19">How It Works (Plain Language)</h4>
<p>Whenever we call <code>Find(x)</code>, we recursively find the root, then make every node along the way point directly to that root.</p>
<p>Pseudocode:</p>
<pre><code>Find(x):
    if parent[x] != x:
        parent[x] = Find(parent[x])
    return parent[x]</code></pre>
<p>Now, future lookups for <code>x</code> and its descendants become instant.</p>
</section>
<section id="example-20" class="level4">
<h4 class="anchored" data-anchor-id="example-20">Example</h4>
<p>Start with a chain:</p>
<pre><code>1 ← 2 ← 3 ← 4 ← 5</code></pre>
<p>Perform <code>Find(5)</code>:</p>
<ol type="1">
<li><p><code>Find(5)</code> calls <code>Find(4)</code></p></li>
<li><p><code>Find(4)</code> calls <code>Find(3)</code></p></li>
<li><p><code>Find(3)</code> calls <code>Find(2)</code></p></li>
<li><p><code>Find(2)</code> calls <code>Find(1)</code> (root)</p></li>
<li><p>On the way back, each node gets updated:</p>
<pre><code>parent[5] = 1
parent[4] = 1
parent[3] = 1
parent[2] = 1</code></pre></li>
</ol>
<p>After compression, structure becomes flat:</p>
<pre><code>1
├── 2
├── 3
├── 4
└── 5</code></pre>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Element</th>
<th>Parent Before</th>
<th>Parent After</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>3</td>
<td>1</td>
</tr>
<tr class="odd">
<td>5</td>
<td>4</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Next call <code>Find(5)</code> → single step.</p>
</section>
<section id="visualization-5" class="level4">
<h4 class="anchored" data-anchor-id="visualization-5">Visualization</h4>
<p>Before compression:</p>
<pre><code>1 ← 2 ← 3 ← 4 ← 5</code></pre>
<p>After compression:</p>
<pre><code>1
├─2
├─3
├─4
└─5</code></pre>
</section>
<section id="tiny-code-easy-versions-49" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-49">Tiny Code (Easy Versions)</h4>
<p>C Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb165"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> parent<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> make_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> find_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>v <span class="op">!=</span> parent<span class="op">[</span>v<span class="op">])</span></span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>        parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> find_set<span class="op">(</span>parent<span class="op">[</span>v<span class="op">]);</span> <span class="co">// Path compression</span></span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> union_sets<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> find_set<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> find_set<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">!=</span> b<span class="op">)</span></span>
<span id="cb165-20"><a href="#cb165-20" aria-hidden="true" tabindex="-1"></a>        parent<span class="op">[</span>b<span class="op">]</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb165-21"><a href="#cb165-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb165-22"><a href="#cb165-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-23"><a href="#cb165-23" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb165-24"><a href="#cb165-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> make_set<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb165-25"><a href="#cb165-25" aria-hidden="true" tabindex="-1"></a>    union_sets<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb165-26"><a href="#cb165-26" aria-hidden="true" tabindex="-1"></a>    union_sets<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb165-27"><a href="#cb165-27" aria-hidden="true" tabindex="-1"></a>    union_sets<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb165-28"><a href="#cb165-28" aria-hidden="true" tabindex="-1"></a>    union_sets<span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb165-29"><a href="#cb165-29" aria-hidden="true" tabindex="-1"></a>    find_set<span class="op">(</span><span class="dv">5</span><span class="op">);</span> <span class="co">// compress path</span></span>
<span id="cb165-30"><a href="#cb165-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb165-31"><a href="#cb165-31" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Element </span><span class="sc">%d</span><span class="st"> → Parent </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> parent<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb165-32"><a href="#cb165-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_set(x, parent):</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>    parent[x] <span class="op">=</span> x</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_set(x, parent):</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> parent[x] <span class="op">!=</span> x:</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>        parent[x] <span class="op">=</span> find_set(parent[x], parent)</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent[x]</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> union_sets(a, b, parent):</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> find_set(a, parent)</span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> find_set(b, parent)</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">!=</span> b:</span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>        parent[b] <span class="op">=</span> a</span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>parent <span class="op">=</span> {}</span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>):</span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a>    make_set(i, parent)</span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>union_sets(<span class="dv">1</span>, <span class="dv">2</span>, parent)</span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>union_sets(<span class="dv">2</span>, <span class="dv">3</span>, parent)</span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a>union_sets(<span class="dv">3</span>, <span class="dv">4</span>, parent)</span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a>union_sets(<span class="dv">4</span>, <span class="dv">5</span>, parent)</span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a>find_set(<span class="dv">5</span>, parent)</span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parent map after compression:"</span>, parent)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-54" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-54">Why It Matters</h4>
<ul>
<li>Speeds up Find drastically by flattening trees.</li>
<li>Pairs beautifully with Union by Rank.</li>
<li>Achieves amortized O(α(n)) performance.</li>
<li>Essential in graph algorithms like Kruskal’s MST, connectivity checks, and dynamic clustering.</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-54" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-54">A Gentle Proof (Why It Works)</h4>
<p>Path Compression ensures each node’s parent jumps directly to the root. Each node’s depth decreases exponentially with every <code>Find</code>. After a few operations, trees become almost flat, and each subsequent <code>Find</code> becomes O(1).</p>
<p>Combining with Union by Rank:</p>
<blockquote class="blockquote">
<p>Every operation (Find or Union) becomes O(α(n)), where α(n) is the inverse Ackermann function (smaller than 5 for any practical input).</p>
</blockquote>
</section>
<section id="try-it-yourself-54" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-54">Try It Yourself</h4>
<ol type="1">
<li>Create 6 singleton sets.</li>
<li>Perform unions: (1,2), (2,3), (3,4), (4,5), (5,6).</li>
<li>Call <code>Find(6)</code> and print parent map before and after.</li>
<li>Observe how the chain flattens.</li>
<li>Measure calls count difference before and after compression.</li>
</ol>
</section>
<section id="test-cases-54" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-54">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation Sequence</th>
<th>Parent Map After</th>
<th>Tree Depth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>No Compression</td>
<td><code>{1:1, 2:1, 3:2, 4:3, 5:4}</code></td>
<td>4</td>
</tr>
<tr class="even">
<td>After Find(5)</td>
<td><code>{1:1, 2:1, 3:1, 4:1, 5:1}</code></td>
<td>1</td>
</tr>
<tr class="odd">
<td>After Find(3)</td>
<td><code>{1:1, 2:1, 3:1, 4:1, 5:1}</code></td>
<td>1</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-54" class="level4">
<h4 class="anchored" data-anchor-id="complexity-54">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time (Amortized)</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Find with Path Compression</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Union (with rank)</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Make-Set</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>Path Compression is the flattening spell of DSU, once cast, your sets become sleek, your lookups swift, and your unions unstoppable.</p>
</section>
</section>
<section id="dsu-with-rollback" class="level3">
<h3 class="anchored" data-anchor-id="dsu-with-rollback">256 DSU with Rollback</h3>
<p>DSU with Rollback extends the classic Disjoint Set Union to support <em>undoing</em> recent operations. This is vital in scenarios where you need to explore multiple states, like backtracking algorithms, dynamic connectivity queries, or offline problems where unions might need to be reversed.</p>
<p>Instead of destroying past states, this version <em>remembers</em> what changed and can roll back to a previous version in constant time.</p>
<section id="what-problem-are-we-solving-55" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-55">What Problem Are We Solving?</h4>
<p>Standard DSU operations (<code>Find</code>, <code>Union</code>) mutate the structure, parent pointers and ranks get updated, so you can’t easily go back.</p>
<p>But what if you’re exploring a search tree or processing offline queries where you need to:</p>
<ul>
<li>Add an edge (Union),</li>
<li>Explore a path,</li>
<li>Then revert to the previous structure?</li>
</ul>
<p>A rollback DSU lets you undo changes, perfect for divide-and-conquer over time, Mo’s algorithm on trees, and offline dynamic graphs.</p>
</section>
<section id="how-it-works-plain-language-20" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-20">How It Works (Plain Language)</h4>
<p>The idea is simple:</p>
<ul>
<li>Every time you modify the DSU, record what you changed on a stack.</li>
<li>When you need to revert, pop from the stack and undo the last operation.</li>
</ul>
<p>Operations to track:</p>
<ul>
<li>When <code>parent[b]</code> changes, store <code>(b, old_parent)</code></li>
<li>When <code>rank[a]</code> changes, store <code>(a, old_rank)</code></li>
</ul>
<p>You never perform path compression, because it’s not easily reversible. Instead, rely on union by rank for efficiency.</p>
</section>
<section id="example-21" class="level4">
<h4 class="anchored" data-anchor-id="example-21">Example</h4>
<p>Let’s build sets <code>{1}, {2}, {3}, {4}</code></p>
<p>Perform:</p>
<ol type="1">
<li><p><code>Union(1,2)</code> → attach 2 under 1</p>
<ul>
<li>Push <code>(2, parent=2, rank=None)</code></li>
</ul></li>
<li><p><code>Union(3,4)</code> → attach 4 under 3</p>
<ul>
<li>Push <code>(4, parent=4, rank=None)</code></li>
</ul></li>
<li><p><code>Union(1,3)</code> → attach 3 under 1</p>
<ul>
<li>Push <code>(3, parent=3, rank=None)</code></li>
<li>Rank of 1 increases → push <code>(1, rank=0)</code></li>
</ul></li>
</ol>
<p>Rollback once → undo last union:</p>
<ul>
<li>Restore <code>parent[3] = 3</code></li>
<li>Restore <code>rank[1] = 0</code></li>
</ul>
<p>Now DSU returns to state after step 2.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Parent Map</th>
<th>Rank</th>
<th>Stack</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Init</td>
<td>[1,2,3,4]</td>
<td>[0,0,0,0]</td>
<td>[]</td>
</tr>
<tr class="even">
<td>After Union(1,2)</td>
<td>[1,1,3,4]</td>
<td>[1,0,0,0]</td>
<td>[(2,2,None)]</td>
</tr>
<tr class="odd">
<td>After Union(3,4)</td>
<td>[1,1,3,3]</td>
<td>[1,0,1,0]</td>
<td>[(2,2,None),(4,4,None)]</td>
</tr>
<tr class="even">
<td>After Union(1,3)</td>
<td>[1,1,1,3]</td>
<td>[2,0,1,0]</td>
<td>[(2,2,None),(4,4,None),(3,3,None),(1,None,0)]</td>
</tr>
<tr class="odd">
<td>After Rollback</td>
<td>[1,1,3,3]</td>
<td>[1,0,1,0]</td>
<td>[(2,2,None),(4,4,None)]</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-50" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-50">Tiny Code (Easy Versions)</h4>
<p>C Implementation (Conceptual)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb167"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">1000</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> parent<span class="op">[</span>MAXN<span class="op">],</span> rank_<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span> <span class="dt">int</span> node<span class="op">,</span> parent<span class="op">,</span> rank_val<span class="op">,</span> rank_changed<span class="op">;</span> <span class="op">}</span> Change<span class="op">;</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>Change stack<span class="op">[</span>MAXN <span class="op">*</span> <span class="dv">10</span><span class="op">];</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> top <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> make_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>    rank_<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> find_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>v <span class="op">!=</span> parent<span class="op">[</span>v<span class="op">])</span> v <span class="op">=</span> parent<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> v<span class="op">;</span> <span class="co">// no path compression</span></span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> union_sets<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> find_set<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb167-21"><a href="#cb167-21" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> find_set<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb167-22"><a href="#cb167-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> b<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb167-23"><a href="#cb167-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>rank_<span class="op">[</span>a<span class="op">]</span> <span class="op">&lt;</span> rank_<span class="op">[</span>b<span class="op">])</span> <span class="op">{</span> <span class="dt">int</span> tmp <span class="op">=</span> a<span class="op">;</span> a <span class="op">=</span> b<span class="op">;</span> b <span class="op">=</span> tmp<span class="op">;</span> <span class="op">}</span></span>
<span id="cb167-24"><a href="#cb167-24" aria-hidden="true" tabindex="-1"></a>    stack<span class="op">[</span>top<span class="op">++]</span> <span class="op">=</span> <span class="op">(</span>Change<span class="op">){</span>b<span class="op">,</span> parent<span class="op">[</span>b<span class="op">],</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb167-25"><a href="#cb167-25" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span>b<span class="op">]</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb167-26"><a href="#cb167-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>rank_<span class="op">[</span>a<span class="op">]</span> <span class="op">==</span> rank_<span class="op">[</span>b<span class="op">])</span> <span class="op">{</span></span>
<span id="cb167-27"><a href="#cb167-27" aria-hidden="true" tabindex="-1"></a>        stack<span class="op">[</span>top<span class="op">++]</span> <span class="op">=</span> <span class="op">(</span>Change<span class="op">){</span>a<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> rank_<span class="op">[</span>a<span class="op">],</span> <span class="dv">1</span><span class="op">};</span></span>
<span id="cb167-28"><a href="#cb167-28" aria-hidden="true" tabindex="-1"></a>        rank_<span class="op">[</span>a<span class="op">]++;</span></span>
<span id="cb167-29"><a href="#cb167-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb167-30"><a href="#cb167-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb167-31"><a href="#cb167-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-32"><a href="#cb167-32" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> rollback<span class="op">()</span> <span class="op">{</span></span>
<span id="cb167-33"><a href="#cb167-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>top <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb167-34"><a href="#cb167-34" aria-hidden="true" tabindex="-1"></a>    Change ch <span class="op">=</span> stack<span class="op">[--</span>top<span class="op">];</span></span>
<span id="cb167-35"><a href="#cb167-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ch<span class="op">.</span>rank_changed<span class="op">)</span> rank_<span class="op">[</span>ch<span class="op">.</span>node<span class="op">]</span> <span class="op">=</span> ch<span class="op">.</span>rank_val<span class="op">;</span></span>
<span id="cb167-36"><a href="#cb167-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> parent<span class="op">[</span>ch<span class="op">.</span>node<span class="op">]</span> <span class="op">=</span> ch<span class="op">.</span>parent<span class="op">;</span></span>
<span id="cb167-37"><a href="#cb167-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb167-38"><a href="#cb167-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-39"><a href="#cb167-39" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb167-40"><a href="#cb167-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++)</span> make_set<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb167-41"><a href="#cb167-41" aria-hidden="true" tabindex="-1"></a>    union_sets<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb167-42"><a href="#cb167-42" aria-hidden="true" tabindex="-1"></a>    union_sets<span class="op">(</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb167-43"><a href="#cb167-43" aria-hidden="true" tabindex="-1"></a>    union_sets<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb167-44"><a href="#cb167-44" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Before rollback: parent[3]=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> parent<span class="op">[</span><span class="dv">3</span><span class="op">]);</span></span>
<span id="cb167-45"><a href="#cb167-45" aria-hidden="true" tabindex="-1"></a>    rollback<span class="op">();</span></span>
<span id="cb167-46"><a href="#cb167-46" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"After rollback: parent[3]=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> parent<span class="op">[</span><span class="dv">3</span><span class="op">]);</span></span>
<span id="cb167-47"><a href="#cb167-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RollbackDSU:</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n):</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.parent <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(n))</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.rank <span class="op">=</span> [<span class="dv">0</span>]<span class="op">*</span>n</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stack <span class="op">=</span> []</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find(<span class="va">self</span>, x):</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> x <span class="op">!=</span> <span class="va">self</span>.parent[x]:</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> <span class="va">self</span>.parent[x]</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x  <span class="co"># no path compression</span></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> union(<span class="va">self</span>, a, b):</span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> <span class="va">self</span>.find(a), <span class="va">self</span>.find(b)</span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> a <span class="op">==</span> b:</span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.rank[a] <span class="op">&lt;</span> <span class="va">self</span>.rank[b]:</span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>            a, b <span class="op">=</span> b, a</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stack.append((<span class="st">'p'</span>, b, <span class="va">self</span>.parent[b]))</span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.parent[b] <span class="op">=</span> a</span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.rank[a] <span class="op">==</span> <span class="va">self</span>.rank[b]:</span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.stack.append((<span class="st">'r'</span>, a, <span class="va">self</span>.rank[a]))</span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.rank[a] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb168-23"><a href="#cb168-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb168-24"><a href="#cb168-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-25"><a href="#cb168-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rollback(<span class="va">self</span>):</span>
<span id="cb168-26"><a href="#cb168-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.stack:</span>
<span id="cb168-27"><a href="#cb168-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb168-28"><a href="#cb168-28" aria-hidden="true" tabindex="-1"></a>        typ, node, val <span class="op">=</span> <span class="va">self</span>.stack.pop()</span>
<span id="cb168-29"><a href="#cb168-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> typ <span class="op">==</span> <span class="st">'r'</span>:</span>
<span id="cb168-30"><a href="#cb168-30" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.rank[node] <span class="op">=</span> val</span>
<span id="cb168-31"><a href="#cb168-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb168-32"><a href="#cb168-32" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.parent[node] <span class="op">=</span> val</span>
<span id="cb168-33"><a href="#cb168-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-34"><a href="#cb168-34" aria-hidden="true" tabindex="-1"></a>dsu <span class="op">=</span> RollbackDSU(<span class="dv">5</span>)</span>
<span id="cb168-35"><a href="#cb168-35" aria-hidden="true" tabindex="-1"></a>dsu.union(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb168-36"><a href="#cb168-36" aria-hidden="true" tabindex="-1"></a>dsu.union(<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb168-37"><a href="#cb168-37" aria-hidden="true" tabindex="-1"></a>dsu.union(<span class="dv">1</span>,<span class="dv">3</span>)</span>
<span id="cb168-38"><a href="#cb168-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Before rollback:"</span>, dsu.parent)</span>
<span id="cb168-39"><a href="#cb168-39" aria-hidden="true" tabindex="-1"></a>dsu.rollback()</span>
<span id="cb168-40"><a href="#cb168-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"After rollback:"</span>, dsu.parent)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-55" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-55">Why It Matters</h4>
<ul>
<li>Enables reversible union operations</li>
<li>Perfect for offline dynamic connectivity</li>
<li>Core in divide-and-conquer over time algorithms</li>
<li>Used in Mo’s algorithm on trees</li>
<li>Helps in exploration backtracking (e.g., DSU on recursion)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-55" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-55">A Gentle Proof (Why It Works)</h4>
<p>Rollback DSU is efficient because:</p>
<ul>
<li>Each union modifies O(1) fields</li>
<li>Each rollback reverts O(1) fields</li>
<li><code>Find</code> runs in O(log n) (no path compression) Thus, each operation is O(log n) or better, fully reversible.</li>
</ul>
</section>
<section id="try-it-yourself-55" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-55">Try It Yourself</h4>
<ol type="1">
<li>Create 6 sets <code>{1}..{6}</code></li>
<li>Perform unions: (1,2), (3,4), (2,3)</li>
<li>Rollback once, verify sets <code>{1,2}</code> and <code>{3,4}</code> remain separate</li>
<li>Rollback again, check individual sets restored</li>
<li>Print parent and rank at each step</li>
</ol>
</section>
<section id="test-cases-55" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-55">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Parents</th>
<th>Ranks</th>
<th>Stack Size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Union(1,2)</td>
<td>[1,1,3,4]</td>
<td>[1,0,0,0]</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>Union(3,4)</td>
<td>[1,1,3,3]</td>
<td>[1,0,1,0]</td>
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Union(1,3)</td>
<td>[1,1,1,3]</td>
<td>[2,0,1,0]</td>
<td>4</td>
</tr>
<tr class="even">
<td>4</td>
<td>Rollback</td>
<td>[1,1,3,3]</td>
<td>[1,0,1,0]</td>
<td>2</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-55" class="level4">
<h4 class="anchored" data-anchor-id="complexity-55">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Make-Set</td>
<td>O(1)</td>
<td>O(n)</td>
</tr>
<tr class="even">
<td>Union</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Rollback</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>DSU with Rollback is your time machine, merge, explore, undo. Perfect balance between persistence and performance.</p>
</section>
</section>
<section id="dsu-on-tree" class="level3">
<h3 class="anchored" data-anchor-id="dsu-on-tree">257 DSU on Tree</h3>
<p>DSU on Tree is a hybrid technique combining Disjoint Set Union (DSU) and Depth-First Search (DFS) to process subtree queries efficiently. It’s often called the “Small-to-Large” merging technique, and it shines in problems where you need to answer queries like:</p>
<blockquote class="blockquote">
<p>“For each node, count something inside its subtree.”</p>
</blockquote>
<p>Instead of recomputing from scratch at every node, we use DSU logic to reuse computed data, merging smaller subtrees into larger ones for near-linear complexity.</p>
<section id="what-problem-are-we-solving-56" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-56">What Problem Are We Solving?</h4>
<p>Many tree problems ask for aggregated properties of subtrees:</p>
<ul>
<li>Number of distinct colors in a subtree</li>
<li>Frequency of labels, values, or weights</li>
<li>Subtree sums, counts, or modes</li>
</ul>
<p>A naive DFS recomputes at every node → O(n²) time.</p>
<p>DSU on Tree avoids recomputation by merging information from child subtrees cleverly.</p>
</section>
<section id="how-it-works-plain-language-21" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-21">How It Works (Plain Language)</h4>
<p>Think of each node’s subtree as a bag of information (like a multiset of colors). We process subtrees in DFS order, and at each step:</p>
<ol type="1">
<li>Process all <em>small children</em> first and discard their data after use.</li>
<li>Process the <em>heavy child</em> last and keep its data (reuse it).</li>
<li>Merge small subtrees into the large one incrementally.</li>
</ol>
<p>This “small-to-large” merging ensures each element moves O(log n) times, leading to O(n log n) total complexity.</p>
</section>
<section id="example-22" class="level4">
<h4 class="anchored" data-anchor-id="example-22">Example</h4>
<p>Suppose we have a tree:</p>
<pre><code>     1
   / | \
  2  3  4
 / \    \
5   6    7</code></pre>
<p>Each node has a color:</p>
<pre><code>Color = [1, 2, 2, 1, 3, 3, 2]</code></pre>
<p>Goal: For every node, count distinct colors in its subtree.</p>
<p>Naive way: recompute every subtree from scratch, O(n²). DSU-on-Tree way: reuse large child’s color set, merge small ones.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node</th>
<th>Subtree</th>
<th>Colors</th>
<th>Distinct Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5</td>
<td>[5]</td>
<td>{3}</td>
<td>1</td>
</tr>
<tr class="even">
<td>6</td>
<td>[6]</td>
<td>{3}</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[2,5,6]</td>
<td>{2,3}</td>
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
<td>[3]</td>
<td>{2}</td>
<td>1</td>
</tr>
<tr class="odd">
<td>7</td>
<td>[7]</td>
<td>{2}</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>[4,7]</td>
<td>{1,2}</td>
<td>2</td>
</tr>
<tr class="odd">
<td>1</td>
<td>[1,2,3,4,5,6,7]</td>
<td>{1,2,3}</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>Each subtree merges small color sets into the big one only once → efficient.</p>
</section>
<section id="step-by-step-idea" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-idea">Step-by-Step Idea</h4>
<ol type="1">
<li><p>DFS to compute subtree sizes</p></li>
<li><p>Identify heavy child (largest subtree)</p></li>
<li><p>DFS again:</p>
<ul>
<li>Process all <em>light children</em> (small subtrees), discarding results</li>
<li>Process <em>heavy child</em>, keep its results</li>
<li>Merge all light children’s data into heavy child’s data</li>
</ul></li>
<li><p>Record answers for each node after merging</p></li>
</ol>
</section>
<section id="tiny-code-easy-versions-51" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-51">Tiny Code (Easy Versions)</h4>
<p>C Implementation (Conceptual)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb171"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;set&gt;</span></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100005</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>using namespace std<span class="op">;</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> tree<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> color<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> subtree_size<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> answer<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> freq<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">;</span></span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> dfs_size<span class="op">(</span><span class="dt">int</span> u<span class="op">,</span> <span class="dt">int</span> p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a>    subtree_size<span class="op">[</span>u<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> v <span class="op">:</span> tree<span class="op">[</span>u<span class="op">])</span></span>
<span id="cb171-18"><a href="#cb171-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>v <span class="op">!=</span> p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb171-19"><a href="#cb171-19" aria-hidden="true" tabindex="-1"></a>            dfs_size<span class="op">(</span>v<span class="op">,</span> u<span class="op">);</span></span>
<span id="cb171-20"><a href="#cb171-20" aria-hidden="true" tabindex="-1"></a>            subtree_size<span class="op">[</span>u<span class="op">]</span> <span class="op">+=</span> subtree_size<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb171-21"><a href="#cb171-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb171-22"><a href="#cb171-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb171-23"><a href="#cb171-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-24"><a href="#cb171-24" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> add_color<span class="op">(</span><span class="dt">int</span> u<span class="op">,</span> <span class="dt">int</span> p<span class="op">,</span> <span class="dt">int</span> val<span class="op">)</span> <span class="op">{</span></span>
<span id="cb171-25"><a href="#cb171-25" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">[</span>color<span class="op">[</span>u<span class="op">]]</span> <span class="op">+=</span> val<span class="op">;</span></span>
<span id="cb171-26"><a href="#cb171-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> v <span class="op">:</span> tree<span class="op">[</span>u<span class="op">])</span></span>
<span id="cb171-27"><a href="#cb171-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>v <span class="op">!=</span> p<span class="op">)</span> add_color<span class="op">(</span>v<span class="op">,</span> u<span class="op">,</span> val<span class="op">);</span></span>
<span id="cb171-28"><a href="#cb171-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb171-29"><a href="#cb171-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-30"><a href="#cb171-30" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> dfs<span class="op">(</span><span class="dt">int</span> u<span class="op">,</span> <span class="dt">int</span> p<span class="op">,</span> <span class="dt">bool</span> keep<span class="op">)</span> <span class="op">{</span></span>
<span id="cb171-31"><a href="#cb171-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> bigChild <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> maxSize <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb171-32"><a href="#cb171-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> v <span class="op">:</span> tree<span class="op">[</span>u<span class="op">])</span></span>
<span id="cb171-33"><a href="#cb171-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>v <span class="op">!=</span> p <span class="op">&amp;&amp;</span> subtree_size<span class="op">[</span>v<span class="op">]</span> <span class="op">&gt;</span> maxSize<span class="op">)</span></span>
<span id="cb171-34"><a href="#cb171-34" aria-hidden="true" tabindex="-1"></a>            maxSize <span class="op">=</span> subtree_size<span class="op">[</span>v<span class="op">],</span> bigChild <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb171-35"><a href="#cb171-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-36"><a href="#cb171-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Process small children</span></span>
<span id="cb171-37"><a href="#cb171-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> v <span class="op">:</span> tree<span class="op">[</span>u<span class="op">])</span></span>
<span id="cb171-38"><a href="#cb171-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>v <span class="op">!=</span> p <span class="op">&amp;&amp;</span> v <span class="op">!=</span> bigChild<span class="op">)</span></span>
<span id="cb171-39"><a href="#cb171-39" aria-hidden="true" tabindex="-1"></a>            dfs<span class="op">(</span>v<span class="op">,</span> u<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb171-40"><a href="#cb171-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-41"><a href="#cb171-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Process big child</span></span>
<span id="cb171-42"><a href="#cb171-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bigChild <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> dfs<span class="op">(</span>bigChild<span class="op">,</span> u<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb171-43"><a href="#cb171-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-44"><a href="#cb171-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Merge small children's info</span></span>
<span id="cb171-45"><a href="#cb171-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> v <span class="op">:</span> tree<span class="op">[</span>u<span class="op">])</span></span>
<span id="cb171-46"><a href="#cb171-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>v <span class="op">!=</span> p <span class="op">&amp;&amp;</span> v <span class="op">!=</span> bigChild<span class="op">)</span></span>
<span id="cb171-47"><a href="#cb171-47" aria-hidden="true" tabindex="-1"></a>            add_color<span class="op">(</span>v<span class="op">,</span> u<span class="op">,</span> <span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb171-48"><a href="#cb171-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-49"><a href="#cb171-49" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">[</span>color<span class="op">[</span>u<span class="op">]]++;</span></span>
<span id="cb171-50"><a href="#cb171-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Example query: count distinct colors</span></span>
<span id="cb171-51"><a href="#cb171-51" aria-hidden="true" tabindex="-1"></a>    answer<span class="op">[</span>u<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb171-52"><a href="#cb171-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb171-53"><a href="#cb171-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>freq<span class="op">[</span>i<span class="op">]</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> answer<span class="op">[</span>u<span class="op">]++;</span></span>
<span id="cb171-54"><a href="#cb171-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-55"><a href="#cb171-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>keep<span class="op">)</span> add_color<span class="op">(</span>u<span class="op">,</span> p<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb171-56"><a href="#cb171-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb171-57"><a href="#cb171-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-58"><a href="#cb171-58" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb171-59"><a href="#cb171-59" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></span>
<span id="cb171-60"><a href="#cb171-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Build tree, set colors...</span></span>
<span id="cb171-61"><a href="#cb171-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// dfs_size(1,0); dfs(1,0,true);</span></span>
<span id="cb171-62"><a href="#cb171-62" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation (Simplified)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dfs_size(u, p, tree, size):</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>    size[u] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> tree[u]:</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">!=</span> p:</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>            dfs_size(v, u, tree, size)</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>            size[u] <span class="op">+=</span> size[v]</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_color(u, p, tree, color, freq, val):</span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>    freq[color[u]] <span class="op">+=</span> val</span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> tree[u]:</span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">!=</span> p:</span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>            add_color(v, u, tree, color, freq, val)</span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dfs(u, p, tree, size, color, freq, ans, keep):</span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a>    bigChild, maxSize <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span></span>
<span id="cb172-18"><a href="#cb172-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> tree[u]:</span>
<span id="cb172-19"><a href="#cb172-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">!=</span> p <span class="kw">and</span> size[v] <span class="op">&gt;</span> maxSize:</span>
<span id="cb172-20"><a href="#cb172-20" aria-hidden="true" tabindex="-1"></a>            maxSize, bigChild <span class="op">=</span> size[v], v</span>
<span id="cb172-21"><a href="#cb172-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-22"><a href="#cb172-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> tree[u]:</span>
<span id="cb172-23"><a href="#cb172-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">!=</span> p <span class="kw">and</span> v <span class="op">!=</span> bigChild:</span>
<span id="cb172-24"><a href="#cb172-24" aria-hidden="true" tabindex="-1"></a>            dfs(v, u, tree, size, color, freq, ans, <span class="va">False</span>)</span>
<span id="cb172-25"><a href="#cb172-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-26"><a href="#cb172-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bigChild <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb172-27"><a href="#cb172-27" aria-hidden="true" tabindex="-1"></a>        dfs(bigChild, u, tree, size, color, freq, ans, <span class="va">True</span>)</span>
<span id="cb172-28"><a href="#cb172-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-29"><a href="#cb172-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> tree[u]:</span>
<span id="cb172-30"><a href="#cb172-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">!=</span> p <span class="kw">and</span> v <span class="op">!=</span> bigChild:</span>
<span id="cb172-31"><a href="#cb172-31" aria-hidden="true" tabindex="-1"></a>            add_color(v, u, tree, color, freq, <span class="dv">1</span>)</span>
<span id="cb172-32"><a href="#cb172-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-33"><a href="#cb172-33" aria-hidden="true" tabindex="-1"></a>    freq[color[u]] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb172-34"><a href="#cb172-34" aria-hidden="true" tabindex="-1"></a>    ans[u] <span class="op">=</span> <span class="bu">len</span>([c <span class="cf">for</span> c <span class="kw">in</span> freq <span class="cf">if</span> freq[c] <span class="op">&gt;</span> <span class="dv">0</span>])</span>
<span id="cb172-35"><a href="#cb172-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-36"><a href="#cb172-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> keep:</span>
<span id="cb172-37"><a href="#cb172-37" aria-hidden="true" tabindex="-1"></a>        add_color(u, p, tree, color, freq, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb172-38"><a href="#cb172-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-39"><a href="#cb172-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb172-40"><a href="#cb172-40" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb172-41"><a href="#cb172-41" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> {<span class="dv">1</span>:[<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>], <span class="dv">2</span>:[<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>], <span class="dv">3</span>:[<span class="dv">1</span>], <span class="dv">4</span>:[<span class="dv">1</span>,<span class="dv">7</span>], <span class="dv">5</span>:[<span class="dv">2</span>], <span class="dv">6</span>:[<span class="dv">2</span>], <span class="dv">7</span>:[<span class="dv">4</span>]}</span>
<span id="cb172-42"><a href="#cb172-42" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> {<span class="dv">1</span>:<span class="dv">1</span>,<span class="dv">2</span>:<span class="dv">2</span>,<span class="dv">3</span>:<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">1</span>,<span class="dv">5</span>:<span class="dv">3</span>,<span class="dv">6</span>:<span class="dv">3</span>,<span class="dv">7</span>:<span class="dv">2</span>}</span>
<span id="cb172-43"><a href="#cb172-43" aria-hidden="true" tabindex="-1"></a>size <span class="op">=</span> {}</span>
<span id="cb172-44"><a href="#cb172-44" aria-hidden="true" tabindex="-1"></a>ans <span class="op">=</span> {}</span>
<span id="cb172-45"><a href="#cb172-45" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb172-46"><a href="#cb172-46" aria-hidden="true" tabindex="-1"></a>dfs_size(<span class="dv">1</span>,<span class="dv">0</span>,tree,size)</span>
<span id="cb172-47"><a href="#cb172-47" aria-hidden="true" tabindex="-1"></a>dfs(<span class="dv">1</span>,<span class="dv">0</span>,tree,size,color,freq,ans,<span class="va">True</span>)</span>
<span id="cb172-48"><a href="#cb172-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ans)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-56" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-56">Why It Matters</h4>
<ul>
<li>Handles subtree queries in O(n log n)</li>
<li>Works well with static trees and offline queries</li>
<li>Reuses computed results for heavy subtrees</li>
<li>Foundation for Mo’s algorithm on trees and color frequency problems</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-56" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-56">A Gentle Proof (Why It Works)</h4>
<p>Each node’s color (or element) is merged only O(log n) times:</p>
<ul>
<li>Each time, it moves from a smaller set to a larger one.</li>
<li>Hence total merges = O(n log n).</li>
</ul>
<p>The <code>keep</code> flag ensures we only retain big subtrees, discarding light ones to save memory and time.</p>
</section>
<section id="try-it-yourself-56" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-56">Try It Yourself</h4>
<ol type="1">
<li>Assign random colors to a tree of 8 nodes.</li>
<li>Use DSU on Tree to count distinct colors per subtree.</li>
<li>Compare with brute-force DFS result.</li>
<li>Verify both match, but DSU-on-Tree runs faster.</li>
</ol>
</section>
<section id="test-cases-56" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-56">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node</th>
<th>Subtree Colors</th>
<th>Distinct Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5</td>
<td>{3}</td>
<td>1</td>
</tr>
<tr class="even">
<td>6</td>
<td>{3}</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2</td>
<td>{2,3}</td>
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
<td>{2}</td>
<td>1</td>
</tr>
<tr class="odd">
<td>7</td>
<td>{2}</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>{1,2}</td>
<td>2</td>
</tr>
<tr class="odd">
<td>1</td>
<td>{1,2,3}</td>
<td>3</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-56" class="level4">
<h4 class="anchored" data-anchor-id="complexity-56">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DFS Traversal</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr class="even">
<td>DSU Merge</td>
<td>O(n log n)</td>
<td>O(n)</td>
</tr>
<tr class="odd">
<td>Overall</td>
<td>O(n log n)</td>
<td>O(n)</td>
</tr>
</tbody>
</table>
<p>DSU on Tree is your subtree superpower, merge smart, discard light, and conquer queries with elegance.</p>
</section>
</section>
<section id="kruskals-mst-using-dsu" class="level3">
<h3 class="anchored" data-anchor-id="kruskals-mst-using-dsu">258 Kruskal’s MST (Using DSU)</h3>
<p>Kruskal’s Algorithm is a classic greedy method to build a Minimum Spanning Tree (MST), a subset of edges connecting all vertices with the smallest total weight and no cycles. It relies on Disjoint Set Union (DSU) to efficiently check whether adding an edge would form a cycle.</p>
<p>With Union-Find, Kruskal’s MST becomes clean, fast, and conceptually elegant, building the tree edge by edge in sorted order.</p>
<section id="what-problem-are-we-solving-57" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-57">What Problem Are We Solving?</h4>
<p>Given a connected weighted graph with <span class="math inline">\(n\)</span> vertices and <span class="math inline">\(m\)</span> edges, we want to find a tree that:</p>
<ul>
<li>Connects all vertices (spanning)<br>
</li>
<li>Has no cycles (tree)<br>
</li>
<li>Minimizes the total edge weight</li>
</ul>
<p>A naive approach would test every subset of edges, <span class="math inline">\(O(2^m)\)</span>.<br>
Kruskal’s algorithm uses edge sorting and a Disjoint Set Union (DSU) structure to reduce this to <span class="math inline">\(O(m \log m)\)</span>.</p>
</section>
<section id="how-it-works-plain-language-22" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-22">How It Works (Plain Language)</h4>
<p>The algorithm follows three steps:</p>
<ol type="1">
<li>Sort all edges by weight in ascending order.<br>
</li>
<li>Initialize each vertex as its own set (<code>Make-Set</code>).<br>
</li>
<li>For each edge <span class="math inline">\((u, v, w)\)</span> in order:
<ul>
<li>If <span class="math inline">\(\text{Find}(u) \ne \text{Find}(v)\)</span>, the vertices are in different components → add the edge to the MST and merge the sets using <code>Union</code>.<br>
</li>
<li>Otherwise, skip the edge since it would form a cycle.</li>
</ul></li>
</ol>
<p>Repeat until the MST contains <span class="math inline">\(n - 1\)</span> edges.</p>
</section>
<section id="example-23" class="level4">
<h4 class="anchored" data-anchor-id="example-23">Example</h4>
<p>Graph:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Edge</th>
<th>Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A–B</td>
<td>1</td>
</tr>
<tr class="even">
<td>B–C</td>
<td>4</td>
</tr>
<tr class="odd">
<td>A–C</td>
<td>3</td>
</tr>
<tr class="even">
<td>C–D</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Sort edges: (A–B, 1), (C–D, 2), (A–C, 3), (B–C, 4)</p>
<p>Step-by-step:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 9%">
<col style="width: 16%">
<col style="width: 29%">
<col style="width: 13%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Edge</th>
<th>Action</th>
<th>MST Edges</th>
<th>MST Weight</th>
<th>Parent Map</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>(A,B,1)</td>
<td>Add</td>
<td>[(A,B)]</td>
<td>1</td>
<td>A→A, B→A</td>
</tr>
<tr class="even">
<td>2</td>
<td>(C,D,2)</td>
<td>Add</td>
<td>[(A,B), (C,D)]</td>
<td>3</td>
<td>C→C, D→C</td>
</tr>
<tr class="odd">
<td>3</td>
<td>(A,C,3)</td>
<td>Add</td>
<td>[(A,B), (C,D), (A,C)]</td>
<td>6</td>
<td>A→A, B→A, C→A, D→C</td>
</tr>
<tr class="even">
<td>4</td>
<td>(B,C,4)</td>
<td>Skip (cycle)</td>
<td>–</td>
<td>–</td>
<td>–</td>
</tr>
</tbody>
</table>
<p>✅ MST Weight = 6 ✅ Edges = 3 = n − 1</p>
</section>
<section id="visualization-6" class="level4">
<h4 class="anchored" data-anchor-id="visualization-6">Visualization</h4>
<p>Before:</p>
<pre><code>A --1-- B
|      /
3    4
|  /
C --2-- D</code></pre>
<p>After:</p>
<pre><code>A
| \
1  3
B   C
    |
    2
    D</code></pre>
</section>
<section id="tiny-code-easy-versions-52" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-52">Tiny Code (Easy Versions)</h4>
<p>C Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb175"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100</span></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXM </span><span class="dv">1000</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> u<span class="op">,</span> v<span class="op">,</span> w<span class="op">;</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Edge<span class="op">;</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> parent<span class="op">[</span>MAXN<span class="op">],</span> rank_<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>Edge edges<span class="op">[</span>MAXM<span class="op">];</span></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cmp<span class="op">(</span><span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">((</span>Edge<span class="op">*)</span>a<span class="op">)-&gt;</span>w <span class="op">-</span> <span class="op">((</span>Edge<span class="op">*)</span>b<span class="op">)-&gt;</span>w<span class="op">;</span></span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> make_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a>    rank_<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb175-22"><a href="#cb175-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-23"><a href="#cb175-23" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> find_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-24"><a href="#cb175-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>v <span class="op">!=</span> parent<span class="op">[</span>v<span class="op">])</span> parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> find_set<span class="op">(</span>parent<span class="op">[</span>v<span class="op">]);</span></span>
<span id="cb175-25"><a href="#cb175-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb175-26"><a href="#cb175-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb175-27"><a href="#cb175-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-28"><a href="#cb175-28" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> union_sets<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-29"><a href="#cb175-29" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> find_set<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb175-30"><a href="#cb175-30" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> find_set<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb175-31"><a href="#cb175-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">!=</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-32"><a href="#cb175-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>rank_<span class="op">[</span>a<span class="op">]</span> <span class="op">&lt;</span> rank_<span class="op">[</span>b<span class="op">])</span> parent<span class="op">[</span>a<span class="op">]</span> <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb175-33"><a href="#cb175-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>rank_<span class="op">[</span>a<span class="op">]</span> <span class="op">&gt;</span> rank_<span class="op">[</span>b<span class="op">])</span> parent<span class="op">[</span>b<span class="op">]</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb175-34"><a href="#cb175-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span> parent<span class="op">[</span>b<span class="op">]</span> <span class="op">=</span> a<span class="op">;</span> rank_<span class="op">[</span>a<span class="op">]++;</span> <span class="op">}</span></span>
<span id="cb175-35"><a href="#cb175-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb175-36"><a href="#cb175-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb175-37"><a href="#cb175-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-38"><a href="#cb175-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb175-39"><a href="#cb175-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">4</span><span class="op">,</span> m <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb175-40"><a href="#cb175-40" aria-hidden="true" tabindex="-1"></a>    edges<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span>Edge<span class="op">){</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">};</span></span>
<span id="cb175-41"><a href="#cb175-41" aria-hidden="true" tabindex="-1"></a>    edges<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span>Edge<span class="op">){</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">4</span><span class="op">};</span></span>
<span id="cb175-42"><a href="#cb175-42" aria-hidden="true" tabindex="-1"></a>    edges<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span>Edge<span class="op">){</span><span class="dv">0</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">};</span></span>
<span id="cb175-43"><a href="#cb175-43" aria-hidden="true" tabindex="-1"></a>    edges<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span>Edge<span class="op">){</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">2</span><span class="op">};</span></span>
<span id="cb175-44"><a href="#cb175-44" aria-hidden="true" tabindex="-1"></a>    qsort<span class="op">(</span>edges<span class="op">,</span> m<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Edge<span class="op">),</span> cmp<span class="op">);</span></span>
<span id="cb175-45"><a href="#cb175-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-46"><a href="#cb175-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> make_set<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb175-47"><a href="#cb175-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-48"><a href="#cb175-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb175-49"><a href="#cb175-49" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Edges in MST:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb175-50"><a href="#cb175-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb175-51"><a href="#cb175-51" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> u <span class="op">=</span> edges<span class="op">[</span>i<span class="op">].</span>u<span class="op">,</span> v <span class="op">=</span> edges<span class="op">[</span>i<span class="op">].</span>v<span class="op">,</span> w <span class="op">=</span> edges<span class="op">[</span>i<span class="op">].</span>w<span class="op">;</span></span>
<span id="cb175-52"><a href="#cb175-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>find_set<span class="op">(</span>u<span class="op">)</span> <span class="op">!=</span> find_set<span class="op">(</span>v<span class="op">))</span> <span class="op">{</span></span>
<span id="cb175-53"><a href="#cb175-53" aria-hidden="true" tabindex="-1"></a>            union_sets<span class="op">(</span>u<span class="op">,</span> v<span class="op">);</span></span>
<span id="cb175-54"><a href="#cb175-54" aria-hidden="true" tabindex="-1"></a>            total <span class="op">+=</span> w<span class="op">;</span></span>
<span id="cb175-55"><a href="#cb175-55" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> - </span><span class="sc">%d</span><span class="st"> (w=</span><span class="sc">%d</span><span class="st">)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> u<span class="op">,</span> v<span class="op">,</span> w<span class="op">);</span></span>
<span id="cb175-56"><a href="#cb175-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb175-57"><a href="#cb175-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb175-58"><a href="#cb175-58" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Total Weight = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> total<span class="op">);</span></span>
<span id="cb175-59"><a href="#cb175-59" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_set(parent, rank, v):</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>    parent[v] <span class="op">=</span> v</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    rank[v] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_set(parent, v):</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> parent[v] <span class="op">!=</span> v:</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>        parent[v] <span class="op">=</span> find_set(parent, parent[v])</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent[v]</span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> union_sets(parent, rank, a, b):</span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>    a, b <span class="op">=</span> find_set(parent, a), find_set(parent, b)</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">!=</span> b:</span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rank[a] <span class="op">&lt;</span> rank[b]:</span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a>            a, b <span class="op">=</span> b, a</span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a>        parent[b] <span class="op">=</span> a</span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rank[a] <span class="op">==</span> rank[b]:</span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a>            rank[a] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> kruskal(n, edges):</span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a>    parent, rank <span class="op">=</span> {}, {}</span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a>        make_set(parent, rank, i)</span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a>    mst, total <span class="op">=</span> [], <span class="dv">0</span></span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> u, v, w <span class="kw">in</span> <span class="bu">sorted</span>(edges, key<span class="op">=</span><span class="kw">lambda</span> e: e[<span class="dv">2</span>]):</span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> find_set(parent, u) <span class="op">!=</span> find_set(parent, v):</span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a>            union_sets(parent, rank, u, v)</span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a>            mst.append((u, v, w))</span>
<span id="cb176-28"><a href="#cb176-28" aria-hidden="true" tabindex="-1"></a>            total <span class="op">+=</span> w</span>
<span id="cb176-29"><a href="#cb176-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mst, total</span>
<span id="cb176-30"><a href="#cb176-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-31"><a href="#cb176-31" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> [(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>),(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>),(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">3</span>),(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>)]</span>
<span id="cb176-32"><a href="#cb176-32" aria-hidden="true" tabindex="-1"></a>mst, total <span class="op">=</span> kruskal(<span class="dv">4</span>, edges)</span>
<span id="cb176-33"><a href="#cb176-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MST:"</span>, mst)</span>
<span id="cb176-34"><a href="#cb176-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Total Weight:"</span>, total)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-57" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-57">Why It Matters</h4>
<ul>
<li><p>Greedy and elegant: simple sorting + DSU logic</p></li>
<li><p>Foundation for advanced topics:</p>
<ul>
<li>Minimum spanning forests</li>
<li>Dynamic connectivity</li>
<li>MST variations (Maximum, Second-best, etc.)</li>
</ul></li>
<li><p>Works great with edge list input</p></li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-57" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-57">A Gentle Proof (Why It Works)</h4>
<p>By the Cut Property: The smallest edge crossing any cut belongs to the MST. Since Kruskal’s always picks the smallest non-cycling edge, it constructs a valid MST.</p>
<p>Each union merges components without cycles → spanning tree in the end.</p>
</section>
<section id="try-it-yourself-57" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-57">Try It Yourself</h4>
<ol type="1">
<li>Build a graph with 5 nodes, random edges and weights</li>
<li>Sort edges, trace unions step-by-step</li>
<li>Draw MST</li>
<li>Compare with Prim’s algorithm result, they’ll match</li>
</ol>
</section>
<section id="test-cases-57" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-57">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Graph</th>
<th>MST Edges</th>
<th>Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Triangle (1–2:1, 2–3:2, 1–3:3)</td>
<td>(1–2, 2–3)</td>
<td>3</td>
</tr>
<tr class="even">
<td>Square (4 edges, weights 1,2,3,4)</td>
<td>3 smallest edges</td>
<td>6</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-57" class="level4">
<h4 class="anchored" data-anchor-id="complexity-57">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Sorting Edges</td>
<td>O(m log m)</td>
</tr>
<tr class="even">
<td>DSU Operations</td>
<td>O(m α(n))</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>O(m log m)</td>
</tr>
</tbody>
</table>
<div class="line-block">Space | O(n + m) |</div>
<p>Kruskal’s MST is the elegant handshake between greed and union, always connecting lightly, never circling back.</p>
</section>
</section>
<section id="connected-components-using-dsu" class="level3">
<h3 class="anchored" data-anchor-id="connected-components-using-dsu">259 Connected Components (Using DSU)</h3>
<p>Connected Components are groups of vertices where each node can reach any other through a sequence of edges. Using Disjoint Set Union (DSU), we can efficiently identify and label these components in graphs, even for massive datasets.</p>
<p>Instead of exploring each region via DFS or BFS, DSU builds the connectivity relationships incrementally, merging nodes as edges appear.</p>
<section id="what-problem-are-we-solving-58" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-58">What Problem Are We Solving?</h4>
<p>Given a graph (directed or undirected), we want to answer:</p>
<ul>
<li>How many connected components exist?</li>
<li>Which vertices belong to the same component?</li>
<li>Is there a path between <code>u</code> and <code>v</code>?</li>
</ul>
<p>A naive approach (DFS for each node) runs in O(n + m) but may require recursion or adjacency traversal. With DSU, we can process edge lists directly in nearly constant amortized time.</p>
</section>
<section id="how-it-works-plain-language-23" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-23">How It Works (Plain Language)</h4>
<p>Each vertex starts in its own component. For every edge <code>(u, v)</code>:</p>
<ul>
<li>If <code>Find(u) != Find(v)</code>, they are in different components → Union(u, v)</li>
<li>Otherwise, skip (already connected)</li>
</ul>
<p>After all edges are processed, all vertices sharing the same root belong to the same connected component.</p>
</section>
<section id="example-24" class="level4">
<h4 class="anchored" data-anchor-id="example-24">Example</h4>
<p>Graph:</p>
<pre><code>1, 2     3, 4
      \   /
        5</code></pre>
<p>Edges: (1–2), (2–5), (3–5), (3–4)</p>
<p>Step-by-step:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Edge</th>
<th>Action</th>
<th>Components</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>(1,2)</td>
<td>Union</td>
<td>{1,2}, {3}, {4}, {5}</td>
</tr>
<tr class="even">
<td>2</td>
<td>(2,5)</td>
<td>Union</td>
<td>{1,2,5}, {3}, {4}</td>
</tr>
<tr class="odd">
<td>3</td>
<td>(3,5)</td>
<td>Union</td>
<td>{1,2,3,5}, {4}</td>
</tr>
<tr class="even">
<td>4</td>
<td>(3,4)</td>
<td>Union</td>
<td>{1,2,3,4,5}</td>
</tr>
</tbody>
</table>
<p>✅ All connected → 1 component</p>
</section>
<section id="visualization-7" class="level4">
<h4 class="anchored" data-anchor-id="visualization-7">Visualization</h4>
<p>Before:</p>
<pre><code>1   2   3   4   5</code></pre>
<p>After unions:</p>
<pre><code>1—2—5—3—4</code></pre>
<p>One large connected component.</p>
</section>
<section id="tiny-code-easy-versions-53" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-53">Tiny Code (Easy Versions)</h4>
<p>C Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb180"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> parent<span class="op">[</span>MAXN<span class="op">],</span> rank_<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> make_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>    rank_<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> find_set<span class="op">(</span><span class="dt">int</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>v <span class="op">!=</span> parent<span class="op">[</span>v<span class="op">])</span></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>        parent<span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> find_set<span class="op">(</span>parent<span class="op">[</span>v<span class="op">]);</span></span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> union_sets<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb180-18"><a href="#cb180-18" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> find_set<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb180-19"><a href="#cb180-19" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> find_set<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb180-20"><a href="#cb180-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">!=</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb180-21"><a href="#cb180-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>rank_<span class="op">[</span>a<span class="op">]</span> <span class="op">&lt;</span> rank_<span class="op">[</span>b<span class="op">])</span> parent<span class="op">[</span>a<span class="op">]</span> <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb180-22"><a href="#cb180-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>rank_<span class="op">[</span>a<span class="op">]</span> <span class="op">&gt;</span> rank_<span class="op">[</span>b<span class="op">])</span> parent<span class="op">[</span>b<span class="op">]</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb180-23"><a href="#cb180-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span> parent<span class="op">[</span>b<span class="op">]</span> <span class="op">=</span> a<span class="op">;</span> rank_<span class="op">[</span>a<span class="op">]++;</span> <span class="op">}</span></span>
<span id="cb180-24"><a href="#cb180-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb180-25"><a href="#cb180-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb180-26"><a href="#cb180-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-27"><a href="#cb180-27" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb180-28"><a href="#cb180-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb180-29"><a href="#cb180-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> edges<span class="op">[][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">{{</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">},{</span><span class="dv">2</span><span class="op">,</span><span class="dv">5</span><span class="op">},{</span><span class="dv">3</span><span class="op">,</span><span class="dv">5</span><span class="op">},{</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">}};</span></span>
<span id="cb180-30"><a href="#cb180-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span> i<span class="op">&lt;=</span>n<span class="op">;</span> i<span class="op">++)</span> make_set<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb180-31"><a href="#cb180-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span><span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb180-32"><a href="#cb180-32" aria-hidden="true" tabindex="-1"></a>        union_sets<span class="op">(</span>edges<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">],</span> edges<span class="op">[</span>i<span class="op">][</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb180-33"><a href="#cb180-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb180-34"><a href="#cb180-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb180-35"><a href="#cb180-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span> i<span class="op">&lt;=</span>n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb180-36"><a href="#cb180-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>find_set<span class="op">(</span>i<span class="op">)</span> <span class="op">==</span> i<span class="op">)</span> count<span class="op">++;</span></span>
<span id="cb180-37"><a href="#cb180-37" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Number of components: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> count<span class="op">);</span></span>
<span id="cb180-38"><a href="#cb180-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_set(parent, rank, v):</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>    parent[v] <span class="op">=</span> v</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>    rank[v] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_set(parent, v):</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> parent[v] <span class="op">!=</span> v:</span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>        parent[v] <span class="op">=</span> find_set(parent, parent[v])</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent[v]</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> union_sets(parent, rank, a, b):</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>    a, b <span class="op">=</span> find_set(parent, a), find_set(parent, b)</span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">!=</span> b:</span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rank[a] <span class="op">&lt;</span> rank[b]:</span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>            a, b <span class="op">=</span> b, a</span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>        parent[b] <span class="op">=</span> a</span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rank[a] <span class="op">==</span> rank[b]:</span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>            rank[a] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connected_components(n, edges):</span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a>    parent, rank <span class="op">=</span> {}, {}</span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a>        make_set(parent, rank, i)</span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> u, v <span class="kw">in</span> edges:</span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a>        union_sets(parent, rank, u, v)</span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a>    roots <span class="op">=</span> {find_set(parent, i) <span class="cf">for</span> i <span class="kw">in</span> parent}</span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a>    components <span class="op">=</span> {}</span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> find_set(parent, i)</span>
<span id="cb181-29"><a href="#cb181-29" aria-hidden="true" tabindex="-1"></a>        components.setdefault(root, []).append(i)</span>
<span id="cb181-30"><a href="#cb181-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> components</span>
<span id="cb181-31"><a href="#cb181-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-32"><a href="#cb181-32" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> [(<span class="dv">1</span>,<span class="dv">2</span>),(<span class="dv">2</span>,<span class="dv">5</span>),(<span class="dv">3</span>,<span class="dv">5</span>),(<span class="dv">3</span>,<span class="dv">4</span>)]</span>
<span id="cb181-33"><a href="#cb181-33" aria-hidden="true" tabindex="-1"></a>components <span class="op">=</span> connected_components(<span class="dv">5</span>, edges)</span>
<span id="cb181-34"><a href="#cb181-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Components:"</span>, components)</span>
<span id="cb181-35"><a href="#cb181-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Count:"</span>, <span class="bu">len</span>(components))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Components: {1: [1, 2, 3, 4, 5]}
Count: 1</code></pre>
</section>
<section id="why-it-matters-58" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-58">Why It Matters</h4>
<ul>
<li>Quickly answers connectivity questions</li>
<li>Works directly on edge list (no adjacency matrix needed)</li>
<li>Forms the backbone of algorithms like Kruskal’s MST</li>
<li>Extensible to dynamic connectivity and offline queries</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-58" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-58">A Gentle Proof (Why It Works)</h4>
<p>Union-Find forms a forest of trees, one per component. Each union merges two trees if and only if there’s an edge connecting them. No cycles are introduced; final roots mark distinct connected components.</p>
<p>Each vertex ends up linked to exactly one representative.</p>
</section>
<section id="try-it-yourself-58" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-58">Try It Yourself</h4>
<ol type="1">
<li>Build a graph with 6 nodes and 2 disconnected clusters.</li>
<li>Run DSU unions across edges.</li>
<li>Count unique roots.</li>
<li>Print grouping <code>{root: [members]}</code></li>
</ol>
</section>
<section id="test-cases-58" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-58">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Graph</th>
<th>Edges</th>
<th>Components</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1–2–3, 4–5</td>
<td>(1,2),(2,3),(4,5)</td>
<td>{1,2,3}, {4,5}, {6}</td>
</tr>
<tr class="even">
<td>Complete Graph (1–n)</td>
<td>all pairs</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Empty Graph</td>
<td>none</td>
<td>n</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-58" class="level4">
<h4 class="anchored" data-anchor-id="complexity-58">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time (Amortized)</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Make-Set</td>
<td>O(1)</td>
<td>O(n)</td>
</tr>
<tr class="even">
<td>Union</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Find</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Total (m edges)</td>
<td>O(m α(n))</td>
<td>O(n)</td>
</tr>
</tbody>
</table>
<p>Connected Components (DSU), a clean and scalable way to reveal the hidden clusters of any graph.</p>
</section>
</section>
<section id="offline-query-dsu" class="level3">
<h3 class="anchored" data-anchor-id="offline-query-dsu">260 Offline Query DSU</h3>
<p>Offline Query DSU is a clever twist on the standard Disjoint Set Union, used when you need to answer connectivity queries in a graph that changes over time, especially when edges are added or removed.</p>
<p>Instead of handling updates online (in real time), we collect all queries first, then process them in reverse, using DSU to efficiently track connections as we “undo” deletions or simulate the timeline backward.</p>
<section id="what-problem-are-we-solving-59" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-59">What Problem Are We Solving?</h4>
<p>We often face questions like:</p>
<ul>
<li>“After removing these edges, are nodes <code>u</code> and <code>v</code> still connected?”</li>
<li>“If we add edges over time, when do <code>u</code> and <code>v</code> become connected?”</li>
</ul>
<p>Online handling is hard because DSU doesn’t support deletions directly. The trick: reverse time, treat deletions as additions in reverse, and answer queries offline.</p>
</section>
<section id="how-it-works-plain-language-24" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-24">How It Works (Plain Language)</h4>
<ol type="1">
<li><p>Record all events in the order they occur:</p>
<ul>
<li>Edge additions or deletions</li>
<li>Connectivity queries</li>
</ul></li>
<li><p>Reverse the timeline:</p>
<ul>
<li>Process from the last event backward</li>
<li>Every “delete edge” becomes an “add edge”</li>
<li>Queries are answered in reverse order</li>
</ul></li>
<li><p>Use DSU:</p>
<ul>
<li>Each union merges components as edges appear (in reverse)</li>
<li>When processing a query, check if <code>Find(u) == Find(v)</code></li>
</ul></li>
<li><p>Finally, reverse the answers to match the original order.</p></li>
</ol>
</section>
<section id="example-25" class="level4">
<h4 class="anchored" data-anchor-id="example-25">Example</h4>
<p>Imagine a graph:</p>
<pre><code>1, 2, 3</code></pre>
<p>Events (in time order):</p>
<ol type="1">
<li>Query(1,3)?</li>
<li>Remove edge (2,3)</li>
<li>Query(1,3)?</li>
</ol>
<p>We can’t handle removals easily online, so we reverse:</p>
<pre><code>Reverse order:
1. Query(1,3)?
2. Add (2,3)
3. Query(1,3)?</code></pre>
<p>Step-by-step (in reverse):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Action</th>
<th>Answer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Query(1,3)</td>
<td>1 and 3 not connected</td>
<td>No</td>
</tr>
<tr class="even">
<td>2</td>
<td>Add(2,3)</td>
<td>Union(2,3)</td>
<td>–</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Query(1,3)</td>
<td>1–2–3 connected</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>Reverse answers: [Yes, No]</p>
<p>✅ Final output:</p>
<ul>
<li>Query 1: Yes</li>
<li>Query 2: No</li>
</ul>
</section>
<section id="visualization-8" class="level4">
<h4 class="anchored" data-anchor-id="visualization-8">Visualization</h4>
<p>Forward time:</p>
<pre><code>1—2—3</code></pre>
<p>→ remove (2,3) →</p>
<pre><code>1—2   3</code></pre>
<p>Backward time: Start with <code>1—2   3</code> → Add (2,3) → <code>1—2—3</code></p>
<p>We rebuild connectivity over time by unioning edges in reverse.</p>
</section>
<section id="tiny-code-easy-versions-54" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-54">Tiny Code (Easy Versions)</h4>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_set(parent, rank, v):</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>    parent[v] <span class="op">=</span> v</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>    rank[v] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_set(parent, v):</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> parent[v] <span class="op">!=</span> v:</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>        parent[v] <span class="op">=</span> find_set(parent, parent[v])</span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parent[v]</span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> union_sets(parent, rank, a, b):</span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>    a, b <span class="op">=</span> find_set(parent, a), find_set(parent, b)</span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">!=</span> b:</span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rank[a] <span class="op">&lt;</span> rank[b]:</span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a>            a, b <span class="op">=</span> b, a</span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a>        parent[b] <span class="op">=</span> a</span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rank[a] <span class="op">==</span> rank[b]:</span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a>            rank[a] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb187-20"><a href="#cb187-20" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb187-21"><a href="#cb187-21" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> {(<span class="dv">1</span>,<span class="dv">2</span>), (<span class="dv">2</span>,<span class="dv">3</span>)}</span>
<span id="cb187-22"><a href="#cb187-22" aria-hidden="true" tabindex="-1"></a>queries <span class="op">=</span> [</span>
<span id="cb187-23"><a href="#cb187-23" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"?"</span>, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb187-24"><a href="#cb187-24" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"-"</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb187-25"><a href="#cb187-25" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"?"</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb187-26"><a href="#cb187-26" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb187-27"><a href="#cb187-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-28"><a href="#cb187-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Reverse events</span></span>
<span id="cb187-29"><a href="#cb187-29" aria-hidden="true" tabindex="-1"></a>events <span class="op">=</span> <span class="bu">list</span>(<span class="bu">reversed</span>(queries))</span>
<span id="cb187-30"><a href="#cb187-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-31"><a href="#cb187-31" aria-hidden="true" tabindex="-1"></a>parent, rank <span class="op">=</span> {}, {}</span>
<span id="cb187-32"><a href="#cb187-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb187-33"><a href="#cb187-33" aria-hidden="true" tabindex="-1"></a>    make_set(parent, rank, i)</span>
<span id="cb187-34"><a href="#cb187-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-35"><a href="#cb187-35" aria-hidden="true" tabindex="-1"></a>active_edges <span class="op">=</span> <span class="bu">set</span>(edges)</span>
<span id="cb187-36"><a href="#cb187-36" aria-hidden="true" tabindex="-1"></a>answers <span class="op">=</span> []</span>
<span id="cb187-37"><a href="#cb187-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-38"><a href="#cb187-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> e <span class="kw">in</span> events:</span>
<span id="cb187-39"><a href="#cb187-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> e[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"?"</span>:</span>
<span id="cb187-40"><a href="#cb187-40" aria-hidden="true" tabindex="-1"></a>        _, u, v <span class="op">=</span> e</span>
<span id="cb187-41"><a href="#cb187-41" aria-hidden="true" tabindex="-1"></a>        answers.append(<span class="st">"YES"</span> <span class="cf">if</span> find_set(parent, u) <span class="op">==</span> find_set(parent, v) <span class="cf">else</span> <span class="st">"NO"</span>)</span>
<span id="cb187-42"><a href="#cb187-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> e[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"-"</span>:</span>
<span id="cb187-43"><a href="#cb187-43" aria-hidden="true" tabindex="-1"></a>        _, u, v <span class="op">=</span> e</span>
<span id="cb187-44"><a href="#cb187-44" aria-hidden="true" tabindex="-1"></a>        union_sets(parent, rank, u, v)</span>
<span id="cb187-45"><a href="#cb187-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-46"><a href="#cb187-46" aria-hidden="true" tabindex="-1"></a>answers.reverse()</span>
<span id="cb187-47"><a href="#cb187-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ans <span class="kw">in</span> answers:</span>
<span id="cb187-48"><a href="#cb187-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(ans)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>YES
NO</code></pre>
</section>
<section id="why-it-matters-59" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-59">Why It Matters</h4>
<ul>
<li><p>Handles edge deletions without needing rollback</p></li>
<li><p>Perfect for offline dynamic connectivity</p></li>
<li><p>Used in problems like:</p>
<ul>
<li>“Are u and v connected after k deletions?”</li>
<li>“What is the earliest time u and v become connected?”</li>
</ul></li>
<li><p>Core idea behind Dynamic Trees and Divide &amp; Conquer over time</p></li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-59" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-59">A Gentle Proof (Why It Works)</h4>
<p>DSU is monotonic, it supports adding edges, not deleting them. By reversing time, all deletions become additions. Thus, we maintain valid connectivity information backward in time, and can correctly answer queries that depend only on graph connectivity.</p>
<p>Reversing answers afterward restores their original sequence.</p>
</section>
<section id="try-it-yourself-59" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-59">Try It Yourself</h4>
<ol type="1">
<li>Create a graph with 5 nodes and edges (1–2, 2–3, 3–4, 4–5)</li>
<li>Remove (3–4), (2–3) sequentially</li>
<li>Ask connectivity between (1,5) after each removal</li>
<li>Reverse timeline, simulate with DSU</li>
</ol>
</section>
<section id="test-cases-59" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-59">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Event Sequence</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[?, 1–3], [–, 2–3], [?, 1–3]</td>
<td>[YES, NO]</td>
</tr>
<tr class="even">
<td>[–, 1–2], [?, 1–3]</td>
<td>[NO]</td>
</tr>
<tr class="odd">
<td>[?, 4–5] (no edge)</td>
<td>[NO]</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-59" class="level4">
<h4 class="anchored" data-anchor-id="complexity-59">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time (Amortized)</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Make-Set</td>
<td>O(1)</td>
<td>O(n)</td>
</tr>
<tr class="even">
<td>Union</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="odd">
<td>Find</td>
<td>O(α(n))</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Total (Q queries, E edges)</td>
<td>O((Q+E) α(n))</td>
<td>O(n+E)</td>
</tr>
</tbody>
</table>
<p>Offline Query DSU is your time-reversing tool, flip the story, add edges back, and reveal connectivity across history.</p>
</section>
</section>
</section>
<section id="section-27.-probabilistic-data-structure" class="level2">
<h2 class="anchored" data-anchor-id="section-27.-probabilistic-data-structure">Section 27. Probabilistic Data Structure</h2>
<section id="bloom-filter-insert" class="level3">
<h3 class="anchored" data-anchor-id="bloom-filter-insert">261 Bloom Filter Insert</h3>
<p>A Bloom Filter is a compact, probabilistic data structure used for membership testing, it can tell you if an element is definitely not present or possibly present, but never gives false negatives.</p>
<p>Insertion in a Bloom Filter is simple and elegant: hash the item with multiple hash functions and set the corresponding bits to <code>1</code> in a bit array.</p>
<section id="what-problem-are-we-solving-60" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-60">What Problem Are We Solving?</h4>
<p>You have a massive dataset, maybe millions or billions of keys, and you just want to ask:</p>
<blockquote class="blockquote">
<p>“Have I seen this before?”</p>
</blockquote>
<p>A normal hash set would explode in memory. A Bloom Filter gives a lightweight alternative:</p>
<ul>
<li>No false negatives (safe for skipping)</li>
<li>Small memory footprint</li>
<li>Fixed-size bit array</li>
</ul>
<p>Used in systems like:</p>
<ul>
<li>Databases (caching, deduplication)</li>
<li>Web crawlers (visited URLs)</li>
<li>Distributed systems (HBase, Cassandra, Bigtable)</li>
</ul>
</section>
<section id="how-it-works-plain-language-25" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-25">How It Works (Plain Language)</h4>
<p>A Bloom Filter is just a bit array of length <code>m</code> (all zeroes initially), plus k independent hash functions.</p>
<p>To insert an element <code>x</code>:</p>
<ol type="1">
<li>Compute <code>k</code> hash values: <code>h1(x), h2(x), ..., hk(x)</code></li>
<li>Map each hash to an index in <code>[0, m-1]</code></li>
<li>Set all <code>bit[h_i(x)] = 1</code></li>
</ol>
<p>So every element lights up multiple bits. Later, to check membership, we look at those same bits, if any is 0, the item was never inserted.</p>
</section>
<section id="example-26" class="level4">
<h4 class="anchored" data-anchor-id="example-26">Example</h4>
<p>Let’s build a Bloom Filter with:</p>
<ul>
<li><code>m = 10</code> bits</li>
<li><code>k = 3</code> hash functions</li>
</ul>
<p>Insert “cat”:</p>
<pre><code>h1(cat) = 2
h2(cat) = 5
h3(cat) = 7</code></pre>
<p>Set bits 2, 5, and 7 to 1:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Index</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Value</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Insert “dog”:</p>
<pre><code>h1(dog) = 1
h2(dog) = 5
h3(dog) = 9</code></pre>
<p>Now bit array:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Index</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Value</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</section>
<section id="visualization-9" class="level4">
<h4 class="anchored" data-anchor-id="visualization-9">Visualization</h4>
<p>Each insertion adds “footprints” in multiple spots:</p>
<pre><code>Insert(x):
  for i in [1..k]:
     bit[ h_i(x) ] = 1</code></pre>
<p>The overlap of bits allows huge compression, but leads to false positives when unrelated keys share bits.</p>
</section>
<section id="tiny-code-easy-versions-55" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-55">Tiny Code (Easy Versions)</h4>
<p>C Implementation (Conceptual)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb192"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define M </span><span class="dv">10</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define K </span><span class="dv">3</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> bitset<span class="op">[</span>M<span class="op">];</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hash1<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> x <span class="op">%</span> M<span class="op">;</span> <span class="op">}</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hash2<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">(</span>x <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> M<span class="op">;</span> <span class="op">}</span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hash3<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">(</span>x <span class="op">*</span> <span class="dv">7</span> <span class="op">+</span> <span class="dv">5</span><span class="op">)</span> <span class="op">%</span> M<span class="op">;</span> <span class="op">}</span></span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> insert<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> h<span class="op">[</span>K<span class="op">]</span> <span class="op">=</span> <span class="op">{</span>hash1<span class="op">(</span>x<span class="op">),</span> hash2<span class="op">(</span>x<span class="op">),</span> hash3<span class="op">(</span>x<span class="op">)};</span></span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> K<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb192-16"><a href="#cb192-16" aria-hidden="true" tabindex="-1"></a>        bitset<span class="op">[</span>h<span class="op">[</span>i<span class="op">]]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb192-17"><a href="#cb192-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb192-18"><a href="#cb192-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-19"><a href="#cb192-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_bits<span class="op">()</span> <span class="op">{</span></span>
<span id="cb192-20"><a href="#cb192-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> M<span class="op">;</span> i<span class="op">++)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> bitset<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb192-21"><a href="#cb192-21" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb192-22"><a href="#cb192-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb192-23"><a href="#cb192-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-24"><a href="#cb192-24" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb192-25"><a href="#cb192-25" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>bitset<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>bitset<span class="op">));</span></span>
<span id="cb192-26"><a href="#cb192-26" aria-hidden="true" tabindex="-1"></a>    insert<span class="op">(</span><span class="dv">42</span><span class="op">);</span></span>
<span id="cb192-27"><a href="#cb192-27" aria-hidden="true" tabindex="-1"></a>    insert<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span>
<span id="cb192-28"><a href="#cb192-28" aria-hidden="true" tabindex="-1"></a>    print_bits<span class="op">();</span></span>
<span id="cb192-29"><a href="#cb192-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>m, k <span class="op">=</span> <span class="dv">10</span>, <span class="dv">3</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>bitset <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> m</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hash_functions(x):</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [(<span class="bu">hash</span>(x) <span class="op">+</span> i <span class="op">*</span> i) <span class="op">%</span> m <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(k)]</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(x):</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> hash_functions(x):</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>        bitset[h] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display():</span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Bit array:"</span>, bitset)</span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>insert(<span class="st">"cat"</span>)</span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>insert(<span class="st">"dog"</span>)</span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a>display()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-60" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-60">Why It Matters</h4>
<ul>
<li>Extremely space-efficient</li>
<li>No need to store actual data</li>
<li>Ideal for membership filters, duplicate detection, and pre-checks before expensive lookups</li>
<li>The backbone of approximate data structures</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-60" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-60">A Gentle Proof (Why It Works)</h4>
<p>Each bit starts at 0. Each insertion flips <code>k</code> bits to 1. Query returns “maybe” if all <code>k</code> bits = 1, otherwise “no”. Thus:</p>
<ul>
<li>False negative: impossible (never unset a bit)</li>
<li>False positive: possible, due to collisions</li>
</ul>
<p>Probability of false positive ≈ ((1 - e<sup>{-kn/m})</sup>k)</p>
<p>Choosing (m) and (k) well balances accuracy vs.&nbsp;memory.</p>
</section>
<section id="try-it-yourself-60" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-60">Try It Yourself</h4>
<ol type="1">
<li>Choose <code>m = 20</code>, <code>k = 3</code></li>
<li>Insert {“apple”, “banana”, “grape”}</li>
<li>Print bit array</li>
<li>Query for “mango” → likely “maybe” (false positive)</li>
</ol>
</section>
<section id="test-cases-60" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-60">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Inserted Elements</th>
<th>Query</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{cat, dog}</td>
<td>cat</td>
<td>maybe (true positive)</td>
</tr>
<tr class="even">
<td>{cat, dog}</td>
<td>dog</td>
<td>maybe (true positive)</td>
</tr>
<tr class="odd">
<td>{cat, dog}</td>
<td>fox</td>
<td>maybe / no (false positive possible)</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-60" class="level4">
<h4 class="anchored" data-anchor-id="complexity-60">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(k)</td>
<td>O(m)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(k)</td>
<td>O(m)</td>
</tr>
<tr class="odd">
<td>False Positives</td>
<td>≈ (1 - e<sup>{-kn/m})</sup>k</td>
<td>–</td>
</tr>
</tbody>
</table>
<p>Bloom Filter Insert, write once, maybe forever. Compact, fast, and probabilistically powerful.</p>
</section>
</section>
<section id="bloom-filter-query" class="level3">
<h3 class="anchored" data-anchor-id="bloom-filter-query">262 Bloom Filter Query</h3>
<p>A Bloom Filter Query checks whether an element <em>might</em> be present in the set. It uses the same k hash functions and bit array as insertion, but instead of setting bits, it simply tests them.</p>
<p>The magic:</p>
<ul>
<li>If any bit is <code>0</code>, the element was never inserted (definitely not present).</li>
<li>If all bits are <code>1</code>, the element is possibly present (maybe yes).</li>
</ul>
<p>No false negatives, if the Bloom Filter says “no,” it’s always correct.</p>
<section id="what-problem-are-we-solving-61" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-61">What Problem Are We Solving?</h4>
<p>When handling huge datasets (web crawlers, caches, key-value stores), we need a fast and memory-efficient way to answer:</p>
<blockquote class="blockquote">
<p>“Have I seen this before?”</p>
</blockquote>
<p>But full storage is expensive. Bloom Filters let us skip expensive lookups by confidently ruling out items early.</p>
<p>Typical use cases:</p>
<ul>
<li>Databases: Avoid disk lookups for missing keys</li>
<li>Web crawlers: Skip revisiting known URLs</li>
<li>Networking: Cache membership checks</li>
</ul>
</section>
<section id="how-it-works-plain-language-26" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-26">How It Works (Plain Language)</h4>
<p>A Bloom Filter has:</p>
<ul>
<li>Bit array <code>bits[0..m-1]</code></li>
<li><code>k</code> hash functions</li>
</ul>
<p>To query element <code>x</code>:</p>
<ol type="1">
<li><p>Compute all hashes: <code>h1(x), h2(x), ..., hk(x)</code></p></li>
<li><p>Check bits at those positions</p>
<ul>
<li>If any <code>bit[h_i(x)] == 0</code>, return “No” (definitely not present)</li>
<li>If all are <code>1</code>, return “Maybe” (possible false positive)</li>
</ul></li>
</ol>
<p>The key rule: bits can only turn on, never off, so “no” answers are reliable.</p>
</section>
<section id="example-27" class="level4">
<h4 class="anchored" data-anchor-id="example-27">Example</h4>
<p>Let’s use a filter of size <code>m = 10</code>, <code>k = 3</code>:</p>
<p>Bit array after inserting “cat” and “dog”:</p>
<pre><code>Index:  0 1 2 3 4 5 6 7 8 9
Bits:   0 1 1 0 0 1 0 1 0 1</code></pre>
<p>Now query “cat”:</p>
<pre><code>h1(cat)=2, h2(cat)=5, h3(cat)=7
bits[2]=1, bits[5]=1, bits[7]=1 → maybe present ✅</code></pre>
<p>Query “fox”:</p>
<pre><code>h1(fox)=3, h2(fox)=5, h3(fox)=8
bits[3]=0 → definitely not present ❌</code></pre>
</section>
<section id="visualization-10" class="level4">
<h4 class="anchored" data-anchor-id="visualization-10">Visualization</h4>
<p>Query(x):</p>
<pre><code>for i in 1..k:
  if bit[ h_i(x) ] == 0:
     return "NO"
return "MAYBE"</code></pre>
<p>Bloom Filters say “maybe” for safety, but never lie with “no”.</p>
</section>
<section id="tiny-code-easy-versions-56" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-56">Tiny Code (Easy Versions)</h4>
<p>C Implementation (Conceptual)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb198"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define M </span><span class="dv">10</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define K </span><span class="dv">3</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> bitset<span class="op">[</span>M<span class="op">];</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hash1<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> x <span class="op">%</span> M<span class="op">;</span> <span class="op">}</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hash2<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">(</span>x <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> M<span class="op">;</span> <span class="op">}</span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> hash3<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">(</span>x <span class="op">*</span> <span class="dv">7</span> <span class="op">+</span> <span class="dv">5</span><span class="op">)</span> <span class="op">%</span> M<span class="op">;</span> <span class="op">}</span></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> query<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> h<span class="op">[</span>K<span class="op">]</span> <span class="op">=</span> <span class="op">{</span>hash1<span class="op">(</span>x<span class="op">),</span> hash2<span class="op">(</span>x<span class="op">),</span> hash3<span class="op">(</span>x<span class="op">)};</span></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> K<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>bitset<span class="op">[</span>h<span class="op">[</span>i<span class="op">]]</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// definitely not</span></span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// possibly yes</span></span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb198-20"><a href="#cb198-20" aria-hidden="true" tabindex="-1"></a>    bitset<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> bitset<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> bitset<span class="op">[</span><span class="dv">7</span><span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// insert "cat"</span></span>
<span id="cb198-21"><a href="#cb198-21" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Query 42: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> query<span class="op">(</span><span class="dv">42</span><span class="op">)</span> <span class="op">?</span> <span class="st">"maybe"</span> <span class="op">:</span> <span class="st">"no"</span><span class="op">);</span></span>
<span id="cb198-22"><a href="#cb198-22" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Query 23: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> query<span class="op">(</span><span class="dv">23</span><span class="op">)</span> <span class="op">?</span> <span class="st">"maybe"</span> <span class="op">:</span> <span class="st">"no"</span><span class="op">);</span></span>
<span id="cb198-23"><a href="#cb198-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>m, k <span class="op">=</span> <span class="dv">10</span>, <span class="dv">3</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>bitset <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> m</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hash_functions(x):</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [(<span class="bu">hash</span>(x) <span class="op">+</span> i <span class="op">*</span> i) <span class="op">%</span> m <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(k)]</span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(x):</span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> hash_functions(x):</span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>        bitset[h] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> query(x):</span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> hash_functions(x):</span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> bitset[h] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"NO"</span></span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"MAYBE"</span></span>
<span id="cb199-16"><a href="#cb199-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-17"><a href="#cb199-17" aria-hidden="true" tabindex="-1"></a>insert(<span class="st">"cat"</span>)</span>
<span id="cb199-18"><a href="#cb199-18" aria-hidden="true" tabindex="-1"></a>insert(<span class="st">"dog"</span>)</span>
<span id="cb199-19"><a href="#cb199-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Query cat:"</span>, query(<span class="st">"cat"</span>))</span>
<span id="cb199-20"><a href="#cb199-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Query dog:"</span>, query(<span class="st">"dog"</span>))</span>
<span id="cb199-21"><a href="#cb199-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Query fox:"</span>, query(<span class="st">"fox"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-61" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-61">Why It Matters</h4>
<ul>
<li>Constant-time membership test</li>
<li>No false negatives, only rare false positives</li>
<li>Great for pre-filtering before heavy lookups</li>
<li>Common in distributed systems and caching layers</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-61" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-61">A Gentle Proof (Why It Works)</h4>
<p>Each inserted element sets <span class="math inline">\(k\)</span> bits to 1 in the bit array.<br>
For a query, if all <span class="math inline">\(k\)</span> bits are 1, the element <em>might</em> be present (or collisions caused those bits).<br>
If any bit is 0, the element was definitely never inserted.</p>
<p>The false positive probability is:</p>
<p><span class="math display">\[
p = \left(1 - e^{-kn/m}\right)^k
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(m\)</span>: size of the bit array<br>
</li>
<li><span class="math inline">\(n\)</span>: number of inserted elements<br>
</li>
<li><span class="math inline">\(k\)</span>: number of hash functions</li>
</ul>
<p>Choose <span class="math inline">\(m\)</span> and <span class="math inline">\(k\)</span> to minimize <span class="math inline">\(p\)</span> for the target false positive rate.</p>
</section>
<section id="try-it-yourself-61" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-61">Try It Yourself</h4>
<ol type="1">
<li>Create a filter with <code>m=20</code>, <code>k=3</code></li>
<li>Insert {“apple”, “banana”}</li>
<li>Query {“apple”, “grape”}</li>
<li>See how “grape” may return “maybe”</li>
</ol>
</section>
<section id="test-cases-61" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-61">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Inserted Elements</th>
<th>Query</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{cat, dog}</td>
<td>cat</td>
<td>maybe</td>
</tr>
<tr class="even">
<td>{cat, dog}</td>
<td>dog</td>
<td>maybe</td>
</tr>
<tr class="odd">
<td>{cat, dog}</td>
<td>fox</td>
<td>no</td>
</tr>
<tr class="even">
<td>{}</td>
<td>anything</td>
<td>no</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-61" class="level4">
<h4 class="anchored" data-anchor-id="complexity-61">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>False Negatives</th>
<th>False Positives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Query</td>
<td>O(k)</td>
<td>O(m)</td>
<td>None</td>
<td>Possible</td>
</tr>
</tbody>
</table>
<p>Bloom Filter Query, fast, memory-light, and trustable when it says “no.”</p>
</section>
</section>
<section id="counting-bloom-filter" class="level3">
<h3 class="anchored" data-anchor-id="counting-bloom-filter">263 Counting Bloom Filter</h3>
<p>A Counting Bloom Filter (CBF) extends the classic Bloom Filter by allowing deletions. Instead of a simple bit array, it uses an integer counter array, so each bit becomes a small counter tracking how many elements mapped to that position.</p>
<p>When inserting, increment the counters; when deleting, decrement them. If all required counters are greater than zero, the element is possibly present.</p>
<section id="what-problem-are-we-solving-62" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-62">What Problem Are We Solving?</h4>
<p>A regular Bloom Filter is <em>write-only</em>: you can insert, but not remove. Once a bit is set to <code>1</code>, it stays <code>1</code> forever.</p>
<p>But what if:</p>
<ul>
<li>You’re tracking <em>active sessions</em>?</li>
<li>You need to remove <em>expired cache keys</em>?</li>
<li>You want to maintain a <em>sliding window</em> of data?</li>
</ul>
<p>Then you need a Counting Bloom Filter, which supports safe deletions.</p>
</section>
<section id="how-it-works-plain-language-27" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-27">How It Works (Plain Language)</h4>
<p>We replace the bit array with a counter array of size <span class="math inline">\(m\)</span>.</p>
<p>For each element <span class="math inline">\(x\)</span>:</p>
<p>Insert(x)<br>
- For each hash <span class="math inline">\(h_i(x)\)</span>: increment <code>count[h_i(x)]++</code></p>
<p>Query(x)<br>
- Check all <code>count[h_i(x)] &gt; 0</code> → “maybe”<br>
- If any are <code>0</code>, → “no”</p>
<p>Delete(x)<br>
- For each hash <span class="math inline">\(h_i(x)\)</span>: decrement <code>count[h_i(x)]--</code><br>
- Ensure counters never become negative</p>
</section>
<section id="example-28" class="level4">
<h4 class="anchored" data-anchor-id="example-28">Example</h4>
<p>Let <span class="math inline">\(m = 10\)</span>, <span class="math inline">\(k = 3\)</span></p>
<p>Initial state<br>
[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</p>
<p>Insert “cat”</p>
<p><span class="math inline">\(h_1(\text{cat}) = 2\)</span><br>
<span class="math inline">\(h_2(\text{cat}) = 5\)</span><br>
<span class="math inline">\(h_3(\text{cat}) = 7\)</span></p>
<p>→ increment <span class="math inline">\(count[2]\)</span>, <span class="math inline">\(count[5]\)</span>, <span class="math inline">\(count[7]\)</span></p>
<p>Array after insertion<br>
[0, 0, 1, 0, 0, 1, 0, 1, 0, 0]</p>
<p>Insert “dog”</p>
<p><span class="math inline">\(h_1(\text{dog}) = 1\)</span><br>
<span class="math inline">\(h_2(\text{dog}) = 5\)</span><br>
<span class="math inline">\(h_3(\text{dog}) = 9\)</span></p>
<p>→ increment <span class="math inline">\(count[1]\)</span>, <span class="math inline">\(count[5]\)</span>, <span class="math inline">\(count[9]\)</span></p>
<p>Array after insertion<br>
[0, 1, 1, 0, 0, 2, 0, 1, 0, 1]</p>
<p>Delete “cat”</p>
<p><span class="math inline">\(h_1(\text{cat}) = 2\)</span><br>
<span class="math inline">\(h_2(\text{cat}) = 5\)</span><br>
<span class="math inline">\(h_3(\text{cat}) = 7\)</span></p>
<p>→ decrement <span class="math inline">\(count[2]\)</span>, <span class="math inline">\(count[5]\)</span>, <span class="math inline">\(count[7]\)</span></p>
<p>Array after deletion<br>
[0, 1, 0, 0, 0, 1, 0, 0, 0, 1]</p>
<p>After deletion, “cat” is removed while “dog” remains.</p>
</section>
<section id="visualization-11" class="level4">
<h4 class="anchored" data-anchor-id="visualization-11">Visualization</h4>
<p>Counters evolve with each insert/delete:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Index 1</th>
<th>2</th>
<th>5</th>
<th>7</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert(cat)</td>
<td>–</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>–</td>
</tr>
<tr class="even">
<td>Insert(dog)</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Delete(cat)</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-versions-57" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-versions-57">Tiny Code (Easy Versions)</h4>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>m, k <span class="op">=</span> <span class="dv">10</span>, <span class="dv">3</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> m</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hash_functions(x):</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [(<span class="bu">hash</span>(x) <span class="op">+</span> i <span class="op">*</span> i) <span class="op">%</span> m <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(k)]</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(x):</span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> hash_functions(x):</span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>        counts[h] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> query(x):</span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">all</span>(counts[h] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> hash_functions(x))</span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> delete(x):</span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> hash_functions(x):</span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> counts[h] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a>            counts[h] <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a>insert(<span class="st">"cat"</span>)</span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a>insert(<span class="st">"dog"</span>)</span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"After insert:"</span>, counts)</span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a>delete(<span class="st">"cat"</span>)</span>
<span id="cb200-24"><a href="#cb200-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"After delete(cat):"</span>, counts)</span>
<span id="cb200-25"><a href="#cb200-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Query cat:"</span>, <span class="st">"Maybe"</span> <span class="cf">if</span> query(<span class="st">"cat"</span>) <span class="cf">else</span> <span class="st">"No"</span>)</span>
<span id="cb200-26"><a href="#cb200-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Query dog:"</span>, <span class="st">"Maybe"</span> <span class="cf">if</span> query(<span class="st">"dog"</span>) <span class="cf">else</span> <span class="st">"No"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output</p>
<pre><code>After insert: [0,1,1,0,0,2,0,1,0,1]
After delete(cat): [0,1,0,0,0,1,0,0,0,1]
Query cat: No
Query dog: Maybe</code></pre>
</section>
<section id="why-it-matters-62" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-62">Why It Matters</h4>
<ul>
<li>Enables safe deletions without full reset</li>
<li>Useful for cache invalidation, session tracking, streaming windows</li>
<li>Memory-efficient alternative to dynamic hash sets</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-62" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-62">A Gentle Proof (Why It Works)</h4>
<p>Each counter approximates how many items mapped to it. Deletion only decrements counters, if multiple elements shared a hash, it stays ≥1. Thus:</p>
<ul>
<li>No false negatives, unless you over-decrement (bug)</li>
<li>False positives remain possible, as in classic Bloom Filters</li>
</ul>
<p>Probability of false positive remains: <span class="math display">\[
p = \left(1 - e^{-kn/m}\right)^k
\]</span></p>
</section>
<section id="try-it-yourself-62" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-62">Try It Yourself</h4>
<ol type="1">
<li>Create a filter with <code>m=20, k=3</code></li>
<li>Insert 5 words</li>
<li>Delete 2 of them</li>
<li>Query all 5, deleted ones should say no, others maybe</li>
</ol>
</section>
<section id="test-cases-62" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-62">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Array Snapshot</th>
<th>Query Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert(cat)</td>
<td>[0,0,1,0,0,1,0,1,0,0]</td>
<td>–</td>
</tr>
<tr class="even">
<td>Insert(dog)</td>
<td>[0,1,1,0,0,2,0,1,0,1]</td>
<td>–</td>
</tr>
<tr class="odd">
<td>Delete(cat)</td>
<td>[0,1,0,0,0,1,0,0,0,1]</td>
<td>cat → No, dog → Maybe</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-62" class="level4">
<h4 class="anchored" data-anchor-id="complexity-62">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(k)</td>
<td>O(m)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(k)</td>
<td>O(m)</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td>O(k)</td>
<td>O(m)</td>
</tr>
</tbody>
</table>
<p>Counting Bloom Filter, flexible and reversible, keeping memory lean and deletions clean.</p>
</section>
</section>
<section id="cuckoo-filter" class="level3">
<h3 class="anchored" data-anchor-id="cuckoo-filter">264 Cuckoo Filter</h3>
<p>A Cuckoo Filter is a space-efficient alternative to Bloom filters that supports both insertions and deletions while maintaining low false positive rates. Instead of using a bit array, it stores small <em>fingerprints</em> of keys in hash buckets, using cuckoo hashing to resolve collisions.</p>
<p>It’s like a smarter, tidier roommate, always making room by moving someone else when things get crowded.</p>
<section id="what-problem-are-we-solving-63" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-63">What Problem Are We Solving?</h4>
<p>Bloom filters are fast and compact, but they can’t delete elements efficiently. Counting Bloom filters fix that, but they’re more memory-hungry.</p>
<p>We want:</p>
<ul>
<li>Fast membership queries (<code>O(1)</code>)</li>
<li>Insert + Delete support</li>
<li>High load factor (~95%)</li>
<li>Compact memory footprint</li>
</ul>
<p>The Cuckoo Filter solves all three by using cuckoo hashing + small fingerprints.</p>
</section>
<section id="how-it-works-plain-language-28" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-28">How It Works (Plain Language)</h4>
<p>Each element is represented by a short fingerprint (e.g., 8 bits). Each fingerprint can be placed in two possible buckets, determined by two hash functions.</p>
<p>If a bucket is full, we <em>evict</em> an existing fingerprint and relocate it to its alternate bucket (cuckoo style).</p>
<p>Operations:</p>
<ol type="1">
<li><p>Insert(x)</p>
<ul>
<li>Compute fingerprint <code>f = hash_fingerprint(x)</code></li>
<li>Compute <code>i1 = hash(x) % m</code></li>
<li>Compute <code>i2 = i1 ⊕ hash(f)</code> (alternate index)</li>
<li>Try to place <code>f</code> in either <code>i1</code> or <code>i2</code></li>
<li>If both full, evict one fingerprint and relocate</li>
</ul></li>
<li><p>Query(x)</p>
<ul>
<li>Check if <code>f</code> is present in bucket <code>i1</code> or <code>i2</code></li>
</ul></li>
<li><p>Delete(x)</p>
<ul>
<li>Remove <code>f</code> if found in either bucket</li>
</ul></li>
</ol>
</section>
<section id="example-step-by-step" class="level4">
<h4 class="anchored" data-anchor-id="example-step-by-step">Example (Step-by-Step)</h4>
<p>Assume:</p>
<ul>
<li>Buckets: <code>m = 4</code></li>
<li>Bucket size: <code>b = 2</code></li>
<li>Fingerprint size: 4 bits</li>
</ul>
<p>Start (empty):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Bucket 0</th>
<th>Bucket 1</th>
<th>Bucket 2</th>
<th>Bucket 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Insert A</p>
<pre><code>f(A) = 1010  
i1 = 1, i2 = 1 ⊕ hash(1010) = 3  
→ Place in bucket 1</code></pre>
<table class="caption-top table">
<thead>
<tr class="header">
<th>B0</th>
<th>B1</th>
<th>B2</th>
<th>B3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>1010</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Insert B</p>
<pre><code>f(B) = 0111  
i1 = 3, i2 = 3 ⊕ hash(0111) = 0  
→ Place in bucket 3</code></pre>
<table class="caption-top table">
<thead>
<tr class="header">
<th>B0</th>
<th>B1</th>
<th>B2</th>
<th>B3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>1010</td>
<td></td>
<td>0111</td>
</tr>
</tbody>
</table>
<p>Insert C</p>
<pre><code>f(C) = 0100  
i1 = 1, i2 = 1 ⊕ hash(0100) = 2  
→ Bucket 1 full? Move (cuckoo) if needed  
→ Place in bucket 2</code></pre>
<table class="caption-top table">
<thead>
<tr class="header">
<th>B0</th>
<th>B1</th>
<th>B2</th>
<th>B3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>1010</td>
<td>0100</td>
<td>0111</td>
</tr>
</tbody>
</table>
<p>Query C → found in bucket 2 ✅ Delete A → remove from bucket 1</p>
</section>
<section id="tiny-code-easy-version-3" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-version-3">Tiny Code (Easy Version)</h4>
<p>Python Example</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CuckooFilter:</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, size<span class="op">=</span><span class="dv">4</span>, bucket_size<span class="op">=</span><span class="dv">2</span>, fingerprint_bits<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> size</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.bucket_size <span class="op">=</span> bucket_size</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.buckets <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(size)]</span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mask <span class="op">=</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> fingerprint_bits) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _fingerprint(<span class="va">self</span>, item):</span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(item) <span class="op">&amp;</span> <span class="va">self</span>.mask</span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _alt_index(<span class="va">self</span>, i, fp):</span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (i <span class="op">^</span> <span class="bu">hash</span>(fp)) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, item, max_kicks<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a>        fp <span class="op">=</span> <span class="va">self</span>._fingerprint(item)</span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a>        i1 <span class="op">=</span> <span class="bu">hash</span>(item) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a>        i2 <span class="op">=</span> <span class="va">self</span>._alt_index(i1, fp)</span>
<span id="cb205-20"><a href="#cb205-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> (i1, i2):</span>
<span id="cb205-21"><a href="#cb205-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.buckets[i]) <span class="op">&lt;</span> <span class="va">self</span>.bucket_size:</span>
<span id="cb205-22"><a href="#cb205-22" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.buckets[i].append(fp)</span>
<span id="cb205-23"><a href="#cb205-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb205-24"><a href="#cb205-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Cuckoo eviction</span></span>
<span id="cb205-25"><a href="#cb205-25" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> random.choice([i1, i2])</span>
<span id="cb205-26"><a href="#cb205-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(max_kicks):</span>
<span id="cb205-27"><a href="#cb205-27" aria-hidden="true" tabindex="-1"></a>            fp, <span class="va">self</span>.buckets[i][<span class="dv">0</span>] <span class="op">=</span> <span class="va">self</span>.buckets[i][<span class="dv">0</span>], fp</span>
<span id="cb205-28"><a href="#cb205-28" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> <span class="va">self</span>._alt_index(i, fp)</span>
<span id="cb205-29"><a href="#cb205-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.buckets[i]) <span class="op">&lt;</span> <span class="va">self</span>.bucket_size:</span>
<span id="cb205-30"><a href="#cb205-30" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.buckets[i].append(fp)</span>
<span id="cb205-31"><a href="#cb205-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb205-32"><a href="#cb205-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span>  <span class="co"># insert failed</span></span>
<span id="cb205-33"><a href="#cb205-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-34"><a href="#cb205-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> contains(<span class="va">self</span>, item):</span>
<span id="cb205-35"><a href="#cb205-35" aria-hidden="true" tabindex="-1"></a>        fp <span class="op">=</span> <span class="va">self</span>._fingerprint(item)</span>
<span id="cb205-36"><a href="#cb205-36" aria-hidden="true" tabindex="-1"></a>        i1 <span class="op">=</span> <span class="bu">hash</span>(item) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb205-37"><a href="#cb205-37" aria-hidden="true" tabindex="-1"></a>        i2 <span class="op">=</span> <span class="va">self</span>._alt_index(i1, fp)</span>
<span id="cb205-38"><a href="#cb205-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fp <span class="kw">in</span> <span class="va">self</span>.buckets[i1] <span class="kw">or</span> fp <span class="kw">in</span> <span class="va">self</span>.buckets[i2]</span>
<span id="cb205-39"><a href="#cb205-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-40"><a href="#cb205-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete(<span class="va">self</span>, item):</span>
<span id="cb205-41"><a href="#cb205-41" aria-hidden="true" tabindex="-1"></a>        fp <span class="op">=</span> <span class="va">self</span>._fingerprint(item)</span>
<span id="cb205-42"><a href="#cb205-42" aria-hidden="true" tabindex="-1"></a>        i1 <span class="op">=</span> <span class="bu">hash</span>(item) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb205-43"><a href="#cb205-43" aria-hidden="true" tabindex="-1"></a>        i2 <span class="op">=</span> <span class="va">self</span>._alt_index(i1, fp)</span>
<span id="cb205-44"><a href="#cb205-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> (i1, i2):</span>
<span id="cb205-45"><a href="#cb205-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> fp <span class="kw">in</span> <span class="va">self</span>.buckets[i]:</span>
<span id="cb205-46"><a href="#cb205-46" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.buckets[i].remove(fp)</span>
<span id="cb205-47"><a href="#cb205-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb205-48"><a href="#cb205-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-63" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-63">Why It Matters</h4>
<ul>
<li>Supports deletions efficiently</li>
<li>High load factor (~95%) before failure</li>
<li>Smaller than Counting Bloom Filter for same error rate</li>
<li>Practical for caches, membership checks, deduplication</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-63" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-63">A Gentle Proof (Why It Works)</h4>
<p>Each element has two potential homes → high flexibility Cuckoo eviction ensures the table remains compact Short fingerprints preserve memory while keeping collisions low</p>
<p>False positive rate: <span class="math display">\[
p \approx \frac{2b}{2^f}
\]</span> where <code>b</code> is bucket size, <code>f</code> is fingerprint bits</p>
</section>
<section id="try-it-yourself-63" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-63">Try It Yourself</h4>
<ol type="1">
<li>Build a filter with 8 buckets, 2 slots each</li>
<li>Insert 5 words</li>
<li>Delete 1 word</li>
<li>Query all 5, deleted one should return “no”</li>
</ol>
</section>
<section id="test-cases-63" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-63">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Bucket 0</th>
<th>Bucket 1</th>
<th>Bucket 2</th>
<th>Bucket 3</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert(A)</td>
<td>–</td>
<td>1010</td>
<td>–</td>
<td>–</td>
<td>OK</td>
</tr>
<tr class="even">
<td>Insert(B)</td>
<td>–</td>
<td>1010</td>
<td>–</td>
<td>0111</td>
<td>OK</td>
</tr>
<tr class="odd">
<td>Insert(C)</td>
<td>–</td>
<td>1010</td>
<td>0100</td>
<td>0111</td>
<td>OK</td>
</tr>
<tr class="even">
<td>Query(C)</td>
<td>–</td>
<td>1010</td>
<td>0100</td>
<td>0111</td>
<td>Maybe</td>
</tr>
<tr class="odd">
<td>Delete(A)</td>
<td>–</td>
<td>–</td>
<td>0100</td>
<td>0111</td>
<td>Deleted ✅</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-63" class="level4">
<h4 class="anchored" data-anchor-id="complexity-63">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(1) amortized</td>
<td>O(m × b × f)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(1)</td>
<td>O(m × b × f)</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td>O(1)</td>
<td>O(m × b × f)</td>
</tr>
</tbody>
</table>
<p>Cuckoo Filter, a nimble, compact, and deletable membership structure built on playful eviction.</p>
</section>
</section>
<section id="count-min-sketch" class="level3">
<h3 class="anchored" data-anchor-id="count-min-sketch">265 Count-Min Sketch</h3>
<p>A Count-Min Sketch (CMS) is a compact data structure for estimating the frequency of elements in a data stream. Instead of storing every item, it keeps a small 2D array of counters updated by multiple hash functions. It never underestimates counts, but may slightly overestimate due to hash collisions.</p>
<p>Think of it as a memory-efficient radar, it doesn’t see every car, but it knows roughly how many are on each lane.</p>
<section id="what-problem-are-we-solving-64" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-64">What Problem Are We Solving?</h4>
<p>In streaming or massive datasets, we can’t store every key-value count exactly. We want to track approximate frequencies with limited memory, supporting:</p>
<ul>
<li>Streaming updates: count items as they arrive</li>
<li>Approximate queries: estimate item frequency</li>
<li>Memory efficiency: sublinear space</li>
</ul>
<p>Used in network monitoring, NLP (word counts), heavy hitter detection, and online analytics.</p>
</section>
<section id="how-it-works-plain-language-29" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-29">How It Works (Plain Language)</h4>
<p>CMS uses a 2D array with <code>d</code> rows and <code>w</code> columns. Each row has a different hash function. Each item updates one counter per row, all at its hashed index.</p>
<p>Insert(x): For each row <code>i</code>:</p>
<pre><code>index = hash_i(x) % w
count[i][index] += 1</code></pre>
<p>Query(x): For each row <code>i</code>:</p>
<pre><code>estimate = min(count[i][hash_i(x) % w])</code></pre>
<p>We take the <em>minimum</em> across rows, hence “Count-Min”.</p>
</section>
<section id="example-step-by-step-1" class="level4">
<h4 class="anchored" data-anchor-id="example-step-by-step-1">Example (Step-by-Step)</h4>
<p>Let <code>d = 3</code> hash functions, <code>w = 10</code> width.</p>
<p>Initialize table:</p>
<pre><code>Row1: [0 0 0 0 0 0 0 0 0 0]
Row2: [0 0 0 0 0 0 0 0 0 0]
Row3: [0 0 0 0 0 0 0 0 0 0]</code></pre>
<p>Insert “apple”</p>
<pre><code>h1(apple)=2, h2(apple)=5, h3(apple)=9
→ increment positions (1,2), (2,5), (3,9)</code></pre>
<p>Insert “banana”</p>
<pre><code>h1(banana)=2, h2(banana)=3, h3(banana)=1
→ increment (1,2), (2,3), (3,1)</code></pre>
<p>Now:</p>
<pre><code>Row1: [0 0 2 0 0 0 0 0 0 0]
Row2: [0 0 0 1 0 1 0 0 0 0]
Row3: [0 1 0 0 0 0 0 0 0 1]</code></pre>
<p>Query “apple”:</p>
<pre><code>min(count[1][2], count[2][5], count[3][9]) = min(2,1,1) = 1</code></pre>
<p>Estimate frequency ≈ 1 (may be slightly high if collisions overlap).</p>
</section>
<section id="table-visualization" class="level4">
<h4 class="anchored" data-anchor-id="table-visualization">Table Visualization</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Item</th>
<th>h₁(x)</th>
<th>h₂(x)</th>
<th>h₃(x)</th>
<th>Estimated Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>apple</td>
<td>2</td>
<td>5</td>
<td>9</td>
<td>1</td>
</tr>
<tr class="even">
<td>banana</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-version-4" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-version-4">Tiny Code (Easy Version)</h4>
<p>Python Example</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb213"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mmh3</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CountMinSketch:</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, width<span class="op">=</span><span class="dv">10</span>, depth<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.width <span class="op">=</span> width</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.depth <span class="op">=</span> depth</span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.table <span class="op">=</span> [[<span class="dv">0</span>] <span class="op">*</span> width <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(depth)]</span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.seeds <span class="op">=</span> [i <span class="op">*</span> <span class="dv">17</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(depth)]  <span class="co"># different hash seeds</span></span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, item, seed):</span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mmh3.<span class="bu">hash</span>(<span class="bu">str</span>(item), seed) <span class="op">%</span> <span class="va">self</span>.width</span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(<span class="va">self</span>, item, count<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, seed <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.seeds):</span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">=</span> <span class="va">self</span>._hash(item, seed)</span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.table[i][idx] <span class="op">+=</span> count</span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> query(<span class="va">self</span>, item):</span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a>        estimates <span class="op">=</span> []</span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, seed <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.seeds):</span>
<span id="cb213-21"><a href="#cb213-21" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">=</span> <span class="va">self</span>._hash(item, seed)</span>
<span id="cb213-22"><a href="#cb213-22" aria-hidden="true" tabindex="-1"></a>            estimates.append(<span class="va">self</span>.table[i][idx])</span>
<span id="cb213-23"><a href="#cb213-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">min</span>(estimates)</span>
<span id="cb213-24"><a href="#cb213-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-25"><a href="#cb213-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb213-26"><a href="#cb213-26" aria-hidden="true" tabindex="-1"></a>cms <span class="op">=</span> CountMinSketch(width<span class="op">=</span><span class="dv">10</span>, depth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb213-27"><a href="#cb213-27" aria-hidden="true" tabindex="-1"></a>cms.add(<span class="st">"apple"</span>)</span>
<span id="cb213-28"><a href="#cb213-28" aria-hidden="true" tabindex="-1"></a>cms.add(<span class="st">"banana"</span>)</span>
<span id="cb213-29"><a href="#cb213-29" aria-hidden="true" tabindex="-1"></a>cms.add(<span class="st">"apple"</span>)</span>
<span id="cb213-30"><a href="#cb213-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"apple:"</span>, cms.query(<span class="st">"apple"</span>))</span>
<span id="cb213-31"><a href="#cb213-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"banana:"</span>, cms.query(<span class="st">"banana"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output</p>
<pre><code>apple: 2
banana: 1</code></pre>
</section>
<section id="why-it-matters-64" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-64">Why It Matters</h4>
<ul>
<li>Compact: O(w × d) memory</li>
<li>Fast: O(1) updates and queries</li>
<li>Scalable: Works on unbounded data streams</li>
<li>Deterministic upper bound: never underestimates</li>
</ul>
<p>Used in:</p>
<ul>
<li>Word frequency estimation</li>
<li>Network flow counting</li>
<li>Clickstream analysis</li>
<li>Approximate histograms</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-64" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-64">A Gentle Proof (Why It Works)</h4>
<p>Each item is hashed to <code>d</code> positions. Collisions can cause overestimation, never underestimation. By taking the minimum, we get the best upper bound estimate.</p>
<p>Error bound: <span class="math display">\[
\text{error} \le \epsilon N, \quad \text{with probability } 1 - \delta
\]</span> Choose: <span class="math display">\[
w = \lceil e / \epsilon \rceil,\quad d = \lceil \ln(1/\delta) \rceil
\]</span></p>
</section>
<section id="try-it-yourself-64" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-64">Try It Yourself</h4>
<ol type="1">
<li>Create a CMS with <code>(w=20, d=4)</code></li>
<li>Stream 1000 random items</li>
<li>Compare estimated vs.&nbsp;actual counts</li>
<li>Observe overestimation patterns</li>
</ol>
</section>
<section id="test-cases-64" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-64">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Action</th>
<th>Query Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert(apple)</td>
<td>+1</td>
<td>–</td>
</tr>
<tr class="even">
<td>Insert(apple)</td>
<td>+1</td>
<td>–</td>
</tr>
<tr class="odd">
<td>Insert(banana)</td>
<td>+1</td>
<td>–</td>
</tr>
<tr class="even">
<td>Query(apple)</td>
<td>–</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Query(banana)</td>
<td>–</td>
<td>1</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-64" class="level4">
<h4 class="anchored" data-anchor-id="complexity-64">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(d)</td>
<td>O(w × d)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(d)</td>
<td>O(w × d)</td>
</tr>
</tbody>
</table>
<p>Count-Min Sketch, lightweight, accurate-enough, and built for streams that never stop flowing.</p>
</section>
</section>
<section id="hyperloglog" class="level3">
<h3 class="anchored" data-anchor-id="hyperloglog">266 HyperLogLog</h3>
<p>A HyperLogLog (HLL) is a probabilistic data structure for cardinality estimation, that is, estimating the number of distinct elements in a massive dataset or stream using very little memory.</p>
<p>It doesn’t remember <em>which</em> items you saw, only <em>how many distinct ones there likely were</em>. Think of it as a memory-efficient crowd counter, it doesn’t know faces, but it knows how full the stadium is.</p>
<section id="what-problem-are-we-solving-65" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-65">What Problem Are We Solving?</h4>
<p>When processing large data streams (web analytics, logs, unique visitors, etc.), exact counting of distinct elements (using sets or hash tables) is too memory-heavy.</p>
<p>We want a solution that:</p>
<ul>
<li>Tracks distinct counts approximately</li>
<li>Uses constant memory</li>
<li>Supports mergeability (combine two sketches easily)</li>
</ul>
<p>HyperLogLog delivers O(1) time per update and ~1.04/√m error rate with just kilobytes of memory.</p>
</section>
<section id="how-it-works-plain-language-30" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-30">How It Works (Plain Language)</h4>
<p>Each incoming element is hashed to a large binary number. HLL uses the position of the leftmost 1-bit in the hash to estimate how rare (and thus how many) elements exist.</p>
<p>It maintains an array of <code>m</code> <em>registers</em> (buckets). Each bucket stores the maximum leading zero count seen so far for its hash range.</p>
<p>Steps:</p>
<ol type="1">
<li>Hash element <code>x</code> to 64 bits: <code>h = hash(x)</code></li>
<li>Bucket index: use first <code>p</code> bits of <code>h</code> to pick one of <code>m = 2^p</code> buckets</li>
<li>Rank: count leading zeros in the remaining bits + 1</li>
<li>Update: store <code>max(existing, rank)</code> in that bucket</li>
</ol>
<p>Final count = harmonic mean of <code>2^rank</code> values, scaled by a bias-corrected constant.</p>
</section>
<section id="example-step-by-step-2" class="level4">
<h4 class="anchored" data-anchor-id="example-step-by-step-2">Example (Step-by-Step)</h4>
<p>Let <code>p = 2</code> → <code>m = 4</code> buckets. Initialize registers: <code>[0,0,0,0]</code></p>
<p>Insert “apple”:</p>
<pre><code>hash("apple") = 110010100…  
bucket = first 2 bits = 11 (3)
rank = position of first 1 after prefix = 2
→ bucket[3] = max(0, 2) = 2</code></pre>
<p>Insert “banana”:</p>
<pre><code>hash("banana") = 01000100…  
bucket = 01 (1)
rank = 3
→ bucket[1] = 3</code></pre>
<p>Insert “pear”:</p>
<pre><code>hash("pear") = 10010000…  
bucket = 10 (2)
rank = 4
→ bucket[2] = 4</code></pre>
<p>Registers: <code>[0, 3, 4, 2]</code></p>
<p>Estimate: <span class="math display">\[
E = \alpha_m \cdot m^2 / \sum 2^{-M[i]}
\]</span> where <code>α_m</code> is a bias-correction constant (≈0.673 for small m).</p>
</section>
<section id="visualization-12" class="level4">
<h4 class="anchored" data-anchor-id="visualization-12">Visualization</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Bucket</th>
<th>Values Seen</th>
<th>Leading Zeros</th>
<th>Stored Rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>none</td>
<td>–</td>
<td>0</td>
</tr>
<tr class="even">
<td>1</td>
<td>banana</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="odd">
<td>2</td>
<td>pear</td>
<td>3</td>
<td>4</td>
</tr>
<tr class="even">
<td>3</td>
<td>apple</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-version-5" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-version-5">Tiny Code (Easy Version)</h4>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mmh3</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> HyperLogLog:</span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, p<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.p <span class="op">=</span> p</span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.m <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> p</span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.registers <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="va">self</span>.m</span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.alpha <span class="op">=</span> <span class="fl">0.673</span> <span class="cf">if</span> <span class="va">self</span>.m <span class="op">==</span> <span class="dv">16</span> <span class="cf">else</span> <span class="fl">0.709</span> <span class="cf">if</span> <span class="va">self</span>.m <span class="op">==</span> <span class="dv">32</span> <span class="cf">else</span> <span class="fl">0.7213</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> <span class="fl">1.079</span> <span class="op">/</span> <span class="va">self</span>.m)</span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, x):</span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mmh3.<span class="bu">hash</span>(<span class="bu">str</span>(x), <span class="dv">42</span>) <span class="op">&amp;</span> <span class="bn">0xffffffff</span></span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(<span class="va">self</span>, x):</span>
<span id="cb218-15"><a href="#cb218-15" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> <span class="va">self</span>._hash(x)</span>
<span id="cb218-16"><a href="#cb218-16" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> h <span class="op">&gt;&gt;</span> (<span class="dv">32</span> <span class="op">-</span> <span class="va">self</span>.p)</span>
<span id="cb218-17"><a href="#cb218-17" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> (h <span class="op">&lt;&lt;</span> <span class="va">self</span>.p) <span class="op">&amp;</span> <span class="bn">0xffffffff</span></span>
<span id="cb218-18"><a href="#cb218-18" aria-hidden="true" tabindex="-1"></a>        rank <span class="op">=</span> <span class="va">self</span>._rank(w, <span class="dv">32</span> <span class="op">-</span> <span class="va">self</span>.p)</span>
<span id="cb218-19"><a href="#cb218-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.registers[idx] <span class="op">=</span> <span class="bu">max</span>(<span class="va">self</span>.registers[idx], rank)</span>
<span id="cb218-20"><a href="#cb218-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-21"><a href="#cb218-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _rank(<span class="va">self</span>, w, bits):</span>
<span id="cb218-22"><a href="#cb218-22" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb218-23"><a href="#cb218-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> w <span class="op">&amp;</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> (bits <span class="op">-</span> <span class="dv">1</span>)) <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> r <span class="op">&lt;=</span> bits:</span>
<span id="cb218-24"><a href="#cb218-24" aria-hidden="true" tabindex="-1"></a>            r <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb218-25"><a href="#cb218-25" aria-hidden="true" tabindex="-1"></a>            w <span class="op">&lt;&lt;=</span> <span class="dv">1</span></span>
<span id="cb218-26"><a href="#cb218-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> r</span>
<span id="cb218-27"><a href="#cb218-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-28"><a href="#cb218-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> count(<span class="va">self</span>):</span>
<span id="cb218-29"><a href="#cb218-29" aria-hidden="true" tabindex="-1"></a>        Z <span class="op">=</span> <span class="bu">sum</span>([<span class="fl">2.0</span>  <span class="op">-</span>v <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.registers])</span>
<span id="cb218-30"><a href="#cb218-30" aria-hidden="true" tabindex="-1"></a>        E <span class="op">=</span> <span class="va">self</span>.alpha <span class="op">*</span> <span class="va">self</span>.m <span class="op">*</span> <span class="va">self</span>.m <span class="op">/</span> Z</span>
<span id="cb218-31"><a href="#cb218-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">round</span>(E)</span>
<span id="cb218-32"><a href="#cb218-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-33"><a href="#cb218-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb218-34"><a href="#cb218-34" aria-hidden="true" tabindex="-1"></a>hll <span class="op">=</span> HyperLogLog(p<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb218-35"><a href="#cb218-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"pear"</span>, <span class="st">"apple"</span>]:</span>
<span id="cb218-36"><a href="#cb218-36" aria-hidden="true" tabindex="-1"></a>    hll.add(x)</span>
<span id="cb218-37"><a href="#cb218-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Estimated distinct count:"</span>, hll.count())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output</p>
<pre><code>Estimated distinct count: 3</code></pre>
</section>
<section id="why-it-matters-65" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-65">Why It Matters</h4>
<ul>
<li>Tiny memory footprint (kilobytes for billions of elements)</li>
<li>Mergeable: HLL(A∪B) = max(HLL(A), HLL(B)) bucket-wise</li>
<li>Used in: Redis, Google BigQuery, Apache DataSketches, analytics systems</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-65" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-65">A Gentle Proof (Why It Works)</h4>
<p>The position of the first 1-bit follows a geometric distribution, rare long zero streaks mean more unique elements. By keeping the <em>max</em> observed rank per bucket, HLL captures global rarity efficiently. Combining across buckets gives a harmonic mean that balances under/over-counting.</p>
<p>Error ≈ 1.04 / √m, so doubling <code>m</code> halves the error.</p>
</section>
<section id="try-it-yourself-65" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-65">Try It Yourself</h4>
<ol type="1">
<li>Create HLL with <code>p = 10</code> (<code>m = 1024</code>)</li>
<li>Add 1M random numbers</li>
<li>Compare HLL estimate with true count</li>
<li>Test merging two sketches</li>
</ol>
</section>
<section id="test-cases-65" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-65">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Items</th>
<th>True Count</th>
<th>Estimated</th>
<th>Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>10</td>
<td>10</td>
<td>0%</td>
</tr>
<tr class="even">
<td>1000</td>
<td>1000</td>
<td>995</td>
<td>~0.5%</td>
</tr>
<tr class="odd">
<td>1e6</td>
<td>1,000,000</td>
<td>1,010,000</td>
<td>~1%</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-65" class="level4">
<h4 class="anchored" data-anchor-id="complexity-65">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Add</td>
<td>O(1)</td>
<td>O(m)</td>
</tr>
<tr class="even">
<td>Count</td>
<td>O(m)</td>
<td>O(m)</td>
</tr>
<tr class="odd">
<td>Merge</td>
<td>O(m)</td>
<td>O(m)</td>
</tr>
</tbody>
</table>
<p>HyperLogLog, counting the uncountable, one leading zero at a time.</p>
</section>
</section>
<section id="flajoletmartin-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="flajoletmartin-algorithm">267 Flajolet–Martin Algorithm</h3>
<p>The Flajolet–Martin (FM) algorithm is one of the earliest and simplest approaches for probabilistic counting, estimating the number of distinct elements in a data stream using tiny memory.</p>
<p>It’s the conceptual ancestor of HyperLogLog, showing the brilliant idea that <em>the position of the first 1-bit in a hash tells us something about rarity</em>.</p>
<section id="what-problem-are-we-solving-66" class="level4">
<h4 class="anchored" data-anchor-id="what-problem-are-we-solving-66">What Problem Are We Solving?</h4>
<p>When elements arrive in a stream too large to store exactly (web requests, IP addresses, words), we want to estimate the number of unique elements without storing them all.</p>
<p>A naive approach (hash set) is O(n) memory. Flajolet–Martin achieves O(1) memory and O(1) updates.</p>
<p>We need:</p>
<ul>
<li>A streaming algorithm</li>
<li>With constant space</li>
<li>For distinct count estimation</li>
</ul>
</section>
<section id="how-it-works-plain-language-31" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-plain-language-31">How It Works (Plain Language)</h4>
<p>Each element is hashed to a large binary number (uniformly random).<br>
We then find the position of the least significant 1-bit — the number of trailing zeros.<br>
A value with many trailing zeros is rare, which indicates a larger underlying population.</p>
<p>We track the maximum number of trailing zeros observed, denoted as <code>R</code>.<br>
The estimated number of distinct elements is:</p>
<p><span class="math display">\[
\hat{N} = \phi \times 2^{R}
\]</span></p>
<p>where <span class="math inline">\(\phi \approx 0.77351\)</span> is a correction constant.</p>
<p>Steps:</p>
<ol type="1">
<li>Initialize <span class="math inline">\(R = 0\)</span><br>
</li>
<li>For each element <span class="math inline">\(x\)</span>:
<ul>
<li><span class="math inline">\(h = \text{hash}(x)\)</span><br>
</li>
<li><span class="math inline">\(r = \text{count\_trailing\_zeros}(h)\)</span><br>
</li>
<li><span class="math inline">\(R = \max(R, r)\)</span><br>
</li>
</ul></li>
<li>Estimate distinct count as <span class="math inline">\(\hat{N} \approx \phi \times 2^{R}\)</span></li>
</ol>
</section>
<section id="example-step-by-step-3" class="level4">
<h4 class="anchored" data-anchor-id="example-step-by-step-3">Example (Step-by-Step)</h4>
<p>Stream: <code>[apple, banana, apple, cherry, date]</code></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Element</th>
<th>Hash (Binary)</th>
<th>Trailing Zeros</th>
<th>R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>apple</td>
<td>10110</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>banana</td>
<td>10000</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td>apple</td>
<td>10110</td>
<td>1</td>
<td>4</td>
</tr>
<tr class="even">
<td>cherry</td>
<td>11000</td>
<td>3</td>
<td>4</td>
</tr>
<tr class="odd">
<td>date</td>
<td>01100</td>
<td>2</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>Final value: <span class="math inline">\(R = 4\)</span></p>
<p>Estimate: <span class="math display">\[
\hat{N} = 0.77351 \times 2^{4} = 0.77351 \times 16 \approx 12.38
\]</span></p>
<p>So the estimated number of distinct elements is about 12<br>
(overestimation due to small sample size).</p>
<p>In practice, multiple independent hash functions or registers are used,<br>
and their results are averaged to reduce variance and improve accuracy.</p>
</section>
<section id="visualization-13" class="level4">
<h4 class="anchored" data-anchor-id="visualization-13">Visualization</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 14%">
<col style="width: 18%">
<col style="width: 60%">
</colgroup>
<thead>
<tr class="header">
<th>Hash</th>
<th>Binary Form</th>
<th>Trailing Zeros</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10000</td>
<td>16</td>
<td>4</td>
<td>very rare pattern → suggests large population</td>
</tr>
<tr class="even">
<td>11000</td>
<td>24</td>
<td>3</td>
<td>rare-ish</td>
</tr>
<tr class="odd">
<td>10110</td>
<td>22</td>
<td>1</td>
<td>common</td>
</tr>
</tbody>
</table>
<p>The <em>longest</em> zero-run gives the scale of rarity.</p>
</section>
<section id="tiny-code-easy-version-6" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-easy-version-6">Tiny Code (Easy Version)</h4>
<p>Python Example</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mmh3</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> trailing_zeros(x):</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">32</span></span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>    tz <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (x <span class="op">&amp;</span> <span class="dv">1</span>) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>        tz <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>        x <span class="op">&gt;&gt;=</span> <span class="dv">1</span></span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tz</span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flajolet_martin(stream, seed<span class="op">=</span><span class="dv">42</span>):</span>
<span id="cb220-14"><a href="#cb220-14" aria-hidden="true" tabindex="-1"></a>    R <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb220-15"><a href="#cb220-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> stream:</span>
<span id="cb220-16"><a href="#cb220-16" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> mmh3.<span class="bu">hash</span>(<span class="bu">str</span>(x), seed) <span class="op">&amp;</span> <span class="bn">0xffffffff</span></span>
<span id="cb220-17"><a href="#cb220-17" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> trailing_zeros(h)</span>
<span id="cb220-18"><a href="#cb220-18" aria-hidden="true" tabindex="-1"></a>        R <span class="op">=</span> <span class="bu">max</span>(R, r)</span>
<span id="cb220-19"><a href="#cb220-19" aria-hidden="true" tabindex="-1"></a>    phi <span class="op">=</span> <span class="fl">0.77351</span></span>
<span id="cb220-20"><a href="#cb220-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">int</span>(phi <span class="op">*</span> (<span class="dv">2</span>  R))</span>
<span id="cb220-21"><a href="#cb220-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-22"><a href="#cb220-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb220-23"><a href="#cb220-23" aria-hidden="true" tabindex="-1"></a>stream <span class="op">=</span> [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"apple"</span>, <span class="st">"cherry"</span>, <span class="st">"date"</span>]</span>
<span id="cb220-24"><a href="#cb220-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Estimated distinct count:"</span>, flajolet_martin(stream))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output</p>
<pre><code>Estimated distinct count: 12</code></pre>
</section>
<section id="why-it-matters-66" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-66">Why It Matters</h4>
<ul>
<li>Foundational for modern streaming algorithms</li>
<li>Inspired LogLog and HyperLogLog</li>
<li>Memory-light: just a few integers</li>
<li>Useful in approximate analytics, network telemetry, data warehouses</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-66" class="level4">
<h4 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-66">A Gentle Proof (Why It Works)</h4>
<p>Each hash output is uniformly random.<br>
The probability of observing a value with <span class="math inline">\(r\)</span> trailing zeros is:</p>
<p><span class="math display">\[
P(r) = \frac{1}{2^{r+1}}
\]</span></p>
<p>If such a value appears, it suggests the stream size is roughly <span class="math inline">\(2^{r}\)</span>.<br>
Therefore, the estimate <span class="math inline">\(2^{R}\)</span> naturally scales with the number of unique elements.</p>
<p>By using multiple independent estimators and averaging their results,<br>
the variance can be reduced from about 50% down to around 10%.</p>
</section>
<section id="try-it-yourself-66" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-66">Try It Yourself</h4>
<ol type="1">
<li>Generate 100 random numbers, feed to FM</li>
<li>Compare estimated vs.&nbsp;true count</li>
<li>Repeat 10 runs, compute average error</li>
<li>Try combining multiple estimators (median of means)</li>
</ol>
</section>
<section id="test-cases-66" class="level4">
<h4 class="anchored" data-anchor-id="test-cases-66">Test Cases</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Stream Size</th>
<th>True Distinct</th>
<th>R</th>
<th>Estimate</th>
<th>Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>10</td>
<td>3</td>
<td>6</td>
<td>-40%</td>
</tr>
<tr class="even">
<td>100</td>
<td>100</td>
<td>7</td>
<td>99</td>
<td>-1%</td>
</tr>
<tr class="odd">
<td>1000</td>
<td>1000</td>
<td>10</td>
<td>791</td>
<td>-21%</td>
</tr>
</tbody>
</table>
<p>Using multiple registers improves accuracy significantly.</p>
</section>
<section id="complexity-66" class="level4">
<h4 class="anchored" data-anchor-id="complexity-66">Complexity</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr class="even">
<td>Query</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody>
</table>
<p>Flajolet–Martin Algorithm, the original spark of probabilistic counting, turning randomness into estimation magic.</p>
</section>
</section>
<section id="minhash" class="level3">
<h3 class="anchored" data-anchor-id="minhash">268 MinHash</h3>
<p>A MinHash is a probabilistic algorithm for estimating set similarity, particularly the Jaccard similarity, without comparing all elements directly. Instead of storing every element, it constructs a signature of compact hash values. The more overlap in signatures, the more similar the sets.</p>
<p>MinHash is foundational in large-scale similarity estimation, fast, memory-efficient, and mathematically elegant.</p>
</section>
<section id="what-problem-are-we-solving-67" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-67">What Problem Are We Solving?</h3>
<p>To compute the exact Jaccard similarity between two sets <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>:</p>
<p><span class="math display">\[
J(A, B) = \frac{|A \cap B|}{|A \cup B|}
\]</span></p>
<p>This requires comparing all elements, which is infeasible for large datasets.</p>
<p>We need methods that provide:</p>
<ul>
<li>Compact sketches using small memory<br>
</li>
<li>Fast approximate comparisons<br>
</li>
<li>Adjustable accuracy through the number of hash functions</li>
</ul>
<p>MinHash meets these requirements by applying multiple random hash functions<br>
and recording the minimum hash value from each function as the set’s signature.</p>
</section>
<section id="how-it-works-plain-language-32" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-32">How It Works (Plain Language)</h3>
<p>For each set, we apply several independent hash functions. For each hash function, we record the minimum hash value among all elements.</p>
<p>Two sets that share many elements tend to share the same minimums across these hash functions. Thus, the fraction of matching minimums estimates their Jaccard similarity.</p>
<p>Algorithm:</p>
<ol type="1">
<li>Choose <span class="math inline">\(k\)</span> hash functions <span class="math inline">\(h_1, h_2, \ldots, h_k\)</span>.<br>
</li>
<li>For each set <span class="math inline">\(S\)</span>, compute its signature:</li>
</ol>
<p><span class="math display">\[
\text{sig}(S)[i] = \min_{x \in S} h_i(x)
\]</span></p>
<ol start="3" type="1">
<li>Estimate the Jaccard similarity by:</li>
</ol>
<p><span class="math display">\[
\widehat{J}(A, B) = \frac{1}{k} \sum_{i=1}^{k} \mathbf{1}\{\text{sig}(A)[i] = \text{sig}(B)[i]\}
\]</span></p>
<p>Each matching position between <span class="math inline">\(\text{sig}(A)\)</span> and <span class="math inline">\(\text{sig}(B)\)</span> corresponds<br>
to one agreeing hash function, and the fraction of matches approximates <span class="math inline">\(J(A,B)\)</span>.</p>
</section>
<section id="example-step-by-step-4" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-4">Example (Step by Step)</h3>
<p>Let:</p>
<p><span class="math display">\[
A = {\text{apple}, \text{banana}, \text{cherry}}, \quad
B = {\text{banana}, \text{cherry}, \text{date}}
\]</span></p>
<p>Suppose we have 3 hash functions:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Item</th>
<th><span class="math inline">\(h_1\)</span></th>
<th><span class="math inline">\(h_2\)</span></th>
<th><span class="math inline">\(h_3\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>apple</td>
<td>5</td>
<td>1</td>
<td>7</td>
</tr>
<tr class="even">
<td>banana</td>
<td>2</td>
<td>4</td>
<td>3</td>
</tr>
<tr class="odd">
<td>cherry</td>
<td>3</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td>date</td>
<td>4</td>
<td>3</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Signature(A): <span class="math display">\[
\text{sig}(A) = [\min(5,2,3), \min(1,4,2), \min(7,3,1)] = [2,1,1]
\]</span></p>
<p>Signature(B): <span class="math display">\[
\text{sig}(B) = [\min(2,3,4), \min(4,2,3), \min(3,1,2)] = [2,2,1]
\]</span></p>
<p>Compare element-wise:<br>
Matches occur at positions 1 and 3 → <span class="math inline">\(\tfrac{2}{3} \approx 0.67\)</span></p>
<p>Actual Jaccard similarity:</p>
<p><span class="math display">\[
J(A, B) = \frac{|\{\text{banana}, \text{cherry}\}|}{|\{\text{apple}, \text{banana}, \text{cherry}, \text{date}\}|}
= \frac{2}{4} = 0.5
\]</span></p>
<p>The MinHash estimate of <span class="math inline">\(0.67\)</span> is reasonably close to the true value <span class="math inline">\(0.5\)</span>,<br>
demonstrating that even a small number of hash functions can yield a good approximation.</p>
</section>
<section id="visualization-14" class="level3">
<h3 class="anchored" data-anchor-id="visualization-14">Visualization</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Hash Function</th>
<th><span class="math inline">\(\text{sig}(A)\)</span></th>
<th><span class="math inline">\(\text{sig}(B)\)</span></th>
<th>Match</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(h_1\)</span></td>
<td>2</td>
<td>2</td>
<td>✓</td>
</tr>
<tr class="even">
<td><span class="math inline">\(h_2\)</span></td>
<td>1</td>
<td>2</td>
<td>✗</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(h_3\)</span></td>
<td>1</td>
<td>1</td>
<td>✓</td>
</tr>
<tr class="even">
<td>Similarity</td>
<td>–</td>
<td>–</td>
<td><span class="math inline">\((2/3 = 0.67)\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-version-7" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-easy-version-7">Tiny Code (Easy Version)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb222"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mmh3</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> minhash_signature(elements, num_hashes<span class="op">=</span><span class="dv">5</span>, seed<span class="op">=</span><span class="dv">42</span>):</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>    sig <span class="op">=</span> [math.inf] <span class="op">*</span> num_hashes</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> elements:</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_hashes):</span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>            h <span class="op">=</span> mmh3.<span class="bu">hash</span>(<span class="bu">str</span>(x), seed <span class="op">+</span> i)</span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> h <span class="op">&lt;</span> sig[i]:</span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a>                sig[i] <span class="op">=</span> h</span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sig</span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-13"><a href="#cb222-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> jaccard_minhash(sigA, sigB):</span>
<span id="cb222-14"><a href="#cb222-14" aria-hidden="true" tabindex="-1"></a>    matches <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> a, b <span class="kw">in</span> <span class="bu">zip</span>(sigA, sigB) <span class="cf">if</span> a <span class="op">==</span> b)</span>
<span id="cb222-15"><a href="#cb222-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> matches <span class="op">/</span> <span class="bu">len</span>(sigA)</span>
<span id="cb222-16"><a href="#cb222-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-17"><a href="#cb222-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb222-18"><a href="#cb222-18" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> {<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"cherry"</span>}</span>
<span id="cb222-19"><a href="#cb222-19" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> {<span class="st">"banana"</span>, <span class="st">"cherry"</span>, <span class="st">"date"</span>}</span>
<span id="cb222-20"><a href="#cb222-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-21"><a href="#cb222-21" aria-hidden="true" tabindex="-1"></a>sigA <span class="op">=</span> minhash_signature(A, <span class="dv">10</span>)</span>
<span id="cb222-22"><a href="#cb222-22" aria-hidden="true" tabindex="-1"></a>sigB <span class="op">=</span> minhash_signature(B, <span class="dv">10</span>)</span>
<span id="cb222-23"><a href="#cb222-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Approx similarity:"</span>, jaccard_minhash(sigA, sigB))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output</p>
<pre><code>Approx similarity: 0.6</code></pre>
</section>
<section id="why-it-matters-67" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-67">Why It Matters</h3>
<ul>
<li>Scalable similarity: enables fast comparison of very large sets<br>
</li>
<li>Compact representation: stores only <span class="math inline">\(k\)</span> integers per set<br>
</li>
<li>Composable: supports set unions using componentwise minimum<br>
</li>
<li>Common applications:
<ul>
<li>Document deduplication<br>
</li>
<li>Web crawling and search indexing<br>
</li>
<li>Recommendation systems<br>
</li>
<li>Large-scale clustering</li>
</ul></li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-67" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-67">A Gentle Proof (Why It Works)</h3>
<p>For a random permutation <span class="math inline">\(h\)</span>:</p>
<p><span class="math display">\[
P[\min(h(A)) = \min(h(B))] = J(A, B)
\]</span></p>
<p>Each hash function behaves like a Bernoulli trial with success probability <span class="math inline">\(J(A, B)\)</span>.<br>
The MinHash estimator is unbiased:</p>
<p><span class="math display">\[
E[\widehat{J}] = J(A, B)
\]</span></p>
<p>The variance decreases as <span class="math inline">\(\tfrac{1}{k}\)</span>,<br>
so increasing the number of hash functions improves accuracy.</p>
</section>
<section id="try-it-yourself-67" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-67">Try It Yourself</h3>
<ol type="1">
<li>Choose two sets with partial overlap.<br>
</li>
<li>Generate MinHash signatures using <span class="math inline">\(k = 20\)</span> hash functions.<br>
</li>
<li>Compute both the estimated and true Jaccard similarities.<br>
</li>
<li>Increase <span class="math inline">\(k\)</span> and observe how the estimated similarity converges toward the true value — larger <span class="math inline">\(k\)</span> reduces variance and improves accuracy.</li>
</ol>
</section>
<section id="test-cases-67" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-67">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Sets</th>
<th>True <span class="math inline">\(J(A,B)\)</span></th>
<th><span class="math inline">\(k\)</span></th>
<th>Estimated</th>
<th>Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(A=\{1,2,3\}, B=\{2,3,4\}\)</span></td>
<td>0.5</td>
<td>10</td>
<td>0.6</td>
<td>+0.1</td>
</tr>
<tr class="even">
<td><span class="math inline">\(A=\{1,2\}, B=\{1,2,3,4\}\)</span></td>
<td>0.5</td>
<td>20</td>
<td>0.45</td>
<td>-0.05</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(A=B\)</span></td>
<td>1.0</td>
<td>10</td>
<td>1.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-67" class="level3">
<h3 class="anchored" data-anchor-id="complexity-67">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build Signature</td>
<td><span class="math inline">\(O(n \times k)\)</span></td>
<td><span class="math inline">\(O(k)\)</span></td>
</tr>
<tr class="even">
<td>Compare</td>
<td><span class="math inline">\(O(k)\)</span></td>
<td><span class="math inline">\(O(k)\)</span></td>
</tr>
</tbody>
</table>
<p>MinHash turns set similarity into compact signatures — a small sketch that captures the essence of large sets with statistical grace.</p>
</section>
<section id="reservoir-sampling" class="level3">
<h3 class="anchored" data-anchor-id="reservoir-sampling">269 Reservoir Sampling</h3>
<p>Reservoir Sampling is a classic algorithm for randomly sampling k elements from a stream of unknown or very large size, ensuring every element has an equal probability of being selected.</p>
<p>It’s the perfect tool when you can’t store everything, like catching a few fish from an endless river, one by one, without bias.</p>
</section>
<section id="what-problem-are-we-solving-68" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-68">What Problem Are We Solving?</h3>
<p>When data arrives as a stream too large to store in memory, we cannot know its total size in advance.<br>
Yet, we often need to maintain a uniform random sample of fixed size <span class="math inline">\(k\)</span>.</p>
<p>A naive approach would store all items and then sample,<br>
but this becomes infeasible for large or unbounded data.</p>
<p>Reservoir Sampling provides a one-pass solution with these guarantees:</p>
<ul>
<li>Each item in the stream has equal probability <span class="math inline">\(\tfrac{k}{n}\)</span> of being included<br>
</li>
<li>Uses only <span class="math inline">\(O(k)\)</span> memory<br>
</li>
<li>Processes data in a single pass</li>
</ul>
</section>
<section id="how-it-works-plain-language-33" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-33">How It Works (Plain Language)</h3>
<p>We maintain a reservoir (array) of size <span class="math inline">\(k\)</span>.<br>
As each new element arrives, we decide probabilistically whether it replaces one of the existing items.</p>
<p>Steps:</p>
<ol type="1">
<li><p>Fill the reservoir with the first <span class="math inline">\(k\)</span> elements.<br>
</p></li>
<li><p>For each element at index <span class="math inline">\(i\)</span> (starting from <span class="math inline">\(i = k + 1\)</span>):</p>
<ul>
<li>Generate a random integer <span class="math inline">\(j \in [1, i]\)</span><br>
</li>
<li>If <span class="math inline">\(j \le k\)</span>, replace <span class="math inline">\(\text{reservoir}[j]\)</span> with the new element</li>
</ul></li>
</ol>
<p>This ensures every element has an equal chance <span class="math inline">\(\tfrac{k}{n}\)</span> to remain.</p>
</section>
<section id="example-step-by-step-5" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-5">Example (step by step)</h3>
<p>Stream: [A, B, C, D, E]<br>
Goal: <span class="math inline">\(k = 2\)</span></p>
<ol type="1">
<li>Start with the first 2 → [A, B]<br>
</li>
<li><span class="math inline">\(i = 3\)</span>, item = C
<ul>
<li>Pick random <span class="math inline">\(j \in [1, 3]\)</span><br>
</li>
<li>Suppose <span class="math inline">\(j = 2\)</span> → replace B → [A, C]<br>
</li>
</ul></li>
<li><span class="math inline">\(i = 4\)</span>, item = D
<ul>
<li>Pick random <span class="math inline">\(j \in [1, 4]\)</span><br>
</li>
<li>Suppose <span class="math inline">\(j = 4\)</span> → do nothing → [A, C]<br>
</li>
</ul></li>
<li><span class="math inline">\(i = 5\)</span>, item = E
<ul>
<li>Pick random <span class="math inline">\(j \in [1, 5]\)</span><br>
</li>
<li>Suppose <span class="math inline">\(j = 1\)</span> → replace A → [E, C]</li>
</ul></li>
</ol>
<p>Final sample: [E, C]<br>
Each item A–E has equal probability to appear in the final reservoir.</p>
</section>
<section id="mathematical-intuition" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-intuition">Mathematical Intuition</h3>
<p>Each element <span class="math inline">\(x_i\)</span> at position <span class="math inline">\(i\)</span> has probability</p>
<p><span class="math display">\[
P(x_i \text{ in final sample}) = \frac{k}{i} \cdot \prod_{j=i+1}^{n} \left(1 - \frac{1}{j}\right) = \frac{k}{n}
\]</span></p>
<p>Thus, every item is equally likely to be chosen, ensuring perfect uniformity in the final sample.</p>
</section>
<section id="visualization-15" class="level3">
<h3 class="anchored" data-anchor-id="visualization-15">Visualization</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Item</th>
<th>Random <span class="math inline">\(j\)</span></th>
<th>Action</th>
<th>Reservoir</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>A</td>
<td>–</td>
<td>Add</td>
<td>[A]</td>
</tr>
<tr class="even">
<td>2</td>
<td>B</td>
<td>–</td>
<td>Add</td>
<td>[A, B]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>C</td>
<td>2</td>
<td>Replace B</td>
<td>[A, C]</td>
</tr>
<tr class="even">
<td>4</td>
<td>D</td>
<td>4</td>
<td>No Replace</td>
<td>[A, C]</td>
</tr>
<tr class="odd">
<td>5</td>
<td>E</td>
<td>1</td>
<td>Replace A</td>
<td>[E, C]</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-easy-version-8" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-easy-version-8">Tiny Code (Easy Version)</h3>
<p>Python Implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reservoir_sample(stream, k):</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>    reservoir <span class="op">=</span> []</span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(stream, <span class="dv">1</span>):</span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;=</span> k:</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>            reservoir.append(item)</span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> random.randint(<span class="dv">1</span>, i)</span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">&lt;=</span> k:</span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>                reservoir[j <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> item</span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> reservoir</span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a>stream <span class="op">=</span> [<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>]</span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> reservoir_sample(stream, <span class="dv">2</span>)</span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Reservoir sample:"</span>, sample)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output (random):</p>
<pre><code>Reservoir sample: ['E', 'C']</code></pre>
<p>Each run produces a different uniform random sample.</p>
</section>
<section id="why-it-matters-68" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-68">Why It Matters</h3>
<ul>
<li><p>Works on streaming data</p></li>
<li><p>Needs only O(k) memory</p></li>
<li><p>Provides uniform unbiased sampling</p></li>
<li><p>Used in:</p>
<ul>
<li>Big data analytics</li>
<li>Randomized algorithms</li>
<li>Online learning</li>
<li>Network monitoring</li>
</ul></li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-68" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-68">A Gentle Proof (Why It Works)</h3>
<ul>
<li>First <span class="math inline">\(k\)</span> elements: probability <span class="math inline">\(= 1\)</span> to enter the reservoir initially.<br>
</li>
<li>Each new element at index <span class="math inline">\(i\)</span>: probability <span class="math inline">\(\tfrac{k}{i}\)</span> to replace one of the existing items.<br>
</li>
<li>Earlier items may be replaced, but each remains with probability</li>
</ul>
<p><span class="math display">\[
P(\text{survive}) = \prod_{j=i+1}^{n} \left(1 - \frac{1}{j}\right)
\]</span></p>
<p>Multiplying these terms gives the final inclusion probability <span class="math inline">\(\tfrac{k}{n}\)</span>.</p>
<p>Uniformity of selection is guaranteed by induction.</p>
</section>
<section id="try-it-yourself-68" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-68">Try It Yourself</h3>
<ol type="1">
<li>Stream 10 numbers with <span class="math inline">\(k = 3\)</span>.<br>
</li>
<li>Run the algorithm multiple times — all 3-element subsets appear with roughly equal frequency.<br>
</li>
<li>Increase <span class="math inline">\(k\)</span> and observe that the sample becomes more stable, with less variation between runs.</li>
</ol>
</section>
<section id="test-cases-68" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-68">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Stream</th>
<th>k</th>
<th>Sample Size</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1,2,3,4,5]</td>
<td>2</td>
<td>2</td>
<td>Uniform random pairs</td>
</tr>
<tr class="even">
<td>[A,B,C,D]</td>
<td>1</td>
<td>1</td>
<td>Each 25% chance</td>
</tr>
<tr class="odd">
<td>Range(1000)</td>
<td>10</td>
<td>10</td>
<td>Works in one pass</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-68" class="level3">
<h3 class="anchored" data-anchor-id="complexity-68">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td><span class="math inline">\(O(k)\)</span></td>
</tr>
<tr class="even">
<td>Query</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td><span class="math inline">\(O(k)\)</span></td>
</tr>
</tbody>
</table>
<p>Reservoir Sampling, elegantly fair, perfectly simple, and ready for infinite streams.</p>
</section>
<section id="skip-bloom-filter" class="level3">
<h3 class="anchored" data-anchor-id="skip-bloom-filter">270 Skip Bloom Filter</h3>
<p>A Skip Bloom Filter is a probabilistic data structure that extends the Bloom Filter to support range queries, determining whether any element exists within a given interval, not just checking for a single item.</p>
<p>It combines Bloom filters with hierarchical range segmentation, allowing approximate range lookups while keeping space usage compact.</p>
</section>
<section id="what-problem-are-we-solving-69" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-69">What Problem Are We Solving?</h3>
<p>A classic Bloom Filter answers only point queries:</p>
<p><span class="math display">\[
\text{"Is } x \text{ in the set?"}
\]</span></p>
<p>However, many real-world applications require range queries, such as:</p>
<ul>
<li>Databases: “Are there any keys between 10 and 20?”</li>
<li>Time-series: “Were there any events during this time interval?”</li>
<li>Networks: “Is any IP in this subnet?”</li>
</ul>
<p>We need a space-efficient, stream-friendly, and probabilistic structure that can:</p>
<ul>
<li>Handle range membership checks,</li>
<li>Maintain a low false-positive rate,</li>
<li>Scale logarithmically with the universe size.</li>
</ul>
<p>The Skip Bloom Filter solves this by layering Bloom filters over aligned ranges of increasing size.</p>
</section>
<section id="how-it-works-plain-language-34" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-34">How It Works (Plain Language)</h3>
<p>A Skip Bloom Filter maintains multiple Bloom filters, each corresponding to a level that covers intervals (buckets) of sizes <span class="math inline">\(2^0, 2^1, 2^2, \ldots\)</span></p>
<p>Each element is inserted into all Bloom filters representing the ranges that contain it.<br>
When querying a range, the query is decomposed into aligned subranges that correspond to these levels, and each is checked in its respective filter.</p>
<p>Algorithm:</p>
<ol type="1">
<li>Divide the universe into intervals of size <span class="math inline">\(2^\ell\)</span> for each level <span class="math inline">\(\ell\)</span>.<br>
</li>
<li>Each level <span class="math inline">\(\ell\)</span> maintains a Bloom filter representing those buckets.<br>
</li>
<li>To insert a key <span class="math inline">\(x\)</span>: mark all buckets across levels that include <span class="math inline">\(x\)</span>.<br>
</li>
<li>To query a range <span class="math inline">\([a,b]\)</span>: decompose it into a set of disjoint aligned intervals and check the corresponding Bloom filters.</li>
</ol>
</section>
<section id="example-step-by-step-6" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-6">Example (Step by Step)</h3>
<p>Suppose we store keys</p>
<p><span class="math display">\[
S = {3, 7, 14}
\]</span></p>
<p>in a universe ([0, 15]). We build filters at levels with range sizes (1, 2, 4, 8):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Level</th>
<th>Bucket Size</th>
<th>Buckets (Ranges)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1</td>
<td>[0], [1], [2], …, [15]</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>[0–1], [2–3], [4–5], …, [14–15]</td>
</tr>
<tr class="odd">
<td>2</td>
<td>4</td>
<td>[0–3], [4–7], [8–11], [12–15]</td>
</tr>
<tr class="even">
<td>3</td>
<td>8</td>
<td>[0–7], [8–15]</td>
</tr>
</tbody>
</table>
<p>Insert key 3:</p>
<ul>
<li>Level 0: [3]</li>
<li>Level 1: [2–3]</li>
<li>Level 2: [0–3]</li>
<li>Level 3: [0–7]</li>
</ul>
<p>Insert key 7:</p>
<ul>
<li>Level 0: [7]</li>
<li>Level 1: [6–7]</li>
<li>Level 2: [4–7]</li>
<li>Level 3: [0–7]</li>
</ul>
<p>Insert key 14:</p>
<ul>
<li>Level 0: [14]</li>
<li>Level 1: [14–15]</li>
<li>Level 2: [12–15]</li>
<li>Level 3: [8–15]</li>
</ul>
<p>Query range [2, 6]:</p>
<ol type="1">
<li><p>Decompose into aligned intervals: ([2–3], [4–5], [6])</p></li>
<li><p>Check filters:</p>
<ul>
<li>[2–3] → hit</li>
<li>[4–5] → miss</li>
<li>[6] → miss</li>
</ul></li>
</ol>
<p>Result: possibly non-empty, since [2–3] contains 3.</p>
</section>
<section id="visualization-16" class="level3">
<h3 class="anchored" data-anchor-id="visualization-16">Visualization</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Level</th>
<th>Bucket</th>
<th>Contains Key</th>
<th>Bloom Entry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>[3]</td>
<td>Yes</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>[2–3]</td>
<td>Yes</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[0–3]</td>
<td>Yes</td>
<td>1</td>
</tr>
<tr class="even">
<td>3</td>
<td>[0–7]</td>
<td>Yes</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Each key is represented in multiple levels, enabling multi-scale range coverage.</p>
</section>
<section id="tiny-code-simplified-python" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-python">Tiny Code (Simplified Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb226"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math, mmh3</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Bloom:</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, size<span class="op">=</span><span class="dv">64</span>, hash_count<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> size</span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hash_count <span class="op">=</span> hash_count</span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.bits <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> size</span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hashes(<span class="va">self</span>, key):</span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [mmh3.<span class="bu">hash</span>(<span class="bu">str</span>(key), i) <span class="op">%</span> <span class="va">self</span>.size <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.hash_count)]</span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-12"><a href="#cb226-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(<span class="va">self</span>, key):</span>
<span id="cb226-13"><a href="#cb226-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> h <span class="kw">in</span> <span class="va">self</span>._hashes(key):</span>
<span id="cb226-14"><a href="#cb226-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.bits[h] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb226-15"><a href="#cb226-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-16"><a href="#cb226-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> query(<span class="va">self</span>, key):</span>
<span id="cb226-17"><a href="#cb226-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">all</span>(<span class="va">self</span>.bits[h] <span class="cf">for</span> h <span class="kw">in</span> <span class="va">self</span>._hashes(key))</span>
<span id="cb226-18"><a href="#cb226-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-19"><a href="#cb226-19" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SkipBloom:</span>
<span id="cb226-20"><a href="#cb226-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, levels<span class="op">=</span><span class="dv">4</span>, size<span class="op">=</span><span class="dv">64</span>, hash_count<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb226-21"><a href="#cb226-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.levels <span class="op">=</span> [Bloom(size, hash_count) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(levels)]</span>
<span id="cb226-22"><a href="#cb226-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-23"><a href="#cb226-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(<span class="va">self</span>, key):</span>
<span id="cb226-24"><a href="#cb226-24" aria-hidden="true" tabindex="-1"></a>        level <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb226-25"><a href="#cb226-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> level) <span class="op">&lt;=</span> key:</span>
<span id="cb226-26"><a href="#cb226-26" aria-hidden="true" tabindex="-1"></a>            bucket <span class="op">=</span> key <span class="op">//</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> level)</span>
<span id="cb226-27"><a href="#cb226-27" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.levels[level].add(bucket)</span>
<span id="cb226-28"><a href="#cb226-28" aria-hidden="true" tabindex="-1"></a>            level <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb226-29"><a href="#cb226-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-30"><a href="#cb226-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> query_range(<span class="va">self</span>, start, end):</span>
<span id="cb226-31"><a href="#cb226-31" aria-hidden="true" tabindex="-1"></a>        l <span class="op">=</span> <span class="bu">int</span>(math.log2(end <span class="op">-</span> start <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb226-32"><a href="#cb226-32" aria-hidden="true" tabindex="-1"></a>        bucket <span class="op">=</span> start <span class="op">//</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> l)</span>
<span id="cb226-33"><a href="#cb226-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.levels[l].query(bucket)</span>
<span id="cb226-34"><a href="#cb226-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-35"><a href="#cb226-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb226-36"><a href="#cb226-36" aria-hidden="true" tabindex="-1"></a>sb <span class="op">=</span> SkipBloom(levels<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb226-37"><a href="#cb226-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">14</span>]:</span>
<span id="cb226-38"><a href="#cb226-38" aria-hidden="true" tabindex="-1"></a>    sb.add(x)</span>
<span id="cb226-39"><a href="#cb226-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-40"><a href="#cb226-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Query [2,6]:"</span>, sb.query_range(<span class="dv">2</span>,<span class="dv">6</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Query [2,6]: True</code></pre>
</section>
<section id="why-it-matters-69" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-69">Why It Matters</h3>
<ul>
<li><p>Enables range queries in probabilistic manner</p></li>
<li><p>Compact and hierarchical</p></li>
<li><p>No false negatives (for properly configured filters)</p></li>
<li><p>Widely applicable in:</p>
<ul>
<li>Approximate database indexing</li>
<li>Network prefix search</li>
<li>Time-series event detection</li>
</ul></li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-69" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-69">A Gentle Proof (Why It Works)</h3>
<p>Each inserted key participates in <span class="math inline">\(O(\log U)\)</span> Bloom filters, one per level.<br>
A range query <span class="math inline">\([a,b]\)</span> is decomposed into <span class="math inline">\(O(\log U)\)</span> aligned subranges.</p>
<p>A Bloom filter with <span class="math inline">\(m\)</span> bits, <span class="math inline">\(k\)</span> hash functions, and <span class="math inline">\(n\)</span> inserted elements has false positive probability:</p>
<p><span class="math display">\[
p = \left(1 - e^{-kn/m}\right)^k
\]</span></p>
<p>For a Skip Bloom Filter, the total false positive rate is bounded by:</p>
<p><span class="math display">\[
P_{fp} \le O(\log U) \cdot p
\]</span></p>
<p>Each level guarantees no false negatives, since every range containing an element is marked.<br>
Thus, correctness is ensured, and only overestimation (false positives) can occur.</p>
<p>Space complexity<br>
Each level has <span class="math inline">\(m\)</span> bits, and there are <span class="math inline">\(\log U\)</span> levels:</p>
<p><span class="math display">\[
\text{Total space} = O(m \log U)
\]</span></p>
<p>Time complexity<br>
Each query checks <span class="math inline">\(O(\log U)\)</span> buckets, each requiring <span class="math inline">\(O(k)\)</span> time:</p>
<p><span class="math display">\[
T_{\text{query}} = O(k \log U)
\]</span></p>
</section>
<section id="try-it-yourself-69" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-69">Try It Yourself</h3>
<ol type="1">
<li>Insert keys <span class="math inline">\(\{3, 7, 14\}\)</span><br>
</li>
<li>Query ranges <span class="math inline">\([2,6]\)</span>, <span class="math inline">\([8,12]\)</span>, <span class="math inline">\([0,15]\)</span><br>
</li>
<li>Compare true contents with the results<br>
</li>
<li>Adjust parameters <span class="math inline">\(m\)</span>, <span class="math inline">\(k\)</span>, or the number of levels, and observe how the false positive rate changes</li>
</ol>
</section>
<section id="test-cases-69" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-69">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Query Range</th>
<th>Result</th>
<th>True Contents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[2,6]</td>
<td>True</td>
<td>{3}</td>
</tr>
<tr class="even">
<td>[8,12]</td>
<td>False</td>
<td>∅</td>
</tr>
<tr class="odd">
<td>[12,15]</td>
<td>True</td>
<td>{14}</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-69" class="level3">
<h3 class="anchored" data-anchor-id="complexity-69">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td><span class="math inline">\(O(\log U)\)</span></td>
<td><span class="math inline">\(O(m \log U)\)</span></td>
</tr>
<tr class="even">
<td>Query</td>
<td><span class="math inline">\(O(\log U)\)</span></td>
<td><span class="math inline">\(O(m \log U)\)</span></td>
</tr>
</tbody>
</table>
<p>A Skip Bloom Filter is a range-aware extension of standard Bloom filters.<br>
By combining hierarchical decomposition with standard hashing, it enables fast, memory-efficient, and approximate range queries across very large universes.</p>
</section>
</section>
<section id="section-28.-skip-lists-and-b-trees" class="level1">
<h1>Section 28. Skip Lists and B-Trees</h1>
<section id="skip-list-insert" class="level3">
<h3 class="anchored" data-anchor-id="skip-list-insert">271 Skip List Insert</h3>
<p>Skip Lists are probabilistic alternatives to balanced trees. They maintain multiple levels of sorted linked lists, where each level skips over more elements than the one below it. Insertion relies on randomization to achieve expected O(log n) search and update times, without strict rebalancing like AVL or Red-Black trees.</p>
</section>
<section id="what-problem-are-we-solving-70" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-70">What Problem Are We Solving?</h3>
<p>We want to store elements in sorted order and support:</p>
<ul>
<li>Fast search, insert, and delete operations.</li>
<li>Simple structure and easy implementation.</li>
<li>Expected logarithmic performance without complex rotations.</li>
</ul>
<p>Balanced BSTs achieve <span class="math inline">\(O(\log n)\)</span> time but require intricate rotations. Skip Lists solve this with <em>randomized promotion</em>: each inserted node is promoted to higher levels with decreasing probability, forming a tower.</p>
</section>
<section id="how-it-works-plain-language-35" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-35">How It Works (Plain Language)</h3>
<p>Skip list insertion for value <span class="math inline">\(x\)</span></p>
<p>Steps 1. Start at the top level. 2. While the next node’s key &lt; <span class="math inline">\(x\)</span>, move right. 3. If you cannot move right, drop down one level. 4. Repeat until you reach level 0. 5. Insert the new node at its sorted position on level 0. 6. Randomly choose the node height <span class="math inline">\(h\)</span> (for example, flip a fair coin per level until tails, so <span class="math inline">\(P(h \ge t) = 2^{-t}\)</span>). 7. For each level <span class="math inline">\(1 \dots h\)</span>, link the new node into that level by repeating the right-then-drop search with the update pointers saved from the descent.</p>
<p>Notes - Duplicate handling is policy dependent. Often you skip insertion if a node with key <span class="math inline">\(x\)</span> already exists. - Typical height is <span class="math inline">\(O(\log n)\)</span>, expected search and insert time is <span class="math inline">\(O(\log n)\)</span>, space is <span class="math inline">\(O(n)\)</span>.</p>
</section>
<section id="example-step-by-step-7" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-7">Example Step by Step</h3>
<p>Let’s insert <span class="math inline">\(x = 17\)</span> into a skip list that currently contains: [ 5, 10, 15, 20, 25 ]</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 38%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th>Level</th>
<th>Nodes (before insertion)</th>
<th>Path Taken</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>5 → 15 → 25</td>
<td>Move from 5 to 15, then down</td>
</tr>
<tr class="even">
<td>2</td>
<td>5 → 10 → 15 → 25</td>
<td>Move from 5 to 10 to 15, then down</td>
</tr>
<tr class="odd">
<td>1</td>
<td>5 → 10 → 15 → 20 → 25</td>
<td>Move from 15 to 20, then down</td>
</tr>
<tr class="even">
<td>0</td>
<td>5 → 10 → 15 → 20 → 25</td>
<td>Insert after 15</td>
</tr>
</tbody>
</table>
<p>Suppose the random level for 17 is 2. We insert 17 at level 0 and level 1.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Level</th>
<th>Nodes (after insertion)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>5 → 15 → 25</td>
</tr>
<tr class="even">
<td>2</td>
<td>5 → 10 → 15 → 25</td>
</tr>
<tr class="odd">
<td>1</td>
<td>5 → 10 → 15 → 17 → 20 → 25</td>
</tr>
<tr class="even">
<td>0</td>
<td>5 → 10 → 15 → 17 → 20 → 25</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-simplified-python-1" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-python-1">Tiny Code (Simplified Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key, level):</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.forward <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> (level <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SkipList:</span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, max_level<span class="op">=</span><span class="dv">4</span>, p<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_level <span class="op">=</span> max_level</span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.p <span class="op">=</span> p</span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.header <span class="op">=</span> Node(<span class="op">-</span><span class="dv">1</span>, max_level)</span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.level <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> random_level(<span class="va">self</span>):</span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a>        lvl <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> random.random() <span class="op">&lt;</span> <span class="va">self</span>.p <span class="kw">and</span> lvl <span class="op">&lt;</span> <span class="va">self</span>.max_level:</span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a>            lvl <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb228-19"><a href="#cb228-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> lvl</span>
<span id="cb228-20"><a href="#cb228-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-21"><a href="#cb228-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key):</span>
<span id="cb228-22"><a href="#cb228-22" aria-hidden="true" tabindex="-1"></a>        update <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> (<span class="va">self</span>.max_level <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb228-23"><a href="#cb228-23" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> <span class="va">self</span>.header</span>
<span id="cb228-24"><a href="#cb228-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-25"><a href="#cb228-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Move right and down</span></span>
<span id="cb228-26"><a href="#cb228-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">reversed</span>(<span class="bu">range</span>(<span class="va">self</span>.level <span class="op">+</span> <span class="dv">1</span>)):</span>
<span id="cb228-27"><a href="#cb228-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> current.forward[i] <span class="kw">and</span> current.forward[i].key <span class="op">&lt;</span> key:</span>
<span id="cb228-28"><a href="#cb228-28" aria-hidden="true" tabindex="-1"></a>                current <span class="op">=</span> current.forward[i]</span>
<span id="cb228-29"><a href="#cb228-29" aria-hidden="true" tabindex="-1"></a>            update[i] <span class="op">=</span> current</span>
<span id="cb228-30"><a href="#cb228-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-31"><a href="#cb228-31" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> current.forward[<span class="dv">0</span>]</span>
<span id="cb228-32"><a href="#cb228-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> current.key <span class="op">!=</span> key:</span>
<span id="cb228-33"><a href="#cb228-33" aria-hidden="true" tabindex="-1"></a>            lvl <span class="op">=</span> <span class="va">self</span>.random_level()</span>
<span id="cb228-34"><a href="#cb228-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> lvl <span class="op">&gt;</span> <span class="va">self</span>.level:</span>
<span id="cb228-35"><a href="#cb228-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.level <span class="op">+</span> <span class="dv">1</span>, lvl <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb228-36"><a href="#cb228-36" aria-hidden="true" tabindex="-1"></a>                    update[i] <span class="op">=</span> <span class="va">self</span>.header</span>
<span id="cb228-37"><a href="#cb228-37" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.level <span class="op">=</span> lvl</span>
<span id="cb228-38"><a href="#cb228-38" aria-hidden="true" tabindex="-1"></a>            new_node <span class="op">=</span> Node(key, lvl)</span>
<span id="cb228-39"><a href="#cb228-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(lvl <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb228-40"><a href="#cb228-40" aria-hidden="true" tabindex="-1"></a>                new_node.forward[i] <span class="op">=</span> update[i].forward[i]</span>
<span id="cb228-41"><a href="#cb228-41" aria-hidden="true" tabindex="-1"></a>                update[i].forward[i] <span class="op">=</span> new_node</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-70" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-70">Why It Matters</h3>
<ul>
<li>Expected <span class="math inline">\(O(\log n)\)</span> time for search, insert, and delete<br>
</li>
<li>Simpler than AVL or Red-Black Trees<br>
</li>
<li>Probabilistic balancing avoids rigid rotations<br>
</li>
<li>Commonly used in databases and key-value stores such as LevelDB and Redis</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-70" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-70">A Gentle Proof (Why It Works)</h3>
<p>Each node appears in level <span class="math inline">\(i\)</span> with probability <span class="math inline">\(p^i\)</span>.<br>
The expected number of nodes per level is <span class="math inline">\(n p^i\)</span>.<br>
The total number of levels is <span class="math inline">\(O(\log_{1/p} n)\)</span>.</p>
<p>Expected search path length:</p>
<p><span class="math display">\[
E[\text{steps}] = \frac{1}{1 - p} \log_{1/p} n = O(\log n)
\]</span></p>
<p>Expected space usage:</p>
<p><span class="math display">\[
O(n) \text{ nodes} \times O\!\left(\frac{1}{1 - p}\right) \text{ pointers per node}
\]</span></p>
<p>Thus, Skip Lists achieve expected logarithmic performance and linear space.</p>
</section>
<section id="try-it-yourself-70" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-70">Try It Yourself</h3>
<ol type="1">
<li>Build a Skip List and insert <span class="math inline">\(\{5, 10, 15, 20, 25\}\)</span>.<br>
</li>
<li>Insert <span class="math inline">\(17\)</span> and trace which pointers are updated at each level.<br>
</li>
<li>Experiment with <span class="math inline">\(p = 0.25, 0.5, 0.75\)</span>.<br>
</li>
<li>Observe how random heights influence the overall balance.</li>
</ol>
</section>
<section id="test-cases-70" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-70">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Expected Structure (Level 0)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>10</td>
<td>10</td>
</tr>
<tr class="even">
<td>Insert</td>
<td>5</td>
<td>5 → 10</td>
</tr>
<tr class="odd">
<td>Insert</td>
<td>15</td>
<td>5 → 10 → 15</td>
</tr>
<tr class="even">
<td>Insert</td>
<td>17</td>
<td>5 → 10 → 15 → 17</td>
</tr>
<tr class="odd">
<td>Search</td>
<td>15</td>
<td>Found</td>
</tr>
<tr class="even">
<td>Search</td>
<td>12</td>
<td>Not Found</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-70" class="level3">
<h3 class="anchored" data-anchor-id="complexity-70">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time (Expected)</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="even">
<td>Insert</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="odd">
<td>Delete</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
</tbody>
</table>
<p>A Skip List is a simple yet powerful data structure. With randomness as its balancing force, it achieves the elegance of trees and the flexibility of linked lists.</p>
</section>
<section id="skip-list-delete" class="level3">
<h3 class="anchored" data-anchor-id="skip-list-delete">272 Skip List Delete</h3>
<p>Deletion in a Skip List mirrors insertion: we traverse levels from top to bottom, keep track of predecessor nodes at each level, and unlink the target node across all levels it appears in. The structure maintains probabilistic balance, so no rebalancing is needed, deletion is expected <span class="math inline">\(O(\log n)\)</span>.</p>
</section>
<section id="what-problem-are-we-solving-71" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-71">What Problem Are We Solving?</h3>
<p>We want to remove an element efficiently from a sorted, probabilistically balanced structure. Naive linked lists require <span class="math inline">\(O(n)\)</span> traversal; balanced BSTs need complex rotations. A Skip List gives us a middle ground, simple pointer updates with expected logarithmic time.</p>
</section>
<section id="how-it-works-plain-language-36" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-36">How It Works (Plain Language)</h3>
<p>Each node in a skip list can appear at multiple levels. To delete a key <span class="math inline">\(x\)</span>:</p>
<ol type="1">
<li>Start from the top level.</li>
<li>Move right while next node’s key &lt; <span class="math inline">\(x\)</span>.</li>
<li>If next node’s key == <span class="math inline">\(x\)</span>, record current node in an <code>update</code> array.</li>
<li>Drop one level down and repeat.</li>
<li>Once you reach the bottom, remove all forward references to the node from the <code>update</code> array.</li>
<li>If the topmost level becomes empty, reduce list level.</li>
</ol>
</section>
<section id="example-step-by-step-8" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-8">Example Step by Step</h3>
<p>Delete <span class="math inline">\(x = 17\)</span> from this skip list:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Level</th>
<th>Nodes (Before)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>5 → 15 → 25</td>
</tr>
<tr class="even">
<td>2</td>
<td>5 → 10 → 15 → 25</td>
</tr>
<tr class="odd">
<td>1</td>
<td>5 → 10 → 15 → 17 → 20 → 25</td>
</tr>
<tr class="even">
<td>0</td>
<td>5 → 10 → 15 → 17 → 20 → 25</td>
</tr>
</tbody>
</table>
<p>Traversal:</p>
<ul>
<li>Start at Level 3: 15 &lt; 17 → move right → 25 &gt; 17 → drop down</li>
<li>Level 2: 15 &lt; 17 → move right → 25 &gt; 17 → drop down</li>
<li>Level 1: 15 &lt; 17 → move right → 17 found → record predecessor</li>
<li>Level 0: 15 &lt; 17 → move right → 17 found → record predecessor</li>
</ul>
<p>Remove all forward pointers to 17 from recorded nodes.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Level</th>
<th>Nodes (After)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>5 → 15 → 25</td>
</tr>
<tr class="even">
<td>2</td>
<td>5 → 10 → 15 → 25</td>
</tr>
<tr class="odd">
<td>1</td>
<td>5 → 10 → 15 → 20 → 25</td>
</tr>
<tr class="even">
<td>0</td>
<td>5 → 10 → 15 → 20 → 25</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-simplified-python-2" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-python-2">Tiny Code (Simplified Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb229"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key, level):</span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.forward <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> (level <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SkipList:</span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, max_level<span class="op">=</span><span class="dv">4</span>, p<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_level <span class="op">=</span> max_level</span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.p <span class="op">=</span> p</span>
<span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.header <span class="op">=</span> Node(<span class="op">-</span><span class="dv">1</span>, max_level)</span>
<span id="cb229-13"><a href="#cb229-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.level <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb229-14"><a href="#cb229-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-15"><a href="#cb229-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete(<span class="va">self</span>, key):</span>
<span id="cb229-16"><a href="#cb229-16" aria-hidden="true" tabindex="-1"></a>        update <span class="op">=</span> [<span class="va">None</span>] <span class="op">*</span> (<span class="va">self</span>.max_level <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb229-17"><a href="#cb229-17" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> <span class="va">self</span>.header</span>
<span id="cb229-18"><a href="#cb229-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-19"><a href="#cb229-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Traverse from top to bottom</span></span>
<span id="cb229-20"><a href="#cb229-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">reversed</span>(<span class="bu">range</span>(<span class="va">self</span>.level <span class="op">+</span> <span class="dv">1</span>)):</span>
<span id="cb229-21"><a href="#cb229-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> current.forward[i] <span class="kw">and</span> current.forward[i].key <span class="op">&lt;</span> key:</span>
<span id="cb229-22"><a href="#cb229-22" aria-hidden="true" tabindex="-1"></a>                current <span class="op">=</span> current.forward[i]</span>
<span id="cb229-23"><a href="#cb229-23" aria-hidden="true" tabindex="-1"></a>            update[i] <span class="op">=</span> current</span>
<span id="cb229-24"><a href="#cb229-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-25"><a href="#cb229-25" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> current.forward[<span class="dv">0</span>]</span>
<span id="cb229-26"><a href="#cb229-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-27"><a href="#cb229-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Found the node</span></span>
<span id="cb229-28"><a href="#cb229-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current <span class="kw">and</span> current.key <span class="op">==</span> key:</span>
<span id="cb229-29"><a href="#cb229-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.level <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb229-30"><a href="#cb229-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> update[i].forward[i] <span class="op">!=</span> current:</span>
<span id="cb229-31"><a href="#cb229-31" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb229-32"><a href="#cb229-32" aria-hidden="true" tabindex="-1"></a>                update[i].forward[i] <span class="op">=</span> current.forward[i]</span>
<span id="cb229-33"><a href="#cb229-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Reduce level if highest level empty</span></span>
<span id="cb229-34"><a href="#cb229-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">self</span>.level <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.header.forward[<span class="va">self</span>.level] <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb229-35"><a href="#cb229-35" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.level <span class="op">-=</span> <span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-71" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-71">Why It Matters</h3>
<ul>
<li>Symmetric to insertion</li>
<li>No rotations or rebalancing</li>
<li>Expected <span class="math inline">\(O(\log n)\)</span> performance</li>
<li>Perfect for ordered maps, databases, key-value stores</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-71" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-71">A Gentle Proof (Why It Works)</h3>
<p>Each level contains a fraction <span class="math inline">\(p^i\)</span> of nodes. The expected number of levels traversed is <span class="math inline">\(O(\log_{1/p} n)\)</span>. At each level, we move horizontally <span class="math inline">\(O(1)\)</span> on average.</p>
<p>So expected cost:</p>
<p><span class="math display">\[
E[T_{\text{delete}}] = O(\log n)
\]</span></p>
</section>
<section id="try-it-yourself-71" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-71">Try It Yourself</h3>
<ol type="1">
<li>Insert <span class="math inline">\({5, 10, 15, 17, 20, 25}\)</span>.</li>
<li>Delete <span class="math inline">\(17\)</span>.</li>
<li>Trace all pointer changes level by level.</li>
<li>Compare with AVL tree deletion complexity.</li>
</ol>
</section>
<section id="test-cases-71" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-71">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Expected Level 0 Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td>5,10,15,17,20</td>
<td>5 → 10 → 15 → 17 → 20</td>
</tr>
<tr class="even">
<td>Delete</td>
<td>17</td>
<td>5 → 10 → 15 → 20</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td>10</td>
<td>5 → 15 → 20</td>
</tr>
<tr class="even">
<td>Delete</td>
<td>5</td>
<td>15 → 20</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-71" class="level3">
<h3 class="anchored" data-anchor-id="complexity-71">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time (Expected)</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="even">
<td>Insert</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="odd">
<td>Delete</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
</tbody>
</table>
<p>Skip List Deletion keeps elegance through simplicity, a clean pointer adjustment instead of tree surgery.</p>
</section>
<section id="skip-list-search" class="level3">
<h3 class="anchored" data-anchor-id="skip-list-search">273 Skip List Search</h3>
<p>Searching in a Skip List is a dance across levels, we move right until we can’t, then down, repeating until we either find the key or conclude it doesn’t exist. Thanks to the randomized level structure, the expected time complexity is <span class="math inline">\(O(\log n)\)</span>, just like balanced BSTs but with simpler pointer logic.</p>
</section>
<section id="what-problem-are-we-solving-72" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-72">What Problem Are We Solving?</h3>
<p>We need a fast search in a sorted collection that adapts gracefully to dynamic insertions and deletions. Balanced trees guarantee <span class="math inline">\(O(\log n)\)</span> search but need rotations. Skip Lists achieve the same expected time using randomization instead of strict balancing rules.</p>
</section>
<section id="how-it-works-plain-language-37" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-37">How It Works (Plain Language)</h3>
<p>A skip list has multiple levels of linked lists. Each level acts as a fast lane, skipping over multiple nodes. To search for a key <span class="math inline">\(x\)</span>:</p>
<ol type="1">
<li>Start at the top-left header node.</li>
<li>At each level, move right while <code>next.key &lt; x</code>.</li>
<li>When <code>next.key ≥ x</code>, drop down one level.</li>
<li>Repeat until level 0.</li>
<li>If <code>current.forward[0].key == x</code>, found; else, not found.</li>
</ol>
<p>The search path “zigzags” through levels, visiting roughly <span class="math inline">\(\log n\)</span> nodes on average.</p>
</section>
<section id="example-step-by-step-9" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-9">Example Step by Step</h3>
<p>Search for <span class="math inline">\(x = 17\)</span> in the following skip list:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Level</th>
<th>Nodes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>5 → 15 → 25</td>
</tr>
<tr class="even">
<td>2</td>
<td>5 → 10 → 15 → 25</td>
</tr>
<tr class="odd">
<td>1</td>
<td>5 → 10 → 15 → 17 → 20 → 25</td>
</tr>
<tr class="even">
<td>0</td>
<td>5 → 10 → 15 → 17 → 20 → 25</td>
</tr>
</tbody>
</table>
<p>Traversal:</p>
<ul>
<li>Level 3: 5 → 15 → (next = 25 &gt; 17) → drop down</li>
<li>Level 2: 15 → (next = 25 &gt; 17) → drop down</li>
<li>Level 1: 15 → 17 found → success</li>
<li>Level 0: confirm 17 exists</li>
</ul>
<p>Path: 5 → 15 → (down) → 15 → (down) → 15 → 17</p>
</section>
<section id="visualization-17" class="level3">
<h3 class="anchored" data-anchor-id="visualization-17">Visualization</h3>
<p>Skip list search follows a staircase pattern:</p>
<pre><code>Level 3:  5 --------&gt; 15 -----↓
Level 2:  5 ----&gt; 10 --&gt; 15 --↓
Level 1:  5 -&gt; 10 -&gt; 15 -&gt; 17 -&gt; 20
Level 0:  5 -&gt; 10 -&gt; 15 -&gt; 17 -&gt; 20</code></pre>
<p>Each “↓” means dropping a level when the next node is too large.</p>
</section>
<section id="tiny-code-simplified-python-3" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-python-3">Tiny Code (Simplified Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SkipList:</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, max_level<span class="op">=</span><span class="dv">4</span>, p<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_level <span class="op">=</span> max_level</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.p <span class="op">=</span> p</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.header <span class="op">=</span> Node(<span class="op">-</span><span class="dv">1</span>, max_level)</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.level <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, key):</span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> <span class="va">self</span>.header</span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Traverse top-down</span></span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">reversed</span>(<span class="bu">range</span>(<span class="va">self</span>.level <span class="op">+</span> <span class="dv">1</span>)):</span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> current.forward[i] <span class="kw">and</span> current.forward[i].key <span class="op">&lt;</span> key:</span>
<span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a>                current <span class="op">=</span> current.forward[i]</span>
<span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> current.forward[<span class="dv">0</span>]</span>
<span id="cb231-15"><a href="#cb231-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> current <span class="kw">and</span> current.key <span class="op">==</span> key</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-72" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-72">Why It Matters</h3>
<ul>
<li>Simple and efficient: expected <span class="math inline">\(O(\log n)\)</span> time</li>
<li>Probabilistic balance: avoids tree rotations</li>
<li>Foundation for ordered maps, indexes, and databases</li>
<li>Search path length is logarithmic on average</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-72" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-72">A Gentle Proof (Why It Works)</h3>
<p>Each level contains approximately a fraction <span class="math inline">\(p\)</span> of the nodes from the level below. Expected number of levels: <span class="math inline">\(O(\log_{1/p} n)\)</span>.</p>
<p>At each level, expected number of horizontal moves: <span class="math inline">\(O(1)\)</span>.</p>
<p>So total expected search time:</p>
<p><span class="math display">\[
E[T_{\text{search}}] = O(\log n)
\]</span></p>
</section>
<section id="try-it-yourself-72" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-72">Try It Yourself</h3>
<ol type="1">
<li>Build a skip list with <span class="math inline">\({5, 10, 15, 17, 20, 25}\)</span>.</li>
<li>Search for <span class="math inline">\(17\)</span> and trace the path at each level.</li>
<li>Search for <span class="math inline">\(13\)</span>, where do you stop?</li>
<li>Compare path length with a binary search tree of same size.</li>
</ol>
</section>
<section id="test-cases-72" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-72">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Expected Output</th>
<th>Path</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td>17</td>
<td>Found</td>
<td>5 → 15 → 17</td>
</tr>
<tr class="even">
<td>Search</td>
<td>10</td>
<td>Found</td>
<td>5 → 10</td>
</tr>
<tr class="odd">
<td>Search</td>
<td>13</td>
<td>Not Found</td>
<td>5 → 10 → 15</td>
</tr>
<tr class="even">
<td>Search</td>
<td>5</td>
<td>Found</td>
<td>5</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-72" class="level3">
<h3 class="anchored" data-anchor-id="complexity-72">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time (Expected)</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="even">
<td>Insert</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="odd">
<td>Delete</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
</tbody>
</table>
<p>Skip List Search shows how probabilistic structure yields deterministic-like efficiency, walking a staircase of randomness toward certainty.</p>
</section>
<section id="b-tree-insert" class="level3">
<h3 class="anchored" data-anchor-id="b-tree-insert">274 B-Tree Insert</h3>
<p>A B-Tree is a balanced search tree designed for external memory systems such as disks or SSDs. Unlike binary trees, each node can store multiple keys and multiple children, minimizing disk I/O by packing more data into a single node. Insertion into a B-Tree preserves sorted order and balance by splitting full nodes as needed.</p>
</section>
<section id="what-problem-are-we-solving-73" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-73">What Problem Are We Solving?</h3>
<p>When data is too large to fit in memory, standard binary trees perform poorly because each node access may trigger a disk read. We need a structure that:</p>
<ul>
<li>Reduces the number of I/O operations</li>
<li>Keeps height small</li>
<li>Maintains keys in sorted order</li>
<li>Supports search, insert, and delete in <span class="math inline">\(O(\log n)\)</span></li>
</ul>
<p>B-Trees solve this by storing many keys per node and balancing themselves through controlled splits.</p>
</section>
<section id="how-it-works-plain-language-38" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-38">How It Works (Plain Language)</h3>
<p>Each B-Tree node can contain up to <span class="math inline">\(2t - 1\)</span> keys and <span class="math inline">\(2t\)</span> children, where <span class="math inline">\(t\)</span> is the minimum degree.</p>
<p>Insertion steps:</p>
<ol type="1">
<li>Start at root and traverse down like in binary search.</li>
<li>If a child node is full (2t − 1 keys), split it before descending.</li>
<li>Insert the new key into the appropriate non-full node.</li>
</ol>
<p>Splitting a full node:</p>
<ul>
<li>Middle key moves up to parent</li>
<li>Left and right halves become separate child nodes</li>
</ul>
<p>This ensures every node stays within allowed size bounds, keeping height <span class="math inline">\(O(\log_t n)\)</span>.</p>
</section>
<section id="example-step-by-step-10" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-10">Example Step by Step</h3>
<p>Let <span class="math inline">\(t = 2\)</span> (max 3 keys per node). Insert keys in order: <span class="math inline">\([10, 20, 5, 6, 12, 30, 7, 17]\)</span></p>
<p>Step 1: Insert 10 → Root = [10] Step 2: Insert 20 → [10, 20] Step 3: Insert 5 → [5, 10, 20] Step 4: Insert 6 → Node full → Split</p>
<p>Split [5, 6, 10, 20]:</p>
<ul>
<li>Middle key 10 moves up</li>
<li>Left child [5, 6], right child [20] Tree:</li>
</ul>
<pre><code>      [10]
     /    \
 [5, 6]   [20]</code></pre>
<p>Step 5: Insert 12 → go right → [12, 20] Step 6: Insert 30 → [12, 20, 30] Step 7: Insert 7 → go left → [5, 6, 7] → full → split</p>
<ul>
<li>Middle 6 moves up</li>
</ul>
<p>Tree now:</p>
<pre><code>        [6, 10]
       /   |    \
 [5]  [7]  [12, 20, 30]</code></pre>
<p>Step 8: Insert 17 → go to [12, 20, 30] → insert [12, 17, 20, 30] → split</p>
<ul>
<li>Middle 20 moves up</li>
</ul>
<p>Final tree:</p>
<pre><code>          [6, 10, 20]
         /   |   |   \
       [5] [7] [12,17] [30]</code></pre>
</section>
<section id="visualization-18" class="level3">
<h3 class="anchored" data-anchor-id="visualization-18">Visualization</h3>
<p>B-Tree maintains sorted keys at each level and guarantees minimal height by splitting nodes during insertion.</p>
<pre><code>Root: [6, 10, 20]
Children: [5], [7], [12, 17], [30]</code></pre>
</section>
<section id="tiny-code-simplified-python-4" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-python-4">Tiny Code (Simplified Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BTreeNode:</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, t, leaf<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.keys <span class="op">=</span> []</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.children <span class="op">=</span> []</span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.leaf <span class="op">=</span> leaf</span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t <span class="op">=</span> t</span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert_non_full(<span class="va">self</span>, key):</span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.keys) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.leaf:</span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.keys.append(key)</span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.keys.sort()</span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> i <span class="op">&gt;=</span> <span class="dv">0</span> <span class="kw">and</span> key <span class="op">&lt;</span> <span class="va">self</span>.keys[i]:</span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a>                i <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.children[i].keys) <span class="op">==</span> <span class="dv">2</span> <span class="op">*</span> <span class="va">self</span>.t <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.split_child(i)</span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> key <span class="op">&gt;</span> <span class="va">self</span>.keys[i]:</span>
<span id="cb236-20"><a href="#cb236-20" aria-hidden="true" tabindex="-1"></a>                    i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb236-21"><a href="#cb236-21" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.children[i].insert_non_full(key)</span>
<span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> split_child(<span class="va">self</span>, i):</span>
<span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="va">self</span>.t</span>
<span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> <span class="va">self</span>.children[i]</span>
<span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> BTreeNode(t, y.leaf)</span>
<span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a>        mid <span class="op">=</span> y.keys[t <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a>        z.keys <span class="op">=</span> y.keys[t:]</span>
<span id="cb236-29"><a href="#cb236-29" aria-hidden="true" tabindex="-1"></a>        y.keys <span class="op">=</span> y.keys[:t <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb236-30"><a href="#cb236-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> y.leaf:</span>
<span id="cb236-31"><a href="#cb236-31" aria-hidden="true" tabindex="-1"></a>            z.children <span class="op">=</span> y.children[t:]</span>
<span id="cb236-32"><a href="#cb236-32" aria-hidden="true" tabindex="-1"></a>            y.children <span class="op">=</span> y.children[:t]</span>
<span id="cb236-33"><a href="#cb236-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.children.insert(i <span class="op">+</span> <span class="dv">1</span>, z)</span>
<span id="cb236-34"><a href="#cb236-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.keys.insert(i, mid)</span>
<span id="cb236-35"><a href="#cb236-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-36"><a href="#cb236-36" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BTree:</span>
<span id="cb236-37"><a href="#cb236-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, t):</span>
<span id="cb236-38"><a href="#cb236-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.root <span class="op">=</span> BTreeNode(t, <span class="va">True</span>)</span>
<span id="cb236-39"><a href="#cb236-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t <span class="op">=</span> t</span>
<span id="cb236-40"><a href="#cb236-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-41"><a href="#cb236-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key):</span>
<span id="cb236-42"><a href="#cb236-42" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> <span class="va">self</span>.root</span>
<span id="cb236-43"><a href="#cb236-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(r.keys) <span class="op">==</span> <span class="dv">2</span> <span class="op">*</span> <span class="va">self</span>.t <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb236-44"><a href="#cb236-44" aria-hidden="true" tabindex="-1"></a>            s <span class="op">=</span> BTreeNode(<span class="va">self</span>.t)</span>
<span id="cb236-45"><a href="#cb236-45" aria-hidden="true" tabindex="-1"></a>            s.children.insert(<span class="dv">0</span>, r)</span>
<span id="cb236-46"><a href="#cb236-46" aria-hidden="true" tabindex="-1"></a>            s.split_child(<span class="dv">0</span>)</span>
<span id="cb236-47"><a href="#cb236-47" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb236-48"><a href="#cb236-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> key <span class="op">&gt;</span> s.keys[<span class="dv">0</span>]:</span>
<span id="cb236-49"><a href="#cb236-49" aria-hidden="true" tabindex="-1"></a>                i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb236-50"><a href="#cb236-50" aria-hidden="true" tabindex="-1"></a>            s.children[i].insert_non_full(key)</span>
<span id="cb236-51"><a href="#cb236-51" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.root <span class="op">=</span> s</span>
<span id="cb236-52"><a href="#cb236-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb236-53"><a href="#cb236-53" aria-hidden="true" tabindex="-1"></a>            r.insert_non_full(key)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-73" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-73">Why It Matters</h3>
<ul>
<li>Disk-friendly: each node fits into one page</li>
<li>Shallow height: <span class="math inline">\(O(\log_t n)\)</span> levels → few disk reads</li>
<li>Deterministic balance: no randomness, always balanced</li>
<li>Foundation of file systems, databases, indexes (e.g., NTFS, MySQL, PostgreSQL)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-73" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-73">A Gentle Proof (Why It Works)</h3>
<p>Each node has between <span class="math inline">\(t-1\)</span> and <span class="math inline">\(2t-1\)</span> keys (except root).</p>
<p>Each split increases height only when the root splits.</p>
<p>Thus, height <span class="math inline">\(h\)</span> satisfies:</p>
<p><span class="math display">\[
t^h \le n \le (2t)^h
\]</span></p>
<p>Taking logs:</p>
<p><span class="math display">\[
h = O(\log_t n)
\]</span></p>
<p>So insertions and searches take <span class="math inline">\(O(t \cdot \log_t n)\)</span>, often simplified to <span class="math inline">\(O(\log n)\)</span> when <span class="math inline">\(t\)</span> is constant.</p>
</section>
<section id="try-it-yourself-73" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-73">Try It Yourself</h3>
<ol type="1">
<li>Build a B-Tree with <span class="math inline">\(t=2\)</span>.</li>
<li>Insert <span class="math inline">\([10, 20, 5, 6, 12, 30, 7, 17]\)</span>.</li>
<li>Draw the tree after each insertion.</li>
<li>Observe when splits occur and which keys promote upward.</li>
</ol>
</section>
<section id="test-cases-73" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-73">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Input Keys</th>
<th>t</th>
<th>Final Root</th>
<th>Height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[10,20,5,6,12,30,7,17]</td>
<td>2</td>
<td>[6,10,20]</td>
<td>2</td>
</tr>
<tr class="even">
<td>[1,2,3,4,5,6,7,8,9]</td>
<td>2</td>
<td>[4]</td>
<td>3</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-73" class="level3">
<h3 class="anchored" data-anchor-id="complexity-73">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="even">
<td>Insert</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="odd">
<td>Delete</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
</tbody>
</table>
<p>B-Tree insertion is the heartbeat of external memory algorithms, split, promote, balance, ensuring data stays close, shallow, and sorted.</p>
</section>
<section id="b-tree-delete" class="level3">
<h3 class="anchored" data-anchor-id="b-tree-delete">275 B-Tree Delete</h3>
<p>Deletion in a B-Tree is more intricate than insertion, we must carefully remove a key while preserving the B-Tree’s balance properties. Every node must maintain at least <span class="math inline">\(t - 1\)</span> keys (except the root), so deletion may involve borrowing from siblings or merging nodes.</p>
<p>The goal is to maintain the B-Tree invariants:</p>
<ul>
<li>Keys sorted within each node</li>
<li>Node key count between <span class="math inline">\(t - 1\)</span> and <span class="math inline">\(2t - 1\)</span></li>
<li>Balanced height</li>
</ul>
</section>
<section id="what-problem-are-we-solving-74" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-74">What Problem Are We Solving?</h3>
<p>We want to remove a key from a B-Tree without violating balance or occupancy constraints. Unlike binary search trees, where we can simply replace or prune nodes, B-Trees must maintain minimum degree to ensure consistent height and I/O efficiency.</p>
</section>
<section id="how-it-works-plain-language-39" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-39">How It Works (Plain Language)</h3>
<p>To delete a key <span class="math inline">\(k\)</span> from a B-Tree:</p>
<ol type="1">
<li><p>If <span class="math inline">\(k\)</span> is in a leaf node:</p>
<ul>
<li>Simply remove it.</li>
</ul></li>
<li><p>If <span class="math inline">\(k\)</span> is in an internal node:</p>
<ul>
<li>Case A: If left child has ≥ <span class="math inline">\(t\)</span> keys → replace <span class="math inline">\(k\)</span> with predecessor.</li>
<li>Case B: Else if right child has ≥ <span class="math inline">\(t\)</span> keys → replace <span class="math inline">\(k\)</span> with successor.</li>
<li>Case C: Else both children have <span class="math inline">\(t - 1\)</span> keys → merge them and recurse.</li>
</ul></li>
<li><p>If <span class="math inline">\(k\)</span> is not in the current node:</p>
<ul>
<li><p>Move to the correct child.</p></li>
<li><p>Before descending, ensure the child has at least <span class="math inline">\(t\)</span> keys. If not,</p>
<ul>
<li>Borrow from a sibling with ≥ <span class="math inline">\(t\)</span> keys, or</li>
<li>Merge with a sibling to guarantee occupancy.</li>
</ul></li>
</ul></li>
</ol>
<p>This ensures no underflow occurs during traversal.</p>
</section>
<section id="example-step-by-step-11" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-11">Example Step by Step</h3>
<p>Let <span class="math inline">\(t = 2\)</span> (max 3 keys per node). B-Tree before deletion:</p>
<pre><code>          [6, 10, 20]
         /    |     |    \
       [5]  [7]  [12,17] [30]</code></pre>
<section id="delete-key-17" class="level4">
<h4 class="anchored" data-anchor-id="delete-key-17">Delete key 17</h4>
<ul>
<li>17 is in leaf [12, 17] → remove it directly</li>
</ul>
<p>Result:</p>
<pre><code>          [6, 10, 20]
         /    |     |    \
       [5]  [7]   [12]   [30]</code></pre>
</section>
<section id="delete-key-10" class="level4">
<h4 class="anchored" data-anchor-id="delete-key-10">Delete key 10</h4>
<ul>
<li>10 is in internal node</li>
<li>Left child [7] has <span class="math inline">\(t - 1 = 1\)</span> key</li>
<li>Right child [12] also has 1 key → Merge [7], 10, [12] → [7, 10, 12]</li>
</ul>
<p>Tree becomes:</p>
<pre><code>       [6, 20]
      /    |    \
    [5] [7,10,12] [30]</code></pre>
</section>
<section id="delete-key-6" class="level4">
<h4 class="anchored" data-anchor-id="delete-key-6">Delete key 6</h4>
<ul>
<li>6 in internal node</li>
<li>Left [5] has 1 key, right [7,10,12] has ≥ 2 → borrow from right</li>
<li>Replace 6 with successor 7</li>
</ul>
<p>Tree after rebalancing:</p>
<pre><code>       [7, 20]
      /    |    \
    [5,6] [10,12] [30]</code></pre>
</section>
</section>
<section id="visualization-19" class="level3">
<h3 class="anchored" data-anchor-id="visualization-19">Visualization</h3>
<p>Every deletion keeps the tree balanced by ensuring all nodes (except root) stay ≥ <span class="math inline">\(t - 1\)</span> full.</p>
<pre><code>Before:             After Deleting 10:
$$6,10,20]           [6,20]
 / | | \             / | \
$$5][7][12,17][30]   [5][7,10,12][30]</code></pre>
</section>
<section id="tiny-code-simplified-python-5" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-python-5">Tiny Code (Simplified Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb242"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BTreeNode:</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, t, leaf<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t <span class="op">=</span> t</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.keys <span class="op">=</span> []</span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.children <span class="op">=</span> []</span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.leaf <span class="op">=</span> leaf</span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find_key(<span class="va">self</span>, k):</span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, key <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.keys):</span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> key <span class="op">&gt;=</span> k:</span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> i</span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.keys)</span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BTree:</span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, t):</span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.root <span class="op">=</span> BTreeNode(t, <span class="va">True</span>)</span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t <span class="op">=</span> t</span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> delete(<span class="va">self</span>, node, k):</span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="va">self</span>.t</span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> node.find_key(k)</span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Case 1: key in node</span></span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(node.keys) <span class="kw">and</span> node.keys[i] <span class="op">==</span> k:</span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> node.leaf:</span>
<span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a>                node.keys.pop(i)</span>
<span id="cb242-27"><a href="#cb242-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb242-28"><a href="#cb242-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(node.children[i].keys) <span class="op">&gt;=</span> t:</span>
<span id="cb242-29"><a href="#cb242-29" aria-hidden="true" tabindex="-1"></a>                    pred <span class="op">=</span> <span class="va">self</span>.get_predecessor(node, i)</span>
<span id="cb242-30"><a href="#cb242-30" aria-hidden="true" tabindex="-1"></a>                    node.keys[i] <span class="op">=</span> pred</span>
<span id="cb242-31"><a href="#cb242-31" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.delete(node.children[i], pred)</span>
<span id="cb242-32"><a href="#cb242-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="bu">len</span>(node.children[i<span class="op">+</span><span class="dv">1</span>].keys) <span class="op">&gt;=</span> t:</span>
<span id="cb242-33"><a href="#cb242-33" aria-hidden="true" tabindex="-1"></a>                    succ <span class="op">=</span> <span class="va">self</span>.get_successor(node, i)</span>
<span id="cb242-34"><a href="#cb242-34" aria-hidden="true" tabindex="-1"></a>                    node.keys[i] <span class="op">=</span> succ</span>
<span id="cb242-35"><a href="#cb242-35" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.delete(node.children[i<span class="op">+</span><span class="dv">1</span>], succ)</span>
<span id="cb242-36"><a href="#cb242-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb242-37"><a href="#cb242-37" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.merge(node, i)</span>
<span id="cb242-38"><a href="#cb242-38" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.delete(node.children[i], k)</span>
<span id="cb242-39"><a href="#cb242-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb242-40"><a href="#cb242-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Case 2: key not in node</span></span>
<span id="cb242-41"><a href="#cb242-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> node.leaf:</span>
<span id="cb242-42"><a href="#cb242-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span>  <span class="co"># not found</span></span>
<span id="cb242-43"><a href="#cb242-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(node.children[i].keys) <span class="op">&lt;</span> t:</span>
<span id="cb242-44"><a href="#cb242-44" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.fill(node, i)</span>
<span id="cb242-45"><a href="#cb242-45" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.delete(node.children[i], k)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>(Helper methods <code>merge</code>, <code>fill</code>, <code>borrow_from_prev</code>, and <code>borrow_from_next</code> omitted for brevity)</em></p>
</section>
<section id="why-it-matters-74" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-74">Why It Matters</h3>
<ul>
<li>Maintains balanced height after deletions</li>
<li>Prevents underflow in child nodes</li>
<li>Ensures <span class="math inline">\(O(\log n)\)</span> complexity</li>
<li>Used heavily in databases and filesystems where stable performance is critical</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-74" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-74">A Gentle Proof (Why It Works)</h3>
<p>A B-Tree node always satisfies:</p>
<p><span class="math display">\[
t - 1 \le \text{keys per node} \le 2t - 1
\]</span></p>
<p>Merging or borrowing ensures all nodes remain within bounds. The height <span class="math inline">\(h\)</span> satisfies:</p>
<p><span class="math display">\[
h \le \log_t n
\]</span></p>
<p>So deletions require visiting at most <span class="math inline">\(O(\log_t n)\)</span> nodes and performing constant-time merges/borrows per level.</p>
<p>Hence:</p>
<p><span class="math display">\[
T_{\text{delete}} = O(\log n)
\]</span></p>
</section>
<section id="try-it-yourself-74" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-74">Try It Yourself</h3>
<ol type="1">
<li>Build a B-Tree with <span class="math inline">\(t = 2\)</span>.</li>
<li>Insert <span class="math inline">\([10, 20, 5, 6, 12, 30, 7, 17]\)</span>.</li>
<li>Delete keys in order: <span class="math inline">\(17, 10, 6\)</span>.</li>
<li>Draw the tree after each deletion and observe merges/borrows.</li>
</ol>
</section>
<section id="test-cases-74" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-74">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Input Keys</th>
<th>Delete</th>
<th>Result (Level 0)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[5,6,7,10,12,17,20,30]</td>
<td>17</td>
<td>[5,6,7,10,12,20,30]</td>
</tr>
<tr class="even">
<td>[5,6,7,10,12,20,30]</td>
<td>10</td>
<td>[5,6,7,12,20,30]</td>
</tr>
<tr class="odd">
<td>[5,6,7,12,20,30]</td>
<td>6</td>
<td>[5,7,12,20,30]</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-74" class="level3">
<h3 class="anchored" data-anchor-id="complexity-74">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="even">
<td>Insert</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="odd">
<td>Delete</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
</tbody>
</table>
<p>B-Tree deletion is a surgical balancing act, merging, borrowing, and promoting keys just enough to keep the tree compact, shallow, and sorted.</p>
</section>
<section id="b-tree-search" class="level3">
<h3 class="anchored" data-anchor-id="b-tree-search">276 B+ Tree Search</h3>
<p>A B+ Tree is an extension of the B-Tree, optimized for range queries and sequential access. All actual data (records or values) reside in leaf nodes, which are linked together to form a sorted list. Internal nodes contain only keys that guide the search.</p>
<p>Searching in a B+ Tree follows the same principle as a B-Tree, top-down traversal based on key comparisons, but ends at the leaf level where the actual data is stored.</p>
</section>
<section id="what-problem-are-we-solving-75" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-75">What Problem Are We Solving?</h3>
<p>We need a disk-friendly search structure that:</p>
<ul>
<li>Keeps height small (few disk I/Os)</li>
<li>Supports fast range scans</li>
<li>Separates index keys (internal nodes) from records (leaves)</li>
</ul>
<p>B+ Trees meet these needs with:</p>
<ul>
<li>High fan-out: many keys per node</li>
<li>Linked leaves: for efficient sequential traversal</li>
<li>Deterministic balance: height always <span class="math inline">\(O(\log n)\)</span></li>
</ul>
</section>
<section id="how-it-works-plain-language-40" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-40">How It Works (Plain Language)</h3>
<p>Each internal node acts as a router. Each leaf node contains keys + data pointers.</p>
<p>To search for key <span class="math inline">\(k\)</span>:</p>
<ol type="1">
<li>Start at the root.</li>
<li>At each internal node, find the child whose key range contains <span class="math inline">\(k\)</span>.</li>
<li>Follow that pointer to the next level.</li>
<li>Continue until reaching a leaf node.</li>
<li>Perform a linear scan within the leaf to find <span class="math inline">\(k\)</span>.</li>
</ol>
<p>If not found in the leaf, <span class="math inline">\(k\)</span> is not in the tree.</p>
</section>
<section id="example-step-by-step-12" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-12">Example Step by Step</h3>
<p>Let <span class="math inline">\(t = 2\)</span> (each node holds up to 3 keys). B+ Tree:</p>
<pre><code>          [10 | 20]
         /     |     \
   [1 5 8]  [12 15 18]  [22 25 30]</code></pre>
<p>Search for 15:</p>
<ul>
<li>Root [10 | 20]: 15 &gt; 10 and &lt; 20 → follow middle pointer</li>
<li>Node [12 15 18]: found 15</li>
</ul>
<p>Search for 17:</p>
<ul>
<li>Root [10 | 20]: 17 &gt; 10 and &lt; 20 → middle pointer</li>
<li>Node [12 15 18]: not found → not in tree</li>
</ul>
</section>
<section id="visualization-20" class="level3">
<h3 class="anchored" data-anchor-id="visualization-20">Visualization</h3>
<pre><code>         [10 | 20]
        /     |     \
 [1 5 8] [12 15 18] [22 25 30]</code></pre>
<ul>
<li>Internal nodes guide the path</li>
<li>Leaf nodes hold data (and link to next leaf)</li>
<li>Search always ends at a leaf</li>
</ul>
</section>
<section id="tiny-code-simplified-python-6" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-python-6">Tiny Code (Simplified Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb245"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BPlusNode:</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, t, leaf<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t <span class="op">=</span> t</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.leaf <span class="op">=</span> leaf</span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.keys <span class="op">=</span> []</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.children <span class="op">=</span> []</span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">next</span> <span class="op">=</span> <span class="va">None</span>  <span class="co"># link to next leaf</span></span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BPlusTree:</span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, t):</span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.root <span class="op">=</span> BPlusNode(t, <span class="va">True</span>)</span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t <span class="op">=</span> t</span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, node, key):</span>
<span id="cb245-15"><a href="#cb245-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node.leaf:</span>
<span id="cb245-16"><a href="#cb245-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> key <span class="kw">in</span> node.keys</span>
<span id="cb245-17"><a href="#cb245-17" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb245-18"><a href="#cb245-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;</span> <span class="bu">len</span>(node.keys) <span class="kw">and</span> key <span class="op">&gt;=</span> node.keys[i]:</span>
<span id="cb245-19"><a href="#cb245-19" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb245-20"><a href="#cb245-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.search(node.children[i], key)</span>
<span id="cb245-21"><a href="#cb245-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-22"><a href="#cb245-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find(<span class="va">self</span>, key):</span>
<span id="cb245-23"><a href="#cb245-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.search(<span class="va">self</span>.root, key)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-75" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-75">Why It Matters</h3>
<ul>
<li>Efficient disk I/O: high branching factor keeps height low</li>
<li>All data in leaves: simplifies range queries</li>
<li>Linked leaves: enable sequential traversal (sorted order)</li>
<li>Used in: databases, filesystems, key-value stores (e.g., MySQL, InnoDB, NTFS)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-75" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-75">A Gentle Proof (Why It Works)</h3>
<p>Each internal node has between <span class="math inline">\(t\)</span> and <span class="math inline">\(2t\)</span> children. Each leaf holds between <span class="math inline">\(t - 1\)</span> and <span class="math inline">\(2t - 1\)</span> keys. Thus, height <span class="math inline">\(h\)</span> satisfies:</p>
<p><span class="math display">\[
t^h \le n \le (2t)^h
\]</span></p>
<p>Taking logs:</p>
<p><span class="math display">\[
h = O(\log_t n)
\]</span></p>
<p>So search time is:</p>
<p><span class="math display">\[
T_{\text{search}} = O(\log n)
\]</span></p>
<p>And since the final scan within the leaf is constant (small), total cost remains logarithmic.</p>
</section>
<section id="try-it-yourself-75" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-75">Try It Yourself</h3>
<ol type="1">
<li>Build a B+ Tree with <span class="math inline">\(t = 2\)</span> and insert keys <span class="math inline">\([1, 5, 8, 10, 12, 15, 18, 20, 22, 25, 30]\)</span>.</li>
<li>Search for 15, 17, and 8.</li>
<li>Trace your path from root → internal → leaf.</li>
<li>Observe that all searches end in leaves.</li>
</ol>
</section>
<section id="test-cases-75" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-75">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Search Key</th>
<th>Expected Result</th>
<th>Path</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>15</td>
<td>Found</td>
<td>Root → Middle → Leaf</td>
</tr>
<tr class="even">
<td>8</td>
<td>Found</td>
<td>Root → Left → Leaf</td>
</tr>
<tr class="odd">
<td>17</td>
<td>Not Found</td>
<td>Root → Middle → Leaf</td>
</tr>
<tr class="even">
<td>25</td>
<td>Found</td>
<td>Root → Right → Leaf</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-75" class="level3">
<h3 class="anchored" data-anchor-id="complexity-75">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="even">
<td>Insert</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="odd">
<td>Range Query</td>
<td><span class="math inline">\(O(\log n + k)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
</tbody>
</table>
<p>B+ Tree Search exemplifies I/O-aware design, every pointer followed is a disk page, every leaf scan is cache-friendly, and every key lives exactly where range queries want it.</p>
</section>
<section id="b-tree" class="level3">
<h3 class="anchored" data-anchor-id="b-tree">278 B* Tree</h3>
<p>A B* Tree is a refined version of the B-Tree, designed to achieve higher node occupancy and fewer splits. It enforces that each node (except root) must be at least two-thirds full, compared to the half-full guarantee in a standard B-Tree.</p>
<p>To achieve this, B* Trees use redistribution between siblings before splitting, which improves space utilization and I/O efficiency, making them ideal for database and file system indexes.</p>
</section>
<section id="what-problem-are-we-solving-76" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-76">What Problem Are We Solving?</h3>
<p>In a standard B-Tree, each node maintains at least <span class="math inline">\(t - 1\)</span> keys (50% occupancy). But frequent splits can cause fragmentation and wasted space.</p>
<p>We want to:</p>
<ul>
<li>Increase space efficiency (reduce empty slots)</li>
<li>Defer splitting when possible</li>
<li>Maintain balance and sorted order</li>
</ul>
<p>B* Trees solve this by borrowing and redistributing keys between siblings before splitting, ensuring <span class="math inline">\(\ge 2/3\)</span> occupancy.</p>
</section>
<section id="how-it-works-plain-language-41" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-41">How It Works (Plain Language)</h3>
<p>A B* Tree works like a B-Tree but with smarter split logic:</p>
<ol type="1">
<li><p>Insertion path:</p>
<ul>
<li>Traverse top-down to find target leaf.</li>
<li>If the target node is full, check its sibling.</li>
</ul></li>
<li><p>Redistribution step:</p>
<ul>
<li>If sibling has room, redistribute keys between them and the parent key.</li>
</ul></li>
<li><p>Double split step:</p>
<ul>
<li>If both siblings are full, split both into three nodes (two full + one new node), redistributing keys evenly among them.</li>
</ul></li>
</ol>
<p>This ensures every node (except root) is at least 2/3 full, leading to better disk utilization.</p>
</section>
<section id="example-step-by-step-13" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-13">Example Step by Step</h3>
<p>Let <span class="math inline">\(t = 2\)</span> (max 3 keys per node). Insert keys: <span class="math inline">\([5, 10, 15, 20, 25, 30, 35]\)</span></p>
<p>Step 1–4: Build like B-Tree until root [10, 20].</p>
<pre><code>        [10 | 20]
       /    |    \
   [5]   [15]   [25, 30, 35]</code></pre>
<p>Now insert 40 → rightmost node [25, 30, 35] is full.</p>
<ul>
<li>Check sibling: left sibling [15] has room → redistribute keys Combine [15], [25, 30, 35], and parent key 20 → [15, 20, 25, 30, 35] Split into three nodes evenly: [15, 20], [25, 30], [35] Parent updated with new separator.</li>
</ul>
<p>Result:</p>
<pre><code>         [20 | 30]
        /     |     \
    [5,10,15] [20,25] [30,35,40]</code></pre>
<p>Each node ≥ 2/3 full, no wasted space.</p>
</section>
<section id="visualization-21" class="level3">
<h3 class="anchored" data-anchor-id="visualization-21">Visualization</h3>
<pre><code>          [20 | 30]
         /     |     \
 [5 10 15] [20 25] [30 35 40]</code></pre>
<p>Redistribution ensures balance and density before splitting.</p>
</section>
<section id="tiny-code-simplified-pseudocode" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-pseudocode">Tiny Code (Simplified Pseudocode)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_bstar(tree, key):</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>    node <span class="op">=</span> find_leaf(tree.root, key)</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node.full():</span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>        sibling <span class="op">=</span> node.get_sibling()</span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> sibling <span class="kw">and</span> <span class="kw">not</span> sibling.full():</span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>            redistribute(node, sibling, tree.parent(node))</span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a>            split_three(node, sibling, tree.parent(node))</span>
<span id="cb249-9"><a href="#cb249-9" aria-hidden="true" tabindex="-1"></a>    insert_into_leaf(node, key)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>(Actual implementation is more complex, involving parent updates and sibling pointers.)</em></p>
</section>
<section id="why-it-matters-76" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-76">Why It Matters</h3>
<ul>
<li>Better space utilization: nodes ≥ 66% full</li>
<li>Fewer splits: more stable performance under heavy inserts</li>
<li>Improved I/O locality: fewer disk blocks accessed</li>
<li>Used in: database systems (IBM DB2), file systems (ReiserFS), B*-based caching structures</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-76" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-76">A Gentle Proof (Why It Works)</h3>
<p>In B* Trees:</p>
<ul>
<li>Each non-root node contains <span class="math inline">\(\ge \frac{2}{3} (2t - 1)\)</span> keys.</li>
<li>Height <span class="math inline">\(h\)</span> satisfies:</li>
</ul>
<p><span class="math display">\[
\left( \frac{3}{2} t \right)^h \le n
\]</span></p>
<p>Taking logs:</p>
<p><span class="math display">\[
h = O(\log_t n)
\]</span></p>
<p>Thus, height remains logarithmic, but nodes pack more data per level.</p>
<p>Fewer levels → fewer I/Os → better performance.</p>
</section>
<section id="try-it-yourself-76" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-76">Try It Yourself</h3>
<ol type="1">
<li>Build a B* Tree with <span class="math inline">\(t = 2\)</span>.</li>
<li>Insert keys: <span class="math inline">\([5, 10, 15, 20, 25, 30, 35, 40]\)</span>.</li>
<li>Watch how redistribution occurs before splits.</li>
<li>Compare with B-Tree splits for same sequence.</li>
</ol>
</section>
<section id="test-cases-76" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-76">Test Cases</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 1%">
<col style="width: 32%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Input Keys</th>
<th>t</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[5,10,15,20,25]</td>
<td>2</td>
<td>Root [15]</td>
<td>Full utilization</td>
</tr>
<tr class="even">
<td>[5,10,15,20,25,30,35]</td>
<td>2</td>
<td>Root [20,30]</td>
<td>Redistribution before split</td>
</tr>
<tr class="odd">
<td>[1..15]</td>
<td>2</td>
<td>Balanced, 2/3 full nodes</td>
<td>High density</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-76" class="level3">
<h3 class="anchored" data-anchor-id="complexity-76">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Occupancy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(\ge 66%\)</span></td>
</tr>
<tr class="even">
<td>Insert</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(\ge 66%\)</span></td>
</tr>
<tr class="odd">
<td>Delete</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(\ge 66%\)</span></td>
</tr>
</tbody>
</table>
<p>B* Trees take the elegance of B-Trees and push them closer to perfect, fewer splits, denser nodes, and smoother scaling for large datasets.</p>
</section>
<section id="adaptive-radix-tree" class="level3">
<h3 class="anchored" data-anchor-id="adaptive-radix-tree">279 Adaptive Radix Tree</h3>
<p>An Adaptive Radix Tree (ART) is a space-efficient, cache-friendly data structure that combines ideas from tries and radix trees. It dynamically adapts its node representation based on the number of children, optimizing both memory usage and lookup speed.</p>
<p>Unlike a fixed-size radix tree (which wastes space with sparse nodes), ART chooses a compact node type (like Node4, Node16, Node48, Node256) depending on occupancy, growing as needed.</p>
</section>
<section id="what-problem-are-we-solving-77" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-77">What Problem Are We Solving?</h3>
<p>Standard tries and radix trees are fast but memory-heavy. If keys share long prefixes, many nodes hold only one child, wasting memory.</p>
<p>We want a structure that:</p>
<ul>
<li>Keeps O(L) lookup time (L = key length)</li>
<li>Adapts node size to occupancy</li>
<li>Minimizes pointer overhead</li>
<li>Exploits cache locality</li>
</ul>
<p>ART achieves this by dynamically switching node types as the number of children grows.</p>
</section>
<section id="how-it-works-plain-language-42" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-42">How It Works (Plain Language)</h3>
<p>Each internal node in ART can be one of four types:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node Type</th>
<th>Capacity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Node4</td>
<td>4 children</td>
<td>smallest, uses linear search</td>
</tr>
<tr class="even">
<td>Node16</td>
<td>16 children</td>
<td>small array, vectorized search</td>
</tr>
<tr class="odd">
<td>Node48</td>
<td>48 children</td>
<td>index map, stores child pointers</td>
</tr>
<tr class="even">
<td>Node256</td>
<td>256 children</td>
<td>direct addressing by byte value</td>
</tr>
</tbody>
</table>
<p>Keys are processed byte by byte, branching at each level. When a node fills beyond its capacity, it upgrades to the next node type.</p>
<section id="example-29" class="level4">
<h4 class="anchored" data-anchor-id="example-29">Example</h4>
<p>Insert keys: <code>["A", "AB", "AC", "AD", "AE"]</code></p>
<ol type="1">
<li>Start with root Node4 (can store 4 children).</li>
<li>After inserting “AE”, Node4 exceeds capacity → upgrade to Node16.</li>
<li>Children remain in sorted order by key byte.</li>
</ol>
<p>This adaptive upgrade keeps nodes dense and efficient.</p>
</section>
</section>
<section id="example-step-by-step-14" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-14">Example Step by Step</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 17%">
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Node Type</th>
<th>Keys Stored</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Insert “A”</td>
<td>Node4</td>
<td>A</td>
<td>Create root</td>
</tr>
<tr class="even">
<td>2</td>
<td>Insert “AB”</td>
<td>Node4</td>
<td>A, AB</td>
<td>Add branch</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Insert “AC”</td>
<td>Node4</td>
<td>A, AB, AC</td>
<td>Still under 4</td>
</tr>
<tr class="even">
<td>4</td>
<td>Insert “AD”</td>
<td>Node4</td>
<td>A, AB, AC, AD</td>
<td>Full</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Insert “AE”</td>
<td>Upgrade to Node16</td>
<td>A, AB, AC, AD, AE</td>
<td>Adaptive growth</td>
</tr>
</tbody>
</table>
</section>
<section id="visualization-22" class="level3">
<h3 class="anchored" data-anchor-id="visualization-22">Visualization</h3>
<pre><code>Root (Node16)
 ├── 'A' → Node
      ├── 'B' (Leaf)
      ├── 'C' (Leaf)
      ├── 'D' (Leaf)
      └── 'E' (Leaf)</code></pre>
<p>Each node type adapts its layout for the best performance.</p>
</section>
<section id="tiny-code-simplified-pseudocode-1" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-pseudocode-1">Tiny Code (Simplified Pseudocode)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb251"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.children <span class="op">=</span> {}</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_art(root, key):</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>    node <span class="op">=</span> root</span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> byte <span class="kw">in</span> key:</span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> byte <span class="kw">not</span> <span class="kw">in</span> node.children:</span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a>            node.children[byte] <span class="op">=</span> Node()</span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> node.children[byte]</span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>    node.value <span class="op">=</span> <span class="va">True</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>(A real ART dynamically switches between Node4, Node16, Node48, Node256 representations.)</em></p>
</section>
<section id="why-it-matters-77" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-77">Why It Matters</h3>
<ul>
<li>Adaptive memory use, no wasted space for sparse nodes</li>
<li>Cache-friendly, contiguous memory layout</li>
<li>Fast lookups, vectorized search for Node16</li>
<li>Used in modern databases (e.g., HyPer, Umbra, DuckDB)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-77" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-77">A Gentle Proof (Why It Works)</h3>
<p>Let <span class="math inline">\(L\)</span> = key length, <span class="math inline">\(b\)</span> = branching factor (max 256 per byte). In a naive trie, each node allocates <span class="math inline">\(O(b)\)</span> slots, many unused.</p>
<p>In ART:</p>
<ul>
<li>Each node stores only actual children, so <span class="math display">\[
\text{space} \approx O(n + L)
\]</span></li>
<li>Lookup remains <span class="math inline">\(O(L)\)</span> since we traverse one node per byte.</li>
<li>Space improves by factor proportional to sparsity.</li>
</ul>
<p>Thus ART maintains trie-like performance with hash table-like compactness.</p>
</section>
<section id="try-it-yourself-77" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-77">Try It Yourself</h3>
<ol type="1">
<li>Insert <code>["dog", "dot", "door", "dorm"]</code></li>
<li>Observe how Node4 → Node16 transitions happen</li>
<li>Count number of nodes, compare with naive trie</li>
<li>Measure memory usage and access speed</li>
</ol>
</section>
<section id="test-cases-77" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-77">Test Cases</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 39%">
<col style="width: 26%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Keys</th>
<th>Resulting Root Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>["a", "b"]</code></td>
<td>Node4</td>
<td>2 children</td>
</tr>
<tr class="even">
<td><code>["a", "b", "c", "d", "e"]</code></td>
<td>Node16</td>
<td>Upgrade after 5th insert</td>
</tr>
<tr class="odd">
<td><code>["aa", "ab", "ac"... "az"]</code></td>
<td>Node48 or Node256</td>
<td>Dense branching</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-77" class="level3">
<h3 class="anchored" data-anchor-id="complexity-77">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Adaptive Behavior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td><span class="math inline">\(O(L)\)</span></td>
<td><span class="math inline">\(O(n + L)\)</span></td>
<td>Node grows/shrinks</td>
</tr>
<tr class="even">
<td>Insert</td>
<td><span class="math inline">\(O(L)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>Node type upgrade</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td><span class="math inline">\(O(L)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>Downgrade if sparse</td>
</tr>
</tbody>
</table>
<p>An Adaptive Radix Tree gives the best of both worlds: prefix compression of tries and space efficiency of hash maps, a modern weapon for high-performance indexing.</p>
</section>
<section id="trie-compression" class="level3">
<h3 class="anchored" data-anchor-id="trie-compression">280 Trie Compression</h3>
<p>A compressed trie (also called a radix tree or Patricia trie) is an optimized form of a trie where chains of single-child nodes are merged into a single edge. Instead of storing one character per node, each edge can hold an entire substring.</p>
<p>This reduces the height of the trie, minimizes memory usage, and accelerates searches, perfect for applications like prefix lookup, routing tables, and dictionary storage.</p>
</section>
<section id="what-problem-are-we-solving-78" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-78">What Problem Are We Solving?</h3>
<p>A naive trie wastes space when many nodes have only one child.</p>
<p>For example, inserting <code>["cat", "car", "dog"]</code> into a naive trie yields long, skinny paths:</p>
<pre><code>c → a → t  
c → a → r  
d → o → g</code></pre>
<p>We can compress those linear chains into edges labeled with substrings:</p>
<pre><code>c → a → "t"  
c → a → "r"  
d → "og"</code></pre>
<p>This saves memory and reduces traversal depth.</p>
</section>
<section id="how-it-works-plain-language-43" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-43">How It Works (Plain Language)</h3>
<p>The key idea is path compression: whenever a node has a single child, merge them into one edge containing the combined substring.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 52%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Build a normal trie</td>
<td>One character per edge</td>
</tr>
<tr class="even">
<td>2</td>
<td>Traverse each path</td>
<td>If node has one child, merge</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Replace chain with a substring edge</td>
<td>Fewer nodes, shorter height</td>
</tr>
</tbody>
</table>
<p>Compressed tries store edge labels as substrings rather than single characters.</p>
</section>
<section id="example-30" class="level3">
<h3 class="anchored" data-anchor-id="example-30">Example</h3>
<p>Insert <code>["bear", "bell", "bid", "bull", "buy"]</code></p>
<ol type="1">
<li>Start with naive trie.</li>
<li>Identify single-child paths.</li>
<li>Merge paths:</li>
</ol>
<pre><code>b
 ├── e → "ar"
 │    └── "ll"
 └── u → "ll"
      └── "y"</code></pre>
<p>Each edge now carries a substring rather than a single letter.</p>
</section>
<section id="example-step-by-step-15" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-15">Example Step by Step</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 37%">
<col style="width: 40%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Insert</th>
<th>Action</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>“bear”</td>
<td>Create path b-e-a-r</td>
<td>4 nodes</td>
</tr>
<tr class="even">
<td>2</td>
<td>“bell”</td>
<td>Shares prefix “be”</td>
<td>Merge prefix</td>
</tr>
<tr class="odd">
<td>3</td>
<td>“bid”</td>
<td>New branch at “b”</td>
<td>Add new edge</td>
</tr>
<tr class="even">
<td>4</td>
<td>Compress single-child paths</td>
<td>Replace edges with substrings</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-simplified-pseudocode-2" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-pseudocode-2">Tiny Code (Simplified Pseudocode)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb255"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.children <span class="op">=</span> {}</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.is_end <span class="op">=</span> <span class="va">False</span></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_trie_compressed(root, word):</span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>    node <span class="op">=</span> root</span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> <span class="bu">len</span>(word):</span>
<span id="cb255-10"><a href="#cb255-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> edge, child <span class="kw">in</span> node.children.items():</span>
<span id="cb255-11"><a href="#cb255-11" aria-hidden="true" tabindex="-1"></a>            prefix_len <span class="op">=</span> common_prefix(edge, word[i:])</span>
<span id="cb255-12"><a href="#cb255-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> prefix_len <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb255-13"><a href="#cb255-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> prefix_len <span class="op">&lt;</span> <span class="bu">len</span>(edge):</span>
<span id="cb255-14"><a href="#cb255-14" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Split edge</span></span>
<span id="cb255-15"><a href="#cb255-15" aria-hidden="true" tabindex="-1"></a>                    remainder <span class="op">=</span> edge[prefix_len:]</span>
<span id="cb255-16"><a href="#cb255-16" aria-hidden="true" tabindex="-1"></a>                    new_node <span class="op">=</span> Node()</span>
<span id="cb255-17"><a href="#cb255-17" aria-hidden="true" tabindex="-1"></a>                    new_node.children[remainder] <span class="op">=</span> child</span>
<span id="cb255-18"><a href="#cb255-18" aria-hidden="true" tabindex="-1"></a>                    node.children[word[i:i<span class="op">+</span>prefix_len]] <span class="op">=</span> new_node</span>
<span id="cb255-19"><a href="#cb255-19" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">del</span> node.children[edge]</span>
<span id="cb255-20"><a href="#cb255-20" aria-hidden="true" tabindex="-1"></a>                node <span class="op">=</span> node.children[word[i:i<span class="op">+</span>prefix_len]]</span>
<span id="cb255-21"><a href="#cb255-21" aria-hidden="true" tabindex="-1"></a>                i <span class="op">+=</span> prefix_len</span>
<span id="cb255-22"><a href="#cb255-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb255-23"><a href="#cb255-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb255-24"><a href="#cb255-24" aria-hidden="true" tabindex="-1"></a>            node.children[word[i:]] <span class="op">=</span> Node()</span>
<span id="cb255-25"><a href="#cb255-25" aria-hidden="true" tabindex="-1"></a>            node.children[word[i:]].is_end <span class="op">=</span> <span class="va">True</span></span>
<span id="cb255-26"><a href="#cb255-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb255-27"><a href="#cb255-27" aria-hidden="true" tabindex="-1"></a>    node.is_end <span class="op">=</span> <span class="va">True</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This simplified version merges edges whenever possible.</p>
</section>
<section id="why-it-matters-78" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-78">Why It Matters</h3>
<ul>
<li>Saves memory by merging chains</li>
<li>Faster search (fewer hops per lookup)</li>
<li>Ideal for prefix-based queries</li>
<li>Used in routing tables, autocomplete systems, and dictionaries</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-78" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-78">A Gentle Proof (Why It Works)</h3>
<p>Let <span class="math inline">\(n\)</span> be the total length of all keys and <span class="math inline">\(k\)</span> the number of keys.</p>
<ul>
<li>A naive trie can have up to <span class="math inline">\(O(n)\)</span> nodes.</li>
<li>A compressed trie has at most <span class="math inline">\(k - 1\)</span> internal nodes and <span class="math inline">\(k\)</span> leaves, since each branching point corresponds to a unique prefix shared by at least two keys.</li>
</ul>
<p>Thus, compressed tries reduce both height and node count:</p>
<p><span class="math display">\[
O(n) \text{ nodes (naive)} \quad \to \quad O(k) \text{ nodes (compressed)}
\]</span></p>
<p>Search and insert remain <span class="math inline">\(O(L)\)</span>, where <span class="math inline">\(L\)</span> is key length, but with fewer steps.</p>
</section>
<section id="try-it-yourself-78" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-78">Try It Yourself</h3>
<ol type="1">
<li>Insert <code>["car", "cat", "cart", "dog"]</code></li>
<li>Draw both naive and compressed tries</li>
<li>Count number of nodes before and after compression</li>
<li>Verify edge labels as substrings</li>
</ol>
</section>
<section id="test-cases-78" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-78">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Keys</th>
<th>Naive Trie Nodes</th>
<th>Compressed Trie Nodes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>["a", "b"]</code></td>
<td>3</td>
<td>3</td>
</tr>
<tr class="even">
<td><code>["apple", "app"]</code></td>
<td>6</td>
<td>4</td>
</tr>
<tr class="odd">
<td><code>["abc", "abd", "aef"]</code></td>
<td>8</td>
<td>6</td>
</tr>
<tr class="even">
<td><code>["car", "cart", "cat"]</code></td>
<td>9</td>
<td>6</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-78" class="level3">
<h3 class="anchored" data-anchor-id="complexity-78">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Search</td>
<td><span class="math inline">\(O(L)\)</span></td>
<td><span class="math inline">\(O(k)\)</span></td>
<td><span class="math inline">\(L\)</span> = key length</td>
</tr>
<tr class="even">
<td>Insert</td>
<td><span class="math inline">\(O(L)\)</span></td>
<td><span class="math inline">\(O(k)\)</span></td>
<td>Split edges when needed</td>
</tr>
<tr class="odd">
<td>Delete</td>
<td><span class="math inline">\(O(L)\)</span></td>
<td><span class="math inline">\(O(k)\)</span></td>
<td>Merge edges if path shrinks</td>
</tr>
</tbody>
</table>
<p>A compressed trie elegantly blends trie structure and path compression, turning long chains into compact edges, a key step toward efficient prefix trees, routing tables, and tries for text indexing.</p>
</section>
<section id="section-29.-persistent-and-functional-data-structures" class="level2">
<h2 class="anchored" data-anchor-id="section-29.-persistent-and-functional-data-structures">Section 29. Persistent and Functional Data Structures</h2>
<section id="persistent-stack" class="level3">
<h3 class="anchored" data-anchor-id="persistent-stack">281 Persistent Stack</h3>
<p>A persistent stack is a versioned data structure that remembers all its past states. Instead of overwriting data, every <code>push</code> or <code>pop</code> operation creates a new version of the stack while keeping access to the old ones.</p>
<p>This concept is part of functional data structures, where immutability and version history are first-class citizens.</p>
</section>
<section id="what-problem-are-we-solving-79" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-79">What Problem Are We Solving?</h3>
<p>In traditional stacks, each operation mutates the structure, old versions are lost.</p>
<p>Persistent stacks solve this by allowing:</p>
<ul>
<li>Access to previous states at any time</li>
<li>Undo or time-travel features</li>
<li>Purely functional programs where data is never mutated</li>
</ul>
<p>Used in compilers, backtracking systems, and functional programming languages.</p>
</section>
<section id="how-it-works-plain-language-44" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-44">How It Works (Plain Language)</h3>
<p>A stack is a linked list:</p>
<ul>
<li><code>push(x)</code> adds a new head node</li>
<li><code>pop()</code> returns the next node</li>
</ul>
<p>For persistence, we never modify nodes, instead, each operation creates a new head pointing to existing tails.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Version</th>
<th>Operation</th>
<th>Top Element</th>
<th>Structure</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v0</td>
<td>empty</td>
<td>,</td>
<td>∅</td>
</tr>
<tr class="even">
<td>v1</td>
<td>push(10)</td>
<td>10</td>
<td>10 → ∅</td>
</tr>
<tr class="odd">
<td>v2</td>
<td>push(20)</td>
<td>20</td>
<td>20 → 10 → ∅</td>
</tr>
<tr class="even">
<td>v3</td>
<td>pop()</td>
<td>10</td>
<td>10 → ∅</td>
</tr>
</tbody>
</table>
<p>Each version reuses previous nodes, no data copying.</p>
</section>
<section id="example-31" class="level3">
<h3 class="anchored" data-anchor-id="example-31">Example</h3>
<p>Start with an empty stack <code>v0</code>:</p>
<ol type="1">
<li><code>v1 = push(v0, 10)</code> → stack <code>[10]</code></li>
<li><code>v2 = push(v1, 20)</code> → stack <code>[20, 10]</code></li>
<li><code>v3 = pop(v2)</code> → returns 20, new stack <code>[10]</code></li>
</ol>
<p>Now we have three accessible versions:</p>
<pre><code>v0: ∅  
v1: 10  
v2: 20 → 10  
v3: 10  </code></pre>
</section>
<section id="tiny-code-python" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python">Tiny Code (Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb257"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, value, next_node<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.value <span class="op">=</span> value</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">next</span> <span class="op">=</span> next_node</span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PersistentStack:</span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, top<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.top <span class="op">=</span> top</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> push(<span class="va">self</span>, value):</span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># new node points to current top</span></span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> PersistentStack(Node(value, <span class="va">self</span>.top))</span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pop(<span class="va">self</span>):</span>
<span id="cb257-15"><a href="#cb257-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.top:</span>
<span id="cb257-16"><a href="#cb257-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>, <span class="va">None</span></span>
<span id="cb257-17"><a href="#cb257-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> PersistentStack(<span class="va">self</span>.top.<span class="bu">next</span>), <span class="va">self</span>.top.value</span>
<span id="cb257-18"><a href="#cb257-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-19"><a href="#cb257-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> peek(<span class="va">self</span>):</span>
<span id="cb257-20"><a href="#cb257-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span> <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.top <span class="cf">else</span> <span class="va">self</span>.top.value</span>
<span id="cb257-21"><a href="#cb257-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-22"><a href="#cb257-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb257-23"><a href="#cb257-23" aria-hidden="true" tabindex="-1"></a>v0 <span class="op">=</span> PersistentStack()</span>
<span id="cb257-24"><a href="#cb257-24" aria-hidden="true" tabindex="-1"></a>v1 <span class="op">=</span> v0.push(<span class="dv">10</span>)</span>
<span id="cb257-25"><a href="#cb257-25" aria-hidden="true" tabindex="-1"></a>v2 <span class="op">=</span> v1.push(<span class="dv">20</span>)</span>
<span id="cb257-26"><a href="#cb257-26" aria-hidden="true" tabindex="-1"></a>v3, popped <span class="op">=</span> v2.pop()</span>
<span id="cb257-27"><a href="#cb257-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-28"><a href="#cb257-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(v2.peek())  <span class="co"># 20</span></span>
<span id="cb257-29"><a href="#cb257-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(v3.peek())  <span class="co"># 10</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This approach reuses nodes, creating new versions without mutation.</p>
</section>
<section id="tiny-code-c-conceptual" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-c-conceptual">Tiny Code (C, Conceptual)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb258"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node<span class="op">*</span> next<span class="op">;</span></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> top<span class="op">;</span></span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Stack<span class="op">;</span></span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a>Stack<span class="op">*</span> push<span class="op">(</span>Stack<span class="op">*</span> s<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb258-14"><a href="#cb258-14" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> node <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb258-15"><a href="#cb258-15" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb258-16"><a href="#cb258-16" aria-hidden="true" tabindex="-1"></a>    node<span class="op">-&gt;</span>next <span class="op">=</span> s<span class="op">-&gt;</span>top<span class="op">;</span></span>
<span id="cb258-17"><a href="#cb258-17" aria-hidden="true" tabindex="-1"></a>    Stack<span class="op">*</span> new_stack <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Stack<span class="op">));</span></span>
<span id="cb258-18"><a href="#cb258-18" aria-hidden="true" tabindex="-1"></a>    new_stack<span class="op">-&gt;</span>top <span class="op">=</span> node<span class="op">;</span></span>
<span id="cb258-19"><a href="#cb258-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_stack<span class="op">;</span></span>
<span id="cb258-20"><a href="#cb258-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb258-21"><a href="#cb258-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-22"><a href="#cb258-22" aria-hidden="true" tabindex="-1"></a>Stack<span class="op">*</span> pop<span class="op">(</span>Stack<span class="op">*</span> s<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> popped_value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb258-23"><a href="#cb258-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>s<span class="op">-&gt;</span>top<span class="op">)</span> <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb258-24"><a href="#cb258-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>popped_value <span class="op">=</span> s<span class="op">-&gt;</span>top<span class="op">-&gt;</span>value<span class="op">;</span></span>
<span id="cb258-25"><a href="#cb258-25" aria-hidden="true" tabindex="-1"></a>    Stack<span class="op">*</span> new_stack <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Stack<span class="op">));</span></span>
<span id="cb258-26"><a href="#cb258-26" aria-hidden="true" tabindex="-1"></a>    new_stack<span class="op">-&gt;</span>top <span class="op">=</span> s<span class="op">-&gt;</span>top<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb258-27"><a href="#cb258-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_stack<span class="op">;</span></span>
<span id="cb258-28"><a href="#cb258-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Every <code>push</code> or <code>pop</code> creates a new <code>Stack*</code> that points to the previous structure.</p>
</section>
<section id="why-it-matters-79" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-79">Why It Matters</h3>
<ul>
<li>Immutability ensures data safety and concurrency-friendly design</li>
<li>Versioning allows backtracking, undo, or branching computations</li>
<li>Foundation for functional programming and persistent data stores</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-79" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-79">A Gentle Proof (Why It Works)</h3>
<p>Each version of the stack shares unchanged nodes with previous versions. Because <code>push</code> and <code>pop</code> only modify the head reference, older versions remain intact.</p>
<p>If <span class="math inline">\(n\)</span> is the total number of operations,</p>
<ul>
<li>Each new version adds <span class="math inline">\(O(1)\)</span> space</li>
<li>Shared tails ensure total space = <span class="math inline">\(O(n)\)</span></li>
</ul>
<p>Mathematically:</p>
<p><span class="math display">\[
S_n = S_{n-1} + O(1)
\]</span></p>
<p>and old versions never get overwritten, ensuring persistence.</p>
</section>
<section id="try-it-yourself-79" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-79">Try It Yourself</h3>
<ol type="1">
<li>Build a persistent stack with values [1, 2, 3]</li>
<li>Pop once, and confirm earlier versions still have their values</li>
<li>Compare with a mutable stack implementation</li>
<li>Visualize the shared linked nodes between versions</li>
</ol>
</section>
<section id="test-cases-79" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-79">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>v1 = push(v0, 10)</code></td>
<td><code>[10]</code></td>
<td>new version</td>
</tr>
<tr class="even">
<td><code>v2 = push(v1, 20)</code></td>
<td><code>[20, 10]</code></td>
<td>shares 10-node</td>
</tr>
<tr class="odd">
<td><code>v3, val = pop(v2)</code></td>
<td>val = 20, <code>[10]</code></td>
<td>old v2 intact</td>
</tr>
<tr class="even">
<td><code>v1.peek()</code></td>
<td><code>10</code></td>
<td>unaffected by later pops</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-79" class="level3">
<h3 class="anchored" data-anchor-id="complexity-79">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Push</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>new head</td>
</tr>
<tr class="even">
<td>Pop</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>new top pointer</td>
</tr>
<tr class="odd">
<td>Access old version</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>,</td>
<td>store reference</td>
</tr>
</tbody>
</table>
<p>A persistent stack elegantly combines immutability, sharing, and time-travel, a small but powerful step into the world of functional data structures.</p>
</section>
<section id="persistent-array" class="level3">
<h3 class="anchored" data-anchor-id="persistent-array">282 Persistent Array</h3>
<p>A persistent array is an immutable, versioned structure that allows access to all past states. Instead of overwriting elements, every update creates a new version that shares most of its structure with previous ones.</p>
<p>This makes it possible to “time travel”, view or restore any earlier version in constant or logarithmic time, without copying the entire array.</p>
</section>
<section id="what-problem-are-we-solving-80" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-80">What Problem Are We Solving?</h3>
<p>A normal array is mutable, every <code>arr[i] = x</code> destroys the old value. If we want history, undo, or branching computation, this is unacceptable.</p>
<p>A persistent array keeps all versions:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Version</th>
<th>Operation</th>
<th>State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v0</td>
<td><code>[]</code></td>
<td>empty</td>
</tr>
<tr class="even">
<td>v1</td>
<td><code>set(0, 10)</code></td>
<td><code>[10]</code></td>
</tr>
<tr class="odd">
<td>v2</td>
<td><code>set(0, 20)</code></td>
<td><code>[20]</code> (v1 still <code>[10]</code>)</td>
</tr>
</tbody>
</table>
<p>Each version reuses unmodified parts of the array, avoiding full duplication.</p>
</section>
<section id="how-it-works-plain-language-45" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-45">How It Works (Plain Language)</h3>
<p>A persistent array can be implemented using copy-on-write or tree-based structures.</p>
<ol type="1">
<li><p>Copy-on-Write (Small Arrays)</p>
<ul>
<li>Create a new array copy only when an element changes.</li>
<li>Simple but <span class="math inline">\(O(n)\)</span> update cost.</li>
</ul></li>
<li><p>Path Copying with Trees (Large Arrays)</p>
<ul>
<li>Represent the array as a balanced binary tree (like a segment tree).</li>
<li>Each update copies only the path to the changed leaf.</li>
<li>Space per update = <span class="math inline">\(O(\log n)\)</span></li>
</ul></li>
</ol>
<p>So, each version points to a root node. When you modify index <span class="math inline">\(i\)</span>, a new path is created down the tree, while untouched subtrees are shared.</p>
</section>
<section id="example-32" class="level3">
<h3 class="anchored" data-anchor-id="example-32">Example</h3>
<p>Let’s build a persistent array of size 4.</p>
<section id="step-1-initial-version" class="level4">
<h4 class="anchored" data-anchor-id="step-1-initial-version">Step 1: Initial version</h4>
<pre><code>v0 = [0, 0, 0, 0]</code></pre>
</section>
<section id="step-2-update-index-2" class="level4">
<h4 class="anchored" data-anchor-id="step-2-update-index-2">Step 2: Update index 2</h4>
<pre><code>v1 = set(v0, 2, 5)  → [0, 0, 5, 0]</code></pre>
</section>
<section id="step-3-update-index-1" class="level4">
<h4 class="anchored" data-anchor-id="step-3-update-index-1">Step 3: Update index 1</h4>
<pre><code>v2 = set(v1, 1, 9)  → [0, 9, 5, 0]</code></pre>
<p><code>v0</code>, <code>v1</code>, and <code>v2</code> all coexist independently.</p>
</section>
</section>
<section id="example-step-by-step-tree-representation" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-tree-representation">Example Step-by-Step (Tree Representation)</h3>
<p>Each node covers a range:</p>
<pre><code>Root: [0..3]
  ├── Left [0..1]
  │     ├── [0] → 0
  │     └── [1] → 9
  └── Right [2..3]
        ├── [2] → 5
        └── [3] → 0</code></pre>
<p>Updating index 1 copies only the path <code>[0..3] → [0..1] → [1]</code>, not the entire tree.</p>
</section>
<section id="tiny-code-python-tree-based" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-tree-based">Tiny Code (Python, Tree-based)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb263"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, left<span class="op">=</span><span class="va">None</span>, right<span class="op">=</span><span class="va">None</span>, value<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> left</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> right</span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.value <span class="op">=</span> value</span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build(l, r):</span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="op">==</span> r:</span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node()</span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Node(build(l, m), build(m<span class="op">+</span><span class="dv">1</span>, r))</span>
<span id="cb263-12"><a href="#cb263-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-13"><a href="#cb263-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update(node, l, r, idx, val):</span>
<span id="cb263-14"><a href="#cb263-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="op">==</span> r:</span>
<span id="cb263-15"><a href="#cb263-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(value<span class="op">=</span>val)</span>
<span id="cb263-16"><a href="#cb263-16" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb263-17"><a href="#cb263-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="op">&lt;=</span> m:</span>
<span id="cb263-18"><a href="#cb263-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(update(node.left, l, m, idx, val), node.right)</span>
<span id="cb263-19"><a href="#cb263-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb263-20"><a href="#cb263-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(node.left, update(node.right, m<span class="op">+</span><span class="dv">1</span>, r, idx, val))</span>
<span id="cb263-21"><a href="#cb263-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-22"><a href="#cb263-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> query(node, l, r, idx):</span>
<span id="cb263-23"><a href="#cb263-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="op">==</span> r:</span>
<span id="cb263-24"><a href="#cb263-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node.value</span>
<span id="cb263-25"><a href="#cb263-25" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb263-26"><a href="#cb263-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> query(node.left, l, m, idx) <span class="cf">if</span> idx <span class="op">&lt;=</span> m <span class="cf">else</span> query(node.right, m<span class="op">+</span><span class="dv">1</span>, r, idx)</span>
<span id="cb263-27"><a href="#cb263-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-28"><a href="#cb263-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb263-29"><a href="#cb263-29" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb263-30"><a href="#cb263-30" aria-hidden="true" tabindex="-1"></a>v0 <span class="op">=</span> build(<span class="dv">0</span>, n<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb263-31"><a href="#cb263-31" aria-hidden="true" tabindex="-1"></a>v1 <span class="op">=</span> update(v0, <span class="dv">0</span>, n<span class="op">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb263-32"><a href="#cb263-32" aria-hidden="true" tabindex="-1"></a>v2 <span class="op">=</span> update(v1, <span class="dv">0</span>, n<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">9</span>)</span>
<span id="cb263-33"><a href="#cb263-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-34"><a href="#cb263-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(query(v2, <span class="dv">0</span>, n<span class="op">-</span><span class="dv">1</span>, <span class="dv">2</span>))  <span class="co"># 5</span></span>
<span id="cb263-35"><a href="#cb263-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(query(v1, <span class="dv">0</span>, n<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))  <span class="co"># 0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each update creates a new version root.</p>
</section>
<section id="why-it-matters-80" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-80">Why It Matters</h3>
<ul>
<li>Time-travel debugging: retrieve old states</li>
<li>Undo/redo systems in editors</li>
<li>Branching computations in persistent algorithms</li>
<li>Functional programming without mutation</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-80" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-80">A Gentle Proof (Why It Works)</h3>
<p>Let <span class="math inline">\(n\)</span> be array size, <span class="math inline">\(u\)</span> number of updates.</p>
<p>Each update copies <span class="math inline">\(O(\log n)\)</span> nodes. So total space:</p>
<p><span class="math display">\[
O(n + u \log n)
\]</span></p>
<p>Each query traverses one path <span class="math inline">\(O(\log n)\)</span>. No version ever invalidates another, all roots remain accessible.</p>
<p>Persistence holds because we never mutate existing nodes, only allocate new ones and reuse subtrees.</p>
</section>
<section id="try-it-yourself-80" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-80">Try It Yourself</h3>
<ol type="1">
<li>Build an array of size 8, all zeros.</li>
<li>Create v1 = set index 4 → 7</li>
<li>Create v2 = set index 2 → 9</li>
<li>Print values from v0, v1, v2</li>
<li>Confirm that old versions remain unchanged.</li>
</ol>
</section>
<section id="test-cases-80" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-80">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Output</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>build(4)</td>
<td><code>[0,0,0,0]</code></td>
<td>v0</td>
<td>base</td>
</tr>
<tr class="even">
<td>set(v0,2,5)</td>
<td></td>
<td><code>[0,0,5,0]</code></td>
<td>new version</td>
</tr>
<tr class="odd">
<td>set(v1,1,9)</td>
<td></td>
<td><code>[0,9,5,0]</code></td>
<td>v1 reused</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-80" class="level3">
<h3 class="anchored" data-anchor-id="complexity-80">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>initial</td>
</tr>
<tr class="even">
<td>Update</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td>path copy</td>
</tr>
<tr class="odd">
<td>Query</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td>,</td>
<td>one path</td>
</tr>
<tr class="even">
<td>Access Old Version</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>,</td>
<td>root reference</td>
</tr>
</tbody>
</table>
<p>A persistent array turns ephemeral memory into a versioned timeline, each change is a branch, every version eternal. Perfect for functional programming, debugging, and algorithmic history.</p>
</section>
<section id="persistent-segment-tree-1" class="level3">
<h3 class="anchored" data-anchor-id="persistent-segment-tree-1">283 Persistent Segment Tree</h3>
<p>A persistent segment tree is a versioned data structure that supports range queries and point updates, while keeping every past version accessible.</p>
<p>It’s a powerful combination of segment trees and persistence, allowing you to query historical states, perform undo operations, and even compare past and present results efficiently.</p>
</section>
<section id="what-problem-are-we-solving-81" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-81">What Problem Are We Solving?</h3>
<p>A standard segment tree allows:</p>
<ul>
<li>Point updates: <code>arr[i] = x</code></li>
<li>Range queries: <code>sum(l, r)</code> or <code>min(l, r)</code></li>
</ul>
<p>But every update overwrites old values. A persistent segment tree solves this by creating a new version on each update, reusing unchanged nodes.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Version</th>
<th>Operation</th>
<th>State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v0</td>
<td>build</td>
<td><code>[1, 2, 3, 4]</code></td>
</tr>
<tr class="even">
<td>v1</td>
<td>update(2, 5)</td>
<td><code>[1, 2, 5, 4]</code></td>
</tr>
<tr class="odd">
<td>v2</td>
<td>update(1, 7)</td>
<td><code>[1, 7, 5, 4]</code></td>
</tr>
</tbody>
</table>
<p>Now you can query any version:</p>
<ul>
<li><code>query(v0, 1, 3)</code> → old sum</li>
<li><code>query(v2, 1, 3)</code> → updated sum</li>
</ul>
</section>
<section id="how-it-works-plain-language-46" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-46">How It Works (Plain Language)</h3>
<p>A segment tree is a binary tree where each node stores an aggregate (sum, min, max) over a segment.</p>
<p>Persistence is achieved by path copying:</p>
<ul>
<li>When updating index <code>i</code>, only nodes on the path from root to leaf are replaced.</li>
<li>All other nodes are shared between versions.</li>
</ul>
<p>So each new version costs <span class="math inline">\(O(\log n)\)</span> nodes and space.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Affected Nodes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Build</td>
<td><span class="math inline">\(O(n)\)</span> nodes</td>
</tr>
<tr class="even">
<td>2</td>
<td>Update(2, 5)</td>
<td><span class="math inline">\(O(\log n)\)</span> new nodes</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Update(1, 7)</td>
<td><span class="math inline">\(O(\log n)\)</span> new nodes</td>
</tr>
</tbody>
</table>
</section>
<section id="example-33" class="level3">
<h3 class="anchored" data-anchor-id="example-33">Example</h3>
<p>Let initial array be <code>[1, 2, 3, 4]</code></p>
<ol type="1">
<li>Build tree (v0)</li>
<li>v1 = update(v0, 2 → 5)</li>
<li>v2 = update(v1, 1 → 7)</li>
</ol>
<p>Now:</p>
<ul>
<li><code>query(v0, 1, 4) = 10</code></li>
<li><code>query(v1, 1, 4) = 12</code></li>
<li><code>query(v2, 1, 4) = 17</code></li>
</ul>
<p>All versions share most nodes, saving memory.</p>
</section>
<section id="example-step-by-step-16" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-16">Example Step-by-Step</h3>
<section id="update-v0-v1-at-index-2" class="level4">
<h4 class="anchored" data-anchor-id="update-v0-v1-at-index-2">Update v0 → v1 at index 2</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Version</th>
<th>Tree Nodes Copied</th>
<th>Shared</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v1</td>
<td>Path [root → left → right]</td>
<td>Others unchanged</td>
</tr>
</tbody>
</table>
<p>So v1 differs only along one path.</p>
</section>
</section>
<section id="tiny-code-python-1" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-1">Tiny Code (Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb264"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, val<span class="op">=</span><span class="dv">0</span>, left<span class="op">=</span><span class="va">None</span>, right<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.val <span class="op">=</span> val</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> left</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> right</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build(arr, l, r):</span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="op">==</span> r:</span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(arr[l])</span>
<span id="cb264-10"><a href="#cb264-10" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb264-11"><a href="#cb264-11" aria-hidden="true" tabindex="-1"></a>    left <span class="op">=</span> build(arr, l, m)</span>
<span id="cb264-12"><a href="#cb264-12" aria-hidden="true" tabindex="-1"></a>    right <span class="op">=</span> build(arr, m <span class="op">+</span> <span class="dv">1</span>, r)</span>
<span id="cb264-13"><a href="#cb264-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Node(left.val <span class="op">+</span> right.val, left, right)</span>
<span id="cb264-14"><a href="#cb264-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-15"><a href="#cb264-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update(node, l, r, idx, val):</span>
<span id="cb264-16"><a href="#cb264-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="op">==</span> r:</span>
<span id="cb264-17"><a href="#cb264-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(val)</span>
<span id="cb264-18"><a href="#cb264-18" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb264-19"><a href="#cb264-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="op">&lt;=</span> m:</span>
<span id="cb264-20"><a href="#cb264-20" aria-hidden="true" tabindex="-1"></a>        left <span class="op">=</span> update(node.left, l, m, idx, val)</span>
<span id="cb264-21"><a href="#cb264-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(left.val <span class="op">+</span> node.right.val, left, node.right)</span>
<span id="cb264-22"><a href="#cb264-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb264-23"><a href="#cb264-23" aria-hidden="true" tabindex="-1"></a>        right <span class="op">=</span> update(node.right, m <span class="op">+</span> <span class="dv">1</span>, r, idx, val)</span>
<span id="cb264-24"><a href="#cb264-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Node(node.left.val <span class="op">+</span> right.val, node.left, right)</span>
<span id="cb264-25"><a href="#cb264-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-26"><a href="#cb264-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> query(node, l, r, ql, qr):</span>
<span id="cb264-27"><a href="#cb264-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> qr <span class="op">&lt;</span> l <span class="kw">or</span> ql <span class="op">&gt;</span> r:</span>
<span id="cb264-28"><a href="#cb264-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb264-29"><a href="#cb264-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ql <span class="op">&lt;=</span> l <span class="kw">and</span> r <span class="op">&lt;=</span> qr:</span>
<span id="cb264-30"><a href="#cb264-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node.val</span>
<span id="cb264-31"><a href="#cb264-31" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb264-32"><a href="#cb264-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> query(node.left, l, m, ql, qr) <span class="op">+</span> query(node.right, m <span class="op">+</span> <span class="dv">1</span>, r, ql, qr)</span>
<span id="cb264-33"><a href="#cb264-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-34"><a href="#cb264-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb264-35"><a href="#cb264-35" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]</span>
<span id="cb264-36"><a href="#cb264-36" aria-hidden="true" tabindex="-1"></a>v0 <span class="op">=</span> build(arr, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb264-37"><a href="#cb264-37" aria-hidden="true" tabindex="-1"></a>v1 <span class="op">=</span> update(v0, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb264-38"><a href="#cb264-38" aria-hidden="true" tabindex="-1"></a>v2 <span class="op">=</span> update(v1, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb264-39"><a href="#cb264-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-40"><a href="#cb264-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(query(v0, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>))  <span class="co"># 10</span></span>
<span id="cb264-41"><a href="#cb264-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(query(v1, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>))  <span class="co"># 12</span></span>
<span id="cb264-42"><a href="#cb264-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(query(v2, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>))  <span class="co"># 17</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-81" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-81">Why It Matters</h3>
<ul>
<li>Access any version instantly</li>
<li>Enables time-travel queries</li>
<li>Supports immutable analytics</li>
<li>Used in offline queries, competitive programming, and functional databases</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-81" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-81">A Gentle Proof (Why It Works)</h3>
<p>Each update only modifies <span class="math inline">\(O(\log n)\)</span> nodes. All other subtrees are shared, so total space:</p>
<p><span class="math display">\[
S(u) = O(n + u \log n)
\]</span></p>
<p>Querying any version costs <span class="math inline">\(O(\log n)\)</span> since only one path is traversed.</p>
<p>Persistence holds since no nodes are mutated, only replaced.</p>
</section>
<section id="try-it-yourself-81" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-81">Try It Yourself</h3>
<ol type="1">
<li>Build <code>[1, 2, 3, 4]</code></li>
<li>Update index 2 → 5 (v1)</li>
<li>Update index 1 → 7 (v2)</li>
<li>Query sum(1, 4) in v0, v1, v2</li>
<li>Verify shared subtrees via visualization</li>
</ol>
</section>
<section id="test-cases-81" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-81">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Version</th>
<th>Operation</th>
<th>Query(0,3)</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v0</td>
<td><code>[1,2,3,4]</code></td>
<td>10</td>
<td>base</td>
</tr>
<tr class="even">
<td>v1</td>
<td>set(2,5)</td>
<td>12</td>
<td>changed one leaf</td>
</tr>
<tr class="odd">
<td>v2</td>
<td>set(1,7)</td>
<td>17</td>
<td>another update</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-81" class="level3">
<h3 class="anchored" data-anchor-id="complexity-81">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>full tree</td>
</tr>
<tr class="even">
<td>Update</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td>path copy</td>
</tr>
<tr class="odd">
<td>Query</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td>,</td>
<td>one path</td>
</tr>
<tr class="even">
<td>Version Access</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>,</td>
<td>via root</td>
</tr>
</tbody>
</table>
<p>A persistent segment tree is your immutable oracle, each version a snapshot in time, forever queryable, forever intact.</p>
</section>
<section id="persistent-linked-list" class="level3">
<h3 class="anchored" data-anchor-id="persistent-linked-list">284 Persistent Linked List</h3>
<p>A persistent linked list is a versioned variant of the classic singly linked list, where every insertion or deletion produces a new version without destroying the old one.</p>
<p>Each version represents a distinct state of the list, and all versions coexist by sharing structure, unchanged nodes are reused, only the modified path is copied.</p>
<p>This technique is core to functional programming, undo systems, and immutable data structures.</p>
</section>
<section id="what-problem-are-we-solving-82" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-82">What Problem Are We Solving?</h3>
<p>A mutable linked list loses its history after every change.</p>
<p>With persistence, we preserve all past versions:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Version</th>
<th>Operation</th>
<th>List</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v0</td>
<td>empty</td>
<td>∅</td>
</tr>
<tr class="even">
<td>v1</td>
<td>push_front(10)</td>
<td>[10]</td>
</tr>
<tr class="odd">
<td>v2</td>
<td>push_front(20)</td>
<td>[20, 10]</td>
</tr>
<tr class="even">
<td>v3</td>
<td>pop_front()</td>
<td>[10]</td>
</tr>
</tbody>
</table>
<p>Each version is a first-class citizen, you can traverse, query, or compare any version at any time.</p>
</section>
<section id="how-it-works-plain-language-47" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-47">How It Works (Plain Language)</h3>
<p>Each node in a singly linked list has:</p>
<ul>
<li><code>value</code></li>
<li><code>next</code> pointer</li>
</ul>
<p>For persistence, we never mutate nodes. Instead, operations return a new head:</p>
<ul>
<li><code>push_front(x)</code>: create a new node <code>n = Node(x, old_head)</code></li>
<li><code>pop_front()</code>: return <code>old_head.next</code> as new head</li>
</ul>
<p>All old nodes remain intact and shared.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>New Node</th>
<th>Shared Structure</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>push_front(20)</td>
<td>new head</td>
<td>tail reused</td>
</tr>
<tr class="even">
<td>pop_front()</td>
<td>new head (next)</td>
<td>old head still exists</td>
</tr>
</tbody>
</table>
</section>
<section id="example-34" class="level3">
<h3 class="anchored" data-anchor-id="example-34">Example</h3>
<section id="step-by-step-versioning" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-versioning">Step-by-step versioning</h4>
<ol type="1">
<li><code>v0 = []</code></li>
<li><code>v1 = push_front(v0, 10)</code> → <code>[10]</code></li>
<li><code>v2 = push_front(v1, 20)</code> → <code>[20, 10]</code></li>
<li><code>v3 = pop_front(v2)</code> → <code>[10]</code></li>
</ol>
<p>Versions:</p>
<pre><code>v0: ∅  
v1: 10  
v2: 20 → 10  
v3: 10  </code></pre>
<p>All coexist and share structure.</p>
</section>
</section>
<section id="example-graph-view" class="level3">
<h3 class="anchored" data-anchor-id="example-graph-view">Example (Graph View)</h3>
<pre><code>v0: ∅
v1: 10 → ∅
v2: 20 → 10 → ∅
v3: 10 → ∅</code></pre>
<p>Notice: <code>v2.tail</code> is reused from <code>v1</code>.</p>
</section>
<section id="tiny-code-python-2" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-2">Tiny Code (Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb267"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, value, next_node<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.value <span class="op">=</span> value</span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">next</span> <span class="op">=</span> next_node</span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PersistentList:</span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, head<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb267-8"><a href="#cb267-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.head <span class="op">=</span> head</span>
<span id="cb267-9"><a href="#cb267-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-10"><a href="#cb267-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> push_front(<span class="va">self</span>, value):</span>
<span id="cb267-11"><a href="#cb267-11" aria-hidden="true" tabindex="-1"></a>        new_node <span class="op">=</span> Node(value, <span class="va">self</span>.head)</span>
<span id="cb267-12"><a href="#cb267-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> PersistentList(new_node)</span>
<span id="cb267-13"><a href="#cb267-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-14"><a href="#cb267-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pop_front(<span class="va">self</span>):</span>
<span id="cb267-15"><a href="#cb267-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.head:</span>
<span id="cb267-16"><a href="#cb267-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>, <span class="va">None</span></span>
<span id="cb267-17"><a href="#cb267-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> PersistentList(<span class="va">self</span>.head.<span class="bu">next</span>), <span class="va">self</span>.head.value</span>
<span id="cb267-18"><a href="#cb267-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-19"><a href="#cb267-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_list(<span class="va">self</span>):</span>
<span id="cb267-20"><a href="#cb267-20" aria-hidden="true" tabindex="-1"></a>        result, curr <span class="op">=</span> [], <span class="va">self</span>.head</span>
<span id="cb267-21"><a href="#cb267-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> curr:</span>
<span id="cb267-22"><a href="#cb267-22" aria-hidden="true" tabindex="-1"></a>            result.append(curr.value)</span>
<span id="cb267-23"><a href="#cb267-23" aria-hidden="true" tabindex="-1"></a>            curr <span class="op">=</span> curr.<span class="bu">next</span></span>
<span id="cb267-24"><a href="#cb267-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb267-25"><a href="#cb267-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-26"><a href="#cb267-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb267-27"><a href="#cb267-27" aria-hidden="true" tabindex="-1"></a>v0 <span class="op">=</span> PersistentList()</span>
<span id="cb267-28"><a href="#cb267-28" aria-hidden="true" tabindex="-1"></a>v1 <span class="op">=</span> v0.push_front(<span class="dv">10</span>)</span>
<span id="cb267-29"><a href="#cb267-29" aria-hidden="true" tabindex="-1"></a>v2 <span class="op">=</span> v1.push_front(<span class="dv">20</span>)</span>
<span id="cb267-30"><a href="#cb267-30" aria-hidden="true" tabindex="-1"></a>v3, popped <span class="op">=</span> v2.pop_front()</span>
<span id="cb267-31"><a href="#cb267-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-32"><a href="#cb267-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(v1.to_list())  <span class="co"># [10]</span></span>
<span id="cb267-33"><a href="#cb267-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(v2.to_list())  <span class="co"># [20, 10]</span></span>
<span id="cb267-34"><a href="#cb267-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(v3.to_list())  <span class="co"># [10]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tiny-code-c-conceptual-1" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-c-conceptual-1">Tiny Code (C, Conceptual)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb268"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node<span class="op">*</span> next<span class="op">;</span></span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb268-8"><a href="#cb268-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-9"><a href="#cb268-9" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb268-10"><a href="#cb268-10" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> head<span class="op">;</span></span>
<span id="cb268-11"><a href="#cb268-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> PList<span class="op">;</span></span>
<span id="cb268-12"><a href="#cb268-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-13"><a href="#cb268-13" aria-hidden="true" tabindex="-1"></a>PList push_front<span class="op">(</span>PList list<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb268-14"><a href="#cb268-14" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span> new_node <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb268-15"><a href="#cb268-15" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb268-16"><a href="#cb268-16" aria-hidden="true" tabindex="-1"></a>    new_node<span class="op">-&gt;</span>next <span class="op">=</span> list<span class="op">.</span>head<span class="op">;</span></span>
<span id="cb268-17"><a href="#cb268-17" aria-hidden="true" tabindex="-1"></a>    PList new_list <span class="op">=</span> <span class="op">{</span> new_node <span class="op">};</span></span>
<span id="cb268-18"><a href="#cb268-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_list<span class="op">;</span></span>
<span id="cb268-19"><a href="#cb268-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb268-20"><a href="#cb268-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-21"><a href="#cb268-21" aria-hidden="true" tabindex="-1"></a>PList pop_front<span class="op">(</span>PList list<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> popped<span class="op">)</span> <span class="op">{</span></span>
<span id="cb268-22"><a href="#cb268-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>list<span class="op">.</span>head<span class="op">)</span> <span class="cf">return</span> list<span class="op">;</span></span>
<span id="cb268-23"><a href="#cb268-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>popped <span class="op">=</span> list<span class="op">.</span>head<span class="op">-&gt;</span>value<span class="op">;</span></span>
<span id="cb268-24"><a href="#cb268-24" aria-hidden="true" tabindex="-1"></a>    PList new_list <span class="op">=</span> <span class="op">{</span> list<span class="op">.</span>head<span class="op">-&gt;</span>next <span class="op">};</span></span>
<span id="cb268-25"><a href="#cb268-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_list<span class="op">;</span></span>
<span id="cb268-26"><a href="#cb268-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>No mutations, only new nodes allocated.</p>
</section>
<section id="why-it-matters-82" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-82">Why It Matters</h3>
<ul>
<li>Immutable, perfect for functional programs</li>
<li>Undo / Time-travel, revisit old versions</li>
<li>Safe concurrency, no data races</li>
<li>Memory-efficient, tail sharing reuses old structure</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-82" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-82">A Gentle Proof (Why It Works)</h3>
<p>Let <span class="math inline">\(n\)</span> be number of operations. Each <code>push_front</code> or <code>pop_front</code> creates at most one new node.</p>
<p>Thus:</p>
<ul>
<li>Total space after <span class="math inline">\(n\)</span> ops: <span class="math inline">\(O(n)\)</span></li>
<li>Time per operation: <span class="math inline">\(O(1)\)</span></li>
</ul>
<p>Persistence is guaranteed since no node is modified in place.</p>
<p>All versions share the unchanged suffix:</p>
<p><span class="math display">\[
v_k = \text{Node}(x_k, v_{k-1})
\]</span></p>
<p>Hence, structure sharing is linear and safe.</p>
</section>
<section id="try-it-yourself-82" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-82">Try It Yourself</h3>
<ol type="1">
<li>Start with empty list</li>
<li>Push 3 → Push 2 → Push 1</li>
<li>Pop once</li>
<li>Print all versions</li>
<li>Observe how tails are shared</li>
</ol>
</section>
<section id="test-cases-82" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-82">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Input</th>
<th>Output</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>push_front</td>
<td>10</td>
<td>[10]</td>
<td>v1</td>
</tr>
<tr class="even">
<td>push_front</td>
<td>20</td>
<td>[20, 10]</td>
<td>v2</td>
</tr>
<tr class="odd">
<td>pop_front</td>
<td>,</td>
<td>[10]</td>
<td>v3</td>
</tr>
<tr class="even">
<td>to_list</td>
<td>v1</td>
<td>[10]</td>
<td>,</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-82" class="level3">
<h3 class="anchored" data-anchor-id="complexity-82">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>push_front</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>new head only</td>
</tr>
<tr class="even">
<td>pop_front</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>reuse next</td>
</tr>
<tr class="odd">
<td>access</td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>,</td>
<td>same as linked list</td>
</tr>
</tbody>
</table>
<p>A persistent linked list is the simplest gateway to persistence, each operation is <span class="math inline">\(O(1)\)</span>, each version immortal. It’s the backbone of functional stacks, queues, and immutable collections.</p>
</section>
<section id="finger-tree" class="level3">
<h3 class="anchored" data-anchor-id="finger-tree">286 Finger Tree</h3>
<p>A finger tree is a versatile, persistent data structure that provides amortized O(1) access to both ends (front and back) and O(log n) access or updates in the middle.</p>
<p>It’s a functional, immutable sequence structure, a balanced tree augmented with <em>fingers</em> (fast access points) to its ends. Finger trees form the foundation for many persistent data types, such as queues, deques, priority sequences, and even rope-like text editors.</p>
</section>
<section id="what-problem-are-we-solving-83" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-83">What Problem Are We Solving?</h3>
<p>Immutable lists are fast at the front but slow at the back. Immutable arrays are the opposite. Deques with persistence are hard to maintain efficiently.</p>
<p>We want:</p>
<ul>
<li><span class="math inline">\(O(1)\)</span> front access</li>
<li><span class="math inline">\(O(1)\)</span> back access</li>
<li><span class="math inline">\(O(\log n)\)</span> middle access</li>
<li>Persistence and immutability</li>
</ul>
<p>Finger trees achieve this by combining shallow digit buffers at the edges with balanced nodes in the middle.</p>
</section>
<section id="how-it-works-plain-language-48" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-48">How It Works (Plain Language)</h3>
<p>A finger tree is built recursively:</p>
<pre><code>FingerTree = Empty
           | Single(a)
           | Deep(prefix, deeper_tree, suffix)</code></pre>
<ul>
<li>prefix and suffix: small arrays (digits) with 1–4 elements</li>
<li>deeper_tree: recursively holds nodes of higher rank</li>
</ul>
<p>The <em>fingers</em> (prefix/suffix) give constant-time access to both ends. Insertions push elements into digits; when full, they roll into the deeper tree.</p>
<section id="example-35" class="level4">
<h4 class="anchored" data-anchor-id="example-35">Example</h4>
<p>Insert 1, 2, 3, 4, 5:</p>
<pre><code>Deep [1,2] (Node [3,4]) [5]</code></pre>
<p>You can:</p>
<ul>
<li>Push front → prepend into prefix</li>
<li>Push back → append into suffix</li>
<li>Access ends in O(1)</li>
<li>Insert middle → recurse into deeper tree (O(log n))</li>
</ul>
<p>Each operation returns a new version sharing unchanged subtrees.</p>
</section>
</section>
<section id="example-state" class="level3">
<h3 class="anchored" data-anchor-id="example-state">Example State</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Structure</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>empty</td>
<td><code>Empty</code></td>
<td>base</td>
</tr>
<tr class="even">
<td>push_front(1)</td>
<td><code>Single(1)</code></td>
<td>one element</td>
</tr>
<tr class="odd">
<td>push_front(2)</td>
<td><code>Deep [2] Empty [1]</code></td>
<td>two ends</td>
</tr>
<tr class="even">
<td>push_back(3)</td>
<td><code>Deep [2] Empty [1,3]</code></td>
<td>add suffix</td>
</tr>
<tr class="odd">
<td>push_back(4)</td>
<td><code>Deep [2,4] Empty [1,3]</code></td>
<td>balanced growth</td>
</tr>
</tbody>
</table>
<p>Each version reuses most of its structure, ensuring persistence.</p>
</section>
<section id="tiny-code-python-conceptual" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-conceptual">Tiny Code (Python – Conceptual)</h3>
<p>This is a simplified model, not a complete implementation (real finger trees rely on more type-level machinery).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb271"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Empty:</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Single:</span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, value):</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.value <span class="op">=</span> value</span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Deep:</span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, prefix, middle, suffix):</span>
<span id="cb271-10"><a href="#cb271-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.prefix <span class="op">=</span> prefix</span>
<span id="cb271-11"><a href="#cb271-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.middle <span class="op">=</span> middle</span>
<span id="cb271-12"><a href="#cb271-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.suffix <span class="op">=</span> suffix</span>
<span id="cb271-13"><a href="#cb271-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-14"><a href="#cb271-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> push_front(tree, x):</span>
<span id="cb271-15"><a href="#cb271-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(tree, Empty):</span>
<span id="cb271-16"><a href="#cb271-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Single(x)</span>
<span id="cb271-17"><a href="#cb271-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(tree, Single):</span>
<span id="cb271-18"><a href="#cb271-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Deep([x], Empty(), [tree.value])</span>
<span id="cb271-19"><a href="#cb271-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(tree.prefix) <span class="op">&lt;</span> <span class="dv">4</span>:</span>
<span id="cb271-20"><a href="#cb271-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Deep([x] <span class="op">+</span> tree.prefix, tree.middle, tree.suffix)</span>
<span id="cb271-21"><a href="#cb271-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb271-22"><a href="#cb271-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># roll prefix into deeper tree</span></span>
<span id="cb271-23"><a href="#cb271-23" aria-hidden="true" tabindex="-1"></a>        new_middle <span class="op">=</span> push_front(tree.middle, tree.prefix)</span>
<span id="cb271-24"><a href="#cb271-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Deep([x], new_middle, tree.suffix)</span>
<span id="cb271-25"><a href="#cb271-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-26"><a href="#cb271-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_list(tree):</span>
<span id="cb271-27"><a href="#cb271-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(tree, Empty):</span>
<span id="cb271-28"><a href="#cb271-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb271-29"><a href="#cb271-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(tree, Single):</span>
<span id="cb271-30"><a href="#cb271-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [tree.value]</span>
<span id="cb271-31"><a href="#cb271-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tree.prefix <span class="op">+</span> to_list(tree.middle) <span class="op">+</span> tree.suffix</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This captures the core recursive flavor, constant-time fingers, logarithmic recursion.</p>
</section>
<section id="why-it-matters-83" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-83">Why It Matters</h3>
<ul>
<li><p>Generic framework for sequences</p></li>
<li><p>Amortized O(1) insertion/removal at both ends</p></li>
<li><p>O(log n) concatenation, split, or search</p></li>
<li><p>Basis for:</p>
<ul>
<li>Functional deques</li>
<li>Priority queues</li>
<li>Ordered sequences (like RRB-trees)</li>
<li>Incremental editors</li>
</ul></li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-83" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-83">A Gentle Proof (Why It Works)</h3>
<p>Digits store up to 4 elements, guaranteeing bounded overhead. Each recursive step reduces the size by a constant factor, ensuring depth = <span class="math inline">\(O(\log n)\)</span>.</p>
<p>For each operation:</p>
<ul>
<li>Ends touched in <span class="math inline">\(O(1)\)</span></li>
<li>Structural changes at depth <span class="math inline">\(O(\log n)\)</span></li>
</ul>
<p>Thus, total cost:</p>
<p><span class="math display">\[
T(n) = O(\log n), \quad \text{amortized O(1) at ends}
\]</span></p>
<p>Persistence is ensured because all updates build new nodes without modifying existing ones.</p>
</section>
<section id="try-it-yourself-83" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-83">Try It Yourself</h3>
<ol type="1">
<li>Start with empty tree.</li>
<li>Push 1, 2, 3, 4.</li>
<li>Pop front, observe structure.</li>
<li>Push 5, inspect sharing between versions.</li>
<li>Convert each version to list, compare results.</li>
</ol>
</section>
<section id="test-cases-83" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-83">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>push_front(1)</td>
<td>[1]</td>
<td>base</td>
</tr>
<tr class="even">
<td>push_front(2)</td>
<td>[2, 1]</td>
<td>prefix growth</td>
</tr>
<tr class="odd">
<td>push_back(3)</td>
<td>[2, 1, 3]</td>
<td>suffix add</td>
</tr>
<tr class="even">
<td>pop_front()</td>
<td>[1, 3]</td>
<td>remove from prefix</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-83" class="level3">
<h3 class="anchored" data-anchor-id="complexity-83">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>push_front/back</td>
<td><span class="math inline">\(O(1)\)</span> amortized</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>uses digits</td>
</tr>
<tr class="even">
<td>pop_front/back</td>
<td><span class="math inline">\(O(1)\)</span> amortized</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>constant fingers</td>
</tr>
<tr class="odd">
<td>random access</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td>recursion</td>
</tr>
<tr class="even">
<td>concat/split</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td>efficient split</td>
</tr>
</tbody>
</table>
<p>A finger tree is the Swiss Army knife of persistent sequences, fast at both ends, balanced within, and beautifully immutable. It’s the blueprint behind countless functional data structures.</p>
</section>
<section id="zipper-structure" class="level3">
<h3 class="anchored" data-anchor-id="zipper-structure">287 Zipper Structure</h3>
<p>A zipper is a powerful technique that makes immutable data structures behave like mutable ones. It provides a focus—a pointer-like position—inside a persistent structure (list, tree, etc.), allowing localized updates, navigation, and edits without mutation.</p>
<p>Think of it as a cursor in a purely functional world. Every movement or edit yields a new version, while sharing unmodified parts.</p>
</section>
<section id="what-problem-are-we-solving-84" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-84">What Problem Are We Solving?</h3>
<p>Immutable data structures can’t be “modified in place.” You can’t just “move a cursor” or “replace an element” without reconstructing the entire structure.</p>
<p>A zipper solves this by maintaining:</p>
<ol type="1">
<li>The focused element, and</li>
<li>The context (what’s on the left/right or above/below).</li>
</ol>
<p>You can then move, update, or rebuild efficiently, reusing everything else.</p>
</section>
<section id="how-it-works-plain-language-49" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-49">How It Works (Plain Language)</h3>
<p>A zipper separates a structure into:</p>
<ul>
<li>Focus: current element under attention</li>
<li>Context: reversible description of the path you took</li>
</ul>
<p>When you move the focus, you update the context. When you change the focused element, you create a new node and rebuild from context.</p>
<p>For lists:</p>
<pre><code>Zipper = (Left, Focus, Right)</code></pre>
<p>For trees:</p>
<pre><code>Zipper = (ParentContext, FocusNode)</code></pre>
<p>You can think of it like a tape in a Turing machine—everything to the left and right is preserved.</p>
</section>
<section id="example-list-zipper" class="level3">
<h3 class="anchored" data-anchor-id="example-list-zipper">Example (List Zipper)</h3>
<p>We represent a list <code>[a, b, c, d]</code> with a cursor on <code>c</code>:</p>
<pre><code>Left: [b, a]   Focus: c   Right: [d]</code></pre>
<p>From here:</p>
<ul>
<li><code>move_left</code> → focus = <code>b</code></li>
<li><code>move_right</code> → focus = <code>d</code></li>
<li><code>update(x)</code> → replace <code>c</code> with <code>x</code></li>
</ul>
<p>All in O(1), returning a new zipper version.</p>
<section id="example-operations" class="level4">
<h4 class="anchored" data-anchor-id="example-operations">Example Operations</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Result</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>from_list([a,b,c,d])</code></td>
<td>([ ], a, [b,c,d])</td>
<td>init at head</td>
</tr>
<tr class="even">
<td><code>move_right</code></td>
<td>([a], b, [c,d])</td>
<td>shift focus right</td>
</tr>
<tr class="odd">
<td><code>update('X')</code></td>
<td>([a], X, [c,d])</td>
<td>replace focus</td>
</tr>
<tr class="even">
<td><code>to_list</code></td>
<td>[a,X,c,d]</td>
<td>rebuild full list</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="tiny-code-python-list-zipper" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-list-zipper">Tiny Code (Python – List Zipper)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb275"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Zipper:</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, left<span class="op">=</span><span class="va">None</span>, focus<span class="op">=</span><span class="va">None</span>, right<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> left <span class="kw">or</span> []</span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.focus <span class="op">=</span> focus</span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> right <span class="kw">or</span> []</span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> from_list(lst):</span>
<span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> lst: <span class="cf">return</span> Zipper([], <span class="va">None</span>, [])</span>
<span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Zipper([], lst[<span class="dv">0</span>], lst[<span class="dv">1</span>:])</span>
<span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> move_left(<span class="va">self</span>):</span>
<span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.left: <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Zipper(<span class="va">self</span>.left[:<span class="op">-</span><span class="dv">1</span>], <span class="va">self</span>.left[<span class="op">-</span><span class="dv">1</span>], [<span class="va">self</span>.focus] <span class="op">+</span> <span class="va">self</span>.right)</span>
<span id="cb275-15"><a href="#cb275-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-16"><a href="#cb275-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> move_right(<span class="va">self</span>):</span>
<span id="cb275-17"><a href="#cb275-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.right: <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb275-18"><a href="#cb275-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Zipper(<span class="va">self</span>.left <span class="op">+</span> [<span class="va">self</span>.focus], <span class="va">self</span>.right[<span class="dv">0</span>], <span class="va">self</span>.right[<span class="dv">1</span>:])</span>
<span id="cb275-19"><a href="#cb275-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-20"><a href="#cb275-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update(<span class="va">self</span>, value):</span>
<span id="cb275-21"><a href="#cb275-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Zipper(<span class="va">self</span>.left, value, <span class="va">self</span>.right)</span>
<span id="cb275-22"><a href="#cb275-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-23"><a href="#cb275-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_list(<span class="va">self</span>):</span>
<span id="cb275-24"><a href="#cb275-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.left <span class="op">+</span> [<span class="va">self</span>.focus] <span class="op">+</span> <span class="va">self</span>.right</span>
<span id="cb275-25"><a href="#cb275-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-26"><a href="#cb275-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb275-27"><a href="#cb275-27" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> Zipper.from_list([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>])</span>
<span id="cb275-28"><a href="#cb275-28" aria-hidden="true" tabindex="-1"></a>z1 <span class="op">=</span> z.move_right().move_right()   <span class="co"># focus on 'c'</span></span>
<span id="cb275-29"><a href="#cb275-29" aria-hidden="true" tabindex="-1"></a>z2 <span class="op">=</span> z1.update(<span class="st">'X'</span>)</span>
<span id="cb275-30"><a href="#cb275-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(z2.to_list())  <span class="co"># ['a', 'b', 'X', 'd']</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each operation returns a new zipper, persistent editing made simple.</p>
</section>
<section id="example-tree-zipper-conceptual" class="level3">
<h3 class="anchored" data-anchor-id="example-tree-zipper-conceptual">Example (Tree Zipper – Conceptual)</h3>
<p>A tree zipper stores the path to the root as context:</p>
<pre><code>Zipper = (ParentPath, FocusNode)</code></pre>
<p>Each parent in the path remembers which side you came from, so you can rebuild upward after an edit.</p>
<p>For example, editing a leaf <code>L</code> creates a new <code>L'</code> and rebuilds only the nodes along the path, leaving other subtrees untouched.</p>
</section>
<section id="why-it-matters-84" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-84">Why It Matters</h3>
<ul>
<li>Enables localized updates in immutable structures</li>
<li>Used in functional editors, parsers, navigation systems</li>
<li>Provides O(1) local movement, O(depth) rebuilds</li>
<li>Core concept in Huet’s zipper, a foundational idea in functional programming</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-84" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-84">A Gentle Proof (Why It Works)</h3>
<p>Each movement or edit affects only the local context:</p>
<ul>
<li>Move left/right in a list → <span class="math inline">\(O(1)\)</span></li>
<li>Move up/down in a tree → <span class="math inline">\(O(1)\)</span></li>
<li>Rebuilding full structure → <span class="math inline">\(O(\text{depth})\)</span></li>
</ul>
<p>No mutation occurs; each version reuses all untouched substructures.</p>
<p>Formally, if <span class="math inline">\(S\)</span> is the original structure and <span class="math inline">\(f\)</span> the focus, <span class="math display">\[
\text{zip}(S) = (\text{context}, f)
\]</span> and <span class="math display">\[
\text{unzip}(\text{context}, f) = S
\]</span> ensuring reversibility.</p>
</section>
<section id="try-it-yourself-84" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-84">Try It Yourself</h3>
<ol type="1">
<li>Create a zipper from <code>[1,2,3,4]</code></li>
<li>Move focus to 3</li>
<li>Update focus to 99</li>
<li>Rebuild full list</li>
<li>Verify older zipper still has old value</li>
</ol>
</section>
<section id="test-cases-84" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-84">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Result</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>from_list([a,b,c,d])</code></td>
<td>([ ], a, [b,c,d])</td>
<td>init</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>move_right()</code></td>
<td>([a], b, [c,d])</td>
<td>shift focus</td>
</tr>
<tr class="odd">
<td>3</td>
<td><code>update('X')</code></td>
<td>([a], X, [c,d])</td>
<td>edit</td>
</tr>
<tr class="even">
<td>4</td>
<td><code>to_list()</code></td>
<td>[a, X, c, d]</td>
<td>rebuild</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-84" class="level3">
<h3 class="anchored" data-anchor-id="complexity-84">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Move left/right</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>shift focus</td>
</tr>
<tr class="even">
<td>Update</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>local replacement</td>
</tr>
<tr class="odd">
<td>Rebuild</td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>when unzipping</td>
</tr>
<tr class="even">
<td>Access old version</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>,</td>
<td>persistent</td>
</tr>
</tbody>
</table>
<p>A zipper turns immutability into interactivity. With a zipper, you can move, focus, and edit, all without breaking persistence. It’s the bridge between static structure and dynamic navigation.</p>
</section>
<section id="trie-with-versioning" class="level3">
<h3 class="anchored" data-anchor-id="trie-with-versioning">289 Trie with Versioning</h3>
<p>A Trie with Versioning is a persistent data structure that stores strings (or sequences) across multiple historical versions. Each new update—an insertion, deletion, or modification—creates a new version of the trie without mutating previous ones, using path copying for structural sharing.</p>
<p>This enables time-travel queries: you can look up keys as they existed at any point in history.</p>
</section>
<section id="what-problem-are-we-solving-85" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-85">What Problem Are We Solving?</h3>
<p>We want to maintain a versioned dictionary of strings or sequences, supporting:</p>
<ul>
<li>Fast prefix search (<span class="math inline">\(O(\text{length})\)</span>)</li>
<li>Efficient updates without mutation</li>
<li>Access to past versions (e.g., snapshots, undo/redo, history)</li>
</ul>
<p>A versioned trie achieves all three by copying only the path from the root to modified nodes while sharing all other subtrees.</p>
<p>Common use cases:</p>
<ul>
<li>Versioned symbol tables</li>
<li>Historical dictionaries</li>
<li>Autocomplete with rollback</li>
<li>Persistent tries in functional languages</li>
</ul>
</section>
<section id="how-it-works-plain-language-50" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-50">How It Works (Plain Language)</h3>
<p>Each trie node contains:</p>
<ul>
<li>A mapping from character → child node</li>
<li>A flag marking end of word</li>
</ul>
<p>For persistence:</p>
<ul>
<li>When you insert or delete, copy only nodes on the affected path.</li>
<li>Old nodes remain untouched and shared by old versions.</li>
</ul>
<p>Thus, version <span class="math inline">\(v_{k+1}\)</span> differs from <span class="math inline">\(v_k\)</span> only along the modified path.</p>
</section>
<section id="tiny-code-conceptual-python" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-conceptual-python">Tiny Code (Conceptual Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb277"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TrieNode:</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, children<span class="op">=</span><span class="va">None</span>, is_end<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.children <span class="op">=</span> <span class="bu">dict</span>(children <span class="kw">or</span> {})</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.is_end <span class="op">=</span> is_end</span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(root, word):</span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _insert(node, i):</span>
<span id="cb277-8"><a href="#cb277-8" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> TrieNode(node.children, node.is_end)</span>
<span id="cb277-9"><a href="#cb277-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="bu">len</span>(word):</span>
<span id="cb277-10"><a href="#cb277-10" aria-hidden="true" tabindex="-1"></a>            node.is_end <span class="op">=</span> <span class="va">True</span></span>
<span id="cb277-11"><a href="#cb277-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> node</span>
<span id="cb277-12"><a href="#cb277-12" aria-hidden="true" tabindex="-1"></a>        ch <span class="op">=</span> word[i]</span>
<span id="cb277-13"><a href="#cb277-13" aria-hidden="true" tabindex="-1"></a>        node.children[ch] <span class="op">=</span> _insert(node.children.get(ch, TrieNode()), i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb277-14"><a href="#cb277-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node</span>
<span id="cb277-15"><a href="#cb277-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _insert(root, <span class="dv">0</span>)</span>
<span id="cb277-16"><a href="#cb277-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-17"><a href="#cb277-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search(root, word):</span>
<span id="cb277-18"><a href="#cb277-18" aria-hidden="true" tabindex="-1"></a>    node <span class="op">=</span> root</span>
<span id="cb277-19"><a href="#cb277-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ch <span class="kw">in</span> word:</span>
<span id="cb277-20"><a href="#cb277-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ch <span class="kw">not</span> <span class="kw">in</span> node.children:</span>
<span id="cb277-21"><a href="#cb277-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb277-22"><a href="#cb277-22" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> node.children[ch]</span>
<span id="cb277-23"><a href="#cb277-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> node.is_end</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each call to <code>insert</code> returns a new root (new version), sharing all unmodified branches.</p>
</section>
<section id="example-36" class="level3">
<h3 class="anchored" data-anchor-id="example-36">Example</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Version</th>
<th>Operation</th>
<th>Trie Content</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v1</td>
<td>insert(“cat”)</td>
<td>{ “cat” }</td>
</tr>
<tr class="even">
<td>v2</td>
<td>insert(“car”)</td>
<td>{ “cat”, “car” }</td>
</tr>
<tr class="odd">
<td>v3</td>
<td>insert(“dog”)</td>
<td>{ “cat”, “car”, “dog” }</td>
</tr>
<tr class="even">
<td>v4</td>
<td>delete(“car”)</td>
<td>{ “cat”, “dog” }</td>
</tr>
</tbody>
</table>
<p>Versions share nodes for prefix <code>"c"</code> between all earlier versions.</p>
</section>
<section id="why-it-matters-85" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-85">Why It Matters</h3>
<ul>
<li>Immutable and Safe: No in-place mutation, perfect for functional systems</li>
<li>Efficient Rollback: Access any prior version in <span class="math inline">\(O(1)\)</span> time</li>
<li>Prefix Sharing: Saves memory through structural reuse</li>
<li>Practical for History: Ideal for versioned dictionaries, IDEs, search indices</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-85" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-85">A Gentle Proof (Why It Works)</h3>
<p>Each insertion copies one path of length <span class="math inline">\(L\)</span> (word length). Total time complexity: <span class="math display">\[
T_{\text{insert}} = O(L)
\]</span></p>
<p>Each node on the new path shares all other unchanged subtrees. If <span class="math inline">\(N\)</span> is total stored characters across all versions, <span class="math display">\[
\text{Space} = O(N)
\]</span></p>
<p>Each version root is a single pointer, enabling <span class="math inline">\(O(1)\)</span> access: <span class="math display">\[
\text{Version}_i = \text{Root}_i
\]</span></p>
<p>Old versions remain fully usable, as they never mutate.</p>
</section>
<section id="try-it-yourself-85" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-85">Try It Yourself</h3>
<ol type="1">
<li>Insert “cat”, “car”, “dog” into versioned trie</li>
<li>Delete “car” to form new version</li>
<li>Query prefix “ca” in all versions</li>
<li>Check that “car” exists only before deletion</li>
<li>Print shared node counts across versions</li>
</ol>
</section>
<section id="test-case" class="level3">
<h3 class="anchored" data-anchor-id="test-case">Test Case</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Version</th>
<th>Exists in Version</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>insert(“cat”)</td>
<td>v1</td>
<td>cat</td>
<td>True</td>
</tr>
<tr class="even">
<td>2</td>
<td>insert(“car”)</td>
<td>v2</td>
<td>car, cat</td>
<td>True</td>
</tr>
<tr class="odd">
<td>3</td>
<td>insert(“dog”)</td>
<td>v3</td>
<td>cat, car, dog</td>
<td>True</td>
</tr>
<tr class="even">
<td>4</td>
<td>delete(“car”)</td>
<td>v4</td>
<td>car (no), cat, dog</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-85" class="level3">
<h3 class="anchored" data-anchor-id="complexity-85">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Insert</td>
<td><span class="math inline">\(O(L)\)</span></td>
<td><span class="math inline">\(O(L)\)</span></td>
<td>Path-copying</td>
</tr>
<tr class="even">
<td>Delete</td>
<td><span class="math inline">\(O(L)\)</span></td>
<td><span class="math inline">\(O(L)\)</span></td>
<td>Path-copying</td>
</tr>
<tr class="odd">
<td>Lookup</td>
<td><span class="math inline">\(O(L)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>Follows shared structure</td>
</tr>
<tr class="even">
<td>Access old version</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>,</td>
<td>Version pointer access</td>
</tr>
</tbody>
</table>
<p>A Trie with Versioning blends structural sharing with prefix indexing. Each version is a frozen snapshot—compact, queryable, and immutable—perfect for versioned word histories.</p>
</section>
<section id="persistent-union-find" class="level3">
<h3 class="anchored" data-anchor-id="persistent-union-find">290 Persistent Union-Find</h3>
<p>A Persistent Union-Find extends the classical Disjoint Set Union (DSU) structure to support <em>time-travel queries</em>. Instead of mutating the parent and rank arrays in place, each union operation produces a new version, enabling queries like:</p>
<ul>
<li>“Are <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> connected at version <span class="math inline">\(v\)</span>?”</li>
<li>“What did the set look like before the last merge?”</li>
</ul>
<p>This structure is vital for dynamic connectivity problems where the history of unions matters.</p>
</section>
<section id="what-problem-are-we-solving-86" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-86">What Problem Are We Solving?</h3>
<p>Classical DSU supports <code>find</code> and <code>union</code> efficiently in near-constant time, but only for a single evolving state. Once you merge two sets, the old version is gone.</p>
<p>We need a versioned DSU that keeps all previous states intact, supporting:</p>
<ul>
<li>Undo/rollback of operations</li>
<li>Queries over past connectivity</li>
<li>Offline dynamic connectivity analysis</li>
</ul>
</section>
<section id="how-it-works-plain-language-51" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-51">How It Works (Plain Language)</h3>
<p>A Persistent Union-Find uses path copying (similar to persistent arrays) to maintain multiple versions:</p>
<ul>
<li>Each <code>union</code> creates a new version</li>
<li>Only affected parent and rank entries are updated in a new structure</li>
<li>All other nodes share structure with the previous version</li>
</ul>
<p>There are two main designs:</p>
<ol type="1">
<li>Full persistence using path copying in functional style</li>
<li>Partial persistence using rollback stack (undo operations)</li>
</ol>
<p>We focus here on <em>full persistence</em>.</p>
</section>
<section id="tiny-code-conceptual-python-1" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-conceptual-python-1">Tiny Code (Conceptual Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb278"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PersistentDSU:</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n):</span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.versions <span class="op">=</span> []</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>        parent <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(n))</span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>        rank <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> n</span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.versions.append((parent, rank))</span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find(<span class="va">self</span>, parent, x):</span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> parent[x] <span class="op">==</span> x:</span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> x</span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.find(parent, parent[x])</span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb278-13"><a href="#cb278-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> union(<span class="va">self</span>, ver, x, y):</span>
<span id="cb278-14"><a href="#cb278-14" aria-hidden="true" tabindex="-1"></a>        parent, rank <span class="op">=</span> [<span class="op">*</span>ver[<span class="dv">0</span>]], [<span class="op">*</span>ver[<span class="dv">1</span>]]  <span class="co"># copy arrays</span></span>
<span id="cb278-15"><a href="#cb278-15" aria-hidden="true" tabindex="-1"></a>        rx, ry <span class="op">=</span> <span class="va">self</span>.find(parent, x), <span class="va">self</span>.find(parent, y)</span>
<span id="cb278-16"><a href="#cb278-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rx <span class="op">!=</span> ry:</span>
<span id="cb278-17"><a href="#cb278-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rank[rx] <span class="op">&lt;</span> rank[ry]:</span>
<span id="cb278-18"><a href="#cb278-18" aria-hidden="true" tabindex="-1"></a>                parent[rx] <span class="op">=</span> ry</span>
<span id="cb278-19"><a href="#cb278-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> rank[rx] <span class="op">&gt;</span> rank[ry]:</span>
<span id="cb278-20"><a href="#cb278-20" aria-hidden="true" tabindex="-1"></a>                parent[ry] <span class="op">=</span> rx</span>
<span id="cb278-21"><a href="#cb278-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb278-22"><a href="#cb278-22" aria-hidden="true" tabindex="-1"></a>                parent[ry] <span class="op">=</span> rx</span>
<span id="cb278-23"><a href="#cb278-23" aria-hidden="true" tabindex="-1"></a>                rank[rx] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb278-24"><a href="#cb278-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.versions.append((parent, rank))</span>
<span id="cb278-25"><a href="#cb278-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.versions) <span class="op">-</span> <span class="dv">1</span>  <span class="co"># new version index</span></span>
<span id="cb278-26"><a href="#cb278-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb278-27"><a href="#cb278-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> connected(<span class="va">self</span>, ver, x, y):</span>
<span id="cb278-28"><a href="#cb278-28" aria-hidden="true" tabindex="-1"></a>        parent, _ <span class="op">=</span> <span class="va">self</span>.versions[ver]</span>
<span id="cb278-29"><a href="#cb278-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.find(parent, x) <span class="op">==</span> <span class="va">self</span>.find(parent, y)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each union returns a new version index. You can query <code>connected(version, a, b)</code> at any time.</p>
</section>
<section id="example-37" class="level3">
<h3 class="anchored" data-anchor-id="example-37">Example</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Version</th>
<th>Connections</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>make-set(5)</td>
<td>v0</td>
<td>0 1 2 3 4</td>
</tr>
<tr class="even">
<td>2</td>
<td>union(0,1)</td>
<td>v1</td>
<td>{0,1}, 2, 3, 4</td>
</tr>
<tr class="odd">
<td>3</td>
<td>union(2,3)</td>
<td>v2</td>
<td>{0,1}, {2,3}, 4</td>
</tr>
<tr class="even">
<td>4</td>
<td>union(1,2)</td>
<td>v3</td>
<td>{0,1,2,3}, 4</td>
</tr>
<tr class="odd">
<td>5</td>
<td>query connected(0,1)</td>
<td>v1</td>
<td>True</td>
</tr>
<tr class="even">
<td>6</td>
<td>query connected(1,3)</td>
<td>v1</td>
<td>False (not yet merged)</td>
</tr>
</tbody>
</table>
<p>You can check connections at any version.</p>
</section>
<section id="why-it-matters-86" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-86">Why It Matters</h3>
<ul>
<li>Time-travel queries across historical versions</li>
<li>Non-destructive updates allow safe rollback</li>
<li>Crucial for offline dynamic connectivity, e.g., edge insertions over time</li>
<li>Simplifies debugging, simulation, and version tracking</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-86" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-86">A Gentle Proof (Why It Works)</h3>
<p>Let <span class="math inline">\(n\)</span> be the number of elements and <span class="math inline">\(q\)</span> the number of versions.</p>
<p>Each version differs in only a small number of parent/rank entries. If each <code>union</code> copies <span class="math inline">\(O(\alpha(n))\)</span> elements, total space after <span class="math inline">\(q\)</span> operations is:</p>
<p><span class="math display">\[
O(n + q \alpha(n))
\]</span></p>
<p>Each query operates on a fixed version in:</p>
<p><span class="math display">\[
O(\alpha(n))
\]</span></p>
<p>Path compression is often replaced with <em>partial compression</em> or omitted to ensure persistence (full path compression breaks immutability).</p>
</section>
<section id="try-it-yourself-86" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-86">Try It Yourself</h3>
<ol type="1">
<li>Initialize DSU with 5 elements</li>
<li>Perform unions step by step, saving each version</li>
<li>Query connectivity across multiple versions</li>
<li>Undo merges by reverting to older versions</li>
<li>Visualize parent tree evolution</li>
</ol>
</section>
<section id="test-cases-85" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-85">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Version</th>
<th>Query</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v0</td>
<td>connected(0,1)</td>
<td>False</td>
</tr>
<tr class="even">
<td>v1</td>
<td>connected(0,1)</td>
<td>True</td>
</tr>
<tr class="odd">
<td>v2</td>
<td>connected(2,3)</td>
<td>True</td>
</tr>
<tr class="even">
<td>v3</td>
<td>connected(1,3)</td>
<td>True</td>
</tr>
<tr class="odd">
<td>v1</td>
<td>connected(1,3)</td>
<td>False</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-86" class="level3">
<h3 class="anchored" data-anchor-id="complexity-86">Complexity</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 21%">
<col style="width: 16%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Find</td>
<td><span class="math inline">\(O(\alpha(n))\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>Per version</td>
</tr>
<tr class="even">
<td>Union</td>
<td><span class="math inline">\(O(\alpha(n))\)</span></td>
<td><span class="math inline">\(O(n)\)</span> copy</td>
<td>Copy-on-write path</td>
</tr>
<tr class="odd">
<td>Connected</td>
<td><span class="math inline">\(O(\alpha(n))\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>Versioned query</td>
</tr>
<tr class="even">
<td>Access old version</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>,</td>
<td>Version pointer lookup</td>
</tr>
</tbody>
</table>
<p>A Persistent Union-Find is a historical map of connectivity. Each version captures a snapshot of relationships—immutable, queryable, and efficient—ideal for evolving graphs and rollback-capable algorithms.</p>
</section>
</section>
<section id="section-30.-advanced-trees-and-range-queries" class="level2">
<h2 class="anchored" data-anchor-id="section-30.-advanced-trees-and-range-queries">Section 30. Advanced Trees and Range Queries</h2>
<section id="sparse-table-build" class="level3">
<h3 class="anchored" data-anchor-id="sparse-table-build">291 Sparse Table Build</h3>
<p>A Sparse Table is a static data structure for answering idempotent range queries in O(1) time after O(n log n) preprocessing. It is perfect for Range Minimum/Maximum Query (RMQ), GCD, and any operation where combining overlapping answers is valid, such as <code>min</code>, <code>max</code>, <code>gcd</code>, <code>lcm</code> (with care), and bitwise <code>and/or</code>. It is not suitable for sum or other non-idempotent operations if you require O(1) queries.</p>
</section>
<section id="what-problem-are-we-solving-87" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-87">What Problem Are We Solving?</h3>
<p>Given an array <code>A[0..n-1]</code>, we want to answer queries like</p>
<ul>
<li>RMQ: minimum on interval <code>[L, R]</code></li>
<li>RMaxQ: maximum on interval <code>[L, R]</code> in O(1) time per query, with no updates.</li>
</ul>
</section>
<section id="how-it-works-plain-language-52" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-52">How It Works (Plain Language)</h3>
<p>Precompute answers for all ranges whose lengths are powers of two. Let <code>st[k][i]</code> store the answer on the interval of length <code>2^k</code> starting at <code>i</code>, that is <code>[i, i + 2^k - 1]</code>.</p>
<p>Build recurrence:</p>
<ul>
<li>Base layer <code>k = 0</code>: intervals of length 1 <code>st[0][i] = A[i]</code></li>
<li>Higher layers: combine two halves of length <code>2^{k-1}</code> <code>st[k][i] = op(st[k-1][i], st[k-1][i + 2^{k-1}])</code></li>
</ul>
<p>To answer a query on <code>[L, R]</code>, let <code>len = R - L + 1</code>, <code>k = floor(log2(len))</code>. For idempotent operations like <code>min</code> or <code>max</code>, we can cover the range with two overlapping blocks:</p>
<ul>
<li>Block 1: <code>[L, L + 2^k - 1]</code></li>
<li>Block 2: <code>[R - 2^k + 1, R]</code> Then <span class="math display">\[
\text{ans} = \operatorname{op}\big(\text{st}[k][L],\ \text{st}[k][R - 2^k + 1]\big)
\]</span></li>
</ul>
</section>
<section id="example-step-by-step-17" class="level3">
<h3 class="anchored" data-anchor-id="example-step-by-step-17">Example Step by Step</h3>
<p>Array <code>A = [7, 2, 3, 0, 5, 10, 3, 12, 18]</code>, <code>op = min</code>.</p>
<ol type="1">
<li><p>Build <code>st[0]</code> (length 1): <code>st[0] = [7, 2, 3, 0, 5, 10, 3, 12, 18]</code></p></li>
<li><p>Build <code>st[1]</code> (length 2): <code>st[1][i] = min(st[0][i], st[0][i+1])</code> <code>st[1] = [2, 2, 0, 0, 5, 3, 3, 12]</code></p></li>
<li><p>Build <code>st[2]</code> (length 4): <code>st[2][i] = min(st[1][i], st[1][i+2])</code> <code>st[2] = [0, 0, 0, 0, 3, 3]</code></p></li>
<li><p>Build <code>st[3]</code> (length 8): <code>st[3][i] = min(st[2][i], st[2][i+4])</code> <code>st[3] = [0, 0]</code></p></li>
</ol>
<p>Query example: RMQ on <code>[3, 8]</code> <code>len = 6</code>, <code>k = floor(log2(6)) = 2</code>, <code>2^k = 4</code></p>
<ul>
<li>Block 1: <code>[3, 6]</code> uses <code>st[2][3]</code></li>
<li>Block 2: <code>[5, 8]</code> uses <code>st[2][5]</code> Answer <span class="math display">\[
\min\big(\text{st}[2][3], \text{st}[2][5]\big) = \min(0, 3) = 0
\]</span></li>
</ul>
</section>
<section id="tiny-code-python-rmq-with-min" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-rmq-with-min">Tiny Code (Python, RMQ with min)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb279"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_sparse_table(arr, op<span class="op">=</span><span class="bu">min</span>):</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(arr)</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>    K <span class="op">=</span> math.floor(math.log2(n)) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>    st <span class="op">=</span> [[<span class="dv">0</span>] <span class="op">*</span> n <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(K)]</span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a>        st[<span class="dv">0</span>][i] <span class="op">=</span> arr[i]</span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a>    j <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> j) <span class="op">&lt;=</span> n:</span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a>        step <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> (j <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n <span class="op">-</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> j) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb279-13"><a href="#cb279-13" aria-hidden="true" tabindex="-1"></a>            st[j][i] <span class="op">=</span> op(st[j <span class="op">-</span> <span class="dv">1</span>][i], st[j <span class="op">-</span> <span class="dv">1</span>][i <span class="op">+</span> step])</span>
<span id="cb279-14"><a href="#cb279-14" aria-hidden="true" tabindex="-1"></a>        j <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb279-15"><a href="#cb279-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Precompute logs for O(1) queries</span></span>
<span id="cb279-16"><a href="#cb279-16" aria-hidden="true" tabindex="-1"></a>    lg <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> (n <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb279-17"><a href="#cb279-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, n <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb279-18"><a href="#cb279-18" aria-hidden="true" tabindex="-1"></a>        lg[i] <span class="op">=</span> lg[i <span class="op">//</span> <span class="dv">2</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb279-19"><a href="#cb279-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> st, lg</span>
<span id="cb279-20"><a href="#cb279-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-21"><a href="#cb279-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> query(st, lg, L, R, op<span class="op">=</span><span class="bu">min</span>):</span>
<span id="cb279-22"><a href="#cb279-22" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> R <span class="op">-</span> L <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb279-23"><a href="#cb279-23" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> lg[length]</span>
<span id="cb279-24"><a href="#cb279-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> op(st[k][L], st[k][R <span class="op">-</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> k) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb279-25"><a href="#cb279-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-26"><a href="#cb279-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb279-27"><a href="#cb279-27" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">7</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">12</span>, <span class="dv">18</span>]</span>
<span id="cb279-28"><a href="#cb279-28" aria-hidden="true" tabindex="-1"></a>st, lg <span class="op">=</span> build_sparse_table(A, op<span class="op">=</span><span class="bu">min</span>)</span>
<span id="cb279-29"><a href="#cb279-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(query(st, lg, <span class="dv">3</span>, <span class="dv">8</span>, op<span class="op">=</span><span class="bu">min</span>))  <span class="co"># 0</span></span>
<span id="cb279-30"><a href="#cb279-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(query(st, lg, <span class="dv">0</span>, <span class="dv">2</span>, op<span class="op">=</span><span class="bu">min</span>))  <span class="co"># 2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>For <code>max</code>, just pass <code>op=max</code>. For <code>gcd</code>, pass <code>math.gcd</code>.</p>
</section>
<section id="why-it-matters-87" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-87">Why It Matters</h3>
<ul>
<li>O(1) query time for static arrays</li>
<li>O(n log n) preprocessing with simple transitions</li>
<li>Excellent for RMQ style tasks, LCA via RMQ on Euler tours, and many competitive programming problems</li>
<li>Cache friendly and implementation simple compared to segment trees when no updates are needed</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-87" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-87">A Gentle Proof (Why It Works)</h3>
<p>The table stores answers for all intervals of length <code>2^k</code>. Any interval <code>[L, R]</code> can be covered by two overlapping power of two blocks of equal length <code>2^k</code>, where <code>k = floor(log2(R - L + 1))</code>. For idempotent operations <code>op</code>, overlap does not affect correctness, so <span class="math display">\[
\text{op}\big([L, R]\big) = \text{op}\big([L, L + 2^k - 1],\ [R - 2^k + 1, R]\big)
\]</span> Both blocks are precomputed, so the query is constant time.</p>
</section>
<section id="try-it-yourself-87" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-87">Try It Yourself</h3>
<ol type="1">
<li>Build a table for <code>A = [5, 4, 3, 6, 1, 2]</code> with <code>op = min</code>.</li>
<li>Answer RMQ on <code>[1, 4]</code> and <code>[0, 5]</code>.</li>
<li>Swap <code>op</code> to <code>max</code> and recheck.</li>
<li>Use <code>op = gcd</code> and verify results on several ranges.</li>
</ol>
</section>
<section id="test-cases-86" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-86">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Array</th>
<th>op</th>
<th>Query</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[7, 2, 3, 0, 5, 10, 3]</td>
<td>min</td>
<td>[0, 2]</td>
<td>2</td>
</tr>
<tr class="even">
<td>[7, 2, 3, 0, 5, 10, 3]</td>
<td>min</td>
<td>[3, 6]</td>
<td>0</td>
</tr>
<tr class="odd">
<td>[1, 5, 2, 4, 6, 1, 3]</td>
<td>max</td>
<td>[2, 5]</td>
<td>6</td>
</tr>
<tr class="even">
<td>[12, 18, 6, 9, 3]</td>
<td>gcd</td>
<td>[1, 4]</td>
<td>3</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-87" class="level3">
<h3 class="anchored" data-anchor-id="complexity-87">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Phase</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Preprocess</td>
<td><span class="math inline">\(O(n \log n)\)</span></td>
<td><span class="math inline">\(O(n \log n)\)</span></td>
</tr>
<tr class="even">
<td>Query</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>,</td>
</tr>
</tbody>
</table>
<p>Note Sparse Table supports static data. If you need updates, consider a segment tree or Fenwick tree. Sparse Table excels when the array is fixed and you need very fast queries.</p>
</section>
<section id="cartesian-tree" class="level3">
<h3 class="anchored" data-anchor-id="cartesian-tree">292 Cartesian Tree</h3>
<p>A Cartesian Tree is a binary tree built from an array such that:</p>
<ol type="1">
<li>In-order traversal of the tree reproduces the array, and</li>
<li>The tree satisfies the heap property with respect to the array values (min-heap or max-heap).</li>
</ol>
<p>This structure elegantly bridges arrays and binary trees, and plays a key role in algorithms for Range Minimum Query (RMQ), Lowest Common Ancestor (LCA), and sequence decomposition.</p>
</section>
<section id="what-problem-are-we-solving-88" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-88">What Problem Are We Solving?</h3>
<p>We want to represent an array <span class="math inline">\(A[0..n-1]\)</span> as a tree that encodes range relationships. For RMQ, if the tree is a min-heap Cartesian Tree, then the LCA of nodes <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> corresponds to the index of the minimum element in the range <span class="math inline">\([i, j]\)</span>.</p>
<p>Thus, building a Cartesian Tree gives us an elegant path from RMQ to LCA in <span class="math inline">\(O(1)\)</span> after <span class="math inline">\(O(n)\)</span> preprocessing.</p>
</section>
<section id="how-it-works-plain-language-53" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-53">How It Works (Plain Language)</h3>
<p>A Cartesian Tree is built recursively:</p>
<ul>
<li>The root is the smallest element (for min-heap) or largest (for max-heap).</li>
<li>The left subtree is built from elements to the left of the root.</li>
<li>The right subtree is built from elements to the right of the root.</li>
</ul>
<p>A more efficient linear-time construction uses a stack:</p>
<ol type="1">
<li>Traverse the array from left to right.</li>
<li>Maintain a stack of nodes in increasing order.</li>
<li>For each new element, pop while the top is greater, then attach the new node as the right child of the last popped node or the left child of the current top.</li>
</ol>
</section>
<section id="example-38" class="level3">
<h3 class="anchored" data-anchor-id="example-38">Example</h3>
<p>Let <span class="math inline">\(A = [3, 2, 6, 1, 9]\)</span></p>
<ol type="1">
<li><p>Start with empty stack</p></li>
<li><p>Insert 3 → stack = [3]</p></li>
<li><p>Insert 2 → pop 3 (since 3 &gt; 2)</p>
<ul>
<li>2 becomes parent of 3</li>
<li>stack = [2]</li>
</ul></li>
<li><p>Insert 6 → 6 &gt; 2 → right child</p>
<ul>
<li>stack = [2, 6]</li>
</ul></li>
<li><p>Insert 1 → pop 6, pop 2 → 1 is new root</p>
<ul>
<li>2 becomes right child of 1</li>
</ul></li>
<li><p>Insert 9 → right child of 6</p></li>
</ol>
<p>Tree structure (min-heap):</p>
<pre><code>       1
      / \
     2   9
    / \
   3   6</code></pre>
<p>In-order traversal: <code>[3, 2, 6, 1, 9]</code> Heap property: every parent is smaller than its children ✅</p>
</section>
<section id="tiny-code-python-min-heap-cartesian-tree" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-min-heap-cartesian-tree">Tiny Code (Python, Min-Heap Cartesian Tree)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb281"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, val):</span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.val <span class="op">=</span> val</span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">None</span></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_cartesian_tree(arr):</span>
<span id="cb281-8"><a href="#cb281-8" aria-hidden="true" tabindex="-1"></a>    stack <span class="op">=</span> []</span>
<span id="cb281-9"><a href="#cb281-9" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> <span class="va">None</span></span>
<span id="cb281-10"><a href="#cb281-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> val <span class="kw">in</span> arr:</span>
<span id="cb281-11"><a href="#cb281-11" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Node(val)</span>
<span id="cb281-12"><a href="#cb281-12" aria-hidden="true" tabindex="-1"></a>        last <span class="op">=</span> <span class="va">None</span></span>
<span id="cb281-13"><a href="#cb281-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> stack <span class="kw">and</span> stack[<span class="op">-</span><span class="dv">1</span>].val <span class="op">&gt;</span> val:</span>
<span id="cb281-14"><a href="#cb281-14" aria-hidden="true" tabindex="-1"></a>            last <span class="op">=</span> stack.pop()</span>
<span id="cb281-15"><a href="#cb281-15" aria-hidden="true" tabindex="-1"></a>        node.left <span class="op">=</span> last</span>
<span id="cb281-16"><a href="#cb281-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> stack:</span>
<span id="cb281-17"><a href="#cb281-17" aria-hidden="true" tabindex="-1"></a>            stack[<span class="op">-</span><span class="dv">1</span>].right <span class="op">=</span> node</span>
<span id="cb281-18"><a href="#cb281-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb281-19"><a href="#cb281-19" aria-hidden="true" tabindex="-1"></a>            root <span class="op">=</span> node</span>
<span id="cb281-20"><a href="#cb281-20" aria-hidden="true" tabindex="-1"></a>        stack.append(node)</span>
<span id="cb281-21"><a href="#cb281-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> root</span>
<span id="cb281-22"><a href="#cb281-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-23"><a href="#cb281-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inorder(node):</span>
<span id="cb281-24"><a href="#cb281-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> inorder(node.left) <span class="op">+</span> [node.val] <span class="op">+</span> inorder(node.right) <span class="cf">if</span> node <span class="cf">else</span> []</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example usage:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb282"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">9</span>]</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> build_cartesian_tree(A)</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inorder(root))  <span class="co"># [3, 2, 6, 1, 9]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-88" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-88">Why It Matters</h3>
<ul>
<li>RMQ in O(1): RMQ becomes LCA in Cartesian Tree (after Euler Tour + Sparse Table).</li>
<li>Monotonic Stack Connection: Linear construction mirrors the logic of stack-based range problems (Next Greater Element, Histogram).</li>
<li>Divide-and-Conquer Decomposition: Represents array’s recursive structure.</li>
<li>Efficient Building: Linear time with stack.</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-88" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-88">A Gentle Proof (Why It Works)</h3>
<p>Each element is pushed and popped at most once, so total operations = <span class="math inline">\(O(n)\)</span>. Heap property ensures RMQ correctness:</p>
<ul>
<li>In min-heap tree, root of any subtree is the minimum of that segment.</li>
<li>Thus, LCA(i, j) gives the index of <span class="math inline">\(\min(A[i..j])\)</span>.</li>
</ul>
<p>So by reducing RMQ to LCA, we achieve:</p>
<p><span class="math display">\[
\text{RMQ}(i, j) = \text{index}( \text{LCA}(i, j) )
\]</span></p>
</section>
<section id="try-it-yourself-88" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-88">Try It Yourself</h3>
<ol type="1">
<li>Build a Cartesian Tree for <span class="math inline">\(A = [4, 5, 2, 3, 1]\)</span> (min-heap).</li>
<li>Verify in-order traversal equals original array.</li>
<li>Mark parents smaller than children.</li>
<li>Identify RMQ(1, 3) from the tree using LCA.</li>
</ol>
</section>
<section id="test-cases-87" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-87">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Array</th>
<th>Tree Type</th>
<th>Root</th>
<th>RMQ(1, 3)</th>
<th>Inorder Matches</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[3, 2, 6, 1, 9]</td>
<td>min-heap</td>
<td>1</td>
<td>2</td>
<td>✅</td>
</tr>
<tr class="even">
<td>[5, 4, 3, 2, 1]</td>
<td>min-heap</td>
<td>1</td>
<td>2</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>[1, 2, 3, 4, 5]</td>
<td>min-heap</td>
<td>1</td>
<td>2</td>
<td>✅</td>
</tr>
<tr class="even">
<td>[2, 7, 5, 9]</td>
<td>min-heap</td>
<td>2</td>
<td>5</td>
<td>✅</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-88" class="level3">
<h3 class="anchored" data-anchor-id="complexity-88">Complexity</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>Stack-based construction</td>
</tr>
<tr class="even">
<td>Query (RMQ)</td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>,</td>
<td>After Euler + Sparse Table</td>
</tr>
<tr class="odd">
<td>LCA Preprocess</td>
<td><span class="math inline">\(O(n \log n)\)</span></td>
<td><span class="math inline">\(O(n \log n)\)</span></td>
<td>Sparse Table method</td>
</tr>
</tbody>
</table>
<p>A Cartesian Tree weaves together order and hierarchy: in-order for sequence, heap for dominance, a silent bridge between arrays and trees.</p>
</section>
<section id="segment-tree-beats" class="level3">
<h3 class="anchored" data-anchor-id="segment-tree-beats">293 Segment Tree Beats</h3>
<p>Segment Tree Beats is an advanced variant of the classical segment tree that can handle non-trivial range queries and updates beyond sum, min, or max. It’s designed for problems where the operation is <em>not linear</em> or <em>not invertible</em>, such as range chmin/chmax, range add with min tracking, or range second-min queries.</p>
<p>It “beats” the limitation of classical lazy propagation by storing extra state (like second minimum, second maximum) to decide when updates can stop early.</p>
</section>
<section id="what-problem-are-we-solving-89" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-89">What Problem Are We Solving?</h3>
<p>Standard segment trees can’t efficiently handle complex updates like:</p>
<ul>
<li>“Set all <span class="math inline">\(A[i]\)</span> in <span class="math inline">\([L, R]\)</span> to <code>min(A[i], x)</code>”</li>
<li>“Set all <span class="math inline">\(A[i]\)</span> in <span class="math inline">\([L, R]\)</span> to <code>max(A[i], x)</code>”</li>
</ul>
<p>Because different elements in a segment may behave differently depending on their value relative to <code>x</code>.</p>
<p>Segment Tree Beats solves this by maintaining extra constraints in each node so we can “beat” recursion and skip branches early when conditions are met.</p>
</section>
<section id="how-it-works-plain-language-54" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-54">How It Works (Plain Language)</h3>
<p>Each node stores not just an aggregate but <em>enough info to know when an operation can be fully applied</em>.</p>
<p>For Range Chmin (A[i] = min(A[i], x)):</p>
<ul>
<li>If <code>max &lt;= x</code>: nothing changes</li>
<li>If <code>second_max &lt; x &lt; max</code>: only elements with <code>max</code> are updated</li>
<li>If <code>x &lt; second_max</code>: recurse to children</li>
</ul>
<p>Each node stores:</p>
<ul>
<li><code>max</code> (maximum value in range)</li>
<li><code>second_max</code> (second largest value)</li>
<li><code>count_max</code> (number of times <code>max</code> appears)</li>
<li><code>sum</code> (sum over range)</li>
</ul>
<p>This lets us decide update logic without touching all elements.</p>
</section>
<section id="example-range-chmin" class="level3">
<h3 class="anchored" data-anchor-id="example-range-chmin">Example (Range Chmin)</h3>
<p>Let <span class="math inline">\(A = [4, 7, 6, 3]\)</span></p>
<p>We apply <code>chmin(L=0, R=3, x=5)</code> → every element &gt; 5 is set to 5.</p>
<p>Step:</p>
<ol type="1">
<li>Node <code>[0, 3]</code>: <code>max = 7</code>, <code>second_max = 6</code></li>
<li>Since <code>x = 5 &lt; second_max = 6</code>, recurse</li>
<li>Update left child <code>[0,1]</code>: has <code>7</code> → <code>7</code> becomes <code>5</code></li>
<li>Update right <code>[2,3]</code>: <code>max = 6</code> → <code>6</code> becomes <code>5</code></li>
</ol>
<p>New array: <code>[4, 5, 5, 3]</code></p>
</section>
<section id="tiny-code-simplified-range-chmin" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-simplified-range-chmin">Tiny Code (Simplified Range Chmin)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb283"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">sum</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">max</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.smax <span class="op">=</span> <span class="op">-</span><span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cnt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l <span class="op">=</span> <span class="va">None</span></span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.r <span class="op">=</span> <span class="va">None</span></span>
<span id="cb283-9"><a href="#cb283-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-10"><a href="#cb283-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge(a, b):</span>
<span id="cb283-11"><a href="#cb283-11" aria-hidden="true" tabindex="-1"></a>    node <span class="op">=</span> Node()</span>
<span id="cb283-12"><a href="#cb283-12" aria-hidden="true" tabindex="-1"></a>    node.<span class="bu">sum</span> <span class="op">=</span> a.<span class="bu">sum</span> <span class="op">+</span> b.<span class="bu">sum</span></span>
<span id="cb283-13"><a href="#cb283-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a.<span class="bu">max</span> <span class="op">==</span> b.<span class="bu">max</span>:</span>
<span id="cb283-14"><a href="#cb283-14" aria-hidden="true" tabindex="-1"></a>        node.<span class="bu">max</span> <span class="op">=</span> a.<span class="bu">max</span></span>
<span id="cb283-15"><a href="#cb283-15" aria-hidden="true" tabindex="-1"></a>        node.smax <span class="op">=</span> <span class="bu">max</span>(a.smax, b.smax)</span>
<span id="cb283-16"><a href="#cb283-16" aria-hidden="true" tabindex="-1"></a>        node.cnt <span class="op">=</span> a.cnt <span class="op">+</span> b.cnt</span>
<span id="cb283-17"><a href="#cb283-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> a.<span class="bu">max</span> <span class="op">&gt;</span> b.<span class="bu">max</span>:</span>
<span id="cb283-18"><a href="#cb283-18" aria-hidden="true" tabindex="-1"></a>        node.<span class="bu">max</span> <span class="op">=</span> a.<span class="bu">max</span></span>
<span id="cb283-19"><a href="#cb283-19" aria-hidden="true" tabindex="-1"></a>        node.smax <span class="op">=</span> <span class="bu">max</span>(a.smax, b.<span class="bu">max</span>)</span>
<span id="cb283-20"><a href="#cb283-20" aria-hidden="true" tabindex="-1"></a>        node.cnt <span class="op">=</span> a.cnt</span>
<span id="cb283-21"><a href="#cb283-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb283-22"><a href="#cb283-22" aria-hidden="true" tabindex="-1"></a>        node.<span class="bu">max</span> <span class="op">=</span> b.<span class="bu">max</span></span>
<span id="cb283-23"><a href="#cb283-23" aria-hidden="true" tabindex="-1"></a>        node.smax <span class="op">=</span> <span class="bu">max</span>(a.<span class="bu">max</span>, b.smax)</span>
<span id="cb283-24"><a href="#cb283-24" aria-hidden="true" tabindex="-1"></a>        node.cnt <span class="op">=</span> b.cnt</span>
<span id="cb283-25"><a href="#cb283-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> node</span>
<span id="cb283-26"><a href="#cb283-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-27"><a href="#cb283-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> push_chmin(node, x, length):</span>
<span id="cb283-28"><a href="#cb283-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node.<span class="bu">max</span> <span class="op">&lt;=</span> x:</span>
<span id="cb283-29"><a href="#cb283-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb283-30"><a href="#cb283-30" aria-hidden="true" tabindex="-1"></a>    node.<span class="bu">sum</span> <span class="op">-=</span> (node.<span class="bu">max</span> <span class="op">-</span> x) <span class="op">*</span> node.cnt</span>
<span id="cb283-31"><a href="#cb283-31" aria-hidden="true" tabindex="-1"></a>    node.<span class="bu">max</span> <span class="op">=</span> x</span>
<span id="cb283-32"><a href="#cb283-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-33"><a href="#cb283-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_chmin(node, l, r, ql, qr, x):</span>
<span id="cb283-34"><a href="#cb283-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> r <span class="op">&lt;</span> ql <span class="kw">or</span> qr <span class="op">&lt;</span> l <span class="kw">or</span> node.<span class="bu">max</span> <span class="op">&lt;=</span> x:</span>
<span id="cb283-35"><a href="#cb283-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb283-36"><a href="#cb283-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ql <span class="op">&lt;=</span> l <span class="kw">and</span> r <span class="op">&lt;=</span> qr <span class="kw">and</span> node.smax <span class="op">&lt;</span> x:</span>
<span id="cb283-37"><a href="#cb283-37" aria-hidden="true" tabindex="-1"></a>        push_chmin(node, x, r <span class="op">-</span> l <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb283-38"><a href="#cb283-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb283-39"><a href="#cb283-39" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb283-40"><a href="#cb283-40" aria-hidden="true" tabindex="-1"></a>    update_chmin(node.l, l, m, ql, qr, x)</span>
<span id="cb283-41"><a href="#cb283-41" aria-hidden="true" tabindex="-1"></a>    update_chmin(node.r, m<span class="op">+</span><span class="dv">1</span>, r, ql, qr, x)</span>
<span id="cb283-42"><a href="#cb283-42" aria-hidden="true" tabindex="-1"></a>    new <span class="op">=</span> merge(node.l, node.r)</span>
<span id="cb283-43"><a href="#cb283-43" aria-hidden="true" tabindex="-1"></a>    node.<span class="bu">max</span>, node.smax, node.cnt, node.<span class="bu">sum</span> <span class="op">=</span> new.<span class="bu">max</span>, new.smax, new.cnt, new.<span class="bu">sum</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is the essence: skip updates when possible, split when necessary.</p>
</section>
<section id="why-it-matters-89" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-89">Why It Matters</h3>
<ul>
<li>Handles non-linear updates efficiently</li>
<li>Preserves logarithmic complexity by reducing unnecessary recursion</li>
<li>Used in many competitive programming RMQ-like challenges with range cap operations</li>
<li>Generalizes segment tree to “hard” problems (range <code>min</code> caps, range <code>max</code> caps, conditional sums)</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-89" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-89">A Gentle Proof (Why It Works)</h3>
<p>The trick: by storing max, second max, and count, we can stop descending if the operation affects only elements equal to max. At most O(log n) nodes per update because:</p>
<ul>
<li>Each update lowers some max values</li>
<li>Each element’s value decreases logarithmically before stabilizing</li>
</ul>
<p>Thus total complexity amortizes to: <span class="math display">\[
O((n + q) \log n)
\]</span></p>
</section>
<section id="try-it-yourself-89" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-89">Try It Yourself</h3>
<ol type="1">
<li>Build a Segment Tree Beats for <span class="math inline">\(A = [4, 7, 6, 3]\)</span>.</li>
<li>Apply <code>chmin(0,3,5)</code> → verify <code>[4,5,5,3]</code>.</li>
<li>Apply <code>chmin(0,3,4)</code> → verify <code>[4,4,4,3]</code>.</li>
<li>Track <code>sum</code> after each operation.</li>
</ol>
</section>
<section id="test-cases-88" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-88">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Array</th>
<th>Operation</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[4,7,6,3]</td>
<td>chmin(0,3,5)</td>
<td>[4,5,5,3]</td>
</tr>
<tr class="even">
<td>[4,5,5,3]</td>
<td>chmin(1,2,4)</td>
<td>[4,4,4,3]</td>
</tr>
<tr class="odd">
<td>[1,10,5,2]</td>
<td>chmin(0,3,6)</td>
<td>[1,6,5,2]</td>
</tr>
<tr class="even">
<td>[5,5,5]</td>
<td>chmin(0,2,4)</td>
<td>[4,4,4]</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-89" class="level3">
<h3 class="anchored" data-anchor-id="complexity-89">Complexity</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 26%">
<col style="width: 10%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Time (Amortized)</th>
<th>Space</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>Same as normal segment tree</td>
</tr>
<tr class="even">
<td>Range Chmin</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>Amortized over operations</td>
</tr>
<tr class="odd">
<td>Query (Sum)</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td>,</td>
<td>Combine like usual</td>
</tr>
</tbody>
</table>
<p>Segment Tree Beats lives at the intersection of elegance and power, retaining <span class="math inline">\(O(\log n)\)</span> intuition while tackling the kinds of operations classical segment trees can’t touch.</p>
</section>
<section id="merge-sort-tree" class="level3">
<h3 class="anchored" data-anchor-id="merge-sort-tree">294 Merge Sort Tree</h3>
<p>A Merge Sort Tree is a segment tree where each node stores a sorted list of the elements in its range. It allows efficient queries that depend on order statistics, such as counting how many elements fall within a range or finding the <span class="math inline">\(k\)</span>-th smallest element in a subarray.</p>
<p>It’s called “Merge Sort Tree” because it is built exactly like merge sort: divide, conquer, and merge sorted halves.</p>
</section>
<section id="what-problem-are-we-solving-90" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-90">What Problem Are We Solving?</h3>
<p>Classical segment trees handle sum, min, or max, but not <em>value-based</em> queries. Merge Sort Trees enable operations like:</p>
<ul>
<li>Count how many numbers in <span class="math inline">\(A[L..R]\)</span> are <span class="math inline">\(\le x\)</span></li>
<li>Count elements in a value range <span class="math inline">\([a,b]\)</span></li>
<li>Find the <span class="math inline">\(k\)</span>-th smallest element in <span class="math inline">\(A[L..R]\)</span></li>
</ul>
<p>These problems often arise in range frequency queries, inversions counting, and offline queries.</p>
</section>
<section id="how-it-works-plain-language-55" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-55">How It Works (Plain Language)</h3>
<p>Each node of the tree covers a segment <code>[l, r]</code> of the array. Instead of storing a single number, it stores a sorted list of all elements in that segment.</p>
<p>Building:</p>
<ol type="1">
<li>If <code>l == r</code>, store <code>[A[l]]</code>.</li>
<li>Otherwise, recursively build left and right children.</li>
<li>Merge the two sorted lists to form this node’s list.</li>
</ol>
<p>Querying: To count numbers <span class="math inline">\(\le x\)</span> in range <code>[L, R]</code>:</p>
<ul>
<li>Visit all segment tree nodes that fully or partially overlap <code>[L, R]</code>.</li>
<li>In each node, binary search for position of <code>x</code> in the node’s sorted list.</li>
</ul>
</section>
<section id="example-39" class="level3">
<h3 class="anchored" data-anchor-id="example-39">Example</h3>
<p>Let <span class="math inline">\(A = [2, 5, 1, 4, 3]\)</span></p>
<section id="step-1-build-tree" class="level4">
<h4 class="anchored" data-anchor-id="step-1-build-tree">Step 1: Build Tree</h4>
<p>Each leaf stores one value:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node Range</th>
<th>Stored List</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[0,0]</td>
<td>[2]</td>
</tr>
<tr class="even">
<td>[1,1]</td>
<td>[5]</td>
</tr>
<tr class="odd">
<td>[2,2]</td>
<td>[1]</td>
</tr>
<tr class="even">
<td>[3,3]</td>
<td>[4]</td>
</tr>
<tr class="odd">
<td>[4,4]</td>
<td>[3]</td>
</tr>
</tbody>
</table>
<p>Now merge:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node Range</th>
<th>Stored List</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[0,1]</td>
<td>[2,5]</td>
</tr>
<tr class="even">
<td>[2,3]</td>
<td>[1,4]</td>
</tr>
<tr class="odd">
<td>[2,4]</td>
<td>[1,3,4]</td>
</tr>
<tr class="even">
<td>[0,4]</td>
<td>[1,2,3,4,5]</td>
</tr>
</tbody>
</table>
</section>
<section id="step-2-query-example" class="level4">
<h4 class="anchored" data-anchor-id="step-2-query-example">Step 2: Query Example</h4>
<p>Count elements <span class="math inline">\(\le 3\)</span> in range <code>[1, 4]</code>.</p>
<p>We query nodes that cover <code>[1,4]</code>: <code>[1,1]</code>, <code>[2,3]</code>, <code>[4,4]</code>.</p>
<ul>
<li><code>[1,1]</code> → list = <code>[5]</code> → count = 0</li>
<li><code>[2,3]</code> → list = <code>[1,4]</code> → count = 1</li>
<li><code>[4,4]</code> → list = <code>[3]</code> → count = 1</li>
</ul>
<p>Total = 2 elements ≤ 3.</p>
</section>
</section>
<section id="tiny-code-python-count-x" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-count-x">Tiny Code (Python, Count ≤ x)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb284"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bisect</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MergeSortTree:</span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, arr):</span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> <span class="bu">len</span>(arr)</span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tree <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span> <span class="op">*</span> <span class="va">self</span>.n)]</span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._build(arr, <span class="dv">1</span>, <span class="dv">0</span>, <span class="va">self</span>.n <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _build(<span class="va">self</span>, arr, node, l, r):</span>
<span id="cb284-10"><a href="#cb284-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> l <span class="op">==</span> r:</span>
<span id="cb284-11"><a href="#cb284-11" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.tree[node] <span class="op">=</span> [arr[l]]</span>
<span id="cb284-12"><a href="#cb284-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb284-13"><a href="#cb284-13" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb284-14"><a href="#cb284-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._build(arr, node <span class="op">*</span> <span class="dv">2</span>, l, m)</span>
<span id="cb284-15"><a href="#cb284-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._build(arr, node <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span>, m <span class="op">+</span> <span class="dv">1</span>, r)</span>
<span id="cb284-16"><a href="#cb284-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tree[node] <span class="op">=</span> <span class="bu">sorted</span>(<span class="va">self</span>.tree[node <span class="op">*</span> <span class="dv">2</span>] <span class="op">+</span> <span class="va">self</span>.tree[node <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb284-17"><a href="#cb284-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-18"><a href="#cb284-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> query_leq(<span class="va">self</span>, node, l, r, ql, qr, x):</span>
<span id="cb284-19"><a href="#cb284-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r <span class="op">&lt;</span> ql <span class="kw">or</span> qr <span class="op">&lt;</span> l:</span>
<span id="cb284-20"><a href="#cb284-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb284-21"><a href="#cb284-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ql <span class="op">&lt;=</span> l <span class="kw">and</span> r <span class="op">&lt;=</span> qr:</span>
<span id="cb284-22"><a href="#cb284-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> bisect.bisect_right(<span class="va">self</span>.tree[node], x)</span>
<span id="cb284-23"><a href="#cb284-23" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> (l <span class="op">+</span> r) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb284-24"><a href="#cb284-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.query_leq(node <span class="op">*</span> <span class="dv">2</span>, l, m, ql, qr, x) <span class="op">+</span></span>
<span id="cb284-25"><a href="#cb284-25" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.query_leq(node <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span>, m <span class="op">+</span> <span class="dv">1</span>, r, ql, qr, x))</span>
<span id="cb284-26"><a href="#cb284-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-27"><a href="#cb284-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb284-28"><a href="#cb284-28" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>]</span>
<span id="cb284-29"><a href="#cb284-29" aria-hidden="true" tabindex="-1"></a>mst <span class="op">=</span> MergeSortTree(A)</span>
<span id="cb284-30"><a href="#cb284-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mst.query_leq(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>))  <span class="co"># count ≤ 3 in [1,4] = 2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-90" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-90">Why It Matters</h3>
<ul>
<li>Enables order-based queries (≤, ≥, count, rank)</li>
<li>Useful for offline range counting, kth-smallest, and inversion queries</li>
<li>Combines divide-and-conquer sorting with range decomposition</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-90" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-90">A Gentle Proof (Why It Works)</h3>
<p>Each level of the tree merges sorted lists from children.</p>
<ul>
<li>Each element appears in <span class="math inline">\(O(\log n)\)</span> nodes.</li>
<li>Each merge is linear in subarray size.</li>
</ul>
<p>Thus, total build time: <span class="math display">\[
O(n \log n)
\]</span></p>
<p>Each query visits <span class="math inline">\(O(\log n)\)</span> nodes, each with <span class="math inline">\(O(\log n)\)</span> binary search: <span class="math display">\[
O(\log^2 n)
\]</span></p>
</section>
<section id="try-it-yourself-90" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-90">Try It Yourself</h3>
<ol type="1">
<li>Build tree for <span class="math inline">\(A = [5, 1, 4, 2, 3]\)</span>.</li>
<li>Query count ≤ 3 in <code>[0, 4]</code>.</li>
<li>Query count ≤ 2 in <code>[1, 3]</code>.</li>
<li>Implement query for “count between <span class="math inline">\([a,b]\)</span>” using two <code>query_leq</code> calls.</li>
</ol>
</section>
<section id="test-cases-89" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-89">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Array</th>
<th>Query</th>
<th>Condition</th>
<th>Answer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[2,5,1,4,3]</td>
<td>[1,4], ≤3</td>
<td>count</td>
<td>2</td>
</tr>
<tr class="even">
<td>[2,5,1,4,3]</td>
<td>[0,2], ≤2</td>
<td>count</td>
<td>2</td>
</tr>
<tr class="odd">
<td>[1,2,3,4,5]</td>
<td>[2,4], ≤4</td>
<td>count</td>
<td>3</td>
</tr>
<tr class="even">
<td>[5,4,3,2,1]</td>
<td>[0,4], ≤3</td>
<td>count</td>
<td>3</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-90" class="level3">
<h3 class="anchored" data-anchor-id="complexity-90">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td><span class="math inline">\(O(n \log n)\)</span></td>
<td><span class="math inline">\(O(n \log n)\)</span></td>
</tr>
<tr class="even">
<td>Query (≤ x)</td>
<td><span class="math inline">\(O(\log^2 n)\)</span></td>
<td>,</td>
</tr>
<tr class="odd">
<td>Query (range count)</td>
<td><span class="math inline">\(O(\log^2 n)\)</span></td>
<td>,</td>
</tr>
</tbody>
</table>
<p>Merge Sort Trees elegantly bridge sorting and segmentation, empowering range queries that depend not on aggregates, but on the distribution of values themselves.</p>
</section>
<section id="wavelet-tree" class="level3">
<h3 class="anchored" data-anchor-id="wavelet-tree">295 Wavelet Tree</h3>
<p>A Wavelet Tree is a compact, indexable structure over a sequence that supports rank, select, and range queries by value in O(log ) time with O(n log ) space, where () is the alphabet size. Think of it as a value-aware segment tree built on bitvectors that let you jump between levels using rank counts.</p>
</section>
<section id="what-problem-are-we-solving-91" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-91">What Problem Are We Solving?</h3>
<p>Given an array <span class="math inline">\(A[1..n]\)</span> over values in <span class="math inline">\([1..\sigma]\)</span>, define the following queries:</p>
<ul>
<li><span class="math inline">\(\text{rank}(x, r)\)</span>: number of occurrences of value <span class="math inline">\(x\)</span> in <span class="math inline">\(A[1..r]\)</span></li>
<li><span class="math inline">\(\text{select}(x, k)\)</span>: position of the <span class="math inline">\(k\)</span>-th occurrence of <span class="math inline">\(x\)</span> in <span class="math inline">\(A\)</span></li>
<li><span class="math inline">\(\text{kth}(l, r, k)\)</span>: the <span class="math inline">\(k\)</span>-th smallest value in the subarray <span class="math inline">\(A[l..r]\)</span></li>
<li><span class="math inline">\(\text{range\_count}(l, r, a, b)\)</span>: number of values in <span class="math inline">\(A[l..r]\)</span> that lie in <span class="math inline">\([a, b]\)</span></li>
</ul>
</section>
<section id="how-it-works" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works">How It Works</h3>
<ol type="1">
<li><p>Value partitioning by halves<br>
Recursively partition the value domain <span class="math inline">\([v_{\min}, v_{\max}]\)</span> into two halves at midpoint <span class="math inline">\(m\)</span>.</p>
<ul>
<li>Left child stores all elements <span class="math inline">\(\le m\)</span><br>
</li>
<li>Right child stores all elements <span class="math inline">\(&gt; m\)</span></li>
</ul></li>
<li><p>Stable partition plus bitvector<br>
At each node, keep the original order and record a bitvector <span class="math inline">\(B\)</span> of length equal to the number of elements that arrive at the node:</p>
<ul>
<li><span class="math inline">\(B[i] = 0\)</span> if the <span class="math inline">\(i\)</span>-th element goes to the left child<br>
</li>
<li><span class="math inline">\(B[i] = 1\)</span> if it goes to the right child</li>
</ul>
<p>Support fast ranks on <span class="math inline">\(B\)</span>: <span class="math inline">\(\mathrm{rank}_0(B,i)\)</span> and <span class="math inline">\(\mathrm{rank}_1(B,i)\)</span>.</p></li>
<li><p>Navigating queries</p>
<ul>
<li>Position based descent: translate positions using prefix counts from <span class="math inline">\(B\)</span>.<br>
If a query interval at this node is <span class="math inline">\([l,r]\)</span>, then the corresponding interval in the left child is <span class="math inline">\([\mathrm{rank}_0(B,l-1)+1,\ \mathrm{rank}_0(B,r)]\)</span> and in the right child is <span class="math inline">\([\mathrm{rank}_1(B,l-1)+1,\ \mathrm{rank}_1(B,r)]\)</span>.</li>
<li>Value based descent: choose left or right child by comparing the value with <span class="math inline">\(m\)</span>.</li>
</ul></li>
</ol>
<p>Height is <span class="math inline">\(O(\log \sigma)\)</span>. Each step uses <span class="math inline">\(O(1)\)</span> bitvector rank operations.</p>
</section>
<section id="example-40" class="level3">
<h3 class="anchored" data-anchor-id="example-40">Example</h3>
<p>Array: <span class="math inline">\(A = [3, 1, 4, 1, 5, 9, 2, 6]\)</span>, values in <span class="math inline">\([1..9]\)</span></p>
<p>Root split by midpoint <span class="math inline">\(m = 5\)</span></p>
<ul>
<li>Left child receives elements <span class="math inline">\(\le 5\)</span>: <span class="math inline">\(\{3, 1, 4, 1, 5, 2\}\)</span></li>
<li>Right child receives elements <span class="math inline">\(&gt; 5\)</span>: <span class="math inline">\(\{9, 6\}\)</span></li>
</ul>
<p>Root bitvector marks routing left (0) or right (1), preserving order:</p>
<ul>
<li><span class="math inline">\(A\)</span> by node: [3, 1, 4, 1, 5, 9, 2, 6]<br>
</li>
<li><span class="math inline">\(B\)</span>: [0, 0, 0, 0, 0, 1, 0, 1]</li>
</ul>
<p>Left child split on <span class="math inline">\([1..5]\)</span> by <span class="math inline">\(m = 3\)</span></p>
<ul>
<li>Left-left (values <span class="math inline">\(\le 3\)</span>): positions where <span class="math inline">\(B=0\)</span> at root, then route by <span class="math inline">\(m=3\)</span><br>
Sequence arriving: [3, 1, 4, 1, 5, 2]<br>
Bitvector at this node <span class="math inline">\(B_L\)</span>: [0, 0, 1, 0, 1, 0]<br>
Children:
<ul>
<li><span class="math inline">\(\le 3\)</span>: [3, 1, 1, 2]</li>
<li><span class="math inline">\(&gt; 3\)</span>: [4, 5]</li>
</ul></li>
<li>Right-right subtree of root contains [9, 6] (no further split shown)</li>
</ul>
<p>Rank translation example at the root</p>
<p>For an interval <span class="math inline">\([l,r]\)</span> at the root, the corresponding intervals are: - Left child: <span class="math inline">\([\,\mathrm{rank}_0(B,l-1)+1,\ \mathrm{rank}_0(B,r)\,]\)</span> - Right child: <span class="math inline">\([\,\mathrm{rank}_1(B,l-1)+1,\ \mathrm{rank}_1(B,r)\,]\)</span></p>
<p>Example: take <span class="math inline">\([l,r]=[2,7]\)</span> at the root with <span class="math inline">\(B=[0,0,0,0,0,1,0,1]\)</span> - <span class="math inline">\(\mathrm{rank}_0(B,1)=1\)</span>, <span class="math inline">\(\mathrm{rank}_0(B,7)=6\)</span> → left interval <span class="math inline">\([2,6]\)</span> - <span class="math inline">\(\mathrm{rank}_1(B,1)=0\)</span>, <span class="math inline">\(\mathrm{rank}_1(B,7)=1\)</span> → right interval <span class="math inline">\([1,1]\)</span></p>
<p>Height is <span class="math inline">\(O(\log \sigma)\)</span>, each descent step uses <span class="math inline">\(O(1)\)</span> rank operations on the local bitvector.</p>
</section>
<section id="core-operations" class="level3">
<h3 class="anchored" data-anchor-id="core-operations">Core Operations</h3>
<ol type="1">
<li><p>rank(x, r)<br>
Walk top down. At a node with split value m:</p>
<ul>
<li>If <span class="math inline">\(x \le m\)</span>, set <span class="math inline">\(r \leftarrow \mathrm{rank}_0(B, r)\)</span> and go left<br>
</li>
<li>Otherwise set <span class="math inline">\(r \leftarrow \mathrm{rank}_1(B, r)\)</span> and go right</li>
</ul>
<p>When you reach the leaf for value <span class="math inline">\(x\)</span>, the current <span class="math inline">\(r\)</span> is the answer.</p></li>
<li><p>select(x, k)<br>
Start at the leaf for value <span class="math inline">\(x\)</span> with local index <span class="math inline">\(k\)</span>.<br>
Move upward to the root, inverting the position mapping at each parent:</p>
<ul>
<li>If you came from the left child, set <span class="math inline">\(k \leftarrow \mathrm{select\_pos\_0}(B, k)\)</span><br>
</li>
<li>If you came from the right child, set <span class="math inline">\(k \leftarrow \mathrm{select\_pos\_1}(B, k)\)</span><br>
The final <span class="math inline">\(k\)</span> at the root is the global position of the <span class="math inline">\(k\)</span>-th <span class="math inline">\(x\)</span>.</li>
</ul></li>
<li><p>kth(l, r, k)<br>
At a node with split value <span class="math inline">\(m\)</span>, let <span class="math display">\[
c \;=\; \mathrm{rank}_0(B, r)\;-\;\mathrm{rank}_0(B, l-1)
\]</span> which is the number of items routed left within <span class="math inline">\([l, r]\)</span>.</p>
<ul>
<li>If <span class="math inline">\(k \le c\)</span>, map the interval to the left child via <span class="math display">\[
l' \;=\; \mathrm{rank}_0(B, l-1) + 1,\quad
r' \;=\; \mathrm{rank}_0(B, r)
\]</span> and recurse on <span class="math inline">\((l', r', k)\)</span>.</li>
<li>Otherwise go right with <span class="math display">\[
k \leftarrow k - c,\quad
l' \;=\; \mathrm{rank}_1(B, l-1) + 1,\quad
r' \;=\; \mathrm{rank}_1(B, r)
\]</span> and recurse on <span class="math inline">\((l', r', k)\)</span>.</li>
</ul></li>
<li><p>range_count(l, r, a, b)<br>
Recurse only into value intervals that intersect <span class="math inline">\([a, b]\)</span>.<br>
At each visited node, map the position interval using <span class="math inline">\(B\)</span>:</p>
<ul>
<li>Left child interval <span class="math display">\[
[\,\mathrm{rank}_0(B, l-1)+1,\ \mathrm{rank}_0(B, r)\,]
\]</span></li>
<li>Right child interval <span class="math display">\[
[\,\mathrm{rank}_1(B, l-1)+1,\ \mathrm{rank}_1(B, r)\,]
\]</span> Stop when a node’s value range is fully inside or outside <span class="math inline">\([a, b]\)</span>:</li>
<li>Fully inside: add its interval length<br>
</li>
<li>Disjoint: add 0</li>
</ul></li>
</ol>
</section>
<section id="tiny-code-sketch-in-python" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-sketch-in-python">Tiny Code Sketch in Python</h3>
<p>This sketch shows the structure and kth query. A production version needs succinct rank structures for (B) to guarantee (O(1)) ranks.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb285"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bisect</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WaveletTree:</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, arr, lo<span class="op">=</span><span class="va">None</span>, hi<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.lo <span class="op">=</span> <span class="bu">min</span>(arr) <span class="cf">if</span> lo <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> lo</span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hi <span class="op">=</span> <span class="bu">max</span>(arr) <span class="cf">if</span> hi <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> hi</span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.b <span class="op">=</span> []          <span class="co"># bitvector as 0-1 list</span></span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pref <span class="op">=</span> [<span class="dv">0</span>]      <span class="co"># prefix sums of ones for O(1) rank1</span></span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.lo <span class="op">==</span> <span class="va">self</span>.hi <span class="kw">or</span> <span class="kw">not</span> arr:</span>
<span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.left <span class="op">=</span> <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb285-12"><a href="#cb285-12" aria-hidden="true" tabindex="-1"></a>        mid <span class="op">=</span> (<span class="va">self</span>.lo <span class="op">+</span> <span class="va">self</span>.hi) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb285-13"><a href="#cb285-13" aria-hidden="true" tabindex="-1"></a>        left_part, right_part <span class="op">=</span> [], []</span>
<span id="cb285-14"><a href="#cb285-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> arr:</span>
<span id="cb285-15"><a href="#cb285-15" aria-hidden="true" tabindex="-1"></a>            go_right <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> x <span class="op">&gt;</span> mid <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb285-16"><a href="#cb285-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.b.append(go_right)</span>
<span id="cb285-17"><a href="#cb285-17" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.pref.append(<span class="va">self</span>.pref[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> go_right)</span>
<span id="cb285-18"><a href="#cb285-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> go_right:</span>
<span id="cb285-19"><a href="#cb285-19" aria-hidden="true" tabindex="-1"></a>                right_part.append(x)</span>
<span id="cb285-20"><a href="#cb285-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb285-21"><a href="#cb285-21" aria-hidden="true" tabindex="-1"></a>                left_part.append(x)</span>
<span id="cb285-22"><a href="#cb285-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> WaveletTree(left_part, <span class="va">self</span>.lo, mid)</span>
<span id="cb285-23"><a href="#cb285-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> WaveletTree(right_part, mid <span class="op">+</span> <span class="dv">1</span>, <span class="va">self</span>.hi)</span>
<span id="cb285-24"><a href="#cb285-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-25"><a href="#cb285-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rank1(<span class="va">self</span>, idx):  <span class="co"># ones in b[1..idx]</span></span>
<span id="cb285-26"><a href="#cb285-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.pref[idx]</span>
<span id="cb285-27"><a href="#cb285-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-28"><a href="#cb285-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rank0(<span class="va">self</span>, idx):  <span class="co"># zeros in b[1..idx]</span></span>
<span id="cb285-29"><a href="#cb285-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> idx <span class="op">-</span> <span class="va">self</span>.rank1(idx)</span>
<span id="cb285-30"><a href="#cb285-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-31"><a href="#cb285-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> kth(<span class="va">self</span>, l, r, k):</span>
<span id="cb285-32"><a href="#cb285-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1-indexed positions</span></span>
<span id="cb285-33"><a href="#cb285-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.lo <span class="op">==</span> <span class="va">self</span>.hi:</span>
<span id="cb285-34"><a href="#cb285-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.lo</span>
<span id="cb285-35"><a href="#cb285-35" aria-hidden="true" tabindex="-1"></a>        mid <span class="op">=</span> (<span class="va">self</span>.lo <span class="op">+</span> <span class="va">self</span>.hi) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb285-36"><a href="#cb285-36" aria-hidden="true" tabindex="-1"></a>        cnt_left <span class="op">=</span> <span class="va">self</span>.rank0(r) <span class="op">-</span> <span class="va">self</span>.rank0(l <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb285-37"><a href="#cb285-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> k <span class="op">&lt;=</span> cnt_left:</span>
<span id="cb285-38"><a href="#cb285-38" aria-hidden="true" tabindex="-1"></a>            nl <span class="op">=</span> <span class="va">self</span>.rank0(l <span class="op">-</span> <span class="dv">1</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb285-39"><a href="#cb285-39" aria-hidden="true" tabindex="-1"></a>            nr <span class="op">=</span> <span class="va">self</span>.rank0(r)</span>
<span id="cb285-40"><a href="#cb285-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.left.kth(nl, nr, k)</span>
<span id="cb285-41"><a href="#cb285-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb285-42"><a href="#cb285-42" aria-hidden="true" tabindex="-1"></a>            nl <span class="op">=</span> <span class="va">self</span>.rank1(l <span class="op">-</span> <span class="dv">1</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb285-43"><a href="#cb285-43" aria-hidden="true" tabindex="-1"></a>            nr <span class="op">=</span> <span class="va">self</span>.rank1(r)</span>
<span id="cb285-44"><a href="#cb285-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.right.kth(nl, nr, k <span class="op">-</span> cnt_left)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Usage example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb286"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">2</span>,<span class="dv">6</span>]</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>wt <span class="op">=</span> WaveletTree(A)</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(wt.kth(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">3</span>))  <span class="co"># 3rd smallest in the whole array</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-91" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-91">Why It Matters</h3>
<ul>
<li>Combines value partitioning with positional stability, enabling order statistics on subranges</li>
<li>Underpins succinct indexes, FM indexes, rank select dictionaries, and fast offline range queries</li>
<li>Efficient when () is moderate or compressible</li>
</ul>
</section>
<section id="a-gentle-proof-of-bounds" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-of-bounds">A Gentle Proof of Bounds</h3>
<p>The tree has height <span class="math inline">\(O(\log \sigma)\)</span> since each level halves the value domain. Each query descends one level and performs <span class="math inline">\(O(1)\)</span> rank operations on a bitvector. Therefore <span class="math display">\[
T_{\text{query}} = O(\log \sigma)
\]</span> Space stores one bit per element per level on average, so <span class="math display">\[
S = O(n \log \sigma)
\]</span> With compressed bitvectors supporting constant time rank and select, these bounds hold in practice.</p>
</section>
<section id="try-it-yourself-91" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-91">Try It Yourself</h3>
<ol type="1">
<li>Build a wavelet tree for <span class="math inline">\(A = [2, 7, 1, 8, 2, 8, 1]\)</span>.</li>
<li>Compute <span class="math inline">\(\text{kth}(2, 6, 2)\)</span>.</li>
<li>Compute <span class="math inline">\(\text{range\_count}(2, 7, 2, 8)\)</span>.</li>
<li>Compare against a naive sort on <span class="math inline">\(A[l..r]\)</span>.</li>
</ol>
</section>
<section id="test-cases-90" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-90">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Array</th>
<th>Query</th>
<th>Answer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[3,1,4,1,5,9,2,6]</td>
<td>kth(1,8,3)</td>
<td>3</td>
</tr>
<tr class="even">
<td>[3,1,4,1,5,9,2,6]</td>
<td>range_count(3,7,2,5)</td>
<td>3</td>
</tr>
<tr class="odd">
<td>[1,1,1,1,1]</td>
<td>rank(1,5)</td>
<td>5</td>
</tr>
<tr class="even">
<td>[5,4,3,2,1]</td>
<td>kth(2,5,2)</td>
<td>3</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-91" class="level3">
<h3 class="anchored" data-anchor-id="complexity-91">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td><span class="math inline">\(O(n \log \sigma)\)</span></td>
<td><span class="math inline">\(O(n \log \sigma)\)</span></td>
</tr>
<tr class="even">
<td>rank, select</td>
<td><span class="math inline">\(O(\log \sigma)\)</span></td>
<td>–</td>
</tr>
<tr class="odd">
<td>kth, range_count</td>
<td><span class="math inline">\(O(\log \sigma)\)</span></td>
<td>–</td>
</tr>
</tbody>
</table>
<p>Wavelet trees are a sharp tool for order aware range queries. By weaving bitvectors with stable partitions, they deliver succinct, logarithmic time answers on top of the original sequence.</p>
</section>
<section id="kd-tree" class="level3">
<h3 class="anchored" data-anchor-id="kd-tree">296 KD-Tree</h3>
<p>A KD-Tree (k-dimensional tree) is a binary space partitioning data structure for organizing points in a k-dimensional space. It enables fast range searches, nearest neighbor queries, and spatial indexing, often used in geometry, graphics, and machine learning (like k-NN).</p>
</section>
<section id="what-problem-are-we-solving-92" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-92">What Problem Are We Solving?</h3>
<p>We need to store and query <span class="math inline">\(n\)</span> points in <span class="math inline">\(k\)</span>-dimensional space such that:</p>
<ul>
<li>Nearest neighbor query: find the point closest to a query <span class="math inline">\(q\)</span>.<br>
</li>
<li>Range query: find all points within a given region (rectangle or hypersphere).<br>
</li>
<li>k-NN query: find the <span class="math inline">\(k\)</span> closest points to <span class="math inline">\(q\)</span>.</li>
</ul>
<p>A naive search checks all <span class="math inline">\(n\)</span> points, which takes <span class="math inline">\(O(n)\)</span> time.<br>
A KD-Tree reduces this to <span class="math inline">\(O(\log n)\)</span> expected query time for balanced trees.</p>
</section>
<section id="how-it-works-1" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-1">How It Works</h3>
<section id="recursive-partitioning-by-dimension" class="level4">
<h4 class="anchored" data-anchor-id="recursive-partitioning-by-dimension">1. Recursive Partitioning by Dimension</h4>
<p>At each level, the KD-Tree splits the set of points along one dimension, cycling through all dimensions.</p>
<p>If the current depth is <span class="math inline">\(d\)</span>, use the axis <span class="math inline">\(a = d \bmod k\)</span>:</p>
<ul>
<li>Sort points by their <span class="math inline">\(a\)</span>-th coordinate.<br>
</li>
<li>Choose the median point as the root to maintain balance.<br>
</li>
<li>Left child: points with smaller <span class="math inline">\(a\)</span>-th coordinate.<br>
</li>
<li>Right child: points with larger <span class="math inline">\(a\)</span>-th coordinate.</li>
</ul>
</section>
<section id="search-nearest-neighbor" class="level4">
<h4 class="anchored" data-anchor-id="search-nearest-neighbor">2. Search (Nearest Neighbor)</h4>
<p>To find nearest neighbor of query <span class="math inline">\(q\)</span>:</p>
<ol type="1">
<li>Descend tree following split planes (like BST).</li>
<li>Track current best (closest point found so far).</li>
<li>Backtrack if potential closer point exists across split plane (distance to plane &lt; current best).</li>
</ol>
<p>This ensures pruning of subtrees that cannot contain closer points.</p>
</section>
</section>
<section id="example-41" class="level3">
<h3 class="anchored" data-anchor-id="example-41">Example</h3>
<p>Suppose 2D points: <span class="math display">\[
P = { (2,3), (5,4), (9,6), (4,7), (8,1), (7,2) }
\]</span></p>
<p>Step 1: Root splits by (x)-axis (axis 0). Sorted by (x): ((2,3), (4,7), (5,4), (7,2), (8,1), (9,6)). Median = ((7,2)). Root = (7,2).</p>
<p>Step 2:</p>
<ul>
<li>Left subtree (points with (x &lt; 7)) split by (y)-axis.</li>
<li>Right subtree (points with (x &gt; 7)) split by (y)-axis.</li>
</ul>
<p>This creates alternating partitions by x and y, forming axis-aligned rectangles.</p>
</section>
<section id="tiny-code-python-3" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-3">Tiny Code (Python)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb287"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, point, axis):</span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.point <span class="op">=</span> point</span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.axis <span class="op">=</span> axis</span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">None</span></span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_kdtree(points, depth<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> points:</span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb287-11"><a href="#cb287-11" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="bu">len</span>(points[<span class="dv">0</span>])</span>
<span id="cb287-12"><a href="#cb287-12" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> depth <span class="op">%</span> k</span>
<span id="cb287-13"><a href="#cb287-13" aria-hidden="true" tabindex="-1"></a>    points.sort(key<span class="op">=</span><span class="kw">lambda</span> p: p[axis])</span>
<span id="cb287-14"><a href="#cb287-14" aria-hidden="true" tabindex="-1"></a>    median <span class="op">=</span> <span class="bu">len</span>(points) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb287-15"><a href="#cb287-15" aria-hidden="true" tabindex="-1"></a>    node <span class="op">=</span> Node(points[median], axis)</span>
<span id="cb287-16"><a href="#cb287-16" aria-hidden="true" tabindex="-1"></a>    node.left <span class="op">=</span> build_kdtree(points[:median], depth <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb287-17"><a href="#cb287-17" aria-hidden="true" tabindex="-1"></a>    node.right <span class="op">=</span> build_kdtree(points[median <span class="op">+</span> <span class="dv">1</span>:], depth <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb287-18"><a href="#cb287-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> node</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="how-nearest-neighbor-works" class="level3">
<h3 class="anchored" data-anchor-id="how-nearest-neighbor-works">How Nearest Neighbor Works</h3>
<p>Given query (q), maintain best distance (d_{}). For each visited node:</p>
<ul>
<li>Compute distance (d = |q - p|)</li>
<li>If (d &lt; d_{}), update best</li>
<li>Check opposite branch only if (|q[a] - p[a]| &lt; d_{})</li>
</ul>
<section id="example-table" class="level4">
<h4 class="anchored" data-anchor-id="example-table">Example Table</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 20%">
<col style="width: 6%">
<col style="width: 20%">
<col style="width: 28%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Node Visited</th>
<th>Axis</th>
<th>Current Best</th>
<th>Distance to Plane</th>
<th>Search Next</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>(7,2)</td>
<td>x</td>
<td>(7,2), 0.0</td>
<td>0.0</td>
<td>Left</td>
</tr>
<tr class="even">
<td>2</td>
<td>(5,4)</td>
<td>y</td>
<td>(5,4), 2.8</td>
<td>2.0</td>
<td>Left</td>
</tr>
<tr class="odd">
<td>3</td>
<td>(2,3)</td>
<td>x</td>
<td>(5,4), 2.8</td>
<td>3.0</td>
<td>Stop</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="why-it-matters-92" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-92">Why It Matters</h3>
<ul>
<li>Efficient spatial querying in multidimensional data.</li>
<li>Common in k-NN classification, computer graphics, and robotics pathfinding.</li>
<li>Basis for libraries like <code>scipy.spatial.KDTree</code>.</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-91" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-91">A Gentle Proof (Why It Works)</h3>
<p>Each level splits points into halves, forming <span class="math inline">\(O(\log n)\)</span> height. Each query visits a bounded number of nodes (dependent on dimension). Expected nearest neighbor cost:</p>
<p><span class="math display">\[
T_{\text{query}} = O(\log n)
\]</span></p>
<p>Building sorts points at each level:</p>
<p><span class="math display">\[
T_{\text{build}} = O(n \log n)
\]</span></p>
</section>
<section id="try-it-yourself-92" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-92">Try It Yourself</h3>
<ol type="1">
<li>Build KD-Tree for 2D points ([(2,3),(5,4),(9,6),(4,7),(8,1),(7,2)]).</li>
<li>Query nearest neighbor of (q = (9,2)).</li>
<li>Trace visited nodes, prune subtrees when possible.</li>
</ol>
</section>
<section id="test-cases-91" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-91">Test Cases</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 54%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>Points</th>
<th>Query</th>
<th>Nearest</th>
<th>Expected Path</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[(2,3),(5,4),(9,6),(4,7),(8,1),(7,2)]</td>
<td>(9,2)</td>
<td>(8,1)</td>
<td>Root → Right → Leaf</td>
</tr>
<tr class="even">
<td>[(1,1),(2,2),(3,3)]</td>
<td>(2,3)</td>
<td>(2,2)</td>
<td>Root → Right</td>
</tr>
<tr class="odd">
<td>[(0,0),(10,10)]</td>
<td>(5,5)</td>
<td>(10,10)</td>
<td>Root → Right</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-92" class="level3">
<h3 class="anchored" data-anchor-id="complexity-92">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td><span class="math inline">\(O(n \log n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="even">
<td>Nearest Neighbor</td>
<td><span class="math inline">\(O(\log n)\)</span> (expected)</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
</tr>
<tr class="odd">
<td>Range Query</td>
<td><span class="math inline">\(O(n^{1 - 1/k} + m)\)</span></td>
<td>–</td>
</tr>
</tbody>
</table>
<p>KD-Trees blend geometry with binary search, cutting space by dimensions to answer questions faster than brute force.</p>
</section>
<section id="range-tree" class="level3">
<h3 class="anchored" data-anchor-id="range-tree">297 Range Tree</h3>
<p>A Range Tree is a multi-level search structure for answering orthogonal range queries in multidimensional space, such as finding all points inside an axis-aligned rectangle. It extends 1D balanced search trees to higher dimensions using recursive trees on projections.</p>
</section>
<section id="what-problem-are-we-solving-93" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-93">What Problem Are We Solving?</h3>
<p>Given a set of <span class="math inline">\(n\)</span> points in <span class="math inline">\(k\)</span>-dimensional space, we want to efficiently answer queries like:</p>
<blockquote class="blockquote">
<p>“List all points <span class="math inline">\((x, y)\)</span> such that <span class="math inline">\(x_1 \le x \le x_2\)</span> and <span class="math inline">\(y_1 \le y \le y_2\)</span>.”</p>
</blockquote>
<p>A naive scan is <span class="math inline">\(O(n)\)</span> per query. Range Trees reduce this to <span class="math inline">\(O(\log^k n + m)\)</span>, where <span class="math inline">\(m\)</span> is the number of reported points.</p>
</section>
<section id="how-it-works-2" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-2">How It Works</h3>
<section id="d-case-baseline" class="level4">
<h4 class="anchored" data-anchor-id="d-case-baseline">1. 1D Case (Baseline)</h4>
<p>A simple balanced BST (e.g.&nbsp;AVL) on <span class="math inline">\(x\)</span> coordinates supports range queries by traversing paths and collecting nodes in range.</p>
</section>
<section id="d-case-extension" class="level4">
<h4 class="anchored" data-anchor-id="d-case-extension">2. 2D Case (Extension)</h4>
<ul>
<li>Build a primary tree on <span class="math inline">\(x\)</span> coordinates.</li>
<li>At each node, store a secondary tree built on <span class="math inline">\(y\)</span> coordinates of the points in its subtree.</li>
</ul>
<p>Each level recursively maintains sorted views along other axes.</p>
</section>
<section id="range-query" class="level4">
<h4 class="anchored" data-anchor-id="range-query">3. Range Query</h4>
<ol type="1">
<li>Search primary tree for split node <span class="math inline">\(s\)</span>, where paths to <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> diverge.</li>
<li>For nodes fully in <span class="math inline">\([x_1, x_2]\)</span>, query their associated <span class="math inline">\(y\)</span>-tree for <span class="math inline">\([y_1, y_2]\)</span>.</li>
<li>Combine results.</li>
</ol>
</section>
</section>
<section id="example-42" class="level3">
<h3 class="anchored" data-anchor-id="example-42">Example</h3>
<p>Given points:</p>
<p><span class="math display">\[
P = {(2,3), (4,7), (5,1), (7,2), (8,5)}
\]</span></p>
<p>Query: <span class="math inline">\([3,7] \times [1,5]\)</span></p>
<ul>
<li>Primary tree on <span class="math inline">\(x\)</span>: median <span class="math inline">\((5,1)\)</span> as root.</li>
<li>Secondary trees at each node on <span class="math inline">\(y\)</span>.</li>
</ul>
<p>Search path:</p>
<ul>
<li>Split node <span class="math inline">\((5,1)\)</span> covers <span class="math inline">\(x \in [3,7]\)</span>.</li>
<li>Visit subtrees with <span class="math inline">\(x \in [4,7]\)</span>.</li>
<li>Query <span class="math inline">\(y\)</span> in <span class="math inline">\([1,5]\)</span> inside secondary trees.</li>
</ul>
<p>Returned points: <span class="math inline">\((5,1), (7,2), (4,7)\)</span> → filter <span class="math inline">\(y \le 5\)</span> → <span class="math inline">\((5,1),(7,2)\)</span>.</p>
</section>
<section id="tiny-code-python-like-pseudocode" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-like-pseudocode">Tiny Code (Python-like Pseudocode)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb288"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RangeTree:</span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, points, depth<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> points: </span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.node <span class="op">=</span> <span class="va">None</span></span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>        axis <span class="op">=</span> depth <span class="op">%</span> <span class="dv">2</span></span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>        points.sort(key<span class="op">=</span><span class="kw">lambda</span> p: p[axis])</span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a>        mid <span class="op">=</span> <span class="bu">len</span>(points) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.node <span class="op">=</span> points[mid]</span>
<span id="cb288-10"><a href="#cb288-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> RangeTree(points[:mid], depth <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb288-11"><a href="#cb288-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> RangeTree(points[mid <span class="op">+</span> <span class="dv">1</span>:], depth <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb288-12"><a href="#cb288-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sorted_y <span class="op">=</span> <span class="bu">sorted</span>(points, key<span class="op">=</span><span class="kw">lambda</span> p: p[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Query recursively:</p>
<ul>
<li>Filter nodes by <span class="math inline">\(x\)</span>.</li>
<li>Binary search on <span class="math inline">\(y\)</span>-lists.</li>
</ul>
</section>
<section id="step-by-step-table-2d-query" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-table-2d-query">Step-by-Step Table (2D Query)</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 28%">
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Operation</th>
<th>Axis</th>
<th>Condition</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Split at (5,1)</td>
<td>x</td>
<td><span class="math inline">\(3 \le 5 \le 7\)</span></td>
<td>Recurse both sides</td>
</tr>
<tr class="even">
<td>2</td>
<td>Left (2,3),(4,7)</td>
<td>x</td>
<td><span class="math inline">\(x &lt; 5\)</span></td>
<td>Visit (4,7) subtree</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Right (7,2),(8,5)</td>
<td>x</td>
<td><span class="math inline">\(x \le 7\)</span></td>
<td>Visit (7,2) subtree</td>
</tr>
<tr class="even">
<td>4</td>
<td>Filter by <span class="math inline">\(y\)</span></td>
<td>y</td>
<td><span class="math inline">\(1 \le y \le 5\)</span></td>
<td>Keep (5,1),(7,2)</td>
</tr>
</tbody>
</table>
</section>
<section id="why-it-matters-93" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-93">Why It Matters</h3>
<p>Range Trees provide deterministic performance for multidimensional queries, unlike kd-trees (which may degrade). They’re ideal for:</p>
<ul>
<li>Orthogonal range counting</li>
<li>Database indexing</li>
<li>Computational geometry problems</li>
</ul>
<p>They are static structures, suited when data doesn’t change often.</p>
</section>
<section id="a-gentle-proof-why-it-works-92" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-92">A Gentle Proof (Why It Works)</h3>
<p>Each dimension adds a logarithmic factor. In 2D, build time:</p>
<p><span class="math display">\[
T(n) = O(n \log n)
\]</span></p>
<p>Query visits <span class="math inline">\(O(\log n)\)</span> nodes in primary tree, each querying <span class="math inline">\(O(\log n)\)</span> secondary trees:</p>
<p><span class="math display">\[
Q(n) = O(\log^2 n + m)
\]</span></p>
<p>Space is <span class="math inline">\(O(n \log n)\)</span> due to secondary trees.</p>
</section>
<section id="try-it-yourself-93" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-93">Try It Yourself</h3>
<ol type="1">
<li>Build a 2D Range Tree for <span class="math inline">\(P = {(1,2),(2,3),(3,4),(4,5),(5,6)}\)</span></li>
<li>Query rectangle <span class="math inline">\([2,4] \times [3,5]\)</span>.</li>
<li>Trace visited nodes and verify output.</li>
</ol>
</section>
<section id="test-cases-92" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-92">Test Cases</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 23%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Points</th>
<th>Query Rectangle</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[(2,3),(4,7),(5,1),(7,2),(8,5)]</td>
<td>[3,7] × [1,5]</td>
<td>(5,1),(7,2)</td>
</tr>
<tr class="even">
<td>[(1,2),(2,4),(3,6),(4,8),(5,10)]</td>
<td>[2,4] × [4,8]</td>
<td>(2,4),(3,6),(4,8)</td>
</tr>
<tr class="odd">
<td>[(1,1),(2,2),(3,3)]</td>
<td>[1,2] × [1,3]</td>
<td>(1,1),(2,2)</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-93" class="level3">
<h3 class="anchored" data-anchor-id="complexity-93">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td><span class="math inline">\(O(n \log n)\)</span></td>
<td><span class="math inline">\(O(n \log n)\)</span></td>
</tr>
<tr class="even">
<td>Query (2D)</td>
<td><span class="math inline">\(O(\log^2 n + m)\)</span></td>
<td>,</td>
</tr>
<tr class="odd">
<td>Update</td>
<td>, (rebuild needed)</td>
<td>,</td>
</tr>
</tbody>
</table>
<p>Range Trees are precise geometric indexes: each axis divides the space, and nested trees give fast access to all points in any axis-aligned box.</p>
</section>
<section id="fenwick-2d-tree" class="level3">
<h3 class="anchored" data-anchor-id="fenwick-2d-tree">298 Fenwick 2D Tree</h3>
<p>A 2D Fenwick Tree (also known as 2D Binary Indexed Tree) extends the 1D Fenwick Tree to handle range queries and point updates on 2D grids such as matrices. It efficiently computes prefix sums and supports dynamic updates in <span class="math inline">\(O(\log^2 n)\)</span> time.</p>
</section>
<section id="what-problem-are-we-solving-94" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-94">What Problem Are We Solving?</h3>
<p>Given an <span class="math inline">\(n \times m\)</span> matrix <span class="math inline">\(A\)</span>, we want to support two operations efficiently:</p>
<ol type="1">
<li>Update: Add a value <span class="math inline">\(v\)</span> to element <span class="math inline">\(A[x][y]\)</span>.</li>
<li>Query: Compute the sum of all elements in submatrix <span class="math inline">\([1..x][1..y]\)</span>.</li>
</ol>
<p>A naive approach takes <span class="math inline">\(O(nm)\)</span> per query. The 2D Fenwick Tree reduces both update and query to <span class="math inline">\(O(\log n \cdot \log m)\)</span>.</p>
</section>
<section id="how-it-works-3" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-3">How It Works</h3>
<p>Each node <span class="math inline">\((i, j)\)</span> in the tree stores the sum of a submatrix region determined by the binary representation of its indices:</p>
<p><span class="math display">\[
T[i][j] = \sum_{x = i - 2^{r_i} + 1}^{i} \sum_{y = j - 2^{r_j} + 1}^{j} A[x][y]
\]</span></p>
<p>where <span class="math inline">\(r_i\)</span> and <span class="math inline">\(r_j\)</span> denote the least significant bit (LSB) of <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.</p>
<section id="update-rule" class="level4">
<h4 class="anchored" data-anchor-id="update-rule">Update Rule</h4>
<p>When updating <span class="math inline">\((x, y)\)</span> by <span class="math inline">\(v\)</span>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb289"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(x, n<span class="op">+</span><span class="dv">1</span>, i <span class="op">&amp;</span> <span class="op">-</span>i):</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(y, m<span class="op">+</span><span class="dv">1</span>, j <span class="op">&amp;</span> <span class="op">-</span>j):</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>        tree[i][j] <span class="op">+=</span> v</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="query-rule" class="level4">
<h4 class="anchored" data-anchor-id="query-rule">Query Rule</h4>
<p>To compute prefix sum <span class="math inline">\((1,1)\)</span> to <span class="math inline">\((x,y)\)</span>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb290"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(x, <span class="dv">0</span>, <span class="op">-</span>i <span class="op">&amp;</span> <span class="op">-</span>i):</span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(y, <span class="dv">0</span>, <span class="op">-</span>j <span class="op">&amp;</span> <span class="op">-</span>j):</span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>        res <span class="op">+=</span> tree[i][j]</span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> res</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="range-query-1" class="level4">
<h4 class="anchored" data-anchor-id="range-query-1">Range Query</h4>
<p>Sum of submatrix <span class="math inline">\([(x_1,y_1),(x_2,y_2)]\)</span>:</p>
<p><span class="math display">\[
S = Q(x_2, y_2) - Q(x_1-1, y_2) - Q(x_2, y_1-1) + Q(x_1-1, y_1-1)
\]</span></p>
</section>
</section>
<section id="example-43" class="level3">
<h3 class="anchored" data-anchor-id="example-43">Example</h3>
<p>Given a <span class="math inline">\(4 \times 4\)</span> matrix:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\(x/y\)</span></th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>0</td>
</tr>
<tr class="even">
<td>4</td>
<td>4</td>
<td>0</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Build Fenwick 2D Tree, then query sum in submatrix <span class="math inline">\([2,2]\)</span> to <span class="math inline">\([3,3]\)</span>.</p>
<p>Expected result:</p>
<p><span class="math display">\[
A[2][2] + A[2][3] + A[3][2] + A[3][3] = 2 + 3 + 1 + 2 = 8
\]</span></p>
</section>
<section id="step-by-step-update-example" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-update-example">Step-by-Step Update Example</h3>
<p>Suppose we add <span class="math inline">\(v = 5\)</span> at <span class="math inline">\((2, 3)\)</span>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 26%">
<col style="width: 18%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th><span class="math inline">\((i,j)\)</span> Updated</th>
<th>Added Value</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><span class="math inline">\((2,3)\)</span></td>
<td>+5</td>
<td>Base position</td>
</tr>
<tr class="even">
<td>2</td>
<td><span class="math inline">\((2,4)\)</span></td>
<td>+5</td>
<td>Next by <span class="math inline">\(j += j \&amp; -j\)</span></td>
</tr>
<tr class="odd">
<td>3</td>
<td><span class="math inline">\((4,3)\)</span></td>
<td>+5</td>
<td>Next by <span class="math inline">\(i += i \&amp; -i\)</span></td>
</tr>
<tr class="even">
<td>4</td>
<td><span class="math inline">\((4,4)\)</span></td>
<td>+5</td>
<td>Both indices propagate upward</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-python-like-pseudocode-1" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-like-pseudocode-1">Tiny Code (Python-like Pseudocode)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb291"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fenwick2D:</span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n, m):</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n, <span class="va">self</span>.m <span class="op">=</span> n, m</span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tree <span class="op">=</span> [[<span class="dv">0</span>]<span class="op">*</span>(m<span class="op">+</span><span class="dv">1</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n<span class="op">+</span><span class="dv">1</span>)]</span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update(<span class="va">self</span>, x, y, val):</span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> x</span>
<span id="cb291-8"><a href="#cb291-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;=</span> <span class="va">self</span>.n:</span>
<span id="cb291-9"><a href="#cb291-9" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> y</span>
<span id="cb291-10"><a href="#cb291-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> j <span class="op">&lt;=</span> <span class="va">self</span>.m:</span>
<span id="cb291-11"><a href="#cb291-11" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.tree[i][j] <span class="op">+=</span> val</span>
<span id="cb291-12"><a href="#cb291-12" aria-hidden="true" tabindex="-1"></a>                j <span class="op">+=</span> j <span class="op">&amp;</span> <span class="op">-</span>j</span>
<span id="cb291-13"><a href="#cb291-13" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> i <span class="op">&amp;</span> <span class="op">-</span>i</span>
<span id="cb291-14"><a href="#cb291-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-15"><a href="#cb291-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> query(<span class="va">self</span>, x, y):</span>
<span id="cb291-16"><a href="#cb291-16" aria-hidden="true" tabindex="-1"></a>        res <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb291-17"><a href="#cb291-17" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> x</span>
<span id="cb291-18"><a href="#cb291-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb291-19"><a href="#cb291-19" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> y</span>
<span id="cb291-20"><a href="#cb291-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> j <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb291-21"><a href="#cb291-21" aria-hidden="true" tabindex="-1"></a>                res <span class="op">+=</span> <span class="va">self</span>.tree[i][j]</span>
<span id="cb291-22"><a href="#cb291-22" aria-hidden="true" tabindex="-1"></a>                j <span class="op">-=</span> j <span class="op">&amp;</span> <span class="op">-</span>j</span>
<span id="cb291-23"><a href="#cb291-23" aria-hidden="true" tabindex="-1"></a>            i <span class="op">-=</span> i <span class="op">&amp;</span> <span class="op">-</span>i</span>
<span id="cb291-24"><a href="#cb291-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> res</span>
<span id="cb291-25"><a href="#cb291-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-26"><a href="#cb291-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> range_sum(<span class="va">self</span>, x1, y1, x2, y2):</span>
<span id="cb291-27"><a href="#cb291-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.query(x2, y2) <span class="op">-</span> <span class="va">self</span>.query(x1<span class="op">-</span><span class="dv">1</span>, y2)</span>
<span id="cb291-28"><a href="#cb291-28" aria-hidden="true" tabindex="-1"></a>                <span class="op">-</span> <span class="va">self</span>.query(x2, y1<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> <span class="va">self</span>.query(x1<span class="op">-</span><span class="dv">1</span>, y1<span class="op">-</span><span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-94" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-94">Why It Matters</h3>
<p>2D Fenwick Trees are lightweight, dynamic structures for prefix sums and submatrix queries. They’re widely used in:</p>
<ul>
<li>Image processing (integral image updates)</li>
<li>Grid-based dynamic programming</li>
<li>Competitive programming for 2D range queries</li>
</ul>
<p>They trade slightly higher code complexity for excellent update-query efficiency.</p>
</section>
<section id="a-gentle-proof-why-it-works-93" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-93">A Gentle Proof (Why It Works)</h3>
<p>Each update/query operation performs <span class="math inline">\(\log n\)</span> steps on <span class="math inline">\(x\)</span> and <span class="math inline">\(\log m\)</span> on <span class="math inline">\(y\)</span>:</p>
<p><span class="math display">\[
T(n,m) = O(\log n \cdot \log m)
\]</span></p>
<p>Each level adds contributions from subregions determined by LSB decomposition, ensuring every cell contributes exactly once to the query sum.</p>
</section>
<section id="try-it-yourself-94" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-94">Try It Yourself</h3>
<ol type="1">
<li>Initialize <span class="math inline">\(4 \times 4\)</span> Fenwick 2D.</li>
<li>Add <span class="math inline">\(5\)</span> to <span class="math inline">\((2,3)\)</span>.</li>
<li>Query sum <span class="math inline">\((1,1)\)</span> to <span class="math inline">\((2,3)\)</span>.</li>
<li>Verify it matches manual computation.</li>
</ol>
</section>
<section id="test-cases-93" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-93">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Matrix (Partial)</th>
<th>Update</th>
<th>Query Rectangle</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\([ [2,1,0],[1,2,3],[0,1,2] ]\)</span></td>
<td><span class="math inline">\((2,3)+5\)</span></td>
<td><span class="math inline">\([1,1]\)</span>–<span class="math inline">\([2,3]\)</span></td>
<td>14</td>
</tr>
<tr class="even">
<td><span class="math inline">\([ [1,1,1],[1,1,1],[1,1,1] ]\)</span></td>
<td><span class="math inline">\((3,3)+2\)</span></td>
<td><span class="math inline">\([2,2]\)</span>–<span class="math inline">\([3,3]\)</span></td>
<td>5</td>
</tr>
<tr class="odd">
<td><span class="math inline">\([ [4,0],[0,4] ]\)</span></td>
<td>,</td>
<td><span class="math inline">\([1,1]\)</span>–<span class="math inline">\([2,2]\)</span></td>
<td>8</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-94" class="level3">
<h3 class="anchored" data-anchor-id="complexity-94">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Update</td>
<td><span class="math inline">\(O(\log n \cdot \log m)\)</span></td>
<td><span class="math inline">\(O(nm)\)</span></td>
</tr>
<tr class="even">
<td>Query</td>
<td><span class="math inline">\(O(\log n \cdot \log m)\)</span></td>
<td>,</td>
</tr>
</tbody>
</table>
<p>The 2D Fenwick Tree is an elegant bridge between prefix sums and spatial queries, simple, powerful, and efficient for dynamic 2D grids.</p>
</section>
<section id="treap-splitmerge" class="level3">
<h3 class="anchored" data-anchor-id="treap-splitmerge">299 Treap Split/Merge</h3>
<p>A Treap Split/Merge algorithm allows you to divide and combine treaps (randomized balanced binary search trees) efficiently, using priority-based rotations and key-based ordering. This is the foundation for range operations like splits, merges, range updates, and segment queries on implicit treaps.</p>
</section>
<section id="what-problem-are-we-solving-95" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-95">What Problem Are We Solving?</h3>
<p>We often need to:</p>
<ol type="1">
<li><p>Split a treap into two parts:</p>
<ul>
<li>All keys <span class="math inline">\(\le k\)</span> go to the left treap</li>
<li>All keys <span class="math inline">\(&gt; k\)</span> go to the right treap</li>
</ul></li>
<li><p>Merge two treaps <span class="math inline">\(T_1\)</span> and <span class="math inline">\(T_2\)</span> where all keys in <span class="math inline">\(T_1 &lt; T_2\)</span></p></li>
</ol>
<p>These operations enable efficient range queries, persistent edits, and order-statistics while maintaining balanced height.</p>
</section>
<section id="how-it-works-plain-language-56" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-56">How It Works (Plain Language)</h3>
<p>Treaps combine two properties:</p>
<ul>
<li>BST Property: Left &lt; Root &lt; Right</li>
<li>Heap Property: Node priority &gt; children priorities</li>
</ul>
<p>Split and merge rely on recursive descent guided by key and priority.</p>
<section id="split-operation" class="level4">
<h4 class="anchored" data-anchor-id="split-operation">Split Operation</h4>
<p>Split treap <span class="math inline">\(T\)</span> by key <span class="math inline">\(k\)</span>:</p>
<ul>
<li>If <span class="math inline">\(T.key \le k\)</span>, split <span class="math inline">\(T.right\)</span> into <span class="math inline">\((t2a, t2b)\)</span> and set <span class="math inline">\(T.right = t2a\)</span></li>
<li>Else, split <span class="math inline">\(T.left\)</span> into <span class="math inline">\((t1a, t1b)\)</span> and set <span class="math inline">\(T.left = t1b\)</span></li>
</ul>
<p>Return <span class="math inline">\((T.left, T.right)\)</span></p>
</section>
<section id="merge-operation" class="level4">
<h4 class="anchored" data-anchor-id="merge-operation">Merge Operation</h4>
<p>Merge <span class="math inline">\(T_1\)</span> and <span class="math inline">\(T_2\)</span>:</p>
<ul>
<li>If <span class="math inline">\(T_1.priority &gt; T_2.priority\)</span>, set <span class="math inline">\(T_1.right = \text{merge}(T_1.right, T_2)\)</span></li>
<li>Else, set <span class="math inline">\(T_2.left = \text{merge}(T_1, T_2.left)\)</span></li>
</ul>
<p>Return new root.</p>
</section>
</section>
<section id="example-44" class="level3">
<h3 class="anchored" data-anchor-id="example-44">Example</h3>
<p>Suppose we have treap with keys: <span class="math display">\[ [1, 2, 3, 4, 5, 6, 7] \]</span></p>
<section id="split-by-k-4" class="level4">
<h4 class="anchored" data-anchor-id="split-by-k-4">Split by <span class="math inline">\(k = 4\)</span>:</h4>
<p>Left Treap: <span class="math inline">\([1, 2, 3, 4]\)</span> Right Treap: <span class="math inline">\([5, 6, 7]\)</span></p>
<p>Now, merge them back restores original order.</p>
</section>
</section>
<section id="step-by-step-split-example" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-split-example">Step-by-Step Split Example</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Node Key</th>
<th>Compare to <span class="math inline">\(k=4\)</span></th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>4</td>
<td><span class="math inline">\(\le\)</span> 4</td>
<td>Go right</td>
</tr>
<tr class="even">
<td>2</td>
<td>5</td>
<td><span class="math inline">\(&gt;\)</span> 4</td>
<td>Split left subtree</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5.left=∅$</td>
<td>return (null,5)</td>
<td>Combine back</td>
</tr>
</tbody>
</table>
<p>Result: left = <span class="math inline">\([1,2,3,4]\)</span>, right = <span class="math inline">\([5,6,7]\)</span></p>
</section>
<section id="tiny-code-python-like-pseudocode-2" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-like-pseudocode-2">Tiny Code (Python-like Pseudocode)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb292"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key):</span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.key <span class="op">=</span> key</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.priority <span class="op">=</span> random.random()</span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> <span class="va">None</span></span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> <span class="va">None</span></span>
<span id="cb292-9"><a href="#cb292-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-10"><a href="#cb292-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split(root, key):</span>
<span id="cb292-11"><a href="#cb292-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> root:</span>
<span id="cb292-12"><a href="#cb292-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">None</span>, <span class="va">None</span>)</span>
<span id="cb292-13"><a href="#cb292-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> root.key <span class="op">&lt;=</span> key:</span>
<span id="cb292-14"><a href="#cb292-14" aria-hidden="true" tabindex="-1"></a>        left, right <span class="op">=</span> split(root.right, key)</span>
<span id="cb292-15"><a href="#cb292-15" aria-hidden="true" tabindex="-1"></a>        root.right <span class="op">=</span> left</span>
<span id="cb292-16"><a href="#cb292-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (root, right)</span>
<span id="cb292-17"><a href="#cb292-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb292-18"><a href="#cb292-18" aria-hidden="true" tabindex="-1"></a>        left, right <span class="op">=</span> split(root.left, key)</span>
<span id="cb292-19"><a href="#cb292-19" aria-hidden="true" tabindex="-1"></a>        root.left <span class="op">=</span> right</span>
<span id="cb292-20"><a href="#cb292-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (left, root)</span>
<span id="cb292-21"><a href="#cb292-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-22"><a href="#cb292-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge(t1, t2):</span>
<span id="cb292-23"><a href="#cb292-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> t1 <span class="kw">or</span> <span class="kw">not</span> t2:</span>
<span id="cb292-24"><a href="#cb292-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> t1 <span class="kw">or</span> t2</span>
<span id="cb292-25"><a href="#cb292-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> t1.priority <span class="op">&gt;</span> t2.priority:</span>
<span id="cb292-26"><a href="#cb292-26" aria-hidden="true" tabindex="-1"></a>        t1.right <span class="op">=</span> merge(t1.right, t2)</span>
<span id="cb292-27"><a href="#cb292-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> t1</span>
<span id="cb292-28"><a href="#cb292-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb292-29"><a href="#cb292-29" aria-hidden="true" tabindex="-1"></a>        t2.left <span class="op">=</span> merge(t1, t2.left)</span>
<span id="cb292-30"><a href="#cb292-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> t2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-95" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-95">Why It Matters</h3>
<p>Treap split/merge unlocks flexible sequence manipulation and range-based operations:</p>
<ul>
<li>Range sum / min / max queries</li>
<li>Insert or delete in <span class="math inline">\(O(\log n)\)</span></li>
<li>Persistent or implicit treaps for lists</li>
<li>Lazy propagation for intervals</li>
</ul>
<p>It’s a key building block in functional and competitive programming data structures.</p>
</section>
<section id="a-gentle-proof-why-it-works-94" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-94">A Gentle Proof (Why It Works)</h3>
<p>Each split or merge operation traverses down the height of the treap. Since treaps are expected balanced, height is <span class="math inline">\(O(\log n)\)</span>.</p>
<ul>
<li>Split correctness: Each recursive call preserves BST ordering.</li>
<li>Merge correctness: Maintains heap property since highest priority becomes root.</li>
</ul>
<p>Thus, both return valid treaps.</p>
</section>
<section id="try-it-yourself-95" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-95">Try It Yourself</h3>
<ol type="1">
<li>Build treap with keys <span class="math inline">\([1..7]\)</span>.</li>
<li>Split by <span class="math inline">\(k=4\)</span>.</li>
<li>Print inorder traversals of both sub-treaps.</li>
<li>Merge back. Confirm structure matches original.</li>
</ol>
</section>
<section id="test-cases-94" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-94">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Input Keys</th>
<th>Split Key</th>
<th>Left Treap Keys</th>
<th>Right Treap Keys</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1,2,3,4,5,6,7]</td>
<td>4</td>
<td>[1,2,3,4]</td>
<td>[5,6,7]</td>
</tr>
<tr class="even">
<td>[10,20,30,40]</td>
<td>25</td>
<td>[10,20]</td>
<td>[30,40]</td>
</tr>
<tr class="odd">
<td>[5,10,15,20]</td>
<td>5</td>
<td>[5]</td>
<td>[10,15,20]</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-95" class="level3">
<h3 class="anchored" data-anchor-id="complexity-95">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Split</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
</tr>
<tr class="even">
<td>Merge</td>
<td><span class="math inline">\(O(\log n)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
</tr>
</tbody>
</table>
<p>Treap Split/Merge is the elegant heart of many dynamic set and sequence structures, one key, one random priority, two simple operations, infinite flexibility.</p>
</section>
<section id="mos-algorithm-on-tree" class="level3">
<h3 class="anchored" data-anchor-id="mos-algorithm-on-tree">300 Mo’s Algorithm on Tree</h3>
<p>Mo’s Algorithm on Tree is an extension of the classical Mo’s algorithm used on arrays. It allows efficient processing of offline queries on trees, especially those involving subtrees or paths, by converting them into a linear order (Euler tour) and then applying a square root decomposition strategy.</p>
</section>
<section id="what-problem-are-we-solving-96" class="level3">
<h3 class="anchored" data-anchor-id="what-problem-are-we-solving-96">What Problem Are We Solving?</h3>
<p>When you need to answer multiple queries like:</p>
<ul>
<li>“How many distinct values are in the subtree of node <span class="math inline">\(u\)</span>?”</li>
<li>“What is the sum over the path from <span class="math inline">\(u\)</span> to <span class="math inline">\(v\)</span>?”</li>
</ul>
<p>A naive approach may require <span class="math inline">\(O(n)\)</span> traversal per query, leading to <span class="math inline">\(O(nq)\)</span> total complexity. Mo’s algorithm on trees reduces this to approximately <span class="math inline">\(O((n + q)\sqrt{n})\)</span>, by reusing results from nearby queries.</p>
</section>
<section id="how-it-works-plain-language-57" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works-plain-language-57">How It Works (Plain Language)</h3>
<ol type="1">
<li><p>Euler Tour Flattening Transform the tree into a linear array using an Euler tour. Each node’s first appearance marks its position in the linearized sequence.</p></li>
<li><p>Query Transformation</p>
<ul>
<li>For subtree queries, a subtree becomes a continuous range in the Euler array.</li>
<li>For path queries, break into two subranges and handle Least Common Ancestor (LCA) separately.</li>
</ul></li>
<li><p>Mo’s Ordering Sort queries by:</p>
<ul>
<li>Block of left endpoint (using <span class="math inline">\(\text{block} = \lfloor L / \sqrt{N} \rfloor\)</span>)</li>
<li>Right endpoint (ascending or alternating per block)</li>
</ul></li>
<li><p>Add/Remove Function Maintain a frequency map or running result as the window moves.</p></li>
</ol>
</section>
<section id="example-45" class="level3">
<h3 class="anchored" data-anchor-id="example-45">Example</h3>
<p>Given a tree:</p>
<pre><code>1
├── 2
│   ├── 4
│   └── 5
└── 3</code></pre>
<p>Euler Tour: <code>[1, 2, 4, 4, 5, 5, 2, 3, 3, 1]</code></p>
<p>Subtree(2): Range covering <code>[2, 4, 4, 5, 5, 2]</code></p>
<p>Each subtree query becomes a range query over the Euler array. Mo’s algorithm processes ranges efficiently in sorted order.</p>
</section>
<section id="step-by-step-example-10" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-example-10">Step-by-Step Example</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Query (L,R)</th>
<th>Current Range</th>
<th>Add/Remove</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>(2,6)</td>
<td>[2,6]</td>
<td>+4,+5</td>
<td>Count=2</td>
</tr>
<tr class="even">
<td>2</td>
<td>(2,8)</td>
<td>[2,8]</td>
<td>+3</td>
<td>Count=3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>(1,6)</td>
<td>[1,6]</td>
<td>-3,+1</td>
<td>Count=3</td>
</tr>
</tbody>
</table>
<p>Each query is answered by incremental adjustment, not recomputation.</p>
</section>
<section id="tiny-code-python-like-pseudocode-3" class="level3">
<h3 class="anchored" data-anchor-id="tiny-code-python-like-pseudocode-3">Tiny Code (Python-like Pseudocode)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb294"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocessing</span></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> euler_tour(u, p, g, order):</span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a>    order.append(u)</span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> g[u]:</span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">!=</span> p:</span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a>            euler_tour(v, u, g, order)</span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a>            order.append(u)</span>
<span id="cb294-10"><a href="#cb294-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-11"><a href="#cb294-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Mo's structure</span></span>
<span id="cb294-12"><a href="#cb294-12" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Query:</span>
<span id="cb294-13"><a href="#cb294-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, l, r, idx):</span>
<span id="cb294-14"><a href="#cb294-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l, <span class="va">self</span>.r, <span class="va">self</span>.idx <span class="op">=</span> l, r, idx</span>
<span id="cb294-15"><a href="#cb294-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-16"><a href="#cb294-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mo_on_tree(n, queries, order, value):</span>
<span id="cb294-17"><a href="#cb294-17" aria-hidden="true" tabindex="-1"></a>    block <span class="op">=</span> <span class="bu">int</span>(math.sqrt(<span class="bu">len</span>(order)))</span>
<span id="cb294-18"><a href="#cb294-18" aria-hidden="true" tabindex="-1"></a>    queries.sort(key<span class="op">=</span><span class="kw">lambda</span> q: (q.l <span class="op">//</span> block, q.r))</span>
<span id="cb294-19"><a href="#cb294-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-20"><a href="#cb294-20" aria-hidden="true" tabindex="-1"></a>    freq <span class="op">=</span> [<span class="dv">0</span>]<span class="op">*</span>(n<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb294-21"><a href="#cb294-21" aria-hidden="true" tabindex="-1"></a>    answer <span class="op">=</span> [<span class="dv">0</span>]<span class="op">*</span><span class="bu">len</span>(queries)</span>
<span id="cb294-22"><a href="#cb294-22" aria-hidden="true" tabindex="-1"></a>    cur <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb294-23"><a href="#cb294-23" aria-hidden="true" tabindex="-1"></a>    L, R <span class="op">=</span> <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span></span>
<span id="cb294-24"><a href="#cb294-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-25"><a href="#cb294-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(pos):</span>
<span id="cb294-26"><a href="#cb294-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">nonlocal</span> cur</span>
<span id="cb294-27"><a href="#cb294-27" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> order[pos]</span>
<span id="cb294-28"><a href="#cb294-28" aria-hidden="true" tabindex="-1"></a>        freq[node] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb294-29"><a href="#cb294-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> freq[node] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb294-30"><a href="#cb294-30" aria-hidden="true" tabindex="-1"></a>            cur <span class="op">+=</span> value[node]</span>
<span id="cb294-31"><a href="#cb294-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-32"><a href="#cb294-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> remove(pos):</span>
<span id="cb294-33"><a href="#cb294-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">nonlocal</span> cur</span>
<span id="cb294-34"><a href="#cb294-34" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> order[pos]</span>
<span id="cb294-35"><a href="#cb294-35" aria-hidden="true" tabindex="-1"></a>        freq[node] <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb294-36"><a href="#cb294-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> freq[node] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb294-37"><a href="#cb294-37" aria-hidden="true" tabindex="-1"></a>            cur <span class="op">-=</span> value[node]</span>
<span id="cb294-38"><a href="#cb294-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-39"><a href="#cb294-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> q <span class="kw">in</span> queries:</span>
<span id="cb294-40"><a href="#cb294-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> L <span class="op">&gt;</span> q.l:</span>
<span id="cb294-41"><a href="#cb294-41" aria-hidden="true" tabindex="-1"></a>            L <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb294-42"><a href="#cb294-42" aria-hidden="true" tabindex="-1"></a>            add(L)</span>
<span id="cb294-43"><a href="#cb294-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> R <span class="op">&lt;</span> q.r:</span>
<span id="cb294-44"><a href="#cb294-44" aria-hidden="true" tabindex="-1"></a>            R <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb294-45"><a href="#cb294-45" aria-hidden="true" tabindex="-1"></a>            add(R)</span>
<span id="cb294-46"><a href="#cb294-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> L <span class="op">&lt;</span> q.l:</span>
<span id="cb294-47"><a href="#cb294-47" aria-hidden="true" tabindex="-1"></a>            remove(L)</span>
<span id="cb294-48"><a href="#cb294-48" aria-hidden="true" tabindex="-1"></a>            L <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb294-49"><a href="#cb294-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> R <span class="op">&gt;</span> q.r:</span>
<span id="cb294-50"><a href="#cb294-50" aria-hidden="true" tabindex="-1"></a>            remove(R)</span>
<span id="cb294-51"><a href="#cb294-51" aria-hidden="true" tabindex="-1"></a>            R <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb294-52"><a href="#cb294-52" aria-hidden="true" tabindex="-1"></a>        answer[q.idx] <span class="op">=</span> cur</span>
<span id="cb294-53"><a href="#cb294-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> answer</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-96" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-96">Why It Matters</h3>
<ul>
<li>Converts tree queries into range queries efficiently</li>
<li>Reuses computation by sliding window technique</li>
<li>Useful for frequency, sum, or distinct count queries</li>
<li>Supports subtree queries, path queries (with LCA handling), and color-based queries</li>
</ul>
</section>
<section id="a-gentle-proof-why-it-works-95" class="level3">
<h3 class="anchored" data-anchor-id="a-gentle-proof-why-it-works-95">A Gentle Proof (Why It Works)</h3>
<ol type="1">
<li>Euler Tour guarantees every subtree is a contiguous range.</li>
<li>Mo’s algorithm ensures total number of add/remove operations is <span class="math inline">\(O((n + q)\sqrt{n})\)</span>.</li>
<li>Combining them, each query is handled incrementally within logarithmic amortized cost.</li>
</ol>
<p>Thus, offline complexity is sublinear per query.</p>
</section>
<section id="try-it-yourself-96" class="level3">
<h3 class="anchored" data-anchor-id="try-it-yourself-96">Try It Yourself</h3>
<ol type="1">
<li>Build Euler tour for tree of 7 nodes.</li>
<li>Write subtree queries for nodes <span class="math inline">\(2,3,4\)</span>.</li>
<li>Sort queries by block order.</li>
<li>Implement add/remove logic to count distinct colors or sums.</li>
<li>Compare performance with naive DFS per query.</li>
</ol>
</section>
<section id="test-cases-95" class="level3">
<h3 class="anchored" data-anchor-id="test-cases-95">Test Cases</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Nodes</th>
<th>Query</th>
<th>Expected Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1-2-3-4-5]</td>
<td>Subtree(2)</td>
<td>Sum or count over nodes 2–5</td>
</tr>
<tr class="even">
<td>[1: {2,3}, 2:{4,5}]</td>
<td>Subtree(1)</td>
<td>All nodes</td>
</tr>
<tr class="odd">
<td>[1-2,1-3]</td>
<td>Path(2,3)</td>
<td>LCA=1 handled separately</td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-96" class="level3">
<h3 class="anchored" data-anchor-id="complexity-96">Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time</th>
<th>Space</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Preprocessing (Euler)</td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
<tr class="even">
<td>Query Sorting</td>
<td><span class="math inline">\(O(q \log q)\)</span></td>
<td><span class="math inline">\(O(q)\)</span></td>
</tr>
<tr class="odd">
<td>Processing</td>
<td><span class="math inline">\(O((n + q)\sqrt{n})\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
</tr>
</tbody>
</table>
<p>Mo’s Algorithm on Tree is the elegant meeting point of graph traversal, offline range query, and amortized optimization, bringing sublinear query handling to complex hierarchical data.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../books/en-us/list-2.html" class="pagination-link" aria-label="Chapter 2. Sorting and searching">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Chapter 2. Sorting and searching</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>